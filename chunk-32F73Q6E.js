import{a as Ie}from"./chunk-6DHKY676.js";import{a as Re}from"./chunk-TUGZBXQ2.js";import{a as _e}from"./chunk-HXJSXSXG.js";import{a as ue,c as ve}from"./chunk-P62NUZ5D.js";import{Ea as x,Ia as Le,N as he,R as fe,Ra as we,Sa as Me,m as ye,n as B,pb as T,qb as xe,sa as Se,ta as ge,ya as be}from"./chunk-WHEH4KMJ.js";import{m as de,n as I,s as R,u as _,v as Ce}from"./chunk-RM6VSO6X.js";import{a as pe,b as me}from"./chunk-63YDUDD6.js";import{$a as W,Dc as re,E as d,Ec as oe,Fc as ie,G as u,Ga as A,Gc as ae,Hc as se,I as D,Ic as ne,J as O,Kc as ce,Oa as Z,P as v,Ra as z,S as X,X as p,Y as S,Ya as k,Z as y,a as E,ba as F,dc as ee,ec as te,hd as le,k as U,la as g,m as Y,mb as Q,q as j,sa as q,xb as J,yb as K}from"./chunk-G5LJQFAD.js";import"./chunk-FJYW2LMB.js";var Te=(n,Ge,r,o,t)=>{let i=[],a=80;r>1&&(a=40),r>2&&(a=20),r>3&&(a=10),r>4&&(a=6),r>5&&(a=4),r>6&&(a=3),r>7&&(a=2),r>8&&(a=1);let c=Ge*a,e=10;e>10&&(e=10),t=ye(t,c);let s=n[0]+e,l=n[1]+e,m=n[2]-e,b=n[3]-e,L=m-s,h=b-l,f=Math.floor(L/c),C=Math.floor(h/c),w=s;for(let G=f;G>0;G--){let M=l;for(let V=C;V>0;V--){let N=w+c,P=M+c,$=[w,M],Ve=[[$,[w,P],[N,P],[N,M],$]];if(B(t,w,M)&&B(t,N,P)){let Ne=new he(Ve).transform("EPSG:4326",o),Pe=new be({geometry:Ne,column:G,row:V,id:i.length+1});i.push(Pe)}M+=c}w+=c}return i};Z.addIcons(J,W,K,Q);var H=(()=>{class n{constructor(r,o,t,i,a,c){this.layersSvc=r,this.mapStateSvc=o,this.mapSvc=t,this.alertSvc=i,this.progressService=a,this.route=c,this.class="content-container floating",this.subs=[],this.startBbox=null,this.updateLayerOnZoom=()=>{let e=this.getGridLayer(),s=this.layersSvc.getLayerById(e.id);s&&(s.custom_layer=e.layer,this.layersSvc.updateLayer(s,s.filtertype))},this.getGridLayer=()=>{let e=this.mapStateSvc.getMapState().getValue(),s=e.extent,l=e.zoom,m="gridLayer",h=Te([-180,-90,180,90],.5,l,this.mapSvc.EPSG,s),f=new Le({features:h,wrapX:!1}),C=new Re({source:f});return C.set("id",m),{layer:C,id:m}},this.controls={attribution:!0,scaleLine:!0}}ngOnInit(){this.addLayers(),this.subscribeToLayers(),this.subscribeToMapState(),this.subscribeToRoute(),this.startBbox&&this.mapStateSvc.setExtent(this.startBbox)}ngAfterViewInit(){this.mapSvc.map.on("moveend",this.updateLayerOnZoom)}ngOnDestroy(){this.subs.map(r=>r.unsubscribe()),this.mapSvc.map.un("moveend",this.updateLayerOnZoom)}addLayers(){let r=new ue({visible:!1}),o=new ve({visible:!0,tileSize:512}),t=new Me({url:"https://ahocevar.com/geoserver/wms",params:{LAYERS:"topp:states"},serverType:"geoserver"});t.on("imageloadstart",()=>{this.progressService.progress({indeterminate:!0})}),t.on("imageloadend",()=>{this.progressService.progress(null)}),t.on("imageloaderror",()=>{this.progressService.progress(null)});let i=new I({id:"event_layer",name:"Image load Layer",type:"custom",custom_layer:new Se({source:t}),visible:!1,bbox:[-133.9453125,18.979025953255267,-60.46875,52.908902047770255]}),a=new de({id:"updatable_feature_layer",name:"Updatable feature layer",type:"geojson",visible:!1,data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-192.48046875,-24.686952411999144],[-88.06640625,-24.686952411999144],[-88.06640625,50.28933925329178],[-192.48046875,50.28933925329178],[-192.48046875,-24.686952411999144]]]}}]},actions:[{action:l=>{a.data=_e,this.layersSvc.updateLayer(a)},icon:"download",title:"Load data"}]}),c=this.getGridLayer(),e=new I({id:c.id,name:"gridLayer",type:"custom",opacity:.3,custom_layer:c.layer});[o,r,i,a,e].forEach(l=>this.layersSvc.addLayer(l,"Layers"))}removeLayer(){this.layersSvc.removeLayerOrGroupById("event_layer2")}addLayer(){let r=new E,o=new E,t=new ge({source:new we({url:"https://geoservice.dlr.de/eoc/land/wms",params:{LAYERS:"GUF28_DLR_v1_Mosaic"}})}),i=e=>{var s=e.context,l=this.mapSvc.map.getSize(),m=l[0]*(50/100),b=x(e,[m,0]),L=x(e,[l[0],0]),h=x(e,[m,l[1]]),f=x(e,l);s.save(),s.beginPath(),s.moveTo(b[0],b[1]),s.lineTo(h[0],h[1]),s.lineTo(f[0],f[1]),s.lineTo(L[0],L[1]),s.closePath(),s.clip()},a=e=>{e.context.restore()};t.on("prerender",e=>{i(e)}),t.on("postrender",e=>{a(e)});let c=new I({id:"event_layer2",name:"Image load Layer 2",type:"custom",custom_layer:new fe({layers:[t]}),visible:!0,removable:!0,events:{source:[{event:"tileloadstart",listener:e=>{r.next(e)}},{event:"tileloadend",listener:e=>{o.next(e)}}],layer:[{event:"prerender",listener:e=>{i(e)}},{event:"postrender",listener:e=>{i(e)}}]}});r.subscribe(e=>this.progressService.progress({indeterminate:!0})),o.pipe(U(200)).subscribe(e=>this.progressService.progress(null)),this.layersSvc.addLayer(c,"Layers")}getSearchParamsHashRouting(r=window.location.href){r.indexOf("http")===-1&&(r=new URL(r,`${window.location.origin}${window.location.pathname}`).toString());let o=new URL(window.location.href,window.location.origin),[t,i]=o.hash.split("?"),a=new URLSearchParams;return i&&(a=new URLSearchParams(i)),{query:a,urlHashRouting:o,hash:t}}updateSearchParamsHashRouting(r){let{query:o,urlHashRouting:t,hash:i}=this.getSearchParamsHashRouting();Object.keys(r).map(e=>{o.set(e,r[e])});let a=decodeURIComponent(`${o}`);return`${t.protocol}//${t.host}${t.pathname||"/"}${i||"#/"}?${a}`}subscribeToMapState(){let r=this.mapStateSvc.getMapState().subscribe(o=>{if(history.pushState){let t=o.extent.map(a=>a.toFixed(3)),i=this.updateSearchParamsHashRouting({bbox:t.join(","),zoom:o.zoom.toString()});window.history.pushState({path:i},"",i)}});this.subs.push(r)}subscribeToRoute(){let r=this.route.queryParams.pipe(Y()).subscribe(o=>{if(Object.keys(o).length>0&&o.bbox){let t=o.bbox.split(",").map(i=>parseFloat(i));t.length===4&&(this.startBbox=t)}});this.subs.push(r)}subscribeToLayers(){if(this.layersSvc){let r=this.layersSvc.getLayers().subscribe(o=>{o.filter(i=>i.visible===!0).forEach(i=>{i.id==="updatable_feature_layer"&&i.data.features.length<=1&&this.alertSvc.alert({type:"info",text:"Click the layer setting down arrow icon to load new features.",closeable:!0})})});this.subs.push(r)}}static{this.\u0275fac=function(o){return new(o||n)(u(R),u(_),u(T),u(pe),u(me),u(z))}}static{this.\u0275cmp=D({type:n,selectors:[["app-route-map3"]],hostVars:2,hostBindings:function(o,t){o&2&&X(t.class)},features:[q([R,_,T])],decls:21,vars:10,consts:[[1,"content-area","map-view"],["id","olMap",3,"layersSvc","mapState","controls"],[1,"right",3,"clrVerticalNavCollapsible","clr-nav-level"],[1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","layers","clrVerticalNavIcon","","title","layers"],[1,"padding","title-ellipsis"],[3,"layersSvc","mapStateSvc"],["title","Coordinates",1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","compass","clrVerticalNavIcon",""],["title","Test",1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","cog","clrVerticalNavIcon",""],[1,"btn","btn-primary",3,"click"]],template:function(o,t){o&1&&(p(0,"main",0),y(1,"ukis-map-ol",1),S(),p(2,"clr-vertical-nav",2)(3,"clr-vertical-nav-group",3),y(4,"cds-icon",4),g(5," Layers "),p(6,"clr-vertical-nav-group-children",5),y(7,"ukis-layer-control",6),S()(),p(8,"clr-vertical-nav-group",7),y(9,"cds-icon",8),g(10," Coordinates "),p(11,"clr-vertical-nav-group-children",5),y(12,"ukis-mouse-position"),S()(),p(13,"clr-vertical-nav-group",9),y(14,"cds-icon",10),g(15," Test "),p(16,"clr-vertical-nav-group-children",5)(17,"button",11),F("click",function(){return t.removeLayer()}),g(18,"remove Layer"),S(),p(19,"button",11),F("click",function(){return t.addLayer()}),g(20,"add Layer"),S()()()()),o&2&&(d(),v("layersSvc",t.layersSvc)("mapState",t.mapStateSvc)("controls",t.controls),d(),v("clrVerticalNavCollapsible",!0)("clr-nav-level",2),d(),v("clrVerticalNavGroupExpanded",!0),d(4),v("layersSvc",t.layersSvc)("mapStateSvc",t.mapStateSvc),d(),v("clrVerticalNavGroupExpanded",!1),d(5),v("clrVerticalNavGroupExpanded",!0))},dependencies:[xe,ce,ie,ae,se,ne,ee,oe,re,te,Ce,Ie],encapsulation:2})}}return n})();var je=[{path:"",component:H}],Oe=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=O({type:n})}static{this.\u0275inj=j({imports:[k.forChild(je),k]})}}return n})(),_t=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=O({type:n})}static{this.\u0275inj=j({imports:[A,Oe,le,H]})}}return n})();export{_t as RouteMap3Module,Oe as RouteMap3RoutingModule};
