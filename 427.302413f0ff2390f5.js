"use strict";(self.webpackChunkdemo_maps=self.webpackChunkdemo_maps||[]).push([[427],{2427:(vt,I,s)=>{s.r(I),s.d(I,{RouteMap3Module:()=>lt,RouteMap3RoutingModule:()=>H});var Y=s(6610),M=s(7925),h=s(1686),E=s(6478),x=s(5857),j=s(6924),U=s(7908),B=s(7659),A=s(2080),X=s(6370),N=s(9557),Z=s(4157),G=s(8507),D=s(8887),z=s(6715),P=s(6104),W=s(7327),Q=s(8201),J=s(1888),b=s(7915),K=s(3942),k=s(3982),q=s(479),_=s(7846),tt=s(509);const at=["download",(0,s(6256).s)({outline:'<path d="M31,31H5a1,1,0,0,0,0,2H31a1,1,0,0,0,0-2Z"/><path d="M18,29.48,28.61,18.87a1,1,0,0,0-1.41-1.41L19,25.65V5a1,1,0,0,0-2,0V25.65L8.81,17.46a1,1,0,1,0-1.41,1.41Z"/>',outlineAlerted:'<path d="M31,31H5a1,1,0,0,0,0,2H31a1,1,0,0,0,0-2Z"/><path d="M18,29.48,28.61,18.87a1,1,0,0,0-1.41-1.41L19,25.65V5a1,1,0,0,0-2,0V25.65L8.81,17.46a1,1,0,1,0-1.41,1.41Z"/>',outlineBadged:'<path d="M31,31H5a1,1,0,0,0,0,2H31a1,1,0,0,0,0-2Z"/><path d="M18,29.48,28.61,18.87a1,1,0,0,0-1.41-1.41L19,25.65V5a1,1,0,0,0-2,0V25.65L8.81,17.46a1,1,0,1,0-1.41,1.41Z"/>'})];var p=s(213),rt=s(3522),st=s(2459),t=s(3279),ot=s(9284),nt=s(792);k.h.addIcons(q.Q,_.F,tt.G,at);let C=(()=>{class c{constructor(r,o,a,n,i,d){this.layersSvc=r,this.mapStateSvc=o,this.mapSvc=a,this.alertSvc=n,this.progressService=i,this.route=d,this.class="content-container floating",this.subs=[],this.startBbox=null,this.updateLayerOnZoom=()=>{const e=this.getGridLayer(),l=this.layersSvc.getLayerById(e.id);l&&(l.custom_layer=e.layer,this.layersSvc.updateLayer(l,l.filtertype))},this.getGridLayer=()=>{const e=this.mapStateSvc.getMapState().getValue(),v="gridLayer",y=((c,ct,r,o,a)=>{const n=[];let i=80;r>1&&(i=40),r>2&&(i=20),r>3&&(i=10),r>4&&(i=6),r>5&&(i=4),r>6&&(i=3),r>7&&(i=2),r>8&&(i=1);const d=.5*i;let e=10;e>10&&(e=10),a=(0,G.r)(a,d);const l=c[0]+e,u=c[1]+e,y=c[3]-e-u,m=Math.floor((c[2]-e-l)/d),R=Math.floor(y/d);let f=l;for(let F=m;F>0;F--){let L=u;for(let w=R;w>0;w--){const V=f+d,T=L+d,$=[f,L],dt=[[$,[f,T],[V,T],[V,L],$]];if((0,G.Rj)(a,f,L)&&(0,G.Rj)(a,V,T)){const ut=new Z.Ay(dt).transform("EPSG:4326",o),pt=new N.A({geometry:ut,column:F,row:w,id:n.length+1});n.push(pt)}L+=d}f+=d}return n})([-180,-90,180,90],0,e.zoom,this.mapSvc.EPSG,e.extent),m=new X.A({features:y,wrapX:!1}),R=new A.A({source:m});return R.set("id",v),{layer:R,id:v}},this.controls={attribution:!0,scaleLine:!0}}ngOnInit(){this.addLayers(),this.subscribeToLayers(),this.subscribeToMapState(),this.subscribeToRoute(),this.startBbox&&this.mapStateSvc.setExtent(this.startBbox)}ngAfterViewInit(){this.mapSvc.map.on("moveend",this.updateLayerOnZoom)}ngOnDestroy(){this.subs.map(r=>r.unsubscribe()),this.mapSvc.map.un("moveend",this.updateLayerOnZoom)}addLayers(){const r=new j.dl({visible:!1}),o=new j.wl({visible:!0,tileSize:512}),a=new B.A({url:"https://ahocevar.com/geoserver/wms",params:{LAYERS:"topp:states"},serverType:"geoserver"});a.on("imageloadstart",()=>{this.progressService.progress({indeterminate:!0})}),a.on("imageloadend",()=>{this.progressService.progress(null)}),a.on("imageloaderror",()=>{this.progressService.progress(null)});const n=new h.tr({id:"event_layer",name:"Image load Layer",type:"custom",custom_layer:new U.A({source:a}),visible:!1,bbox:[-133.9453125,18.979025953255267,-60.46875,52.908902047770255]}),i=new h.vK({id:"updatable_feature_layer",name:"Updatable feature layer",type:"geojson",visible:!1,data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-192.48046875,-24.686952411999144],[-88.06640625,-24.686952411999144],[-88.06640625,50.28933925329178],[-192.48046875,50.28933925329178],[-192.48046875,-24.686952411999144]]]}}]},actions:[{action:u=>{i.data=W,this.layersSvc.updateLayer(i)},icon:"download",title:"Load data"}]}),d=this.getGridLayer(),e=new h.tr({id:d.id,name:"gridLayer",type:"custom",opacity:.3,custom_layer:d.layer});[o,r,n,i,e].forEach(u=>this.layersSvc.addLayer(u,"Layers"))}removeLayer(){this.layersSvc.removeLayerOrGroupById("event_layer2")}addLayer(){const r=new P.B,o=new P.B,a=new Q.A({source:new J.A({url:"https://geoservice.dlr.de/eoc/land/wms",params:{LAYERS:"GUF28_DLR_v1_Mosaic"}})}),n=e=>{var l=e.context,u=this.mapSvc.map.getSize(),v=.5*u[0],S=(0,b.FY)(e,[v,0]),g=(0,b.FY)(e,[u[0],0]),y=(0,b.FY)(e,[v,u[1]]),m=(0,b.FY)(e,u);l.save(),l.beginPath(),l.moveTo(S[0],S[1]),l.lineTo(y[0],y[1]),l.lineTo(m[0],m[1]),l.lineTo(g[0],g[1]),l.closePath(),l.clip()};a.on("prerender",e=>{n(e)}),a.on("postrender",e=>{(e=>{e.context.restore()})(e)});const d=new h.tr({id:"event_layer2",name:"Image load Layer 2",type:"custom",custom_layer:new K.A({layers:[a]}),visible:!0,removable:!0,events:{source:[{event:"tileloadstart",listener:e=>{r.next(e)}},{event:"tileloadend",listener:e=>{o.next(e)}}],layer:[{event:"prerender",listener:e=>{n(e)}},{event:"postrender",listener:e=>{n(e)}}]}});r.subscribe(e=>this.progressService.progress({indeterminate:!0})),o.pipe((0,D.B)(200)).subscribe(e=>this.progressService.progress(null)),this.layersSvc.addLayer(d,"Layers")}getSearchParamsHashRouting(r=window.location.href){-1===r.indexOf("http")&&(r=new URL(r,`${window.location.origin}${window.location.pathname}`).toString());const o=new URL(window.location.href,window.location.origin),[a,n]=o.hash.split("?");let i=new URLSearchParams;return n&&(i=new URLSearchParams(n)),{query:i,urlHashRouting:o,hash:a}}updateSearchParamsHashRouting(r){const{query:o,urlHashRouting:a,hash:n}=this.getSearchParamsHashRouting();Object.keys(r).map(e=>{o.set(e,r[e])});const i=decodeURIComponent(`${o}`);return`${a.protocol}//${a.host}${a.pathname||"/"}${n||"#/"}?${i}`}subscribeToMapState(){const r=this.mapStateSvc.getMapState().subscribe(o=>{if(history.pushState){const a=o.extent.map(i=>i.toFixed(3)),n=this.updateSearchParamsHashRouting({bbox:a.join(","),zoom:o.zoom.toString()});window.history.pushState({path:n},"",n)}});this.subs.push(r)}subscribeToRoute(){const r=this.route.queryParams.pipe((0,z.$)()).subscribe(o=>{if(Object.keys(o).length>0&&o.bbox){const a=o.bbox.split(",").map(n=>parseFloat(n));4===a.length&&(this.startBbox=a)}});this.subs.push(r)}subscribeToLayers(){if(this.layersSvc){const r=this.layersSvc.getLayers().subscribe(o=>{o.filter(n=>!0===n.visible).forEach(n=>{"updatable_feature_layer"===n.id&&n.data.features.length<=1&&this.alertSvc.alert({type:"info",text:"Click the layer setting down arrow icon to load new features.",closeable:!0})})});this.subs.push(r)}}static{this.\u0275fac=function(o){return new(o||c)(t.rXU(h._t),t.rXU(E.d),t.rXU(x.t),t.rXU(ot.u),t.rXU(nt.n),t.rXU(M.nX))}}static{this.\u0275cmp=t.VBU({type:c,selectors:[["app-route-map3"]],hostVars:2,hostBindings:function(o,a){2&o&&t.HbH(a.class)},standalone:!0,features:[t.Jv_([h._t,E.d,x.t]),t.aNF],decls:21,vars:10,consts:[[1,"content-area","map-view"],["id","olMap",3,"layersSvc","mapState","controls"],[1,"right",3,"clrVerticalNavCollapsible","clr-nav-level"],[1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","layers","clrVerticalNavIcon","","title","layers"],[1,"padding","title-ellipsis"],[3,"layersSvc","mapStateSvc"],["title","Coordinates",1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","compass","clrVerticalNavIcon",""],["title","Test",1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","cog","clrVerticalNavIcon",""],[1,"btn","btn-primary",3,"click"]],template:function(o,a){1&o&&(t.j41(0,"main",0),t.nrm(1,"ukis-map-ol",1),t.k0s(),t.j41(2,"clr-vertical-nav",2)(3,"clr-vertical-nav-group",3),t.nrm(4,"cds-icon",4),t.EFF(5," Layers "),t.j41(6,"clr-vertical-nav-group-children",5),t.nrm(7,"ukis-layer-control",6),t.k0s()(),t.j41(8,"clr-vertical-nav-group",7),t.nrm(9,"cds-icon",8),t.EFF(10," Coordinates "),t.j41(11,"clr-vertical-nav-group-children",5),t.nrm(12,"ukis-mouse-position"),t.k0s()(),t.j41(13,"clr-vertical-nav-group",9),t.nrm(14,"cds-icon",10),t.EFF(15," Test "),t.j41(16,"clr-vertical-nav-group-children",5)(17,"button",11),t.bIt("click",function(){return a.removeLayer()}),t.EFF(18,"remove Layer"),t.k0s(),t.j41(19,"button",11),t.bIt("click",function(){return a.addLayer()}),t.EFF(20,"add Layer"),t.k0s()()()()),2&o&&(t.R7$(),t.Y8G("layersSvc",a.layersSvc)("mapState",a.mapStateSvc)("controls",a.controls),t.R7$(),t.Y8G("clrVerticalNavCollapsible",!0)("clr-nav-level",2),t.R7$(),t.Y8G("clrVerticalNavGroupExpanded",!0),t.R7$(4),t.Y8G("layersSvc",a.layersSvc)("mapStateSvc",a.mapStateSvc),t.R7$(),t.Y8G("clrVerticalNavGroupExpanded",!1),t.R7$(5),t.Y8G("clrVerticalNavGroupExpanded",!0))},dependencies:[x.L,p.HEs,p.D2I,p.wqM,p.zLy,p.Wfw,p.BlU,p.Qmr,p.ndX,p.Lfk,rt.Sj,st.c2]})}}return c})();const it=[{path:"",component:C}];let H=(()=>{class c{static{this.\u0275fac=function(o){return new(o||c)}}static{this.\u0275mod=t.$C({type:c})}static{this.\u0275inj=t.G2t({imports:[M.iI.forChild(it),M.iI]})}}return c})(),lt=(()=>{class c{static{this.\u0275fac=function(o){return new(o||c)}}static{this.\u0275mod=t.$C({type:c})}static{this.\u0275inj=t.G2t({imports:[Y.MD,H,p.PuD,C]})}}return c})()}}]);