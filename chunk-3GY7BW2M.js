function G(e,t,n=2){let x=t&&t.length,r=x?t[0]*n:e.length,o=D(e,0,r,n,!0),i=[];if(!o||o.next===o.prev)return i;let f,u,l;if(x&&(o=S(e,t,o,n)),e.length>80*n){f=1/0,u=1/0;let h=-1/0,p=-1/0;for(let Z=n;Z<r;Z+=n){let g=e[Z],y=e[Z+1];g<f&&(f=g),y<u&&(u=y),g>h&&(h=g),y>p&&(p=y)}l=Math.max(h-f,p-u),l=l!==0?32767/l:0}return H(o,i,n,f,u,l,0),i}function D(e,t,n,x,r){let o;if(r===a(e,t,n,x)>0)for(let i=t;i<n;i+=x)o=B(i/x|0,e[i],e[i+1],o);else for(let i=n-x;i>=t;i-=x)o=B(i/x|0,e[i],e[i+1],o);return o&&w(o,o.next)&&(E(o),o=o.next),o}function M(e,t){if(!e)return e;t||(t=e);let n=e,x;do if(x=!1,!n.steiner&&(w(n,n.next)||v(n.prev,n,n.next)===0)){if(E(n),n=t=n.prev,n===n.next)break;x=!0}else n=n.next;while(x||n!==t);return t}function H(e,t,n,x,r,o,i){if(!e)return;!i&&o&&X(e,x,r,o);let f=e;for(;e.prev!==e.next;){let u=e.prev,l=e.next;if(o?K(e,x,r,o):J(e)){t.push(u.i,e.i,l.i),E(e),e=l.next,f=l.next;continue}if(e=l,e===f){i?i===1?(e=N(M(e),t),H(e,t,n,x,r,o,2)):i===2&&Q(e,t,n,x,r,o):H(M(e),t,n,x,r,o,1);break}}}function J(e){let t=e.prev,n=e,x=e.next;if(v(t,n,x)>=0)return!1;let r=t.x,o=n.x,i=x.x,f=t.y,u=n.y,l=x.y,h=Math.min(r,o,i),p=Math.min(f,u,l),Z=Math.max(r,o,i),g=Math.max(f,u,l),y=x.next;for(;y!==t;){if(y.x>=h&&y.x<=Z&&y.y>=p&&y.y<=g&&k(r,f,o,u,i,l,y.x,y.y)&&v(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function K(e,t,n,x){let r=e.prev,o=e,i=e.next;if(v(r,o,i)>=0)return!1;let f=r.x,u=o.x,l=i.x,h=r.y,p=o.y,Z=i.y,g=Math.min(f,u,l),y=Math.min(h,p,Z),F=Math.max(f,u,l),L=Math.max(h,p,Z),T=C(g,y,t,n,x),j=C(F,L,t,n,x),c=e.prevZ,s=e.nextZ;for(;c&&c.z>=T&&s&&s.z<=j;){if(c.x>=g&&c.x<=F&&c.y>=y&&c.y<=L&&c!==r&&c!==i&&k(f,h,u,p,l,Z,c.x,c.y)&&v(c.prev,c,c.next)>=0||(c=c.prevZ,s.x>=g&&s.x<=F&&s.y>=y&&s.y<=L&&s!==r&&s!==i&&k(f,h,u,p,l,Z,s.x,s.y)&&v(s.prev,s,s.next)>=0))return!1;s=s.nextZ}for(;c&&c.z>=T;){if(c.x>=g&&c.x<=F&&c.y>=y&&c.y<=L&&c!==r&&c!==i&&k(f,h,u,p,l,Z,c.x,c.y)&&v(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;s&&s.z<=j;){if(s.x>=g&&s.x<=F&&s.y>=y&&s.y<=L&&s!==r&&s!==i&&k(f,h,u,p,l,Z,s.x,s.y)&&v(s.prev,s,s.next)>=0)return!1;s=s.nextZ}return!0}function N(e,t){let n=e;do{let x=n.prev,r=n.next.next;!w(x,r)&&R(x,n,n.next,r)&&z(x,r)&&z(r,x)&&(t.push(x.i,n.i,r.i),E(n),E(n.next),n=e=r),n=n.next}while(n!==e);return M(n)}function Q(e,t,n,x,r,o){let i=e;do{let f=i.next.next;for(;f!==i.prev;){if(i.i!==f.i&&b(i,f)){let u=V(i,f);i=M(i,i.next),u=M(u,u.next),H(i,t,n,x,r,o,0),H(u,t,n,x,r,o,0);return}f=f.next}i=i.next}while(i!==e)}function S(e,t,n,x){let r=[];for(let o=0,i=t.length;o<i;o++){let f=t[o]*x,u=o<i-1?t[o+1]*x:e.length,l=D(e,f,u,x,!1);l===l.next&&(l.steiner=!0),r.push(m(l))}r.sort(U);for(let o=0;o<r.length;o++)n=W(r[o],n);return n}function U(e,t){let n=e.x-t.x;if(n===0&&(n=e.y-t.y,n===0)){let x=(e.next.y-e.y)/(e.next.x-e.x),r=(t.next.y-t.y)/(t.next.x-t.x);n=x-r}return n}function W(e,t){let n=_(e,t);if(!n)return t;let x=V(n,e);return M(x,x.next),M(n,n.next)}function _(e,t){let n=t,x=e.x,r=e.y,o=-1/0,i;if(w(e,n))return n;do{if(w(e,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){let p=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(p<=x&&p>o&&(o=p,i=n.x<n.next.x?n:n.next,p===x))return i}n=n.next}while(n!==t);if(!i)return null;let f=i,u=i.x,l=i.y,h=1/0;n=i;do{if(x>=n.x&&n.x>=u&&x!==n.x&&O(r<l?x:o,r,u,l,r<l?o:x,r,n.x,n.y)){let p=Math.abs(r-n.y)/(x-n.x);z(n,e)&&(p<h||p===h&&(n.x>i.x||n.x===i.x&&$(i,n)))&&(i=n,h=p)}n=n.next}while(n!==f);return i}function $(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function X(e,t,n,x){let r=e;do r.z===0&&(r.z=C(r.x,r.y,t,n,x)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,Y(r)}function Y(e){let t,n=1;do{let x=e,r;e=null;let o=null;for(t=0;x;){t++;let i=x,f=0;for(let l=0;l<n&&(f++,i=i.nextZ,!!i);l++);let u=n;for(;f>0||u>0&&i;)f!==0&&(u===0||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(t>1);return e}function C(e,t,n,x,r){return e=(e-n)*r|0,t=(t-x)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function m(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function O(e,t,n,x,r,o,i,f){return(r-i)*(t-f)>=(e-i)*(o-f)&&(e-i)*(x-f)>=(n-i)*(t-f)&&(n-i)*(o-f)>=(r-i)*(x-f)}function k(e,t,n,x,r,o,i,f){return!(e===i&&t===f)&&O(e,t,n,x,r,o,i,f)}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!q(e,t)&&(z(e,t)&&z(t,e)&&d(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||w(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function w(e,t){return e.x===t.x&&e.y===t.y}function R(e,t,n,x){let r=P(v(e,t,n)),o=P(v(e,t,x)),i=P(v(n,x,e)),f=P(v(n,x,t));return!!(r!==o&&i!==f||r===0&&A(e,n,t)||o===0&&A(e,x,t)||i===0&&A(n,e,x)||f===0&&A(n,t,x))}function A(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function P(e){return e>0?1:e<0?-1:0}function q(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&R(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function z(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function d(e,t){let n=e,x=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(x=!x),n=n.next;while(n!==e);return x}function V(e,t){let n=I(e.i,e.x,e.y),x=I(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,x.next=n,n.prev=x,o.next=x,x.prev=o,x}function B(e,t,n,x){let r=I(e,t,n);return x?(r.next=x.next,r.prev=x,x.next.prev=r,x.next=r):(r.prev=r,r.next=r),r}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function I(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function a(e,t,n,x){let r=0;for(let o=t,i=n-x;o<n;o+=x)r+=(e[i]-e[o])*(e[o+1]+e[i+1]),i=o;return r}export{G as a};
