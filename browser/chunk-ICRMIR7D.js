import{B as I,D as u,Ea as D,F as w,J as B,K as F,ca as P,d as v,ha as A,ka as E,m,s as _,t as T,u as y,v as C,za as L}from"./chunk-OTRZYAA2.js";import{f as H}from"./chunk-FJYW2LMB.js";var O=H(B(),1);var g=class extends A{constructor(e){super(e),this.vectorRenderer_=new E(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=I(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);let t=u(this.coordinateToVectorPixelTransform_,u(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){let t=e.pixelRatio,i=e.viewState,n=i.resolution,a=e.viewHints,r=this.vectorRenderer_,o=e.extent;this.layerImageRatio_!==1&&(o=o.slice(0),C(o,this.layerImageRatio_));let p=T(o)/n,R=_(o)/n;if(!a[m.ANIMATING]&&!a[m.INTERACTING]&&!y(o)){r.useContainer(null,null);let b=r.context,j=e.layerStatesArray[e.layerIndex],G=Object.assign({},j,{opacity:1}),d=Object.assign({},e,{extent:o,size:[p,R],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[G],layerIndex:0,declutter:null}),f=this.getLayer().getDeclutter();f&&(d.declutter={[f]:new O.default(9)});let x=!0,s=new L(o,n,t,b.canvas,function(c){r.prepareFrame(d)&&r.replayGroupChanged&&(r.clipping=!1,r.renderFrame(d,null)&&(r.renderDeclutter(d),r.renderDeferred(d),x=!1),c())});s.addEventListener(v.CHANGE,()=>{if(s.getState()!==F.LOADED)return;this.image_=x?null:s;let c=s.getPixelRatio(),l=D(s.getResolution())*t/c;this.renderedResolution=l,this.coordinateToVectorPixelTransform_=w(this.coordinateToVectorPixelTransform_,p/2,R/2,1/l,-1/l,0,-i.center[0],-i.center[1])}),s.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,i,n,a){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,i,n,a):super.forEachFeatureAtCoordinate(e,t,i,n,a)}},V=g;var h=class extends P{constructor(e){e=e||{};let t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new V(this)}},Z=h;export{Z as a};
