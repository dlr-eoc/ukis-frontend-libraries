import{a as hh,b as uh,c as fh,d as u1,e as dh,f as f1,g as mh,h as d1,i as m1,l as Vd,m as fl,n as eo,o as p1,q as g1,t as y1}from"./chunk-RM6VSO6X.js";import{Aa as l1,E as Q_,G as Bd,I as t1,M as e1,N as i1,Oa as c1,T as r1,X as qd,Y as Xd,a as jd,ha as n1,ia as s1,ja as o1,la as a1,n as K_,p as H_,r as Ud,sb as h1,t as Z_,y as J_}from"./chunk-G5LJQFAD.js";import{a as Ir,b as Bo,e as Qb,f as tC,h as to}from"./chunk-FJYW2LMB.js";var rb=Qb((Pit,Cd)=>{(function(i){var t={};t.Constants={},t.Math={},t.Accumulator={},function(e){"use strict";e.WGS84={a:6378137,f:1/298.257223563},e.version={major:2,minor:1,patch:1},e.version_string="2.1.1"}(t.Constants),function(e){"use strict";e.digits=53,e.epsilon=Math.pow(.5,e.digits-1),e.degree=Math.PI/180,e.sq=function(r){return r*r},e.hypot=function(r,n){return Math.sqrt(r*r+n*n)},e.cbrt=Math.cbrt||function(r){var n=Math.pow(Math.abs(r),.3333333333333333);return r>0?n:r<0?-n:r},e.log1p=Math.log1p||function(r){var n=1+r,s=n-1;return s===0?r:r*Math.log(n)/s},e.atanh=Math.atanh||function(r){var n=Math.abs(r);return n=e.log1p(2*n/(1-n))/2,r>0?n:r<0?-n:r},e.copysign=function(r,n){return Math.abs(r)*(n<0||n===0&&1/n<0?-1:1)},e.sum=function(r,n){var s=r+n,o=s-n,a=s-o,l;return o-=r,a-=n,l=s&&0-(o+a),{s,t:l}},e.polyval=function(r,n,s,o){for(var a=r<0?0:n[s++];--r>=0;)a=a*o+n[s++];return a},e.AngRound=function(r){var n=.0625,s=Math.abs(r);return s=s<n?n-(n-s):s,e.copysign(s,r)},e.remainder=function(r,n){return r%=n,r<-n/2?r+n:r<n/2?r:r-n},e.AngNormalize=function(r){var n=e.remainder(r,360);return Math.abs(n)===180?e.copysign(180,r):n},e.LatFix=function(r){return Math.abs(r)>90?NaN:r},e.AngDiff=function(r,n){var s=e.sum(e.remainder(-r,360),e.remainder(n,360)),o,a;return s=e.sum(e.remainder(s.s,360),s.t),o=s.s,a=s.t,(o===0||Math.abs(o)===180)&&(o=e.copysign(o,a===0?n-r:-a)),{d:o,e:a}},e.sincosd=function(r){var n,s,o,a,l,c,h;switch(n=r%360,o=Math.round(n/90),n-=90*o,s=n*this.degree,a=Math.sin(s),l=Math.cos(s),Math.abs(n)===45?(l=Math.sqrt(.5),a=e.copysign(l,s)):Math.abs(n)===30&&(l=Math.sqrt(.75),a=e.copysign(.5,s)),o&3){case 0:c=a,h=l;break;case 1:c=l,h=-a;break;case 2:c=-a,h=-l;break;default:c=-l,h=a;break}return h+=0,c===0&&(c=e.copysign(c,r)),{s:c,c:h}},e.sincosde=function(r,n){var s,o,a,l,c,h,u;switch(s=r%360,a=Math.round(s/90),s=e.AngRound(s-90*a+n),o=s*this.degree,l=Math.sin(o),c=Math.cos(o),Math.abs(s)===45?(c=Math.sqrt(.5),l=e.copysign(c,o)):Math.abs(s)===30&&(c=Math.sqrt(.75),l=e.copysign(.5,o)),a&3){case 0:h=l,u=c;break;case 1:h=c,u=-l;break;case 2:h=-l,u=-c;break;default:h=-c,u=l;break}return u+=0,h===0&&(h=e.copysign(h,r+n)),{s:h,c:u}},e.atan2d=function(r,n){var s=0,o;switch(Math.abs(r)>Math.abs(n)&&([r,n]=[n,r],s=2),e.copysign(1,n)<0&&(n=-n,++s),o=Math.atan2(r,n)/this.degree,s){case 1:o=e.copysign(180,r)-o;break;case 2:o=90-o;break;case 3:o=-90+o;break;default:break}return o}}(t.Math),function(e,r){"use strict";e.Accumulator=function(n){this.Set(n)},e.Accumulator.prototype.Set=function(n){n||(n=0),n.constructor===e.Accumulator?(this._s=n._s,this._t=n._t):(this._s=n,this._t=0)},e.Accumulator.prototype.Add=function(n){var s=r.sum(n,this._t),o=r.sum(s.s,this._s);s=s.t,this._s=o.s,this._t=o.t,this._s===0?this._s=s:this._t+=s},e.Accumulator.prototype.Sum=function(n){var s;return n?(s=new e.Accumulator(this),s.Add(n),s._s):this._s},e.Accumulator.prototype.Negate=function(){this._s*=-1,this._t*=-1},e.Accumulator.prototype.Remainder=function(n){this._s=r.remainder(this._s,n),this.Add(0)}}(t.Accumulator,t.Math),t.Geodesic={},t.GeodesicLine={},t.PolygonArea={},function(e,r,n,s,o){"use strict";var a=6,l=a,c=a,h=a,u=h,f,d,m=20,p=m+s.digits+10,g=s.epsilon,y=200*g,_=Math.sqrt(g),x=g,v=1e3*_,E=0,b=31,S=32640,T,P,F,k,z,W,G,O,X;e.tiny_=Math.sqrt(Number.MIN_VALUE/Number.EPSILON),e.nC1_=a,e.nC1p_=a,e.nC2_=a,e.nC3_=a,e.nC4_=a,f=e.nC3_*(e.nC3_-1)/2,d=e.nC4_*(e.nC4_+1)/2,e.CAP_C1=1,e.CAP_C1p=2,e.CAP_C2=4,e.CAP_C3=8,e.CAP_C4=16,e.NONE=0,e.ARC=64,e.LATITUDE=128|E,e.LONGITUDE=256|e.CAP_C3,e.AZIMUTH=512|E,e.DISTANCE=1024|e.CAP_C1,e.STANDARD=e.LATITUDE|e.LONGITUDE|e.AZIMUTH|e.DISTANCE,e.DISTANCE_IN=2048|e.CAP_C1|e.CAP_C1p,e.REDUCEDLENGTH=4096|e.CAP_C1|e.CAP_C2,e.GEODESICSCALE=8192|e.CAP_C1|e.CAP_C2,e.AREA=16384|e.CAP_C4,e.ALL=S|b,e.LONG_UNROLL=32768,e.OUT_MASK=S|e.LONG_UNROLL,e.SinCosSeries=function(M,R,A,L){var w=L.length,C=w-(M?1:0),V=2*(A-R)*(A+R),ot=C&1?L[--w]:0,xt=0;for(C=Math.floor(C/2);C--;)xt=V*ot-xt+L[--w],ot=V*xt-ot+L[--w];return M?2*R*A*ot:A*(ot-xt)},T=function(M,R){var A,L=s.sq(M),w=s.sq(R),C=(L+w-1)/6,V,ot,xt,J,lt,tt,st,ct,I,St,Rt;return w===0&&C<=0?A=0:(V=L*w/4,ot=s.sq(C),xt=C*ot,J=V*(V+2*xt),lt=C,J>=0?(tt=V+xt,tt+=tt<0?-Math.sqrt(J):Math.sqrt(J),st=s.cbrt(tt),lt+=st+(st!==0?ot/st:0)):(ct=Math.atan2(Math.sqrt(-J),-(V+xt)),lt+=2*C*Math.cos(ct/3)),I=Math.sqrt(s.sq(lt)+w),St=lt<0?w/(I-lt):lt+I,Rt=(St-w)/(2*I),A=St/(Math.sqrt(St+s.sq(Rt))+Rt)),A},P=[1,4,64,0,256],e.A1m1f=function(M){var R=Math.floor(l/2),A=s.polyval(R,P,0,s.sq(M))/P[R+1];return(A+M)/(1-M)},F=[-1,6,-16,32,-9,64,-128,2048,9,-16,768,3,-5,512,-7,1280,-7,2048],e.C1f=function(M,R){var A=s.sq(M),L=M,w=0,C,V;for(C=1;C<=e.nC1_;++C)V=Math.floor((e.nC1_-C)/2),R[C]=L*s.polyval(V,F,w,A)/F[w+V+1],w+=V+2,L*=M},k=[205,-432,768,1536,4005,-4736,3840,12288,-225,116,384,-7173,2695,7680,3467,7680,38081,61440],e.C1pf=function(M,R){var A=s.sq(M),L=M,w=0,C,V;for(C=1;C<=e.nC1p_;++C)V=Math.floor((e.nC1p_-C)/2),R[C]=L*s.polyval(V,k,w,A)/k[w+V+1],w+=V+2,L*=M},z=[-11,-28,-192,0,256],e.A2m1f=function(M){var R=Math.floor(c/2),A=s.polyval(R,z,0,s.sq(M))/z[R+1];return(A-M)/(1+M)},W=[1,2,16,32,35,64,384,2048,15,80,768,7,35,512,63,1280,77,2048],e.C2f=function(M,R){var A=s.sq(M),L=M,w=0,C,V;for(C=1;C<=e.nC2_;++C)V=Math.floor((e.nC2_-C)/2),R[C]=L*s.polyval(V,W,w,A)/W[w+V+1],w+=V+2,L*=M},e.Geodesic=function(M,R){if(this.a=M,this.f=R,this._f1=1-this.f,this._e2=this.f*(2-this.f),this._ep2=this._e2/s.sq(this._f1),this._n=this.f/(2-this.f),this._b=this.a*this._f1,this._c2=(s.sq(this.a)+s.sq(this._b)*(this._e2===0?1:(this._e2>0?s.atanh(Math.sqrt(this._e2)):Math.atan(Math.sqrt(-this._e2)))/Math.sqrt(Math.abs(this._e2))))/2,this._etol2=.1*_/Math.sqrt(Math.max(.001,Math.abs(this.f))*Math.min(1,1-this.f/2)/2),!(isFinite(this.a)&&this.a>0))throw new Error("Equatorial radius is not positive");if(!(isFinite(this._b)&&this._b>0))throw new Error("Polar semi-axis is not positive");this._A3x=new Array(u),this._C3x=new Array(f),this._C4x=new Array(d),this.A3coeff(),this.C3coeff(),this.C4coeff()},G=[-3,128,-2,-3,64,-1,-3,-1,16,3,-1,-2,8,1,-1,2,1,1],e.Geodesic.prototype.A3coeff=function(){var M=0,R=0,A,L;for(A=h-1;A>=0;--A)L=Math.min(h-A-1,A),this._A3x[R++]=s.polyval(L,G,M,this._n)/G[M+L+1],M+=L+2},O=[3,128,2,5,128,-1,3,3,64,-1,0,1,8,-1,1,4,5,256,1,3,128,-3,-2,3,64,1,-3,2,32,7,512,-10,9,384,5,-9,5,192,7,512,-14,7,512,21,2560],e.Geodesic.prototype.C3coeff=function(){var M=0,R=0,A,L,w;for(A=1;A<e.nC3_;++A)for(L=e.nC3_-1;L>=A;--L)w=Math.min(e.nC3_-L-1,L),this._C3x[R++]=s.polyval(w,O,M,this._n)/O[M+w+1],M+=w+2},X=[97,15015,1088,156,45045,-224,-4784,1573,45045,-10656,14144,-4576,-858,45045,64,624,-4576,6864,-3003,15015,100,208,572,3432,-12012,30030,45045,1,9009,-2944,468,135135,5792,1040,-1287,135135,5952,-11648,9152,-2574,135135,-64,-624,4576,-6864,3003,135135,8,10725,1856,-936,225225,-8448,4992,-1144,225225,-1440,4160,-4576,1716,225225,-136,63063,1024,-208,105105,3584,-3328,1144,315315,-128,135135,-2560,832,405405,128,99099],e.Geodesic.prototype.C4coeff=function(){var M=0,R=0,A,L,w;for(A=0;A<e.nC4_;++A)for(L=e.nC4_-1;L>=A;--L)w=e.nC4_-L-1,this._C4x[R++]=s.polyval(w,X,M,this._n)/X[M+w+1],M+=w+2},e.Geodesic.prototype.A3f=function(M){return s.polyval(u-1,this._A3x,0,M)},e.Geodesic.prototype.C3f=function(M,R){var A=1,L=0,w,C;for(w=1;w<e.nC3_;++w)C=e.nC3_-w-1,A*=M,R[w]=A*s.polyval(C,this._C3x,L,M),L+=C+1},e.Geodesic.prototype.C4f=function(M,R){var A=1,L=0,w,C;for(w=0;w<e.nC4_;++w)C=e.nC4_-w-1,R[w]=A*s.polyval(C,this._C4x,L,M),L+=C+1,A*=M},e.Geodesic.prototype.Lengths=function(M,R,A,L,w,C,V,ot,xt,J,lt,tt,st){lt&=e.OUT_MASK;var ct={},I=0,St=0,Rt=0,et=0,Dt,It,Mt,Zt,At;if(lt&(e.DISTANCE|e.REDUCEDLENGTH|e.GEODESICSCALE)&&(Rt=e.A1m1f(M),e.C1f(M,tt),lt&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(et=e.A2m1f(M),e.C2f(M,st),I=Rt-et,et=1+et),Rt=1+Rt),lt&e.DISTANCE)Dt=e.SinCosSeries(!0,C,V,tt)-e.SinCosSeries(!0,A,L,tt),ct.s12b=Rt*(R+Dt),lt&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(It=e.SinCosSeries(!0,C,V,st)-e.SinCosSeries(!0,A,L,st),St=I*R+(Rt*Dt-et*It));else if(lt&(e.REDUCEDLENGTH|e.GEODESICSCALE)){for(Mt=1;Mt<=e.nC2_;++Mt)st[Mt]=Rt*tt[Mt]-et*st[Mt];St=I*R+(e.SinCosSeries(!0,C,V,st)-e.SinCosSeries(!0,A,L,st))}return lt&e.REDUCEDLENGTH&&(ct.m0=I,ct.m12b=ot*(L*C)-w*(A*V)-L*V*St),lt&e.GEODESICSCALE&&(Zt=L*V+A*C,At=this._ep2*(xt-J)*(xt+J)/(w+ot),ct.M12=Zt+(At*C-V*St)*A/w,ct.M21=Zt-(At*A-L*St)*C/ot),ct},e.Geodesic.prototype.InverseStart=function(M,R,A,L,w,C,V,ot,xt,J,lt){var tt={},st=L*R-w*M,ct=w*R+L*M,I,St,Rt,et,Dt,It,Mt,Zt,At,wt,vt,yt,bt,he,qt,jt,Ut,Ot,ft,pt,_t,Wt,Kt;return tt.sig12=-1,I=L*R,I+=w*M,St=ct>=0&&st<.5&&w*V<.5,St?(et=s.sq(M+L),et/=et+s.sq(R+w),tt.dnm=Math.sqrt(1+this._ep2*et),Rt=V/(this._f1*tt.dnm),Dt=Math.sin(Rt),It=Math.cos(Rt)):(Dt=ot,It=xt),tt.salp1=w*Dt,tt.calp1=It>=0?st+w*M*s.sq(Dt)/(1+It):I-w*M*s.sq(Dt)/(1-It),Zt=s.hypot(tt.salp1,tt.calp1),At=M*L+R*w*It,St&&Zt<this._etol2?(tt.salp2=R*Dt,tt.calp2=st-R*L*(It>=0?s.sq(Dt)/(1+It):1-It),Mt=s.hypot(tt.salp2,tt.calp2),tt.salp2/=Mt,tt.calp2/=Mt,tt.sig12=Math.atan2(Zt,At)):Math.abs(this._n)>.1||At>=0||Zt>=6*Math.abs(this._n)*Math.PI*s.sq(R)||(Kt=Math.atan2(-ot,-xt),this.f>=0?(he=s.sq(M)*this._ep2,qt=he/(2*(1+Math.sqrt(1+he))+he),yt=this.f*R*this.A3f(qt)*Math.PI,bt=yt*R,wt=Kt/yt,vt=I/bt):(jt=w*R-L*M,Ut=Math.atan2(I,jt),pt=this.Lengths(this._n,Math.PI+Ut,M,-R,A,L,w,C,R,w,e.REDUCEDLENGTH,J,lt),Ot=pt.m12b,ft=pt.m0,wt=-1+Ot/(R*w*ft*Math.PI),bt=wt<-.01?I/wt:-this.f*s.sq(R)*Math.PI,yt=bt/R,vt=V/yt),vt>-y&&wt>-1-v?this.f>=0?(tt.salp1=Math.min(1,-wt),tt.calp1=-Math.sqrt(1-s.sq(tt.salp1))):(tt.calp1=Math.max(wt>-y?0:-1,wt),tt.salp1=Math.sqrt(1-s.sq(tt.calp1))):(_t=T(wt,vt),Wt=yt*(this.f>=0?-wt*_t/(1+_t):-vt*(1+_t)/_t),Dt=Math.sin(Wt),It=-Math.cos(Wt),tt.salp1=w*Dt,tt.calp1=I-w*M*s.sq(Dt)/(1-It))),tt.salp1<=0?(tt.salp1=1,tt.calp1=0):(Mt=s.hypot(tt.salp1,tt.calp1),tt.salp1/=Mt,tt.calp1/=Mt),tt},e.Geodesic.prototype.Lambda12=function(M,R,A,L,w,C,V,ot,xt,J,lt,tt,st,ct){var I={},St,Rt,et,Dt,It,Mt,Zt,At,wt,vt,yt,bt,he;return M===0&&ot===0&&(ot=-e.tiny_),Rt=V*R,et=s.hypot(ot,V*M),I.ssig1=M,Dt=Rt*M,I.csig1=It=ot*R,St=s.hypot(I.ssig1,I.csig1),I.ssig1/=St,I.csig1/=St,I.salp2=w!==R?Rt/w:V,I.calp2=w!==R||Math.abs(L)!==-M?Math.sqrt(s.sq(ot*R)+(R<-M?(w-R)*(R+w):(M-L)*(M+L)))/w:Math.abs(ot),I.ssig2=L,Mt=Rt*L,I.csig2=Zt=I.calp2*w,St=s.hypot(I.ssig2,I.csig2),I.ssig2/=St,I.csig2/=St,I.sig12=Math.atan2(Math.max(0,I.csig1*I.ssig2-I.ssig1*I.csig2),I.csig1*I.csig2+I.ssig1*I.ssig2),At=Math.max(0,It*Mt-Dt*Zt),wt=It*Zt+Dt*Mt,yt=Math.atan2(At*J-wt*xt,wt*J+At*xt),bt=s.sq(et)*this._ep2,I.eps=bt/(2*(1+Math.sqrt(1+bt))+bt),this.C3f(I.eps,ct),vt=e.SinCosSeries(!0,I.ssig2,I.csig2,ct)-e.SinCosSeries(!0,I.ssig1,I.csig1,ct),I.domg12=-this.f*this.A3f(I.eps)*Rt*(I.sig12+vt),I.lam12=yt+I.domg12,lt&&(I.calp2===0?I.dlam12=-2*this._f1*A/M:(he=this.Lengths(I.eps,I.sig12,I.ssig1,I.csig1,A,I.ssig2,I.csig2,C,R,w,e.REDUCEDLENGTH,tt,st),I.dlam12=he.m12b,I.dlam12*=this._f1/(I.calp2*w))),I},e.Geodesic.prototype.Inverse=function(M,R,A,L,w){var C,V;return w||(w=e.STANDARD),w===e.LONG_UNROLL&&(w|=e.STANDARD),w&=e.OUT_MASK,C=this.InverseInt(M,R,A,L,w),V=C.vals,w&e.AZIMUTH&&(V.azi1=s.atan2d(C.salp1,C.calp1),V.azi2=s.atan2d(C.salp2,C.calp2)),V},e.Geodesic.prototype.InverseInt=function(M,R,A,L,w){var C={},V,ot,xt,J,lt,tt,st,ct,I,St,Rt,et,Dt,It,Mt,Zt,At,wt,vt,yt,bt,he,qt,jt,Ut,Ot,ft,pt,_t,Wt,Kt,Qe,Ve,ue,xe,te,fe,ve,$t,We,ds,Rr,De,Ri,ti,Ii,ci,_r,tr,le,Ye,Ai,sh,oh,Y_,$_,hl,ah,ul,Dd,Gd,lh,ch,kd,zd;if(C.lat1=M=s.LatFix(M),C.lat2=A=s.LatFix(A),M=s.AngRound(M),A=s.AngRound(A),V=s.AngDiff(R,L),ot=V.e,V=V.d,w&e.LONG_UNROLL?(C.lon1=R,C.lon2=R+V+ot):(C.lon1=s.AngNormalize(R),C.lon2=s.AngNormalize(L)),xt=s.copysign(1,V),V*=xt,ot*=xt,Mt=V*s.degree,J=s.sincosde(V,ot),Zt=J.s,At=J.c,ot=180-V-ot,lt=Math.abs(M)<Math.abs(A)||isNaN(A)?-1:1,lt<0&&(xt*=-1,[A,M]=[M,A]),tt=s.copysign(1,-M),M*=tt,A*=tt,J=s.sincosd(M),st=this._f1*J.s,ct=J.c,J=s.hypot(st,ct),st/=J,ct/=J,ct=Math.max(e.tiny_,ct),J=s.sincosd(A),I=this._f1*J.s,St=J.c,J=s.hypot(I,St),I/=J,St/=J,St=Math.max(e.tiny_,St),ct<-st?St===ct&&(I=s.copysign(st,I)):Math.abs(I)===-st&&(St=ct),Dt=Math.sqrt(1+this._ep2*s.sq(st)),It=Math.sqrt(1+this._ep2*s.sq(I)),qt=new Array(e.nC1_+1),jt=new Array(e.nC2_+1),Ut=new Array(e.nC3_),Ot=M===-90||Zt===0,Ot&&(vt=At,yt=Zt,bt=1,he=0,pt=st,_t=vt*ct,Wt=I,Kt=bt*St,wt=Math.atan2(Math.max(0,_t*Wt-pt*Kt),_t*Kt+pt*Wt),ft=this.Lengths(this._n,wt,pt,_t,Dt,Wt,Kt,It,ct,St,w|e.DISTANCE|e.REDUCEDLENGTH,qt,jt),Rt=ft.s12b,et=ft.m12b,w&e.GEODESICSCALE&&(C.M12=ft.M12,C.M21=ft.M21),wt<1||et>=0?((wt<3*e.tiny_||wt<g&&(Rt<0||et<0))&&(wt=et=Rt=0),et*=this._b,Rt*=this._b,C.a12=wt/s.degree):Ot=!1),hl=2,!Ot&&st===0&&(this.f<=0||ot>=this.f*180))vt=bt=0,yt=he=1,Rt=this.a*Mt,wt=Ve=Mt/this._f1,et=this._b*Math.sin(wt),w&e.GEODESICSCALE&&(C.M12=C.M21=Math.cos(wt)),C.a12=V/this._f1;else if(!Ot)if(ft=this.InverseStart(st,ct,Dt,I,St,It,Mt,Zt,At,qt,jt),wt=ft.sig12,yt=ft.salp1,vt=ft.calp1,wt>=0)he=ft.salp2,bt=ft.calp2,ue=ft.dnm,Rt=wt*this._b*ue,et=s.sq(ue)*this._b*Math.sin(wt/ue),w&e.GEODESICSCALE&&(C.M12=C.M21=Math.cos(wt/ue)),C.a12=wt/s.degree,Ve=Mt/(this._f1*ue);else{for(xe=0,te=e.tiny_,fe=1,ve=e.tiny_,$t=-1,We=!1,ds=!1;ft=this.Lambda12(st,ct,Dt,I,St,It,yt,vt,Zt,At,xe<m,qt,jt,Ut),Rr=ft.lam12,he=ft.salp2,bt=ft.calp2,wt=ft.sig12,pt=ft.ssig1,_t=ft.csig1,Wt=ft.ssig2,Kt=ft.csig2,Qe=ft.eps,ul=ft.domg12,De=ft.dlam12,!(ds||!(Math.abs(Rr)>=(We?8:1)*g)||xe==p);++xe){if(Rr>0&&(xe<m||vt/yt>$t/ve)?(ve=yt,$t=vt):Rr<0&&(xe<m||vt/yt<fe/te)&&(te=yt,fe=vt),xe<m&&De>0&&(Ri=-Rr/De,Math.abs(Ri)<Math.PI&&(ti=Math.sin(Ri),Ii=Math.cos(Ri),ci=yt*Ii+vt*ti,ci>0))){vt=vt*Ii-yt*ti,yt=ci,J=s.hypot(yt,vt),yt/=J,vt/=J,We=Math.abs(Rr)<=16*g;continue}yt=(te+ve)/2,vt=(fe+$t)/2,J=s.hypot(yt,vt),yt/=J,vt/=J,We=!1,ds=Math.abs(te-yt)+(fe-vt)<x||Math.abs(yt-ve)+(vt-$t)<x}_r=w|(w&(e.REDUCEDLENGTH|e.GEODESICSCALE)?e.DISTANCE:e.NONE),ft=this.Lengths(Qe,wt,pt,_t,Dt,Wt,Kt,It,ct,St,_r,qt,jt),Rt=ft.s12b,et=ft.m12b,w&e.GEODESICSCALE&&(C.M12=ft.M12,C.M21=ft.M21),et*=this._b,Rt*=this._b,C.a12=wt/s.degree,w&e.AREA&&(kd=Math.sin(ul),zd=Math.cos(ul),hl=Zt*zd-At*kd,ah=At*zd+Zt*kd)}return w&e.DISTANCE&&(C.s12=0+Rt),w&e.REDUCEDLENGTH&&(C.m12=0+et),w&e.AREA&&(tr=yt*ct,le=s.hypot(vt,yt*st),le!==0&&tr!==0?(pt=st,_t=vt*ct,Wt=I,Kt=bt*St,Ai=s.sq(le)*this._ep2,Qe=Ai/(2*(1+Math.sqrt(1+Ai))+Ai),sh=s.sq(this.a)*le*tr*this._e2,J=s.hypot(pt,_t),pt/=J,_t/=J,J=s.hypot(Wt,Kt),Wt/=J,Kt/=J,oh=new Array(e.nC4_),this.C4f(Qe,oh),Y_=e.SinCosSeries(!1,pt,_t,oh),$_=e.SinCosSeries(!1,Wt,Kt,oh),C.S12=sh*($_-Y_)):C.S12=0,!Ot&&hl==2&&(hl=Math.sin(Ve),ah=Math.cos(Ve)),!Ot&&ah>-.7071&&I-st<1.75?(ul=1+ah,Dd=1+ct,Gd=1+St,Ye=2*Math.atan2(hl*(st*Gd+I*Dd),ul*(st*I+Dd*Gd))):(lh=he*vt-bt*yt,ch=bt*vt+he*yt,lh===0&&ch<0&&(lh=e.tiny_*vt,ch=-1),Ye=Math.atan2(lh,ch)),C.S12+=this._c2*Ye,C.S12*=lt*xt*tt,C.S12+=0),lt<0&&([he,yt]=[yt,he],[bt,vt]=[vt,bt],w&e.GEODESICSCALE&&([C.M21,C.M12]=[C.M12,C.M21])),yt*=lt*xt,vt*=lt*tt,he*=lt*xt,bt*=lt*tt,{vals:C,salp1:yt,calp1:vt,salp2:he,calp2:bt}},e.Geodesic.prototype.GenDirect=function(M,R,A,L,w,C){var V;return C?C===e.LONG_UNROLL&&(C|=e.STANDARD):C=e.STANDARD,L||(C|=e.DISTANCE_IN),V=new r.GeodesicLine(this,M,R,A,C),V.GenPosition(L,w,C)},e.Geodesic.prototype.Direct=function(M,R,A,L,w){return this.GenDirect(M,R,A,!1,L,w)},e.Geodesic.prototype.ArcDirect=function(M,R,A,L,w){return this.GenDirect(M,R,A,!0,L,w)},e.Geodesic.prototype.Line=function(M,R,A,L){return new r.GeodesicLine(this,M,R,A,L)},e.Geodesic.prototype.DirectLine=function(M,R,A,L,w){return this.GenDirectLine(M,R,A,!1,L,w)},e.Geodesic.prototype.ArcDirectLine=function(M,R,A,L,w){return this.GenDirectLine(M,R,A,!0,L,w)},e.Geodesic.prototype.GenDirectLine=function(M,R,A,L,w,C){var V;return C||(C=e.STANDARD|e.DISTANCE_IN),L||(C|=e.DISTANCE_IN),V=new r.GeodesicLine(this,M,R,A,C),V.GenSetDistance(L,w),V},e.Geodesic.prototype.InverseLine=function(M,R,A,L,w){var C,V,ot;return w||(w=e.STANDARD|e.DISTANCE_IN),C=this.InverseInt(M,R,A,L,e.ARC),ot=s.atan2d(C.salp1,C.calp1),w&(e.OUT_MASK&e.DISTANCE_IN)&&(w|=e.DISTANCE),V=new r.GeodesicLine(this,M,R,ot,w,C.salp1,C.calp1),V.SetArc(C.vals.a12),V},e.Geodesic.prototype.Polygon=function(M){return new n.PolygonArea(this,M)},e.WGS84=new e.Geodesic(o.WGS84.a,o.WGS84.f)}(t.Geodesic,t.GeodesicLine,t.PolygonArea,t.Math,t.Constants),function(e,r,n){"use strict";r.GeodesicLine=function(s,o,a,l,c,h,u){var f,d,m,p,g,y;c||(c=e.STANDARD|e.DISTANCE_IN),this.a=s.a,this.f=s.f,this._b=s._b,this._c2=s._c2,this._f1=s._f1,this.caps=c|e.LATITUDE|e.AZIMUTH|e.LONG_UNROLL,this.lat1=n.LatFix(o),this.lon1=a,typeof h>"u"||typeof u>"u"?(this.azi1=n.AngNormalize(l),f=n.sincosd(n.AngRound(this.azi1)),this.salp1=f.s,this.calp1=f.c):(this.azi1=l,this.salp1=h,this.calp1=u),f=n.sincosd(n.AngRound(this.lat1)),m=this._f1*f.s,d=f.c,f=n.hypot(m,d),m/=f,d/=f,d=Math.max(e.tiny_,d),this._dn1=Math.sqrt(1+s._ep2*n.sq(m)),this._salp0=this.salp1*d,this._calp0=n.hypot(this.calp1,this.salp1*m),this._ssig1=m,this._somg1=this._salp0*m,this._csig1=this._comg1=m!==0||this.calp1!==0?d*this.calp1:1,f=n.hypot(this._ssig1,this._csig1),this._ssig1/=f,this._csig1/=f,this._k2=n.sq(this._calp0)*s._ep2,p=this._k2/(2*(1+Math.sqrt(1+this._k2))+this._k2),this.caps&e.CAP_C1&&(this._A1m1=e.A1m1f(p),this._C1a=new Array(e.nC1_+1),e.C1f(p,this._C1a),this._B11=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C1a),g=Math.sin(this._B11),y=Math.cos(this._B11),this._stau1=this._ssig1*y+this._csig1*g,this._ctau1=this._csig1*y-this._ssig1*g),this.caps&e.CAP_C1p&&(this._C1pa=new Array(e.nC1p_+1),e.C1pf(p,this._C1pa)),this.caps&e.CAP_C2&&(this._A2m1=e.A2m1f(p),this._C2a=new Array(e.nC2_+1),e.C2f(p,this._C2a),this._B21=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C2a)),this.caps&e.CAP_C3&&(this._C3a=new Array(e.nC3_),s.C3f(p,this._C3a),this._A3c=-this.f*this._salp0*s.A3f(p),this._B31=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C3a)),this.caps&e.CAP_C4&&(this._C4a=new Array(e.nC4_),s.C4f(p,this._C4a),this._A4=n.sq(this.a)*this._calp0*this._salp0*s._e2,this._B41=e.SinCosSeries(!1,this._ssig1,this._csig1,this._C4a)),this.a13=this.s13=NaN},r.GeodesicLine.prototype.GenPosition=function(s,o,a){var l={},c,h,u,f,d,m,p,g,y,_,x,v,E,b,S,T,P,F,k,z,W,G,O,X,M,R,A,L,w;return a?a===e.LONG_UNROLL&&(a|=e.STANDARD):a=e.STANDARD,a&=this.caps&e.OUT_MASK,l.lat1=this.lat1,l.azi1=this.azi1,l.lon1=a&e.LONG_UNROLL?this.lon1:n.AngNormalize(this.lon1),s?l.a12=o:l.s12=o,s||this.caps&e.DISTANCE_IN&e.OUT_MASK?(f=0,d=0,s?(c=o*n.degree,R=n.sincosd(o),h=R.s,u=R.c):(g=o/(this._b*(1+this._A1m1)),y=Math.sin(g),_=Math.cos(g),f=-e.SinCosSeries(!0,this._stau1*_+this._ctau1*y,this._ctau1*_-this._stau1*y,this._C1pa),c=g-(f-this._B11),h=Math.sin(c),u=Math.cos(c),Math.abs(this.f)>.01&&(m=this._ssig1*u+this._csig1*h,p=this._csig1*u-this._ssig1*h,f=e.SinCosSeries(!0,m,p,this._C1a),x=(1+this._A1m1)*(c+(f-this._B11))-o/this._b,c=c-x/Math.sqrt(1+this._k2*n.sq(m)),h=Math.sin(c),u=Math.cos(c))),m=this._ssig1*u+this._csig1*h,p=this._csig1*u-this._ssig1*h,G=Math.sqrt(1+this._k2*n.sq(m)),a&(e.DISTANCE|e.REDUCEDLENGTH|e.GEODESICSCALE)&&((s||Math.abs(this.f)>.01)&&(f=e.SinCosSeries(!0,m,p,this._C1a)),d=(1+this._A1m1)*(f-this._B11)),T=this._calp0*m,P=n.hypot(this._salp0,this._calp0*p),P===0&&(P=p=e.tiny_),z=this._salp0,W=this._calp0*p,s&&a&e.DISTANCE&&(l.s12=this._b*((1+this._A1m1)*c+d)),a&e.LONGITUDE&&(F=this._salp0*m,k=p,S=n.copysign(1,this._salp0),v=a&e.LONG_UNROLL?S*(c-(Math.atan2(m,p)-Math.atan2(this._ssig1,this._csig1))+(Math.atan2(S*F,k)-Math.atan2(S*this._somg1,this._comg1))):Math.atan2(F*this._comg1-k*this._somg1,k*this._comg1+F*this._somg1),E=v+this._A3c*(c+(e.SinCosSeries(!0,m,p,this._C3a)-this._B31)),b=E/n.degree,l.lon2=a&e.LONG_UNROLL?this.lon1+b:n.AngNormalize(n.AngNormalize(this.lon1)+n.AngNormalize(b))),a&e.LATITUDE&&(l.lat2=n.atan2d(T,this._f1*P)),a&e.AZIMUTH&&(l.azi2=n.atan2d(z,W)),a&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(O=e.SinCosSeries(!0,m,p,this._C2a),X=(1+this._A2m1)*(O-this._B21),M=(this._A1m1-this._A2m1)*c+(d-X),a&e.REDUCEDLENGTH&&(l.m12=this._b*(G*(this._csig1*m)-this._dn1*(this._ssig1*p)-this._csig1*p*M)),a&e.GEODESICSCALE&&(R=this._k2*(m-this._ssig1)*(m+this._ssig1)/(this._dn1+G),l.M12=u+(R*m-p*M)*this._ssig1/this._dn1,l.M21=u-(R*this._ssig1-this._csig1*M)*m/G)),a&e.AREA&&(A=e.SinCosSeries(!1,m,p,this._C4a),this._calp0===0||this._salp0===0?(L=z*this.calp1-W*this.salp1,w=W*this.calp1+z*this.salp1):(L=this._calp0*this._salp0*(u<=0?this._csig1*(1-u)+h*this._ssig1:h*(this._csig1*h/(1+u)+this._ssig1)),w=n.sq(this._salp0)+n.sq(this._calp0)*this._csig1*p),l.S12=this._c2*Math.atan2(L,w)+this._A4*(A-this._B41)),s||(l.a12=c/n.degree),l):(l.a12=NaN,l)},r.GeodesicLine.prototype.Position=function(s,o){return this.GenPosition(!1,s,o)},r.GeodesicLine.prototype.ArcPosition=function(s,o){return this.GenPosition(!0,s,o)},r.GeodesicLine.prototype.GenSetDistance=function(s,o){s?this.SetArc(o):this.SetDistance(o)},r.GeodesicLine.prototype.SetDistance=function(s){var o;this.s13=s,o=this.GenPosition(!1,this.s13,e.ARC),this.a13=0+o.a12},r.GeodesicLine.prototype.SetArc=function(s){var o;this.a13=s,o=this.GenPosition(!0,this.a13,e.DISTANCE),this.s13=0+o.s12}}(t.Geodesic,t.GeodesicLine,t.Math),function(e,r,n,s){"use strict";var o,a,l,c;o=function(h,u){var f=n.AngDiff(h,u).d;return h=n.AngNormalize(h),u=n.AngNormalize(u),f>0&&(h<0&&u>=0||h>0&&u===0)?1:f<0&&h>=0&&u<0?-1:0},a=function(h,u){return h=h%720,u=u%720,(0<=u&&u<360||u<-360?0:1)-(0<=h&&h<360||h<-360?0:1)},l=function(h,u,f,d,m){return h.Remainder(u),f&1&&h.Add((h.Sum()<0?1:-1)*u/2),d||h.Negate(),m?h.Sum()>u/2?h.Add(-u):h.Sum()<=-u/2&&h.Add(+u):h.Sum()>=u?h.Add(-u):h.Sum()<0&&h.Add(+u),0+h.Sum()},c=function(h,u,f,d,m){return h=n.remainder(h,u),f&1&&(h+=(h<0?1:-1)*u/2),d||(h*=-1),m?h>u/2?h-=u:h<=-u/2&&(h+=u):h>=u?h-=u:h<0&&(h+=u),0+h},e.PolygonArea=function(h,u){this._geod=h,this.a=this._geod.a,this.f=this._geod.f,this._area0=4*Math.PI*h._c2,this.polyline=u||!1,this._mask=r.LATITUDE|r.LONGITUDE|r.DISTANCE|(this.polyline?r.NONE:r.AREA|r.LONG_UNROLL),this.polyline||(this._areasum=new s.Accumulator(0)),this._perimetersum=new s.Accumulator(0),this.Clear()},e.PolygonArea.prototype.Clear=function(){this.num=0,this._crossings=0,this.polyline||this._areasum.Set(0),this._perimetersum.Set(0),this._lat0=this._lon0=this.lat=this.lon=NaN},e.PolygonArea.prototype.AddPoint=function(h,u){var f;this.num===0?(this._lat0=this.lat=h,this._lon0=this.lon=u):(f=this._geod.Inverse(this.lat,this.lon,h,u,this._mask),this._perimetersum.Add(f.s12),this.polyline||(this._areasum.Add(f.S12),this._crossings+=o(this.lon,u)),this.lat=h,this.lon=u),++this.num},e.PolygonArea.prototype.AddEdge=function(h,u){var f;this.num&&(f=this._geod.Direct(this.lat,this.lon,h,u,this._mask),this._perimetersum.Add(u),this.polyline||(this._areasum.Add(f.S12),this._crossings+=a(this.lon,f.lon2)),this.lat=f.lat2,this.lon=f.lon2),++this.num},e.PolygonArea.prototype.Compute=function(h,u){var f={number:this.num},d,m;return this.num<2?(f.perimeter=0,this.polyline||(f.area=0),f):this.polyline?(f.perimeter=this._perimetersum.Sum(),f):(d=this._geod.Inverse(this.lat,this.lon,this._lat0,this._lon0,this._mask),f.perimeter=this._perimetersum.Sum(d.s12),m=new s.Accumulator(this._areasum),m.Add(d.S12),f.area=l(m,this._area0,this._crossings+o(this.lon,this._lon0),h,u),f)},e.PolygonArea.prototype.TestPoint=function(h,u,f,d){var m={number:this.num+1},p,g,y,_;if(this.num===0)return m.perimeter=0,this.polyline||(m.area=0),m;for(m.perimeter=this._perimetersum.Sum(),g=this.polyline?0:this._areasum.Sum(),y=this._crossings,_=0;_<(this.polyline?1:2);++_)p=this._geod.Inverse(_===0?this.lat:h,_===0?this.lon:u,_!==0?this._lat0:h,_!==0?this._lon0:u,this._mask),m.perimeter+=p.s12,this.polyline||(g+=p.S12,y+=o(_===0?this.lon:u,_!==0?this._lon0:u));return this.polyline||(m.area=c(g,this._area0,y,f,d)),m},e.PolygonArea.prototype.TestEdge=function(h,u,f,d){var m={number:this.num?this.num+1:0},p,g,y;return this.num===0||(m.perimeter=this._perimetersum.Sum()+u,this.polyline)||(g=this._areasum.Sum(),y=this._crossings,p=this._geod.Direct(this.lat,this.lon,h,u,this._mask),g+=p.S12,y+=a(this.lon,p.lon2),y+=o(p.lon2,this._lon0),p=this._geod.Inverse(p.lat2,p.lon2,this._lat0,this._lon0,this._mask),m.perimeter+=p.s12,g+=p.S12,m.area=c(g,this._area0,y,f,d)),m}}(t.PolygonArea,t.Geodesic,t.Math,t.Accumulator),i(t)})(function(i){typeof Cd=="object"&&Cd.exports?Cd.exports=i:typeof define=="function"&&define.amd?define("geographiclib-geodesic",[],function(){return i}):window.geodesic=i})});var ei={ADD:"add",REMOVE:"remove"};var er={PROPERTYCHANGE:"propertychange"};var $={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};var Wd=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},Hr=Wd;function _1(i,t,e){let r,n;e=e||hi;let s=0,o=i.length,a=!1;for(;s<o;)r=s+(o-s>>1),n=+e(i[r],t),n<0?s=r+1:(o=r,a=!n);return a?s:~s}function hi(i,t){return i>t?1:i<t?-1:0}function x1(i,t){return i<t?1:i>t?-1:0}function ms(i,t,e){if(i[0]<=t)return 0;let r=i.length;if(t<=i[r-1])return r-1;if(typeof e=="function"){for(let n=1;n<r;++n){let s=i[n];if(s===t)return n;if(s<t)return e(t,i[n-1],s)>0?n-1:n}return r-1}if(e>0){for(let n=1;n<r;++n)if(i[n]<t)return n-1;return r-1}if(e<0){for(let n=1;n<r;++n)if(i[n]<=t)return n;return r-1}for(let n=1;n<r;++n){if(i[n]==t)return n;if(i[n]<t)return i[n-1]-t<t-i[n]?n-1:n}return r-1}function v1(i,t,e){for(;t<e;){let r=i[t];i[t]=i[e],i[e]=r,++t,--e}}function Gt(i,t){let e=Array.isArray(t)?t:[t],r=e.length;for(let n=0;n<r;n++)i[i.length]=e[n]}function ui(i,t){let e=i.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function E1(i,t,e){let r=t||hi;return i.every(function(n,s){if(s===0)return!0;let o=r(i[s-1],n);return!(o>0||e&&o===0)})}function Mn(){return!0}function Tn(){return!1}function Pn(){}function ph(i){let t,e,r;return function(){let n=Array.prototype.slice.call(arguments);return(!e||this!==r||!ui(n,e))&&(r=this,e=n,t=i.apply(this,arguments)),t}}function Zr(i){function t(){let e;try{e=i()}catch(r){return Promise.reject(r)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Jr(i){for(let t in i)delete i[t]}function vi(i){let t;for(t in i)return!1;return!t}var Yd=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Re=Yd;var $d=class extends Hr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;let r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){let e=typeof t=="string",r=e?t:t.type,n=this.listeners_&&this.listeners_[r];if(!n)return;let s=e?new Re(t):t;s.target||(s.target=this.eventTarget_||this);let o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});r in o||(o[r]=0,a[r]=0),++o[r];let l;for(let c=0,h=n.length;c<h;++c)if("handleEvent"in n[c]?l=n[c].handleEvent(s):l=n[c].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[r]===0){let c=a[r];for(delete a[r];c--;)this.removeEventListener(r,Pn);delete o[r]}return l}disposeInternal(){this.listeners_&&Jr(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;let r=this.listeners_[t];if(!r)return;let n=r.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=Pn,++this.pendingRemovals_[t]):(r.splice(n,1),r.length===0&&delete this.listeners_[t]))}},Qr=$d;function dt(i,t,e,r,n){if(n){let o=e;e=function(a){return i.removeEventListener(t,e),o.call(r??this,a)}}else r&&r!==i&&(e=e.bind(r));let s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function ps(i,t,e,r){return dt(i,t,e,r,!0)}function Tt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Jr(i))}var qo=class extends Qr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent($.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){let r=t.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=dt(this,t[s],e);return n}return dt(this,t,e)}onceInternal(t,e){let r;if(Array.isArray(t)){let n=t.length;r=new Array(n);for(let s=0;s<n;++s)r[s]=ps(this,t[s],e)}else r=ps(this,t,e);return e.ol_key=r,r}unInternal(t,e){let r=e.ol_key;if(r)Kd(r);else if(Array.isArray(t))for(let n=0,s=t.length;n<s;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}};qo.prototype.on;qo.prototype.once;qo.prototype.un;function Kd(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Tt(i[t]);else Tt(i)}var gh=qo;function nt(){throw new Error("Unimplemented abstract method.")}var eC=0;function H(i){return i.ol_uid||(i.ol_uid=String(++eC))}var yh=class extends Re{constructor(t,e,r){super(t),this.key=e,this.oldValue=r}},Hd=class extends gh{constructor(t){super(),this.on,this.once,this.un,H(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new yh(r,t,e)),r=er.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new yh(r,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,r){let n=this.values_||(this.values_={});if(r)n[t]=e;else{let s=n[t];n[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(let r in t)this.set(r,t[r],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){let r=this.values_[t];delete this.values_[t],vi(this.values_)&&(this.values_=null),e||this.notify(t,r)}}},Ie=Hd;var w1={LENGTH:"length"},Xo=class extends Re{constructor(t,e,r){super(t),this.element=e,this.index=r}},Zd=class extends Ie{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let r=0,n=this.array_.length;r<n;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,r=t.length;e<r;++e)this.push(t[e]);return this}forEach(t){let e=this.array_;for(let r=0,n=e.length;r<n;++r)t(e[r],r,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(w1.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Xo(ei.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);let e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){let e=this.array_;for(let r=0,n=e.length;r<n;++r)if(e[r]===t)return this.removeAt(r)}removeAt(t){if(t<0||t>=this.getLength())return;let e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Xo(ei.REMOVE,e,t)),e}setAt(t,e){let r=this.getLength();if(t>=r){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);let n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Xo(ei.REMOVE,n,t)),this.dispatchEvent(new Xo(ei.ADD,e,t))}updateLength_(){this.set(w1.LENGTH,this.array_.length)}assertUnique_(t,e){for(let r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===t&&r!==e)throw new Error("Duplicate item added to a unique collection")}},pe=Zd;var Jd=class extends Re{constructor(t,e,r){super(t),this.map=e,this.frameState=r!==void 0?r:null}},gs=Jd;var Qd=class extends gs{constructor(t,e,r,n,s,o){super(t,e,s),this.originalEvent=r,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},tn=Qd;var de={SINGLECLICK:"singleclick",CLICK:$.CLICK,DBLCLICK:$.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var io=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",iC=io.includes("safari")&&!io.includes("chrom"),H5=iC&&(io.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(io)),S1=io.includes("webkit")&&!io.includes("edge"),tm=io.includes("macintosh"),b1=typeof devicePixelRatio<"u"?devicePixelRatio:1,_h=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,xh=typeof Image<"u"&&Image.prototype.decode,em=typeof createImageBitmap=="function",vh=function(){let i=!1;try{let t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}();var ys={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var im=class extends Qr{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;let r=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=r,this.pointerdownListenerKey_=dt(r,ys.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=dt(r,ys.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener($.TOUCHMOVE,this.boundHandleTouchMove_,vh?{passive:!1}:!1)}emulateClick_(t){let e=new tn(de.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new tn(de.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let r=new tn(de.SINGLECLICK,this.map_,t);this.dispatchEvent(r)},250)}updateActivePointers_(t){let e=t,r=e.pointerId;if(e.type==de.POINTERUP||e.type==de.POINTERCANCEL){delete this.trackedTouches_[r];for(let n in this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else(e.type==de.POINTERDOWN||e.type==de.POINTERMOVE)&&(this.trackedTouches_[r]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);let e=new tn(de.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Tt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);let e=new tn(de.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){let r=this.map_.getOwnerDocument();this.dragListenerKeys_.push(dt(r,de.POINTERMOVE,this.handlePointerMove_,this),dt(r,de.POINTERUP,this.handlePointerUp_,this),dt(this.element_,de.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==r&&this.dragListenerKeys_.push(dt(this.element_.getRootNode(),de.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;let e=new tn(de.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;let e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new tn(de.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){let e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Tt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener($.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Tt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Tt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},C1=im;var Li={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var Ee={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var q={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Et(i,t){if(!i)throw new Error(t)}var dl=1/0,rm=class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Jr(this.queuedElements_)}dequeue(){let t=this.elements_,e=this.priorities_,r=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));let n=this.keyFunction_(r);return delete this.queuedElements_[n],r}enqueue(t){Et(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let e=this.priorityFunction_(t);return e!=dl?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){let e=this.elements_,r=this.priorities_,n=e.length,s=e[t],o=r[t],a=t;for(;t<n>>1;){let l=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),h=c<n&&r[c]<r[l]?c:l;e[t]=e[h],r[t]=r[h],t=h}e[t]=s,r[t]=o,this.siftDown_(a,t)}siftDown_(t,e){let r=this.elements_,n=this.priorities_,s=r[e],o=n[e];for(;e>t;){let a=this.getParentIndex_(e);if(n[a]>o)r[e]=r[a],n[e]=n[a],e=a;else break}r[e]=s,n[e]=o}reprioritize(){let t=this.priorityFunction_,e=this.elements_,r=this.priorities_,n=0,s=e.length,o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==dl?delete this.queuedElements_[this.keyFunction_(o)]:(r[n]=l,e[n++]=o);e.length=n,r.length=n,this.heapify_()}},M1=rm;var nm=class extends M1{constructor(t,e){super(r=>t.apply(null,r),r=>r[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){let e=super.enqueue(t);return e&&t[0].addEventListener($.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){let e=t.target,r=e.getState();if(r===q.LOADED||r===q.ERROR||r===q.EMPTY){r!==q.ERROR&&e.removeEventListener($.CHANGE,this.boundHandleTileChange_);let n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let r=0;for(;this.tilesLoading_<t&&r<e&&this.getCount()>0;){let n=this.dequeue()[0],s=n.getKey();n.getState()===q.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++r,n.load())}}},Eh=nm;function T1(i,t,e,r,n){if(!i||!(e in i.wantedTiles))return dl;if(!i.wantedTiles[e][t.getKey()])return dl;let s=i.viewState.center,o=r[0]-s[0],a=r[1]-s[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}var ie={ANIMATING:0,INTERACTING:1};var Ei={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function ht(i,t,e){return Math.min(Math.max(i,t),e)}function wh(i,t,e,r,n,s){let o=n-e,a=s-r;if(o!==0||a!==0){let l=((i-e)*o+(t-r)*a)/(o*o+a*a);l>1?(e=n,r=s):l>0&&(e+=o*l,r+=a*l)}return Ar(i,t,e,r)}function Ar(i,t,e,r){let n=e-i,s=r-t;return n*n+s*s}function P1(i){let t=i.length;for(let r=0;r<t;r++){let n=r,s=Math.abs(i[r][r]);for(let a=r+1;a<t;a++){let l=Math.abs(i[a][r]);l>s&&(s=l,n=a)}if(s===0)return null;let o=i[n];i[n]=i[r],i[r]=o;for(let a=r+1;a<t;a++){let l=-i[a][r]/i[r][r];for(let c=r;c<t+1;c++)r==c?i[a][c]=0:i[a][c]+=l*i[r][c]}}let e=new Array(t);for(let r=t-1;r>=0;r--){e[r]=i[r][t]/i[r][r];for(let n=r-1;n>=0;n--)i[n][t]-=i[n][r]*e[r]}return e}function ml(i){return i*180/Math.PI}function Oi(i){return i*Math.PI/180}function Fi(i,t){let e=i%t;return e*t<0?e+t:e}function si(i,t,e){return i+e*(t-i)}function Rn(i,t){let e=Math.pow(10,t);return Math.round(i*e)/e}function sm(i,t){return Math.round(Rn(i,t))}function _s(i,t){return Math.floor(Rn(i,t))}function en(i,t){return Math.ceil(Rn(i,t))}function Sh(i,t,e){if(i>=t&&i<e)return i;let r=e-t;return((i-t)%r+r)%r+t}function om(i,t,e){return function(r,n,s,o,a){if(!r)return;if(!n&&!t)return r;let l=t?0:s[0]*n,c=t?0:s[1]*n,h=a?a[0]:0,u=a?a[1]:0,f=i[0]+l/2+h,d=i[2]-l/2+h,m=i[1]+c/2+u,p=i[3]-c/2+u;f>d&&(f=(d+f)/2,d=f),m>p&&(m=(p+m)/2,p=m);let g=ht(r[0],f,d),y=ht(r[1],m,p);if(o&&e&&n){let _=30*n;g+=-_*Math.log(1+Math.max(0,f-r[0])/_)+_*Math.log(1+Math.max(0,r[0]-d)/_),y+=-_*Math.log(1+Math.max(0,m-r[1])/_)+_*Math.log(1+Math.max(0,r[1]-p)/_)}return[g,y]}}function R1(i){return i}var Ge={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function pl(i){let t=ge();for(let e=0,r=i.length;e<r;++e)ro(t,i[e]);return t}function rC(i,t,e){let r=Math.min.apply(null,i),n=Math.min.apply(null,t),s=Math.max.apply(null,i),o=Math.max.apply(null,t);return ir(r,n,s,o,e)}function ii(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function Ch(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function Ni(i,t,e){let r,n;return t<i[0]?r=i[0]-t:i[2]<t?r=t-i[2]:r=0,e<i[1]?n=i[1]-e:i[3]<e?n=e-i[3]:n=0,r*r+n*n}function ke(i,t){return gl(i,t[0],t[1])}function Ce(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function gl(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function bh(i,t){let e=i[0],r=i[1],n=i[2],s=i[3],o=t[0],a=t[1],l=Ge.UNKNOWN;return o<e?l=l|Ge.LEFT:o>n&&(l=l|Ge.RIGHT),a<r?l=l|Ge.BELOW:a>s&&(l=l|Ge.ABOVE),l===Ge.UNKNOWN&&(l=Ge.INTERSECTING),l}function ge(){return[1/0,1/0,-1/0,-1/0]}function ir(i,t,e,r,n){return n?(n[0]=i,n[1]=t,n[2]=e,n[3]=r,n):[i,t,e,r]}function In(i){return ir(1/0,1/0,-1/0,-1/0,i)}function Vo(i,t){let e=i[0],r=i[1];return ir(e,r,e,r,t)}function Wo(i,t,e,r,n){let s=In(n);return am(s,i,t,e,r)}function ze(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function I1(i,t,e){return Math.abs(i[0]-t[0])<e&&Math.abs(i[2]-t[2])<e&&Math.abs(i[1]-t[1])<e&&Math.abs(i[3]-t[3])<e}function Yo(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function ro(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function am(i,t,e,r,n){for(;e<r;e+=n)nC(i,t[e],t[e+1]);return i}function nC(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Mh(i,t){let e;return e=t($o(i)),e||(e=t(xs(i)),e)||(e=t(Ko(i)),e)||(e=t(Ue(i)),e)?e:!1}function yl(i){let t=0;return Di(i)||(t=it(i)*Ft(i)),t}function $o(i){return[i[0],i[1]]}function xs(i){return[i[2],i[1]]}function re(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function A1(i,t){let e;if(t==="bottom-left")e=$o(i);else if(t==="bottom-right")e=xs(i);else if(t==="top-left")e=Ue(i);else if(t==="top-right")e=Ko(i);else throw new Error("Invalid corner");return e}function An(i,t,e,r,n){let[s,o,a,l,c,h,u,f]=lm(i,t,e,r);return ir(Math.min(s,a,c,u),Math.min(o,l,h,f),Math.max(s,a,c,u),Math.max(o,l,h,f),n)}function lm(i,t,e,r){let n=t*r[0]/2,s=t*r[1]/2,o=Math.cos(e),a=Math.sin(e),l=n*o,c=n*a,h=s*o,u=s*a,f=i[0],d=i[1];return[f-l+u,d-c-h,f-l-u,d-c+h,f+l-u,d+c+h,f+l+u,d+c-h,f-l+u,d-c-h]}function Ft(i){return i[3]-i[1]}function je(i,t,e){let r=e||ge();return kt(i,t)?(i[0]>t[0]?r[0]=i[0]:r[0]=t[0],i[1]>t[1]?r[1]=i[1]:r[1]=t[1],i[2]<t[2]?r[2]=i[2]:r[2]=t[2],i[3]<t[3]?r[3]=i[3]:r[3]=t[3]):In(r),r}function Ue(i){return[i[0],i[3]]}function Ko(i){return[i[2],i[3]]}function it(i){return i[2]-i[0]}function kt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Di(i){return i[2]<i[0]||i[3]<i[1]}function L1(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Th(i,t){let e=(i[2]-i[0])/2*(t-1),r=(i[3]-i[1])/2*(t-1);i[0]-=e,i[2]+=e,i[1]-=r,i[3]+=r}function O1(i,t,e){let r=!1,n=bh(i,t),s=bh(i,e);if(n===Ge.INTERSECTING||s===Ge.INTERSECTING)r=!0;else{let o=i[0],a=i[1],l=i[2],c=i[3],h=t[0],u=t[1],f=e[0],d=e[1],m=(d-u)/(f-h),p,g;s&Ge.ABOVE&&!(n&Ge.ABOVE)&&(p=f-(d-c)/m,r=p>=o&&p<=l),!r&&s&Ge.RIGHT&&!(n&Ge.RIGHT)&&(g=d-(f-l)*m,r=g>=a&&g<=c),!r&&s&Ge.BELOW&&!(n&Ge.BELOW)&&(p=f-(d-a)/m,r=p>=o&&p<=l),!r&&s&Ge.LEFT&&!(n&Ge.LEFT)&&(g=d-(f-o)*m,r=g>=a&&g<=c)}return r}function no(i,t,e,r){if(Di(i))return In(e);let n=[];if(r>1){let a=i[2]-i[0],l=i[3]-i[1];for(let c=0;c<r;++c)n.push(i[0]+a*c/r,i[1],i[2],i[1]+l*c/r,i[2]-a*c/r,i[3],i[0],i[3]-l*c/r)}else n=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]];t(n,n,2);let s=[],o=[];for(let a=0,l=n.length;a<l;a+=2)s.push(n[a]),o.push(n[a+1]);return rC(s,o,e)}function _l(i,t){let e=t.getExtent(),r=re(i);if(t.canWrapX()&&(r[0]<e[0]||r[0]>=e[2])){let n=it(e),o=Math.floor((r[0]-e[0])/n)*n;i[0]-=o,i[2]-=o}return i}function Ph(i,t,e){if(t.canWrapX()){let r=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[r[0],i[1],r[2],i[3]]];_l(i,t);let n=it(r);if(it(i)>n&&!e)return[[r[0],i[1],r[2],i[3]]];if(i[0]<r[0])return[[i[0]+n,i[1],r[2],i[3]],[r[0],i[1],i[2],i[3]]];if(i[2]>r[2])return[[i[0],i[1],r[2],i[3]],[r[0],i[1],i[2]-n,i[3]]]}return[i]}function cm(i,t,e){let r=e!==void 0?i.toFixed(e):""+i,n=r.indexOf(".");return n=n===-1?r.length:n,n>t?r:new Array(1+t-n).join("0")+r}function xl(i,t){let e=(""+i).split("."),r=(""+t).split(".");for(let n=0;n<Math.max(e.length,r.length);n++){let s=parseInt(e[n]||"0",10),o=parseInt(r[n]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function Rh(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function hm(i,t,e){let r=Fi(t+180,360)-180,n=Math.abs(3600*r),s=e||0,o=Math.floor(n/3600),a=Math.floor((n-o*3600)/60),l=Rn(n-o*3600-a*60,s);l>=60&&(l=0,a+=1),a>=60&&(a=0,o+=1);let c=o+"\xB0";return(a!==0||l!==0)&&(c+=" "+cm(a,2)+"\u2032"),l!==0&&(c+=" "+cm(l,2,s)+"\u2033"),r!==0&&(c+=" "+i.charAt(r<0?1:0)),c}function sC(i,t,e){return i?t.replace("{x}",i[0].toFixed(e)).replace("{y}",i[1].toFixed(e)):""}function so(i,t){let e=!0;for(let r=i.length-1;r>=0;--r)if(i[r]!=t[r]){e=!1;break}return e}function Ho(i,t){let e=Math.cos(t),r=Math.sin(t),n=i[0]*e-i[1]*r,s=i[1]*e+i[0]*r;return i[0]=n,i[1]=s,i}function Ih(i,t){return i[0]*=t,i[1]*=t,i}function oC(i,t){let e=i[0]-t[0],r=i[1]-t[1];return e*e+r*r}function F1(i,t){return Math.sqrt(oC(i,t))}function N1(i,t){return sC(i,"{x}, {y}",t)}function vs(i,t){if(t.canWrapX()){let e=it(t.getExtent()),r=um(i,t,e);r&&(i[0]-=r*e)}return i}function um(i,t,e){let r=t.getExtent(),n=0;return t.canWrapX()&&(i[0]<r[0]||i[0]>r[2])&&(e=e||it(r),n=Math.floor((i[0]-r[0])/e)),n}function fm(i){return Math.pow(i,3)}function Gi(i){return 1-fm(1-i)}function D1(i){return 3*i*i-2*i*i*i}function G1(i){return i}var aC=63710088e-1;function dm(i,t,e){e=e||aC;let r=Oi(i[1]),n=Oi(t[1]),s=(n-r)/2,o=Oi(t[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(r)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var k1={info:1,warn:2,error:3,none:4},lC=k1.info;function Ah(...i){lC>k1.warn||console.warn(...i)}var rr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var mm=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||rr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},ki=mm;var vl=6378137,Zo=Math.PI*vl,cC=[-Zo,-Zo,Zo,Zo],hC=[-180,-85,180,85],Lh=vl*Math.log(Math.tan(Math.PI/2)),Es=class extends ki{constructor(t){super({code:t,units:"m",extent:cC,global:!0,worldExtent:hC,getPointResolution:function(e,r){return e/Math.cosh(r[1]/vl)}})}},pm=[new Es("EPSG:3857"),new Es("EPSG:102100"),new Es("EPSG:102113"),new Es("EPSG:900913"),new Es("http://www.opengis.net/def/crs/EPSG/0/3857"),new Es("http://www.opengis.net/gml/srs/epsg.xml#3857")];function z1(i,t,e,r){let n=i.length;e=e>1?e:2,r=r??e,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let s=0;s<n;s+=r){t[s]=Zo*i[s]/180;let o=vl*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));o>Lh?o=Lh:o<-Lh&&(o=-Lh),t[s+1]=o}return t}function j1(i,t,e,r){let n=i.length;e=e>1?e:2,r=r??e,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let s=0;s<n;s+=r)t[s]=180*i[s]/Zo,t[s+1]=360*Math.atan(Math.exp(i[s+1]/vl))/Math.PI-90;return t}var uC=6378137,U1=[-180,-90,180,90],fC=Math.PI*uC/180,Ln=class extends ki{constructor(t,e){super({code:t,units:"degrees",extent:U1,axisOrientation:e,global:!0,metersPerUnit:fC,worldExtent:U1})}},gm=[new Ln("CRS:84"),new Ln("EPSG:4326","neu"),new Ln("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ln("urn:ogc:def:crs:OGC:2:84"),new Ln("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ln("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ln("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var ym={};function Jo(i){return ym[i]||ym[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function B1(i,t){ym[i]=t}var Qo={};function ws(i,t,e){let r=i.getCode(),n=t.getCode();r in Qo||(Qo[r]={}),Qo[r][n]=e}function ta(i,t){return i in Qo&&t in Qo[i]?Qo[i][t]:null}var Oh=.9996,xr=.00669438,Nh=xr*xr,Dh=Nh*xr,oo=xr/(1-xr),q1=Math.sqrt(1-xr),ea=(1-q1)/(1+q1),Y1=ea*ea,_m=Y1*ea,xm=_m*ea,$1=xm*ea,K1=1-xr/4-3*Nh/64-5*Dh/256,dC=3*xr/8+3*Nh/32+45*Dh/1024,mC=15*Nh/256+45*Dh/1024,pC=35*Dh/3072,gC=3/2*ea-27/32*_m+269/512*$1,yC=21/16*Y1-55/32*xm,_C=151/96*_m-417/128*$1,xC=1097/512*xm,Fh=6378137;function vC(i,t,e){let r=i-5e5,o=(e.north?t:t-1e7)/Oh/(Fh*K1),a=o+gC*Math.sin(2*o)+yC*Math.sin(4*o)+_C*Math.sin(6*o)+xC*Math.sin(8*o),l=Math.sin(a),c=l*l,h=Math.cos(a),u=l/h,f=u*u,d=f*f,m=1-xr*c,p=Math.sqrt(1-xr*c),g=Fh/p,y=(1-xr)/m,_=oo*h**2,x=_*_,v=r/(g*Oh),E=v*v,b=E*v,S=b*v,T=S*v,P=T*v,F=a-u/y*(E/2-S/24*(5+3*f+10*_-4*x-9*oo))+P/720*(61+90*f+298*_+45*d-252*oo-3*x),k=(v-b/6*(1+2*f+_)+T/120*(5-2*_+28*f-3*x+8*oo+24*d))/h;return k=Sh(k+Oi(H1(e.number)),-Math.PI,Math.PI),[ml(k),ml(F)]}var X1=-80,V1=84,EC=-180,wC=180;function SC(i,t,e){i=Sh(i,EC,wC),t<X1?t=X1:t>V1&&(t=V1);let r=Oi(t),n=Math.sin(r),s=Math.cos(r),o=n/s,a=o*o,l=a*a,c=Oi(i),h=H1(e.number),u=Oi(h),f=Fh/Math.sqrt(1-xr*n**2),d=oo*s**2,m=s*Sh(c-u,-Math.PI,Math.PI),p=m*m,g=p*m,y=g*m,_=y*m,x=_*m,v=Fh*(K1*r-dC*Math.sin(2*r)+mC*Math.sin(4*r)-pC*Math.sin(6*r)),E=Oh*f*(m+g/6*(1-a+d)+_/120*(5-18*a+l+72*d-58*oo))+5e5,b=Oh*(v+f*o*(p/2+y/24*(5-a+9*d+4*d**2)+x/720*(61-58*a+l+600*d-330*oo)));return e.north||(b+=1e7),[E,b]}function H1(i){return(i-1)*6-180+3}var bC=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Z1(i){let t=0;for(let n of bC){let s=i.match(n);if(s){t=parseInt(s[1]);break}}if(!t)return null;let e=0,r=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(r=!0,e=t-32600),e?{number:e,north:r}:null}function W1(i,t){return function(e,r,n,s){let o=e.length;n=n>1?n:2,s=s??n,r||(n>2?r=e.slice():r=new Array(o));for(let a=0;a<o;a+=s){let l=e[a],c=e[a+1],h=i(l,c,t);r[a]=h[0],r[a+1]=h[1]}return r}}function J1(i){return Z1(i)?new ki({code:i,units:"m"}):null}function Q1(i){let t=Z1(i.getCode());return t?{forward:W1(SC,t),inverse:W1(vC,t)}:null}var CC=[Q1],MC=[J1];var Em=!0;function wm(i){Em=!(i===void 0?!0:i)}function Sm(i,t){if(t!==void 0){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];t=t}else t=i.slice();return t}function tx(i,t){if(t!==void 0&&i!==t){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];i=t}return i}function El(i){B1(i.getCode(),i),ws(i,i,Sm)}function TC(i){i.forEach(El)}function Z(i){if(typeof i!="string")return i;let t=Jo(i);if(t)return t;for(let e of MC){let r=e(i);if(r)return r}return null}function ao(i,t,e,r){i=Z(i);let n,s=i.getPointResolutionFunc();if(s){if(n=s(t,e),r&&r!==i.getUnits()){let o=i.getMetersPerUnit();o&&(n=n*o/rr[r])}}else{let o=i.getUnits();if(o=="degrees"&&!r||r=="degrees")n=t;else{let a=zi(i,Z("EPSG:4326"));if(!a&&o!=="degrees")n=t*i.getMetersPerUnit();else{let c=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];c=a(c,c,2);let h=dm(c.slice(0,2),c.slice(2,4)),u=dm(c.slice(4,6),c.slice(6,8));n=(h+u)/2}let l=r?rr[r]:i.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Gh(i){TC(i),i.forEach(function(t){i.forEach(function(e){t!==e&&ws(t,e,Sm)})})}function PC(i,t,e,r){i.forEach(function(n){t.forEach(function(s){ws(n,s,e),ws(s,n,r)})})}function zh(i,t){return i?typeof i=="string"?Z(i):i:Z(t)}function kh(i){return function(t,e,r,n){let s=t.length;r=r!==void 0?r:2,n=n??r,e=e!==void 0?e:new Array(s);for(let o=0;o<s;o+=n){let a=i(t.slice(o,o+r)),l=a.length;for(let c=0,h=n;c<h;++c)e[o+c]=c>=l?t[o+c]:a[c]}return e}}function ex(i,t,e,r){let n=Z(i),s=Z(t);ws(n,s,kh(e)),ws(s,n,kh(r))}function bm(i,t){return wm(),di(i,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function fi(i,t){if(i===t)return!0;let e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||zi(i,t)===Sm)&&e}function zi(i,t){let e=i.getCode(),r=t.getCode(),n=ta(e,r);if(n)return n;let s=null,o=null;for(let l of CC)s||(s=l(i)),o||(o=l(t));if(!s&&!o)return null;let a="EPSG:4326";if(o)if(s)n=vm(s.inverse,o.forward);else{let l=ta(e,a);l&&(n=vm(l,o.forward))}else{let l=ta(a,r);l&&(n=vm(s.inverse,l))}return n&&(El(i),El(t),ws(i,t,n)),n}function vm(i,t){return function(e,r,n,s){return r=i(e,r,n,s),t(r,r,n,s)}}function wi(i,t){let e=Z(i),r=Z(t);return zi(e,r)}function di(i,t,e){let r=wi(t,e);if(!r){let n=Z(t).getCode(),s=Z(e).getCode();throw new Error(`No transform available between ${n} and ${s}`)}return r(i,void 0,i.length)}function nr(i,t,e,r){let n=wi(t,e);return no(i,n,void 0,r)}var Lr=null;function sr(){return Lr}function wl(i,t){return Lr?di(i,t,Lr):i}function Or(i,t){return Lr?di(i,Lr,t):(Em&&!so(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Em=!1,Ah("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i)}function Ss(i,t){return Lr?nr(i,t,Lr):i}function Si(i,t){return Lr?nr(i,Lr,t):i}function ix(i,t){if(!Lr)return i;let e=Z(t).getMetersPerUnit(),r=Lr.getMetersPerUnit();return e&&r?i*e/r:i}function Cm(i,t,e){return function(r){let n,s;if(i.canWrapX()){let o=i.getExtent(),a=it(o);r=r.slice(0),s=um(r,i,a),s&&(r[0]=r[0]-s*a),r[0]=ht(r[0],o[0],o[2]),r[1]=ht(r[1],o[1],o[3]),n=e(r)}else n=e(r);return s&&t.canWrapX()&&(n[0]+=s*it(t.getExtent())),n}}function RC(){Gh(pm),Gh(gm),PC(gm,pm,z1,j1)}RC();var nx=new Array(6);function we(){return[1,0,0,1,0,0]}function Mm(i){return Tm(i,1,0,0,1,0,0)}function ia(i,t){let e=i[0],r=i[1],n=i[2],s=i[3],o=i[4],a=i[5],l=t[0],c=t[1],h=t[2],u=t[3],f=t[4],d=t[5];return i[0]=e*l+n*c,i[1]=r*l+s*c,i[2]=e*h+n*u,i[3]=r*h+s*u,i[4]=e*f+n*d+o,i[5]=r*f+s*d+a,i}function Tm(i,t,e,r,n,s,o){return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i[4]=s,i[5]=o,i}function sx(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function ne(i,t){let e=t[0],r=t[1];return t[0]=i[0]*e+i[2]*r+i[4],t[1]=i[1]*e+i[3]*r+i[5],t}function ra(i,t,e){return ia(i,Tm(nx,t,0,0,e,0,0))}function ox(i,t,e){return ia(i,Tm(nx,1,0,0,1,t,e))}function $e(i,t,e,r,n,s,o,a){let l=Math.sin(s),c=Math.cos(s);return i[0]=r*c,i[1]=n*l,i[2]=-r*l,i[3]=n*c,i[4]=o*r*c-a*r*l+t,i[5]=o*n*l+a*n*c+e,i}function jh(i,t){let e=IC(t);Et(e!==0,"Transformation matrix cannot be inverted");let r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return i[0]=o/e,i[1]=-n/e,i[2]=-s/e,i[3]=r/e,i[4]=(s*l-o*a)/e,i[5]=-(r*l-n*a)/e,i}function IC(i){return i[0]*i[3]-i[1]*i[2]}var AC=[1e5,1e5,1e5,1e5,2,2];function ax(i){return"matrix("+i.join(", ")+")"}function rx(i){return i.substring(7,i.length-1).split(",").map(parseFloat)}function lx(i,t){let e=rx(i),r=rx(t);for(let n=0;n<6;++n)if(Math.round((e[n]-r[n])*AC[n])!==0)return!1;return!0}function ji(i,t,e,r,n,s,o){s=s||[],o=o||2;let a=0;for(let l=t;l<e;l+=r){let c=i[l],h=i[l+1];s[a++]=n[0]*c+n[2]*h+n[4],s[a++]=n[1]*c+n[3]*h+n[5];for(let u=2;u<o;u++)s[a++]=i[l+u]}return s&&s.length!=a&&(s.length=a),s}function Uh(i,t,e,r,n,s,o){o=o||[];let a=Math.cos(n),l=Math.sin(n),c=s[0],h=s[1],u=0;for(let f=t;f<e;f+=r){let d=i[f]-c,m=i[f+1]-h;o[u++]=c+d*a-m*l,o[u++]=h+d*l+m*a;for(let p=f+2;p<f+r;++p)o[u++]=i[p]}return o&&o.length!=u&&(o.length=u),o}function cx(i,t,e,r,n,s,o,a){a=a||[];let l=o[0],c=o[1],h=0;for(let u=t;u<e;u+=r){let f=i[u]-l,d=i[u+1]-c;a[h++]=l+n*f,a[h++]=c+s*d;for(let m=u+2;m<u+r;++m)a[h++]=i[m]}return a&&a.length!=h&&(a.length=h),a}function hx(i,t,e,r,n,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=r){o[a++]=i[l]+n,o[a++]=i[l+1]+s;for(let c=l+2;c<l+r;++c)o[a++]=i[c]}return o&&o.length!=a&&(o.length=a),o}var ux=we(),LC=[NaN,NaN],Pm=class extends Ie{constructor(){super(),this.extent_=ge(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ph((t,e,r)=>{if(!r)return this.getSimplifiedGeometry(e);let n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return nt()}closestPointXY(t,e,r,n){return nt()}containsXY(t,e){return this.closestPointXY(t,e,LC,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return nt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){let e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&In(e),this.extentRevision_=this.getRevision()}return L1(this.extent_,t)}rotate(t,e){nt()}scale(t,e,r){nt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return nt()}getType(){return nt()}applyTransform(t){nt()}intersectsExtent(t){return nt()}translate(t,e){nt()}transform(t,e){let r=Z(t),n=r.getUnits()=="tile-pixels"?function(s,o,a){let l=r.getExtent(),c=r.getWorldExtent(),h=Ft(c)/Ft(l);$e(ux,c[0],c[3],h,-h,0,0,0);let u=ji(s,0,s.length,a,ux,o),f=wi(r,e);return f?f(u,u,a):u}:wi(r,e);return this.applyTransform(n),this}},Bh=Pm;var Rm=class extends Bh{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return nt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=fx(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){nt()}setLayout(t,e,r){let n;if(t)n=fx(t);else{for(let s=0;s<r;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}n=e.length,t=bs(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){let r=this.getFlatCoordinates();if(r){let n=this.getStride();Uh(r,0,r.length,n,t,e,r),this.changed()}}scale(t,e,r){e===void 0&&(e=t),r||(r=re(this.getExtent()));let n=this.getFlatCoordinates();if(n){let s=this.getStride();cx(n,0,n.length,s,t,e,r,n),this.changed()}}translate(t,e){let r=this.getFlatCoordinates();if(r){let n=this.getStride();hx(r,0,r.length,n,t,e,r),this.changed()}}};function bs(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function fx(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function dx(i,t,e){let r=i.getFlatCoordinates();if(!r)return null;let n=i.getStride();return ji(r,0,r.length,n,t,e)}var Ui=Rm;function Im(i,t,e,r){let n=0,s=i[e-r],o=i[e-r+1],a=0,l=0;for(;t<e;t+=r){let c=i[t]-s,h=i[t+1]-o;n+=l*c-a*h,a=c,l=h}return n/2}function Am(i,t,e,r){let n=0;for(let s=0,o=e.length;s<o;++s){let a=e[s];n+=Im(i,t,a,r),t=a}return n}function mx(i,t,e,r){let n=0;for(let s=0,o=e.length;s<o;++s){let a=e[s];n+=Am(i,t,a,r),t=a[a.length-1]}return n}function px(i,t,e,r,n,s,o){let a=i[t],l=i[t+1],c=i[e]-a,h=i[e+1]-l,u;if(c===0&&h===0)u=t;else{let f=((n-a)*c+(s-l)*h)/(c*c+h*h);if(f>1)u=e;else if(f>0){for(let d=0;d<r;++d)o[d]=si(i[t+d],i[e+d],f);o.length=r;return}else u=t}for(let f=0;f<r;++f)o[f]=i[u+f];o.length=r}function Sl(i,t,e,r,n){let s=i[t],o=i[t+1];for(t+=r;t<e;t+=r){let a=i[t],l=i[t+1],c=Ar(s,o,a,l);c>n&&(n=c),s=a,o=l}return n}function bl(i,t,e,r,n){for(let s=0,o=e.length;s<o;++s){let a=e[s];n=Sl(i,t,a,r,n),t=a}return n}function gx(i,t,e,r,n){for(let s=0,o=e.length;s<o;++s){let a=e[s];n=bl(i,t,a,r,n),t=a[a.length-1]}return n}function Cl(i,t,e,r,n,s,o,a,l,c,h){if(t==e)return c;let u,f;if(n===0){if(f=Ar(o,a,i[t],i[t+1]),f<c){for(u=0;u<r;++u)l[u]=i[t+u];return l.length=r,f}return c}h=h||[NaN,NaN];let d=t+r;for(;d<e;)if(px(i,d-r,d,r,o,a,h),f=Ar(o,a,h[0],h[1]),f<c){for(c=f,u=0;u<r;++u)l[u]=h[u];l.length=r,d+=r}else d+=r*Math.max((Math.sqrt(f)-Math.sqrt(c))/n|0,1);if(s&&(px(i,e-r,t,r,o,a,h),f=Ar(o,a,h[0],h[1]),f<c)){for(c=f,u=0;u<r;++u)l[u]=h[u];l.length=r}return c}function Ml(i,t,e,r,n,s,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){let d=e[u];c=Cl(i,t,d,r,n,s,o,a,l,c,h),t=d}return c}function yx(i,t,e,r,n,s,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){let d=e[u];c=Ml(i,t,d,r,n,s,o,a,l,c,h),t=d[d.length-1]}return c}function _x(i,t,e,r){for(let n=0,s=e.length;n<s;++n)i[t++]=e[n];return t}function lo(i,t,e,r){for(let n=0,s=e.length;n<s;++n){let o=e[n];for(let a=0;a<r;++a)i[t++]=o[a]}return t}function Cs(i,t,e,r,n){n=n||[];let s=0;for(let o=0,a=e.length;o<a;++o){let l=lo(i,t,e[o],r);n[s++]=l,t=l}return n.length=s,n}function qh(i,t,e,r,n){n=n||[];let s=0;for(let o=0,a=e.length;o<a;++o){let l=Cs(i,t,e[o],r,n[s]);l.length===0&&(l[0]=t),n[s++]=l,t=l[l.length-1]}return n.length=s,n}function vr(i,t,e,r,n){n=n!==void 0?n:[];let s=0;for(let o=t;o<e;o+=r)n[s++]=i.slice(o,o+r);return n.length=s,n}function Ms(i,t,e,r,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=e.length;o<a;++o){let l=e[o];n[s++]=vr(i,t,l,r,n[s]),t=l}return n.length=s,n}function Tl(i,t,e,r,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=e.length;o<a;++o){let l=e[o];n[s++]=l.length===1&&l[0]===t?[]:Ms(i,t,l,r,n[s]),t=l[l.length-1]}return n.length=s,n}function co(i,t,e,r,n,s,o){let a=(e-t)/r;if(a<3){for(;t<e;t+=r)s[o++]=i[t],s[o++]=i[t+1];return o}let l=new Array(a);l[0]=1,l[a-1]=1;let c=[t,e-r],h=0;for(;c.length>0;){let u=c.pop(),f=c.pop(),d=0,m=i[f],p=i[f+1],g=i[u],y=i[u+1];for(let _=f+r;_<u;_+=r){let x=i[_],v=i[_+1],E=wh(x,v,m,p,g,y);E>d&&(h=_,d=E)}d>n&&(l[(h-t)/r]=1,f+r<h&&c.push(f,h),h+r<u&&c.push(h,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[t+u*r],s[o++]=i[t+u*r+1]);return o}function Xh(i,t,e,r,n,s,o,a){for(let l=0,c=e.length;l<c;++l){let h=e[l];o=co(i,t,h,r,n,s,o),a.push(o),t=h}return o}function Ts(i,t){return t*Math.round(i/t)}function OC(i,t,e,r,n,s,o){if(t==e)return o;let a=Ts(i[t],n),l=Ts(i[t+1],n);t+=r,s[o++]=a,s[o++]=l;let c,h;do if(c=Ts(i[t],n),h=Ts(i[t+1],n),t+=r,t==e)return s[o++]=c,s[o++]=h,o;while(c==a&&h==l);for(;t<e;){let u=Ts(i[t],n),f=Ts(i[t+1],n);if(t+=r,u==c&&f==h)continue;let d=c-a,m=h-l,p=u-a,g=f-l;if(d*g==m*p&&(d<0&&p<d||d==p||d>0&&p>d)&&(m<0&&g<m||m==g||m>0&&g>m)){c=u,h=f;continue}s[o++]=c,s[o++]=h,a=c,l=h,c=u,h=f}return s[o++]=c,s[o++]=h,o}function Pl(i,t,e,r,n,s,o,a){for(let l=0,c=e.length;l<c;++l){let h=e[l];o=OC(i,t,h,r,n,s,o),a.push(o),t=h}return o}function xx(i,t,e,r,n,s,o,a){for(let l=0,c=e.length;l<c;++l){let h=e[l],u=[];o=Pl(i,t,h,r,n,s,o,u),a.push(u),t=h[h.length-1]}return o}var Lm=class i extends Ui{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new i(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,r,n){return n<Ni(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Sl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Cl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,n))}getArea(){return Im(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return vr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){let e=[];return e.length=co(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new i(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=lo(this.flatCoordinates,0,t,this.stride),this.changed()}},Om=Lm;var Fm=class i extends Ui{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){let t=new i(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,n){let s=this.flatCoordinates,o=Ar(t,e,s[0],s[1]);if(o<n){let a=this.stride;for(let l=0;l<a;++l)r[l]=s[l];return r.length=a,o}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Vo(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return gl(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_x(this.flatCoordinates,0,t,this.stride),this.changed()}},oi=Fm;function vx(i,t,e,r,n){return!Mh(n,function(o){return!Ps(i,t,e,r,o[0],o[1])})}function Ps(i,t,e,r,n,s){let o=0,a=i[e-r],l=i[e-r+1];for(;t<e;t+=r){let c=i[t],h=i[t+1];l<=s?h>s&&(c-a)*(s-l)-(n-a)*(h-l)>0&&o++:h<=s&&(c-a)*(s-l)-(n-a)*(h-l)<0&&o--,a=c,l=h}return o!==0}function Rl(i,t,e,r,n,s){if(e.length===0||!Ps(i,t,e[0],r,n,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Ps(i,e[o-1],e[o],r,n,s))return!1;return!0}function Ex(i,t,e,r,n,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){let l=e[o];if(Rl(i,t,l,r,n,s))return!0;t=l[l.length-1]}return!1}function Il(i,t,e,r,n,s,o){let a,l,c,h,u,f,d,m=n[s+1],p=[];for(let _=0,x=e.length;_<x;++_){let v=e[_];for(h=i[v-r],f=i[v-r+1],a=t;a<v;a+=r)u=i[a],d=i[a+1],(m<=f&&d<=m||f<=m&&m<=d)&&(c=(m-f)/(d-f)*(u-h)+h,p.push(c)),h=u,f=d}let g=NaN,y=-1/0;for(p.sort(hi),h=p[0],a=1,l=p.length;a<l;++a){u=p[a];let _=Math.abs(u-h);_>y&&(c=(h+u)/2,Rl(i,t,e,r,c,m)&&(g=c,y=_)),h=u}return isNaN(g)&&(g=n[s]),o?(o.push(g,m,y),o):[g,m,y]}function Vh(i,t,e,r,n){let s=[];for(let o=0,a=e.length;o<a;++o){let l=e[o];s=Il(i,t,l,r,n,2*o,s),t=l[l.length-1]}return s}function Wh(i,t,e,r,n){let s;for(t+=r;t<e;t+=r)if(s=n(i.slice(t-r,t),i.slice(t,t+r)),s)return s;return!1}function Al(i,t,e,r,n,s){return s=s??am(ge(),i,t,e,r),kt(n,s)?s[0]>=n[0]&&s[2]<=n[2]||s[1]>=n[1]&&s[3]<=n[3]?!0:Wh(i,t,e,r,function(o,a){return O1(n,o,a)}):!1}function wx(i,t,e,r,n){for(let s=0,o=e.length;s<o;++s){if(Al(i,t,e[s],r,n))return!0;t=e[s]}return!1}function Nm(i,t,e,r,n){return!!(Al(i,t,e,r,n)||Ps(i,t,e,r,n[0],n[1])||Ps(i,t,e,r,n[0],n[3])||Ps(i,t,e,r,n[2],n[1])||Ps(i,t,e,r,n[2],n[3]))}function Dm(i,t,e,r,n){if(!Nm(i,t,e[0],r,n))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(vx(i,e[s-1],e[s],r,n)&&!Al(i,e[s-1],e[s],r,n))return!1;return!0}function Sx(i,t,e,r,n){for(let s=0,o=e.length;s<o;++s){let a=e[s];if(Dm(i,t,a,r,n))return!0;t=a[a.length-1]}return!1}function bx(i,t,e,r){for(;t<e-r;){for(let n=0;n<r;++n){let s=i[t+n];i[t+n]=i[e-r+n],i[e-r+n]=s}t+=r,e-=r}}function Gm(i,t,e,r){let n=0,s=i[e-r],o=i[e-r+1];for(;t<e;t+=r){let a=i[t],l=i[t+1];n+=(a-s)*(l+o),s=a,o=l}return n===0?void 0:n>0}function Ll(i,t,e,r,n){n=n!==void 0?n:!1;for(let s=0,o=e.length;s<o;++s){let a=e[s],l=Gm(i,t,a,r);if(s===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;t=a}return!0}function Yh(i,t,e,r,n){for(let s=0,o=e.length;s<o;++s){let a=e[s];if(!Ll(i,t,a,r,n))return!1;a.length&&(t=a[a.length-1])}return!0}function na(i,t,e,r,n){n=n!==void 0?n:!1;for(let s=0,o=e.length;s<o;++s){let a=e[s],l=Gm(i,t,a,r);(s===0?n&&l||!n&&!l:n&&!l||!n&&l)&&bx(i,t,a,r),t=a}return t}function Ol(i,t,e,r,n){for(let s=0,o=e.length;s<o;++s)t=na(i,t,e[s],r,n);return t}function $h(i,t){let e=[],r=0,n=0,s;for(let o=0,a=t.length;o<a;++o){let l=t[o],c=Gm(i,r,l,2);if(s===void 0&&(s=c),c===s)e.push(t.slice(n,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[n])}n=o+1,r=l}return e}var Kh=class i extends Ui{constructor(t,e,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&r?(this.setFlatCoordinates(e,t),this.ends_=r):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Gt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new i(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,n){return n<Ni(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(bl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ml(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,n))}containsXY(t,e){return Rl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Am(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),na(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ms(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let t=re(this.getExtent());this.flatInteriorPoint_=Il(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new oi(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Om(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){let t=this.layout,e=this.flatCoordinates,r=this.ends_,n=[],s=0;for(let o=0,a=r.length;o<a;++o){let l=r[o],c=new Om(e.slice(s,l),t);n.push(c),s=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;Ll(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=na(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let e=[],r=[];return e.length=Pl(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,r),new i(e,"XY",r)}getType(){return"Polygon"}intersectsExtent(t){return Dm(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let r=Cs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}},or=Kh;function Fl(i){if(Di(i))throw new Error("Cannot create polygon from empty extent");let t=i[0],e=i[1],r=i[2],n=i[3],s=[t,e,t,n,r,n,r,e,t,e];return new Kh(s,"XY",[s.length])}function km(i,t,e,r){let n=it(t)/e[0],s=Ft(t)/e[1];return r?Math.min(i,Math.max(n,s)):Math.min(i,Math.min(n,s))}function zm(i,t,e){let r=Math.min(i,t),n=50;return r*=Math.log(1+n*Math.max(0,i/t-1))/n+1,e&&(r=Math.max(r,e),r/=Math.log(1+n*Math.max(0,e/i-1))/n+1),ht(r,e/2,t*2)}function Cx(i,t,e,r){return t=t!==void 0?t:!0,function(n,s,o,a){if(n!==void 0){let l=i[0],c=i[i.length-1],h=e?km(l,e,o,r):l;if(a)return t?zm(n,h,c):ht(n,c,h);let u=Math.min(h,n),f=Math.floor(ms(i,u,s));return i[f]>h&&f<i.length-1?i[f+1]:i[f]}}}function Mx(i,t,e,r,n,s){return r=r!==void 0?r:!0,e=e!==void 0?e:0,function(o,a,l,c){if(o!==void 0){let h=n?km(t,n,l,s):t;if(c)return r?zm(o,h,e):ht(o,e,h);let u=1e-9,f=Math.ceil(Math.log(t/h)/Math.log(i)-u),d=-a*(.5-u)+.5,m=Math.min(h,o),p=Math.floor(Math.log(t/m)/Math.log(i)+d),g=Math.max(f,p),y=t/Math.pow(i,g);return ht(y,e,h)}}}function jm(i,t,e,r,n){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){let c=r?km(i,r,a,n):i;return!e||!l?ht(s,t,c):zm(s,c,t)}}}function sa(i){if(i!==void 0)return 0}function Um(i){if(i!==void 0)return i}function Tx(i){let t=2*Math.PI/i;return function(e,r){if(r)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function Px(i){let t=i===void 0?Oi(5):i;return function(e,r){return r||e===void 0?e:Math.abs(e)<=t?0:e}}var Bm=0,Xm=class extends Ie{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=zh(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&wm(),t.center&&(t.center=Or(t.center,this.projection_)),t.extent&&(t.extent=Si(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){let e=Object.assign({},t);for(let a in Ei)delete e[a];this.setProperties(e,!0);let r=NC(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;let n=FC(t),s=r.constraint,o=DC(t);this.constraints_={center:n,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;let r=this.getCenterInternal();if(r){let n=t||[0,0,0,0];e=e||[0,0,0,0];let s=this.getResolution(),o=s/2*(n[3]-e[3]+e[1]-n[1]),a=s/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([r[0]+o,r[1]-a])}}getUpdatedOptions_(t){let e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let e=new Array(arguments.length);for(let r=0;r<e.length;++r){let n=arguments[r];n.center&&(n=Object.assign({},n),n.center=Or(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Or(n.anchor,this.getProjection())),e[r]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,r;e>1&&typeof arguments[e-1]=="function"&&(r=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){let h=arguments[n];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(n===e){r&&Hh(r,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_,c=[];for(;n<e;++n){let h=arguments[n],u={start:s,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||D1,callback:r};if(h.center&&(u.sourceCenter=o,u.targetCenter=h.center.slice(),o=u.targetCenter),h.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(h.zoom),a=u.targetResolution):h.resolution&&(u.sourceResolution=a,u.targetResolution=h.resolution,a=u.targetResolution),h.rotation!==void 0){u.sourceRotation=l;let f=Fi(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+f,l=u.targetRotation}GC(u)?u.complete=!0:s+=u.duration,c.push(u)}this.animations_.push(c),this.setHint(ie.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ie.ANIMATING]>0}getInteracting(){return this.hints_[ie.INTERACTING]>0}cancelAnimations(){this.setHint(ie.ANIMATING,-this.hints_[ie.ANIMATING]);let t;for(let e=0,r=this.animations_.length;e<r;++e){let n=this.animations_[e];if(n[0].callback&&Hh(n[0].callback,!1),!t)for(let s=0,o=n.length;s<o;++s){let a=n[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let t=Date.now(),e=!1;for(let r=this.animations_.length-1;r>=0;--r){let n=this.animations_[r],s=!0;for(let o=0,a=n.length;o<a;++o){let l=n[o];if(l.complete)continue;let c=t-l.start,h=l.duration>0?c/l.duration:1;h>=1?(l.complete=!0,h=1):s=!1;let u=l.easing(h);if(l.sourceCenter){let f=l.sourceCenter[0],d=l.sourceCenter[1],m=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;let g=f+u*(m-f),y=d+u*(p-d);this.targetCenter_=[g,y]}if(l.sourceResolution&&l.targetResolution){let f=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){let d=this.getViewportSize_(this.getRotation()),m=this.constraints_.resolution(f,0,d,!0);this.targetCenter_=this.calculateCenterZoom(m,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){let f=u===1?Fi(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){let d=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(d,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[r]=null,this.setHint(ie.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let o=n[0].callback;o&&Hh(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let r,n=this.getCenterInternal();return n!==void 0&&(r=[n[0]-e[0],n[1]-e[1]],Ho(r,t-this.getRotation()),Rh(r,e)),r}calculateCenterZoom(t,e){let r,n=this.getCenterInternal(),s=this.getResolution();if(n!==void 0&&s!==void 0){let o=e[0]-t*(e[0]-n[0])/s,a=e[1]-t*(e[1]-n[1])/s;r=[o,a]}return r}getViewportSize_(t){let e=this.viewportSize_;if(t){let r=e[0],n=e[1];return[Math.abs(r*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let t=this.getCenterInternal();return t&&wl(t,this.getProjection())}getCenterInternal(){return this.get(Ei.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){let e=this.calculateExtentInternal(t);return Ss(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();let e=this.getCenterInternal();Et(e,"The view center is not defined");let r=this.getResolution();Et(r!==void 0,"The view resolution is not defined");let n=this.getRotation();return Et(n!==void 0,"The view rotation is not defined"),An(e,r,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ei.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Si(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();let r=it(t)/e[0],n=Ft(t)/e[1];return Math.max(r,n)}getResolutionForValueFunction(t){t=t||2;let e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,n=Math.log(e/r)/Math.log(t);return function(s){return e/Math.pow(t,s*n)}}getRotation(){return this.get(Ei.ROTATION)}getValueForResolutionFunction(t){let e=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(r/n)/e;return function(o){return Math.log(r/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t),r=this.padding_;return r&&(e=[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e}getState(){let t=this.getProjection(),e=this.getResolution(),r=this.getRotation(),n=this.getCenterInternal(),s=this.padding_;if(s){let o=this.getViewportSizeMinusPadding_();n=qm(n,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,r)}return{center:n.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t,e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,r,n;if(this.resolutions_){let s=ms(this.resolutions_,t,1);e=s,r=this.resolutions_[s],s==this.resolutions_.length-1?n=2:n=r/this.resolutions_[s+1]}else r=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(r/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];let e=ht(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(r,ht(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let r;if(Et(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Et(!Di(t),"Cannot fit empty extent provided as `geometry`");let n=Si(t,this.getProjection());r=Fl(n)}else if(t.getType()==="Circle"){let n=Si(t.getExtent(),this.getProjection());r=Fl(n),r.rotate(this.getRotation(),re(n))}else{let n=sr();n?r=t.clone().transform(n,this.getProjection()):r=t}this.fitInternal(r,e)}rotatedExtentForGeometry(t){let e=this.getRotation(),r=Math.cos(e),n=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride(),a=1/0,l=1/0,c=-1/0,h=-1/0;for(let u=0,f=s.length;u<f;u+=o){let d=s[u]*r-s[u+1]*n,m=s[u]*n+s[u+1]*r;a=Math.min(a,d),l=Math.min(l,m),c=Math.max(c,d),h=Math.max(h,m)}return[a,l,c,h]}fitInternal(t,e){e=e||{};let r=e.size;r||(r=this.getViewportSizeMinusPadding_());let n=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1,o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;let a=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(a,[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);let c=this.getRotation(),h=Math.sin(c),u=Math.cos(c),f=re(a);f[0]+=(n[1]-n[3])/2*l,f[1]+=(n[0]-n[2])/2*l;let d=f[0]*u-f[1]*h,m=f[1]*u+f[0]*h,p=this.getConstrainedCenter([d,m],l),g=e.callback?e.callback:Pn;e.duration!==void 0?this.animateInternal({resolution:l,center:p,duration:e.duration,easing:e.easing},g):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),Hh(g,!0))}centerOn(t,e,r){this.centerOnInternal(Or(t,this.getProjection()),e,r)}centerOnInternal(t,e,r){this.setCenterInternal(qm(t,e,r,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,r,n){let s,o=this.padding_;if(o&&t){let a=this.getViewportSizeMinusPadding_(-r),l=qm(t,n,[a[0]/2+o[3],a[1]/2+o[0]],e,r);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){let e=wl(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){let e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Or(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){let r=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,n,r);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Or(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){let r=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,r);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Or(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){let r=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,r),s=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,s,r),a=this.constraints_.center(this.targetCenter_,o,s,r,this.calculateCenterShift(this.targetCenter_,o,n,s));this.get(Ei.ROTATION)!==n&&this.set(Ei.ROTATION,n),this.get(Ei.RESOLUTION)!==o&&(this.set(Ei.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ei.CENTER)||!so(this.get(Ei.CENTER),a))&&this.set(Ei.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,r){t=t!==void 0?t:200;let n=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}r=r||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!so(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:Gi,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ie.INTERACTING,1)}endInteraction(t,e,r){r=r&&Or(r,this.getProjection()),this.endInteractionInternal(t,e,r)}endInteractionInternal(t,e,r){this.getInteracting()&&(this.setHint(ie.INTERACTING,-1),this.resolveConstraints(t,e,r))}getConstrainedCenter(t,e){let r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),r)}getConstrainedZoom(t,e){let r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,e))}getConstrainedResolution(t,e){e=e||0;let r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,r)}};function Hh(i,t){setTimeout(function(){i(t)},0)}function FC(i){if(i.extent!==void 0){let e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return om(i.extent,i.constrainOnlyCenter,e)}let t=zh(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){let e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,om(e,!1,!1)}return R1}function NC(i){let t,e,r,o=i.minZoom!==void 0?i.minZoom:Bm,a=i.maxZoom!==void 0?i.maxZoom:28,l=i.zoomFactor!==void 0?i.zoomFactor:2,c=i.multiWorld!==void 0?i.multiWorld:!1,h=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,f=zh(i.projection,"EPSG:3857"),d=f.getExtent(),m=i.constrainOnlyCenter,p=i.extent;if(!c&&!p&&f.isGlobal()&&(m=!1,p=d),i.resolutions!==void 0){let g=i.resolutions;e=g[o],r=g[a]!==void 0?g[a]:g[g.length-1],i.constrainResolution?t=Cx(g,h,!m&&p,u):t=jm(e,r,h,!m&&p,u)}else{let y=(d?Math.max(it(d),Ft(d)):360*rr.degrees/f.getMetersPerUnit())/256/Math.pow(2,Bm),_=y/Math.pow(2,28-Bm);e=i.maxResolution,e!==void 0?o=0:e=y/Math.pow(l,o),r=i.minResolution,r===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?r=e/Math.pow(l,a):r=y/Math.pow(l,a):r=_),a=o+Math.floor(Math.log(e/r)/Math.log(l)),r=e/Math.pow(l,a-o),i.constrainResolution?t=Mx(l,e,r,h,!m&&p,u):t=jm(e,r,h,!m&&p,u)}return{constraint:t,maxResolution:e,minResolution:r,minZoom:o,zoomFactor:l}}function DC(i){if(i.enableRotation!==void 0?i.enableRotation:!0){let e=i.constrainRotation;return e===void 0||e===!0?Px():e===!1?Um:typeof e=="number"?Tx(e):Um}return sa}function GC(i){return!(i.sourceCenter&&i.targetCenter&&!so(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function qm(i,t,e,r,n){let s=Math.cos(-n),o=Math.sin(-n),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(t[0]/2-e[0])*r,l+=(e[1]-t[1]/2)*r,o=-o;let c=a*s-l*o,h=l*s+a*o;return[c,h]}var ai=Xm;var Nl="ol-hidden",Ix="ol-selectable",Bi="ol-unselectable",Wm="ol-unsupported",rn="ol-control",oa="ol-collapsed",kC=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Rx=["style","variant","weight","size","lineHeight","family"],Ym=function(i){let t=i.match(kC);if(!t)return null;let e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let r=0,n=Rx.length;r<n;++r){let s=t[r+1];s!==void 0&&(e[Rx[r]]=s)}return e.families=e.family.split(/,\s?/),e};function Xt(i,t,e,r){let n;return e&&e.length?n=e.shift():_h?n=new OffscreenCanvas(i||300,t||300):n=document.createElement("canvas"),i&&(n.width=i),t&&(n.height=t),n.getContext("2d",r)}var $m;function aa(){return $m||($m=Xt(1,1)),$m}function On(i){let t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Ax(i){let t=i.offsetWidth,e=getComputedStyle(i);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Lx(i){let t=i.offsetHeight,e=getComputedStyle(i);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Fn(i,t){let e=t.parentNode;e&&e.replaceChild(i,t)}function Zh(i){for(;i.lastChild;)i.lastChild.remove()}function Dl(i,t){let e=i.childNodes;for(let r=0;;++r){let n=e[r],s=t[r];if(!n&&!s)break;if(n!==s){if(!n){i.appendChild(s);continue}if(!s){i.removeChild(n),--r;continue}i.insertBefore(s,n)}}}var Km=class extends Ie{constructor(t){super();let e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&this.element?.remove();for(let e=0,r=this.listenerKeys.length;e<r;++e)Tt(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=t,t){let e=this.target_??t.getOverlayContainerStopEvent();this.element&&e.appendChild(this.element),this.render!==Pn&&this.listenerKeys.push(dt(t,Li.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}},qi=Km;var Hm=class extends qi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;let e=t.className!==void 0?t.className:"ol-attribution",r=t.tipLabel!==void 0?t.tipLabel:"Attributions",n=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;let a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;let l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=r,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener($.CLICK,this.handleClick_.bind(this),!1);let c=e+" "+Bi+" "+rn+(this.collapsed_&&this.collapsible_?" "+oa:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=c,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){let e=this.getMap().getAllLayers(),r=new Set(e.flatMap(n=>n.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(n=>r.add(n)):r.add(this.attributions_)),!this.overrideCollapsible_){let n=!e.some(s=>s.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(n)}return Array.from(r)}updateElement_(t){return to(this,null,function*(){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let e=yield Promise.all(this.collectSourceAttributions_(t).map(n=>Zr(()=>n))),r=e.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!ui(e,this.renderedAttributions_)){Zh(this.ulElement_);for(let n=0,s=e.length;n<s;++n){let o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}})}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(oa),this.collapsed_?Fn(this.collapseLabel_,this.label_):Fn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},Jh=Hm;var Zm=class extends qi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});let e=t.className!==void 0?t.className:"ol-rotate",r=t.label!==void 0?t.label:"\u21E7",n=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof r=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=r):(this.label_=r,this.label_.classList.add(n));let s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener($.CLICK,this.handleClick_.bind(this),!1);let a=e+" "+Bi+" "+rn,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Nl)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let e=this.getMap().getView();if(!e)return;let r=e.getRotation();r!==void 0&&(this.duration_>0&&r%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Gi}):e.setRotation(0))}render(t){let e=t.frameState;if(!e)return;let r=e.viewState.rotation;if(r!=this.rotation_){let n="rotate("+r+"rad)";if(this.autoHide_){let s=this.element.classList.contains(Nl);!s&&r===0?this.element.classList.add(Nl):s&&r!==0&&this.element.classList.remove(Nl)}this.label_.style.transform=n}this.rotation_=r}},Qh=Zm;var Jm=class extends qi{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});let e=t.className!==void 0?t.className:"ol-zoom",r=t.delta!==void 0?t.delta:1,n=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=n,h.setAttribute("type","button"),h.title=l,h.appendChild(typeof o=="string"?document.createTextNode(o):o),h.addEventListener($.CLICK,this.handleClick_.bind(this,r),!1);let u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=c,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener($.CLICK,this.handleClick_.bind(this,-r),!1);let f=e+" "+Bi+" "+rn,d=this.element;d.className=f,d.appendChild(h),d.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){let r=this.getMap().getView();if(!r)return;let n=r.getZoom();if(n!==void 0){let s=r.getConstrainedZoom(n+t);this.duration_>0?(r.getAnimating()&&r.cancelAnimations(),r.animate({zoom:s,duration:this.duration_,easing:Gi})):r.setZoom(s)}}},tu=Jm;function Ox(i){i=i||{};let t=new pe;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new tu(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new Qh(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new Jh(i.attributionOptions)),t}var Qm=class{constructor(t,e,r){this.decay_=t,this.minVelocity_=e,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;let t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let r=e-3;for(;r>0&&this.points_[r+2]>t;)r-=3;let n=this.points_[e+2]-this.points_[r+2];if(n<1e3/60)return!1;let s=this.points_[e]-this.points_[r],o=this.points_[e+1]-this.points_[r+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Fx=Qm;var tp={ACTIVE:"active"};var ep=class extends Ie{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(tp.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(tp.ACTIVE,t)}setMap(t){this.map_=t}};function Nx(i,t,e){let r=i.getCenterInternal();if(r){let n=[r[0]+t[0],r[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:G1,center:i.getConstrainedCenter(n)})}}function la(i,t,e,r){let n=i.getZoom();if(n===void 0)return;let s=i.getConstrainedZoom(n+t),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:e,duration:r!==void 0?r:250,easing:Gi})}var nn=ep;var ip=class extends nn{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==de.DBLCLICK){let r=t.originalEvent,n=t.map,s=t.coordinate,o=r.shiftKey?-this.delta_:this.delta_,a=n.getView();la(a,o,s,this.duration_),r.preventDefault(),e=!0}return!e}},Dx=ip;function Gl(i){let t=arguments;return function(e){let r=!0;for(let n=0,s=t.length;n<s&&(r=r&&t[n](e),!!r);++n);return r}}var Gx=function(i){let t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},zC=function(i){let t=i.map.getTargetElement(),e=t.getRootNode(),r=i.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(r):t.contains(r)},eu=function(i){let t=i.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?zC(i):!0},kx=Mn;var iu=function(i){let t=i.originalEvent;return t instanceof PointerEvent&&t.button==0&&!(S1&&tm&&t.ctrlKey)};var ru=function(i){let t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var zx=function(i){let t=i.originalEvent;return tm?t.metaKey:t.ctrlKey},jx=function(i){let t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},nu=function(i){let t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},su=function(i){let t=i.originalEvent;return t instanceof PointerEvent&&t.pointerType=="mouse"};var Ux=function(i){let t=i.originalEvent;return t instanceof PointerEvent&&t.isPrimary&&t.button===0};var rp=class extends nn{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==de.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==de.POINTERUP){let r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==de.POINTERDOWN){let r=this.handleDownEvent(t);this.handlingDownUpSequence=r,e=this.stopDown(r)}else t.type==de.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function ca(i){let t=i.length,e=0,r=0;for(let n=0;n<t;n++)e+=i[n].clientX,r+=i[n].clientY;return{clientX:e/t,clientY:r/t}}var sn=rp;var np=class extends sn{constructor(t){super({stopDown:Tn}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let e=t.condition?t.condition:Gl(ru,Ux);this.condition_=t.onFocusOnly?Gl(eu,e):e,this.noKinetic_=!1}handleDragEvent(t){let e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());let r=this.targetPointers,n=e.getEventPixel(ca(r));if(r.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){let s=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=t.map.getView();Ih(s,a.getResolution()),Ho(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=r.length,t.originalEvent.preventDefault()}handleUpEvent(t){let e=t.map,r=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let n=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=r.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-n*Math.cos(s),a[1]-n*Math.sin(s)]);r.animateInternal({center:r.getConstrainedCenter(l),duration:500,easing:Gi})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){let r=t.map.getView();return this.lastCentroid=null,r.getAnimating()&&r.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Bx=np;var sp=class extends sn{constructor(t){t=t||{},super({stopDown:Tn}),this.condition_=t.condition?t.condition:Gx,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!su(t))return;let e=t.map,r=e.getView();if(r.getConstraints().rotation===sa)return;let n=e.getSize(),s=t.pixel,o=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(this.lastAngle_!==void 0){let a=o-this.lastAngle_;r.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return su(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return su(t)&&iu(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},qx=sp;var op=class extends Hr{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let t=this.startPixel_,e=this.endPixel_,r="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+r,n.top=Math.min(t[1],e[1])+r,n.width=Math.abs(e[0]-t[0])+r,n.height=Math.abs(e[1]-t[1])+r}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new or([n])}getGeometry(){return this.geometry_}},Xx=op;var ha={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},ho=class extends Re{constructor(t,e,r){super(t),this.coordinate=e,this.mapBrowserEvent=r}},ap=class extends sn{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new Xx(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??iu,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,r){let n=r[0]-e[0],s=r[1]-e[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new ho(ha.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;let e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new ho(e?ha.BOXEND:ha.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ho(ha.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ho(ha.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ho(ha.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}},kl=ap;var lp=class extends kl{constructor(t){t=t||{};let e=t.condition?t.condition:jx;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){let r=this.getMap().getView(),n=this.getGeometry();if(this.out_){let s=r.rotatedExtentForGeometry(n),o=r.getResolutionForExtentInternal(s),a=r.getResolution()/o;n=n.clone(),n.scale(a*a)}r.fitInternal(n,{duration:this.duration_,easing:Gi})}},Vx=lp;var Rs={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var cp=class extends nn{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return ru(e)&&nu(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==$.KEYDOWN){let r=t.originalEvent,n=r.key;if(this.condition_(t)&&(n==Rs.DOWN||n==Rs.LEFT||n==Rs.RIGHT||n==Rs.UP)){let o=t.map.getView(),a=o.getResolution()*this.pixelDelta_,l=0,c=0;n==Rs.DOWN?c=-a:n==Rs.LEFT?l=-a:n==Rs.RIGHT?l=a:c=a;let h=[l,c];Ho(h,o.getRotation()),Nx(o,h,this.duration_),r.preventDefault(),e=!0}}return!e}},Wx=cp;var hp=class extends nn{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!zx(e)&&nu(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==$.KEYDOWN||t.type==$.KEYPRESS){let r=t.originalEvent,n=r.key;if(this.condition_(t)&&(n==="+"||n==="-")){let s=t.map,o=n==="+"?this.delta_:-this.delta_,a=s.getView();la(a,o,void 0,this.duration_),r.preventDefault(),e=!0}}return!e}},Yx=hp;var up=class extends nn{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;let e=t.condition?t.condition:kx;this.condition_=t.onFocusOnly?Gl(eu,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==$.WHEEL)return!0;let r=t.map,n=t.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let s;if(t.type==$.WHEEL&&(s=n.deltaY,n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;let o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");let a=r.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_?r.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=s;let l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),l),!1}handleWheelZoom_(t){let e=t.getView();e.getAnimating()&&e.cancelAnimations();let r=-ht(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),la(e,r,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},$x=up;var fp=class extends sn{constructor(t){t=t||{};let e=t;e.stopDown||(e.stopDown=Tn),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0,r=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(this.lastAngle_!==void 0){let l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;let o=t.map,a=o.getView();a.getConstraints().rotation!==sa&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(ca(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){let e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Kx=fp;var dp=class extends sn{constructor(t){t=t||{};let e=t;e.stopDown||(e.stopDown=Tn),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1,r=this.targetPointers[0],n=this.targetPointers[1],s=r.clientX-n.clientX,o=r.clientY-n.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;let l=t.map,c=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(ca(this.targetPointers))),l.render(),c.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){let r=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return r.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){let e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Hx=dp;function ou(i){i=i||{};let t=new pe,e=new Fx(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new qx),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new Dx({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new Bx({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new Kx),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new Hx({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new Wx),t.push(new Yx({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new $x({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new Vx({duration:i.zoomDuration})),t}var Jt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};var mp=class extends Ie{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;let e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Jt.OPACITY]=t.opacity!==void 0?t.opacity:1,Et(typeof e[Jt.OPACITY]=="number","Layer opacity must be a number"),e[Jt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Jt.Z_INDEX]=t.zIndex,e[Jt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Jt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Jt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Jt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){let e=this.state_||{layer:this,managed:t===void 0?!0:t},r=this.getZIndex();return e.opacity=ht(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=r===void 0&&!e.managed?1/0:r,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return nt()}getLayerStatesArray(t){return nt()}getExtent(){return this.get(Jt.EXTENT)}getMaxResolution(){return this.get(Jt.MAX_RESOLUTION)}getMinResolution(){return this.get(Jt.MIN_RESOLUTION)}getMinZoom(){return this.get(Jt.MIN_ZOOM)}getMaxZoom(){return this.get(Jt.MAX_ZOOM)}getOpacity(){return this.get(Jt.OPACITY)}getSourceState(){return nt()}getVisible(){return this.get(Jt.VISIBLE)}getZIndex(){return this.get(Jt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Jt.EXTENT,t)}setMaxResolution(t){this.set(Jt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Jt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Jt.MAX_ZOOM,t)}setMinZoom(t){this.set(Jt.MIN_ZOOM,t)}setOpacity(t){Et(typeof t=="number","Layer opacity must be a number"),this.set(Jt.OPACITY,t)}setVisible(t){this.set(Jt.VISIBLE,t)}setZIndex(t){this.set(Jt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},ua=mp;var Fr=class extends Re{constructor(t,e){super(t),this.layer=e}},pp={LAYERS:"layers"},gp=class i extends ua{constructor(t){t=t||{};let e=Object.assign({},t);delete e.layers;let r=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(pp.LAYERS,this.handleLayersChanged_),r?Array.isArray(r)?r=new pe(r.slice(),{unique:!0}):Et(typeof r.getArray=="function","Expected `layers` to be an array or a `Collection`"):r=new pe(void 0,{unique:!0}),this.setLayers(r)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Tt),this.layersListenerKeys_.length=0;let t=this.getLayers();this.layersListenerKeys_.push(dt(t,ei.ADD,this.handleLayersAdd_,this),dt(t,ei.REMOVE,this.handleLayersRemove_,this));for(let r in this.listenerKeys_)this.listenerKeys_[r].forEach(Tt);Jr(this.listenerKeys_);let e=t.getArray();for(let r=0,n=e.length;r<n;r++){let s=e[r];this.registerLayerListeners_(s),this.dispatchEvent(new Fr("addlayer",s))}this.changed()}registerLayerListeners_(t){let e=[dt(t,er.PROPERTYCHANGE,this.handleLayerChange_,this),dt(t,$.CHANGE,this.handleLayerChange_,this)];t instanceof i&&e.push(dt(t,"addlayer",this.handleLayerGroupAdd_,this),dt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[H(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Fr("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Fr("removelayer",t.layer))}handleLayersAdd_(t){let e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Fr("addlayer",e)),this.changed()}handleLayersRemove_(t){let e=t.element,r=H(e);this.listenerKeys_[r].forEach(Tt),delete this.listenerKeys_[r],this.dispatchEvent(new Fr("removelayer",e)),this.changed()}getLayers(){return this.get(pp.LAYERS)}setLayers(t){let e=this.getLayers();if(e){let r=e.getArray();for(let n=0,s=r.length;n<s;++n)this.dispatchEvent(new Fr("removelayer",r[n]))}this.set(pp.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){let e=t!==void 0?t:[],r=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});let n=this.getLayerState(),s=n.zIndex;!t&&n.zIndex===void 0&&(s=0);for(let o=r,a=e.length;o<a;o++){let l=e[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=je(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}},se=gp;var Ke={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var yp=class extends ua{constructor(t){let e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Jt.SOURCE,this.handleSourcePropertyChange_);let r=t.source?t.source:null;this.setSource(r)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Jt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Tt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let t=this.getSource();t&&(this.sourceChangeKey_=dt(t,$.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e,r=this.getMapInternal();!t&&r&&(t=r.getView()),t instanceof ai?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&r&&(e.layerStatesArray=r.getLayerGroup().getLayerStatesArray());let n;if(e.layerStatesArray){if(n=e.layerStatesArray.find(o=>o.layer===this),!n)return!1}else n=this.getLayerState();let s=this.getExtent();return zl(n,e.viewState)&&(!s||kt(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e=this.getSource()?.getAttributions();if(!e)return[];let r=t instanceof ai?t.getViewStateAndExtent():t,n=e(r);return Array.isArray(n)||(n=[n]),n}render(t,e){let r=this.getRenderer();return r.prepareFrame(t)?(this.rendered=!0,r.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){let e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Jt.MAP,t)}getMapInternal(){return this.get(Jt.MAP)}setMap(t){this.mapPrecomposeKey_&&(Tt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Tt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=dt(t,Ke.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=dt(this,$.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){let e=t.frameState.layerStatesArray,r=this.getLayerState(!1);Et(!e.some(n=>n.layer===r.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(r)}setSource(t){this.set(Jt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function zl(i,t){if(!i.visible)return!1;let e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;let r=t.zoom;return r>i.minZoom&&r<=i.maxZoom}var ye=yp;function au(i,t,e=0,r=i.length-1,n=jC){for(;r>e;){if(r-e>600){let l=r-e+1,c=t-e+1,h=Math.log(l),u=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*u*(l-u)/l)*(c-l/2<0?-1:1),d=Math.max(e,Math.floor(t-c*u/l+f)),m=Math.min(r,Math.floor(t+(l-c)*u/l+f));au(i,t,d,m,n)}let s=i[t],o=e,a=r;for(jl(i,e,t),n(i[r],s)>0&&jl(i,e,r);o<a;){for(jl(i,o,a),o++,a--;n(i[o],s)<0;)o++;for(;n(i[a],s)>0;)a--}n(i[e],s)===0?jl(i,e,a):(a++,jl(i,a,r)),a<=t&&(e=a+1),t<=a&&(r=a-1)}}function jl(i,t,e){let r=i[t];i[t]=i[e],i[e]=r}function jC(i,t){return i<t?-1:i>t?1:0}var ma=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data,r=[];if(!cu(t,e))return r;let n=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){let a=e.children[o],l=e.leaf?n(a):a;cu(t,l)&&(e.leaf?r.push(a):xp(t,l)?this._all(a,r):s.push(a))}e=s.pop()}return r}collides(t){let e=this.data;if(!cu(t,e))return!1;let r=[];for(;e;){for(let n=0;n<e.children.length;n++){let s=e.children[n],o=e.leaf?this.toBBox(s):s;if(cu(t,o)){if(e.leaf||xp(t,o))return!0;r.push(s)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){let r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=da([]),this}remove(t,e){if(!t)return this;let r=this.data,n=this.toBBox(t),s=[],o=[],a,l,c;for(;r||s.length;){if(r||(r=s.pop(),l=s[s.length-1],a=o.pop(),c=!0),r.leaf){let h=UC(t,r.children,e);if(h!==-1)return r.children.splice(h,1),s.push(r),this._condense(s),this}!c&&!r.leaf&&xp(r,n)?(s.push(r),o.push(a),a=0,l=r,r=r.children[0]):l?(a++,r=l.children[a],c=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){let r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,n){let s=r-e+1,o=this._maxEntries,a;if(s<=o)return a=da(t.slice(e,r+1)),fa(a,this.toBBox),a;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),a=da([]),a.leaf=!1,a.height=n;let l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));Zx(t,e,r,c,this.compareMinX);for(let h=e;h<=r;h+=c){let u=Math.min(h+c-1,r);Zx(t,h,u,l,this.compareMinY);for(let f=h;f<=u;f+=l){let d=Math.min(f+l-1,u);a.children.push(this._build(t,f,d,n-1))}}return fa(a,this.toBBox),a}_chooseSubtree(t,e,r,n){for(;n.push(e),!(e.leaf||n.length-1===r);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){let c=e.children[l],h=_p(c),u=XC(t,c)-h;u<o?(o=u,s=h<s?h:s,a=c):u===o&&h<s&&(s=h,a=c)}e=a||e.children[0]}return e}_insert(t,e,r){let n=r?t:this.toBBox(t),s=[],o=this._chooseSubtree(n,this.data,e,s);for(o.children.push(t),Bl(o,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)}_split(t,e){let r=t[e],n=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,n);let o=this._chooseSplitIndex(r,s,n),a=da(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,fa(r,this.toBBox),fa(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)}_splitRoot(t,e){this.data=da([t,e]),this.data.height=t.height+1,this.data.leaf=!1,fa(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let n,s=1/0,o=1/0;for(let a=e;a<=r-e;a++){let l=Ul(t,0,a,this.toBBox),c=Ul(t,a,r,this.toBBox),h=VC(l,c),u=_p(l)+_p(c);h<s?(s=h,n=a,o=u<o?u:o):h===s&&u<o&&(o=u,n=a)}return n||r-e}_chooseSplitAxis(t,e,r){let n=t.leaf?this.compareMinX:BC,s=t.leaf?this.compareMinY:qC,o=this._allDistMargin(t,e,r,n),a=this._allDistMargin(t,e,r,s);o<a&&t.children.sort(n)}_allDistMargin(t,e,r,n){t.children.sort(n);let s=this.toBBox,o=Ul(t,0,e,s),a=Ul(t,r-e,r,s),l=lu(o)+lu(a);for(let c=e;c<r-e;c++){let h=t.children[c];Bl(o,t.leaf?s(h):h),l+=lu(o)}for(let c=r-e-1;c>=e;c--){let h=t.children[c];Bl(a,t.leaf?s(h):h),l+=lu(a)}return l}_adjustParentBBoxes(t,e,r){for(let n=r;n>=0;n--)Bl(e[n],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():fa(t[e],this.toBBox)}};function UC(i,t,e){if(!e)return t.indexOf(i);for(let r=0;r<t.length;r++)if(e(i,t[r]))return r;return-1}function fa(i,t){Ul(i,0,i.children.length,t,i)}function Ul(i,t,e,r,n){n||(n=da(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=t;s<e;s++){let o=i.children[s];Bl(n,i.leaf?r(o):o)}return n}function Bl(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function BC(i,t){return i.minX-t.minX}function qC(i,t){return i.minY-t.minY}function _p(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function lu(i){return i.maxX-i.minX+(i.maxY-i.minY)}function XC(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function VC(i,t){let e=Math.max(i.minX,t.minX),r=Math.max(i.minY,t.minY),n=Math.min(i.maxX,t.maxX),s=Math.min(i.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,s-r)}function xp(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function cu(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function da(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Zx(i,t,e,r,n){let s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=r)continue;let o=t+Math.ceil((e-t)/r/2)*r;au(i,o,t,e,n),s.push(t,o,o,e)}}var uu=[NaN,NaN,NaN,0],vp;function WC(){return vp||(vp=Xt(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),vp}var YC=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,$C=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,KC=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,HC=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function hu(i,t){return i.endsWith("%")?Number(i.substring(0,i.length-1))/t:Number(i)}function Xl(i){throw new Error('failed to parse "'+i+'" as color')}function Jx(i){if(i.toLowerCase().startsWith("rgb")){let s=i.match($C)||i.match(YC)||i.match(KC);if(s){let o=s[4],a=100/255;return[ht(hu(s[1],a)+.5|0,0,255),ht(hu(s[2],a)+.5|0,0,255),ht(hu(s[3],a)+.5|0,0,255),o!==void 0?ht(hu(o,100),0,1):1]}Xl(i)}if(i.startsWith("#")){if(HC.test(i)){let s=i.substring(1),o=s.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=s.length;l<c;l+=o){let h=parseInt(s.substring(l,l+o),16);o===1&&(h+=h<<4),a[l/o]=h}return a[3]=a[3]/255,a}Xl(i)}let t=WC();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=i,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=i,t.fillStyle===e&&Xl(i));let r=t.fillStyle;if(r.startsWith("#")||r.startsWith("rgba"))return Jx(r);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);let n=Array.from(t.getImageData(0,0,1,1).data);return n[3]=Rn(n[3]/255,3),n}function Qx(i){return typeof i=="string"?i:Wl(i)}var ZC=1024,ql={},Ep=0;function tv(i){if(i.length===4)return i;let t=i.slice();return t[3]=1,t}function wp(i){return i>.0031308?Math.pow(i,1/2.4)*269.025-14.025:i*3294.6}function Sp(i){return i>.2068965?Math.pow(i,3):(i-4/29)*(108/841)}function bp(i){return i>10.314724?Math.pow((i+14.025)/269.025,2.4):i/3294.6}function Cp(i){return i>.0088564?Math.pow(i,1/3):i/(108/841)+4/29}function Mp(i){let t=bp(i[0]),e=bp(i[1]),r=bp(i[2]),n=Cp(t*.222488403+e*.716873169+r*.06060791),s=500*(Cp(t*.452247074+e*.399439023+r*.148375274)-n),o=200*(n-Cp(t*.016863605+e*.117638439+r*.865350722)),a=Math.atan2(o,s)*(180/Math.PI);return[116*n-16,Math.sqrt(s*s+o*o),a<0?a+360:a,i[3]]}function ev(i){let t=(i[0]+16)/116,e=i[1],r=i[2]*Math.PI/180,n=Sp(t),s=Sp(t+e/500*Math.cos(r)),o=Sp(t-e/200*Math.sin(r)),a=wp(s*3.021973625-n*1.617392459-o*.404875592),l=wp(s*-.943766287+n*1.916279586+o*.027607165),c=wp(s*.069407491-n*.22898585+o*1.159737864);return[ht(a+.5|0,0,255),ht(l+.5|0,0,255),ht(c+.5|0,0,255),i[3]]}function Vl(i){if(i==="none")return uu;if(ql.hasOwnProperty(i))return ql[i];if(Ep>=ZC){let e=0;for(let r in ql)(e++&3)===0&&(delete ql[r],--Ep)}let t=Jx(i);t.length!==4&&Xl(i);for(let e of t)isNaN(e)&&Xl(i);return ql[i]=t,++Ep,t}function ar(i){return Array.isArray(i)?i:Vl(i)}function Wl(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let r=i[2];r!=(r|0)&&(r=r+.5|0);let n=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+r+","+n+")"}function Tp(i){return i[0]>0&&i[1]>0}function iv(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function me(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}var uo=0;var mi=1<<uo++,Vt=1<<uo++,bi=1<<uo++,lr=1<<uo++,As=1<<uo++,Yl=1<<uo++,fu=Math.pow(2,uo)-1,Ip={[mi]:"boolean",[Vt]:"number",[bi]:"string",[lr]:"color",[As]:"number[]",[Yl]:"size"},JC=Object.keys(Ip).map(Number).sort(hi);function QC(i){return i in Ip}function $l(i){let t=[];for(let e of JC)Kl(i,e)&&t.push(Ip[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Kl(i,t){return(i&t)===t}function Is(i,t){return i===t}var Ae=class{constructor(t,e){if(!QC(t))throw new Error(`literal expressions must have a specific type, got ${$l(t)}`);this.type=t,this.value=e}},Rp=class{constructor(t,e,...r){this.type=t,this.operator=e,this.args=r}};function Ap(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function ri(i,t,e){switch(typeof i){case"boolean":{if(Is(t,bi))return new Ae(bi,i?"true":"false");if(!Kl(t,mi))throw new Error(`got a boolean, but expected ${$l(t)}`);return new Ae(mi,i)}case"number":{if(Is(t,Yl))return new Ae(Yl,me(i));if(Is(t,mi))return new Ae(mi,!!i);if(Is(t,bi))return new Ae(bi,i.toString());if(!Kl(t,Vt))throw new Error(`got a number, but expected ${$l(t)}`);return new Ae(Vt,i)}case"string":{if(Is(t,lr))return new Ae(lr,Vl(i));if(Is(t,mi))return new Ae(mi,!!i);if(!Kl(t,bi))throw new Error(`got a string, but expected ${$l(t)}`);return new Ae(bi,i)}default:}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return hM(i,t,e);for(let r of i)if(typeof r!="number")throw new Error("expected an array of numbers");if(Is(t,Yl)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new Ae(Yl,i)}if(Is(t,lr)){if(i.length===3)return new Ae(lr,[...i,1]);if(i.length===4)return new Ae(lr,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!Kl(t,As))throw new Error(`got an array of numbers, but expected ${$l(t)}`);return new Ae(As,i)}var N={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},tM={[N.Get]:Ct(Nt(1,1/0),rv),[N.Var]:Ct(Nt(1,1),eM),[N.Has]:Ct(Nt(1,1/0),rv),[N.Id]:Ct(iM,pa),[N.Concat]:Ct(Nt(2,1/0),Qt(bi)),[N.GeometryType]:Ct(rM,pa),[N.LineMetric]:Ct(pa),[N.Resolution]:Ct(Pp,pa),[N.Zoom]:Ct(Pp,pa),[N.Time]:Ct(Pp,pa),[N.Any]:Ct(Nt(2,1/0),Qt(mi)),[N.All]:Ct(Nt(2,1/0),Qt(mi)),[N.Not]:Ct(Nt(1,1),Qt(mi)),[N.Equal]:Ct(Nt(2,2),Qt(fu)),[N.NotEqual]:Ct(Nt(2,2),Qt(fu)),[N.GreaterThan]:Ct(Nt(2,2),Qt(Vt)),[N.GreaterThanOrEqualTo]:Ct(Nt(2,2),Qt(Vt)),[N.LessThan]:Ct(Nt(2,2),Qt(Vt)),[N.LessThanOrEqualTo]:Ct(Nt(2,2),Qt(Vt)),[N.Multiply]:Ct(Nt(2,1/0),nv),[N.Coalesce]:Ct(Nt(2,1/0),nv),[N.Divide]:Ct(Nt(2,2),Qt(Vt)),[N.Add]:Ct(Nt(2,1/0),Qt(Vt)),[N.Subtract]:Ct(Nt(2,2),Qt(Vt)),[N.Clamp]:Ct(Nt(3,3),Qt(Vt)),[N.Mod]:Ct(Nt(2,2),Qt(Vt)),[N.Pow]:Ct(Nt(2,2),Qt(Vt)),[N.Abs]:Ct(Nt(1,1),Qt(Vt)),[N.Floor]:Ct(Nt(1,1),Qt(Vt)),[N.Ceil]:Ct(Nt(1,1),Qt(Vt)),[N.Round]:Ct(Nt(1,1),Qt(Vt)),[N.Sin]:Ct(Nt(1,1),Qt(Vt)),[N.Cos]:Ct(Nt(1,1),Qt(Vt)),[N.Atan]:Ct(Nt(1,2),Qt(Vt)),[N.Sqrt]:Ct(Nt(1,1),Qt(Vt)),[N.Match]:Ct(Nt(4,1/0),sv,sM),[N.Between]:Ct(Nt(3,3),Qt(Vt)),[N.Interpolate]:Ct(Nt(6,1/0),sv,oM),[N.Case]:Ct(Nt(3,1/0),nM,aM),[N.In]:Ct(Nt(2,2),lM),[N.Number]:Ct(Nt(1,1/0),Qt(fu)),[N.String]:Ct(Nt(1,1/0),Qt(fu)),[N.Array]:Ct(Nt(1,1/0),Qt(Vt)),[N.Color]:Ct(Nt(1,4),Qt(Vt)),[N.Band]:Ct(Nt(1,3),Qt(Vt)),[N.Palette]:Ct(Nt(2,2),cM),[N.ToString]:Ct(Nt(1,1),Qt(mi|Vt|bi|lr))};function rv(i,t,e){let r=i.length-1,n=new Array(r);for(let s=0;s<r;++s){let o=i[s+1];switch(typeof o){case"number":{n[s]=new Ae(Vt,o);break}case"string":{n[s]=new Ae(bi,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}s===0&&e.properties.add(String(o))}return n}function eM(i,t,e){let r=i[1];if(typeof r!="string")throw new Error("expected a string argument for var operation");return e.variables.add(r),[new Ae(bi,r)]}function iM(i,t,e){e.featureId=!0}function rM(i,t,e){e.geometryType=!0}function Pp(i,t,e){e.mapState=!0}function pa(i,t,e){let r=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${r} operation`);return[]}function Nt(i,t){return function(e,r,n){let s=e[0],o=e.length-1;if(i===t){if(o!==i){let a=i===1?"":"s";throw new Error(`expected ${i} argument${a} for ${s}, got ${o}`)}}else if(o<i||o>t){let a=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${a} arguments for ${s}, got ${o}`)}}}function nv(i,t,e){let r=i.length-1,n=new Array(r);for(let s=0;s<r;++s){let o=ri(i[s+1],t,e);n[s]=o}return n}function Qt(i){return function(t,e,r){let n=t.length-1,s=new Array(n);for(let o=0;o<n;++o){let a=ri(t[o+1],i,r);s[o]=a}return s}}function nM(i,t,e){let r=i[0],n=i.length-1;if(n%2===0)throw new Error(`expected an odd number of arguments for ${r}, got ${n} instead`)}function sv(i,t,e){let r=i[0],n=i.length-1;if(n%2===1)throw new Error(`expected an even number of arguments for operation ${r}, got ${n} instead`)}function sM(i,t,e){let r=i.length-1,n=bi|Vt|mi,s=ri(i[1],n,e),o=ri(i[i.length-1],t,e),a=new Array(r-2);for(let l=0;l<r-2;l+=2){try{let c=ri(i[l+2],s.type,e);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{let c=ri(i[l+3],o.type,e);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[s,...a,o]}function oM(i,t,e){let r=i[1],n;switch(r[0]){case"linear":n=1;break;case"exponential":let l=r[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);n=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(r)}`)}let s=new Ae(Vt,n),o;try{o=ri(i[2],Vt,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}let a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){try{let c=ri(i[l+3],Vt,e);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{let c=ri(i[l+4],t,e);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[s,o,...a]}function aM(i,t,e){let r=ri(i[i.length-1],t,e),n=new Array(i.length-1);for(let s=0;s<n.length-1;s+=2){try{let o=ri(i[s+1],mi,e);n[s]=o}catch(o){throw new Error(`failed to parse argument ${s} of case expression: ${o.message}`)}try{let o=ri(i[s+2],r.type,e);n[s+1]=o}catch(o){throw new Error(`failed to parse argument ${s+1} of case expression: ${o.message}`)}}return n[n.length-1]=r,n}function lM(i,t,e){let r=i[2];if(!Array.isArray(r))throw new Error('the second argument for the "in" operator must be an array');let n;if(typeof r[0]=="string"){if(r[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(r[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');r=r[1],n=bi}else n=Vt;let s=new Array(r.length);for(let a=0;a<s.length;a++)try{let l=ri(r[a],n,e);s[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[ri(i[1],n,e),...s]}function cM(i,t,e){let r;try{r=ri(i[1],Vt,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}let n=i[2];if(!Array.isArray(n))throw new Error("the second argument of palette must be an array");let s=new Array(n.length);for(let o=0;o<s.length;o++){let a;try{a=ri(n[o],lr,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof Ae))throw new Error(`the palette color at index ${o} must be a literal value`);s[o]=a}return[r,...s]}function Ct(...i){return function(t,e,r){let n=t[0],s;for(let o=0;o<i.length;o++){let a=i[o](t,e,r);if(o==i.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");s=a}}return new Rp(e,n,...s)}}function hM(i,t,e){let r=i[0],n=tM[r];if(!n)throw new Error(`unknown operator: ${r}`);return n(i,t,e)}function Lp(i){if(!i)return"";let t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Lp(i.getGeometries()[0]);default:return""}}function Op(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function on(i,t,e){let r=ri(i,t,e);return Nr(r,e)}function Nr(i,t){if(i instanceof Ae){if(i.type===lr&&typeof i.value=="string"){let r=Vl(i.value);return function(){return r}}return function(){return i.value}}let e=i.operator;switch(e){case N.Number:case N.String:case N.Coalesce:return uM(i,t);case N.Get:case N.Var:case N.Has:return fM(i,t);case N.Id:return r=>r.featureId;case N.GeometryType:return r=>r.geometryType;case N.Concat:{let r=i.args.map(n=>Nr(n,t));return n=>"".concat(...r.map(s=>s(n).toString()))}case N.Resolution:return r=>r.resolution;case N.Any:case N.All:case N.Between:case N.In:case N.Not:return mM(i,t);case N.Equal:case N.NotEqual:case N.LessThan:case N.LessThanOrEqualTo:case N.GreaterThan:case N.GreaterThanOrEqualTo:return dM(i,t);case N.Multiply:case N.Divide:case N.Add:case N.Subtract:case N.Clamp:case N.Mod:case N.Pow:case N.Abs:case N.Floor:case N.Ceil:case N.Round:case N.Sin:case N.Cos:case N.Atan:case N.Sqrt:return pM(i,t);case N.Case:return gM(i,t);case N.Match:return yM(i,t);case N.Interpolate:return _M(i,t);case N.ToString:return xM(i,t);default:throw new Error(`Unsupported operator ${e}`)}}function uM(i,t){let e=i.operator,r=i.args.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=Nr(i.args[s],t);switch(e){case N.Coalesce:return s=>{for(let o=0;o<r;++o){let a=n[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case N.Number:case N.String:return s=>{for(let o=0;o<r;++o){let a=n[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function fM(i,t){let r=i.args[0].value;switch(i.operator){case N.Get:return n=>{let s=i.args,o=n.properties[r];for(let a=1,l=s.length;a<l;++a){let h=s[a].value;o=o[h]}return o};case N.Var:return n=>n.variables[r];case N.Has:return n=>{let s=i.args;if(!(r in n.properties))return!1;let o=n.properties[r];for(let a=1,l=s.length;a<l;++a){let h=s[a].value;if(!o||!Object.hasOwn(o,h))return!1;o=o[h]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function dM(i,t){let e=i.operator,r=Nr(i.args[0],t),n=Nr(i.args[1],t);switch(e){case N.Equal:return s=>r(s)===n(s);case N.NotEqual:return s=>r(s)!==n(s);case N.LessThan:return s=>r(s)<n(s);case N.LessThanOrEqualTo:return s=>r(s)<=n(s);case N.GreaterThan:return s=>r(s)>n(s);case N.GreaterThanOrEqualTo:return s=>r(s)>=n(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function mM(i,t){let e=i.operator,r=i.args.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=Nr(i.args[s],t);switch(e){case N.Any:return s=>{for(let o=0;o<r;++o)if(n[o](s))return!0;return!1};case N.All:return s=>{for(let o=0;o<r;++o)if(!n[o](s))return!1;return!0};case N.Between:return s=>{let o=n[0](s),a=n[1](s),l=n[2](s);return o>=a&&o<=l};case N.In:return s=>{let o=n[0](s);for(let a=1;a<r;++a)if(o===n[a](s))return!0;return!1};case N.Not:return s=>!n[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function pM(i,t){let e=i.operator,r=i.args.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=Nr(i.args[s],t);switch(e){case N.Multiply:return s=>{let o=1;for(let a=0;a<r;++a)o*=n[a](s);return o};case N.Divide:return s=>n[0](s)/n[1](s);case N.Add:return s=>{let o=0;for(let a=0;a<r;++a)o+=n[a](s);return o};case N.Subtract:return s=>n[0](s)-n[1](s);case N.Clamp:return s=>{let o=n[0](s),a=n[1](s);if(o<a)return a;let l=n[2](s);return o>l?l:o};case N.Mod:return s=>n[0](s)%n[1](s);case N.Pow:return s=>Math.pow(n[0](s),n[1](s));case N.Abs:return s=>Math.abs(n[0](s));case N.Floor:return s=>Math.floor(n[0](s));case N.Ceil:return s=>Math.ceil(n[0](s));case N.Round:return s=>Math.round(n[0](s));case N.Sin:return s=>Math.sin(n[0](s));case N.Cos:return s=>Math.cos(n[0](s));case N.Atan:return r===2?s=>Math.atan2(n[0](s),n[1](s)):s=>Math.atan(n[0](s));case N.Sqrt:return s=>Math.sqrt(n[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function gM(i,t){let e=i.args.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=Nr(i.args[n],t);return n=>{for(let s=0;s<e-1;s+=2)if(r[s](n))return r[s+1](n);return r[e-1](n)}}function yM(i,t){let e=i.args.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=Nr(i.args[n],t);return n=>{let s=r[0](n);for(let o=1;o<e-1;o+=2)if(s===r[o](n))return r[o+1](n);return r[e-1](n)}}function _M(i,t){let e=i.args.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=Nr(i.args[n],t);return n=>{let s=r[0](n),o=r[1](n),a,l;for(let c=2;c<e;c+=2){let h=r[c](n),u=r[c+1](n),f=Array.isArray(u);if(f&&(u=tv(u)),h>=o)return c===2?u:f?vM(s,o,a,l,h,u):Hl(s,o,a,l,h,u);a=h,l=u}return l}}function xM(i,t){let e=i.operator,r=i.args.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=Nr(i.args[s],t);switch(e){case N.ToString:return s=>{let o=n[0](s);return i.args[0].type===lr?Wl(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Hl(i,t,e,r,n,s){let o=n-e;if(o===0)return r;let a=t-e,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return r+l*(s-r)}function vM(i,t,e,r,n,s){if(n-e===0)return r;let a=Mp(r),l=Mp(s),c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);let h=[Hl(i,t,e,a[0],n,l[0]),Hl(i,t,e,a[1],n,l[1]),a[2]+Hl(i,t,e,0,n,c),Hl(i,t,e,r[3],n,s[3])];return ev(h)}var K={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};var Fp=class extends Qr{constructor(t,e,r,n){super(),this.extent=t,this.pixelRatio_=r,this.resolution=e,this.state=typeof n=="function"?K.IDLE:n,this.image_=null,this.loader=typeof n=="function"?n:null}changed(){this.dispatchEvent($.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==K.IDLE&&this.loader){this.state=K.LOADING,this.changed();let t=this.getResolution(),e=Array.isArray(t)?t[0]:t;Zr(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(r=>{"image"in r&&(this.image_=r.image),"extent"in r&&(this.extent=r.extent),"resolution"in r&&(this.resolution=r.resolution),"pixelRatio"in r&&(this.pixelRatio_=r.pixelRatio),(r instanceof HTMLImageElement||em&&r instanceof ImageBitmap||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)&&(this.image_=r),this.state=K.LOADED}).catch(r=>{this.state=K.ERROR,console.error(r)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}};function ov(i,t,e){let r=i,n=!0,s=!1,o=!1,a=[ps(r,$.LOAD,function(){o=!0,s||t()})];return r.src&&xh?(s=!0,r.decode().then(function(){n&&t()}).catch(function(l){n&&(o?t():e())})):a.push(ps(r,$.ERROR,e)),function(){n=!1,a.forEach(Tt)}}function EM(i,t){return new Promise((e,r)=>{function n(){o(),e(i)}function s(){o(),r(new Error("Image load error"))}function o(){i.removeEventListener("load",n),i.removeEventListener("error",s)}i.addEventListener("load",n),i.addEventListener("error",s),t&&(i.src=t)})}function Np(i,t){return t&&(i.src=t),i.src&&xh?new Promise((e,r)=>i.decode().then(()=>e(i)).catch(n=>i.complete&&i.width?e(i):r(n))):EM(i)}function Ls(i,t){return t&&(i.src=t),i.src&&xh&&em?i.decode().then(()=>createImageBitmap(i)).catch(e=>{if(i.complete&&i.width)return i;throw e}):Np(i)}var Os=Fp;var Gp=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(let e in this.cache_){let r=this.cache_[e];(t++&3)===0&&!r.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,r){let n=Dp(t,e,r);return n in this.cache_?this.cache_[n]:null}getPattern(t,e,r){let n=Dp(t,e,r);return n in this.patternCache_?this.patternCache_[n]:null}set(t,e,r,n,s){let o=Dp(t,e,r),a=o in this.cache_;this.cache_[o]=n,s&&(n.getImageState()===K.IDLE&&n.load(),n.getImageState()===K.LOADING?n.ready().then(()=>{this.patternCache_[o]=aa().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=aa().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function Dp(i,t,e){let r=e?ar(e):"null";return t+":"+i+":"+r}var pi=new Gp;var Zl=null,du=class extends Qr{constructor(t,e,r,n,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=r,this.canvas_={},this.color_=s,this.imageState_=n===void 0?K.IDLE:n,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===K.LOADED){Zl||(Zl=Xt(1,1,void 0,{willReadFrequently:!0})),Zl.drawImage(this.image_,0,0);try{Zl.getImageData(0,0,1,1),this.tainted_=!1}catch{Zl=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent($.CHANGE)}handleImageError_(){this.imageState_=K.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=K.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let t=this.size_[0],e=this.size_[1],r=Xt(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===K.IDLE){this.image_||this.initializeImage_(),this.imageState_=K.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Np(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==K.LOADED)return;let e=this.image_,r=Xt(Math.ceil(e.width*t),Math.ceil(e.height*t)),n=r.canvas;r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=Qx(this.color_),r.fillRect(0,0,n.width/t,n.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===K.LOADED||this.imageState_===K.ERROR)t();else{let e=()=>{(this.imageState_===K.LOADED||this.imageState_===K.ERROR)&&(this.removeEventListener($.CHANGE,e),t())};this.addEventListener($.CHANGE,e)}})),this.ready_}};function ga(i,t,e,r,n,s){let o=t===void 0?void 0:pi.get(t,e,n);return o||(o=new du(i,i&&"src"in i?i.src||void 0:t,e,r,n),pi.set(t,e,n,o,s)),s&&o&&!pi.getPattern(t,e,n)&&pi.set(t,e,n,o,s),o}var av=du;function Xi(i){return i?Array.isArray(i)?Wl(i):typeof i=="object"&&"src"in i?wM(i):i:null}function wM(i){if(!i.offset||!i.size)return pi.getPattern(i.src,"anonymous",i.color);let t=i.src+":"+i.offset,e=pi.getPattern(t,void 0,i.color);if(e)return e;let r=pi.get(i.src,"anonymous",null);if(r.getImageState()!==K.LOADED)return null;let n=Xt(i.size[0],i.size[1]);return n.drawImage(r.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),ga(n.canvas,t,void 0,K.LOADED,i.color,!0),pi.getPattern(t,void 0,i.color)}var pu="10px sans-serif",He="#000",an="round",Vi=[],Wi=0,ln="round",Nn=10,Dn="#000",Fs="center",fo="middle",Gn=[0,0,0,0],kn=1,Er=new Ie,ya=null,kp,zp={},gu=function(){let t="32px ",e=["monospace","serif"],r=e.length,n="wmytzilWMYTZIL@#/&?$%10\uF013",s,o;function a(c,h,u){let f=!0;for(let d=0;d<r;++d){let m=e[d];if(o=mu(c+" "+h+" "+t+m,n),u!=m){let p=mu(c+" "+h+" "+t+u+","+m,n);f=f&&p!=o}}return!!f}function l(){let c=!0,h=Er.getKeys();for(let u=0,f=h.length;u<f;++u){let d=h[u];if(Er.get(d)<100){let[m,p,g]=d.split(`
`);a(m,p,g)?(Jr(zp),ya=null,kp=void 0,Er.set(d,100)):(Er.set(d,Er.get(d)+1,!0),c=!1)}}c&&(clearInterval(s),s=void 0)}return function(c){let h=Ym(c);if(!h)return;let u=h.families;for(let f=0,d=u.length;f<d;++f){let m=u[f],p=h.style+`
`+h.weight+`
`+m;Er.get(p)===void 0&&(Er.set(p,100,!0),a(h.style,h.weight,m)||(Er.set(p,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),SM=function(){let i;return function(t){let e=zp[t];if(e==null){if(_h){let r=Ym(t),n=lv(t,"\u017Dg");e=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);zp[t]=e}return e}}();function lv(i,t){return ya||(ya=Xt(1,1)),i!=kp&&(ya.font=i,kp=ya.font),ya.measureText(t)}function mu(i,t){return lv(i,t).width}function jp(i,t,e){if(t in e)return e[t];let r=t.split(`
`).reduce((n,s)=>Math.max(n,mu(i,s)),0);return e[t]=r,r}function cv(i,t){let e=[],r=[],n=[],s=0,o=0,a=0,l=0;for(let c=0,h=t.length;c<=h;c+=2){let u=t[c];if(u===`
`||c===h){s=Math.max(s,o),n.push(o),o=0,a+=l,l=0;continue}let f=t[c+1]||i.font,d=mu(f,u);e.push(d),o+=d;let m=SM(f);r.push(m),l=Math.max(l,m)}return{width:s,height:a,widths:e,heights:r,lineWidths:n}}function hv(i,t,e,r,n,s,o,a,l,c,h){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),r.contextInstructions?(i.translate(l,c),i.scale(h[0],h[1]),bM(r,i)):h[0]<0||h[1]<0?(i.translate(l,c),i.scale(h[0],h[1]),i.drawImage(r,n,s,o,a,0,0,o,a)):i.drawImage(r,n,s,o,a,l,c,o*h[0],a*h[1]),i.restore()}function bM(i,t){let e=i.contextInstructions;for(let r=0,n=e.length;r<n;r+=2)Array.isArray(e[r+1])?t[e[r]].apply(t,e[r+1]):t[e[r]]=e[r+1]}var Up=class i{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=me(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new i({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return nt()}getImage(t){return nt()}getHitDetectionImage(){return nt()}getPixelRatio(t){return 1}getImageState(){return nt()}getImageSize(){return nt()}getOrigin(){return nt()}getSize(){return nt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=me(t)}listenImageChange(t){nt()}load(){nt()}unlistenImageChange(t){nt()}ready(){return Promise.resolve()}},yu=Up;var Bp=class i extends yu{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?K.LOADING:K.LOADED,this.imageState_===K.LOADING&&this.ready().then(()=>this.imageState_=K.LOADED),this.render()}clone(){let t=this.getScale(),e=new i({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){let t=this.size_,e=this.getDisplacement(),r=this.getScaleArray();return[t[0]/2-e[0]/r[0],t[1]/2+e[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.fill_?.getKey(),r=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(","),n=pi.get(r,null,null)?.getImage(1);if(!n){let s=this.renderOptions_,o=Math.ceil(s.size*t),a=Xt(o,o);this.draw_(s,a,t),n=a.canvas,pi.set(r,null,null,new av(n,void 0,null,K.LOADED,null))}return n}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,r){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius,s=this.radius2_===void 0?n:this.radius2_;if(n<s){let b=n;n=s,s=b}let o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),c=Math.sqrt(s*s-l*l),h=n-c,u=Math.sqrt(l*l+h*h),f=u/l;if(t==="miter"&&f<=r)return f*e;let d=e/2/f,m=e/2*(h/u),g=Math.sqrt((n+d)*(n+d)+m*m)-n;if(this.radius2_===void 0||t==="bevel")return g*2;let y=n*Math.sin(a),_=Math.sqrt(n*n-y*y),x=s-_,E=Math.sqrt(y*y+x*x)/y;if(E<=r){let b=E*e/2-s-n;return 2*Math.max(g,b)}return g*2}createRenderOptions(){let t=an,e=ln,r=0,n=null,s=0,o,a=0;this.stroke_&&(o=Xi(this.stroke_.getColor()??Dn),a=this.stroke_.getWidth()??kn,n=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??ln,t=this.stroke_.getLineCap()??an,r=this.stroke_.getMiterLimit()??Nn);let l=this.calculateLineJoinSize_(e,a,r),c=Math.max(this.radius,this.radius2_||0),h=Math.ceil(2*c+l);return{strokeStyle:o,strokeWidth:a,size:h,lineCap:t,lineDash:n,lineDashOffset:s,lineJoin:e,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();let t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=He),e.fillStyle=Xi(n),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let r=this.fill_.getColor(),n=0;typeof r=="string"&&(r=ar(r)),r===null?n=1:Array.isArray(r)&&(n=r.length===4?r[3]:1),n===0&&(e=Xt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_,r=this.radius;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{let n=this.radius2_===void 0?r:this.radius2_;this.radius2_!==void 0&&(e*=2);let s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){let l=s+a*o,c=a%2===0?r:n;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=He,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},_u=Bp;var qp=class i extends _u{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){let t=this.getScale(),e=new i({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}},zn=qp;var Xp=class i{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){let t=this.getColor();return new i({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){let e=ga(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===K.IDLE&&e.load(),e.getImageState()===K.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){let t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?H(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:ar(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},Le=Xp;function uv(i,t,e,r){return e!==void 0&&r!==void 0?[e/i,r/t]:e!==void 0?e/i:r!==void 0?r/t:1}var Vp=class i extends yu{constructor(t){t=t||{};let e=t.opacity!==void 0?t.opacity:1,r=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:r,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;let o=t.img!==void 0?t.img:null,a=t.src;Et(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||H(o)),Et(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Et(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=K.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?K.LOADED:K.IDLE:l=K.LOADING:l=K.LOADED),this.color_=t.color!==void 0?ar(t.color):null,this.iconImage_=ga(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,h;if(t.size)[c,h]=t.size;else{let u=this.getImage(1);if(u.width&&u.height)c=u.width,h=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;let f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;let d=this.iconImage_.getSize();this.setScale(uv(d[0],d[1],t.width,t.height))};this.listenImageChange(f);return}}c!==void 0&&this.setScale(uv(c,h,t.width,t.height))}}clone(){let t,e,r;return this.initialOptions_?(e=this.initialOptions_.width,r=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new i({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:r,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;let n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}let e=this.getDisplacement(),r=this.getScaleArray();return[t[0]-e[0]/r[0],t[1]+e[1]/r[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){let e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=r[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){let t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener($.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener($.CHANGE,t)}ready(){return this.iconImage_.ready()}},Dr=Vp;var Wp=class i{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){let t=this.getColor();return new i({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}},Be=Wp;var xu=class i{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=fv,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new i({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=fv,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function dv(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(Et(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}var Yp=null;function $p(i,t){if(!Yp){let e=new Le({color:"rgba(255,255,255,0.4)"}),r=new Be({color:"#3399CC",width:1.25});Yp=[new xu({image:new zn({fill:e,stroke:r,radius:5}),fill:e,stroke:r})]}return Yp}function fv(i){return i.getGeometry()}var ce=xu;var CM="#333",Kp=class i{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=me(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Le({color:CM}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new i({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=me(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}},cr=Kp;function MM(i){return!0}function yv(i){let t=Ap(),e=TM(i,t),r=Op();return function(n,s){if(r.properties=n.getPropertiesInternal(),r.resolution=s,t.featureId){let o=n.getId();o!==void 0?r.featureId=o:r.featureId=null}return t.geometryType&&(r.geometryType=Lp(n.getGeometry())),e(r)}}function Jp(i){let t=Ap(),e=i.length,r=new Array(e);for(let o=0;o<e;++o)r[o]=Hp(i[o],t);let n=Op(),s=new Array(e);return function(o,a){if(n.properties=o.getPropertiesInternal(),n.resolution=a,t.featureId){let c=o.getId();c!==void 0?n.featureId=c:n.featureId=null}let l=0;for(let c=0;c<e;++c){let h=r[c](n);h&&(s[l]=h,l+=1)}return s.length=l,s}}function TM(i,t){let e=i.length,r=new Array(e);for(let n=0;n<e;++n){let s=i[n],o="filter"in s?on(s.filter,mi,t):MM,a;if(Array.isArray(s.style)){let l=s.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=Hp(s.style[c],t)}else a=[Hp(s.style,t)];r[n]={filter:o,styles:a}}return function(n){let s=[],o=!1;for(let a=0;a<e;++a){let l=r[a].filter;if(l(n)&&!(i[a].else&&o)){o=!0;for(let c of r[a].styles){let h=c(n);h&&s.push(h)}}}return s}}function Hp(i,t){let e=Jl(i,"",t),r=Ql(i,"",t),n=PM(i,t),s=RM(i,t),o=Yi(i,"z-index",t);if(!e&&!r&&!n&&!s&&!vi(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));let a=new ce;return function(l){let c=!0;if(e){let h=e(l);h&&(c=!1),a.setFill(h)}if(r){let h=r(l);h&&(c=!1),a.setStroke(h)}if(n){let h=n(l);h&&(c=!1),a.setText(h)}if(s){let h=s(l);h&&(c=!1),a.setImage(h)}return o&&a.setZIndex(o(l)),c?null:a}}function Jl(i,t,e){let r;if(t+"fill-pattern-src"in i)r=OM(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return s=>null;r=Qp(i,t+"fill-color",e)}if(!r)return null;let n=new Le;return function(s){let o=r(s);return o===uu?null:(n.setColor(o),n)}}function Ql(i,t,e){let r=Yi(i,t+"stroke-width",e),n=Qp(i,t+"stroke-color",e);if(!r&&!n)return null;let s=jn(i,t+"stroke-line-cap",e),o=jn(i,t+"stroke-line-join",e),a=_v(i,t+"stroke-line-dash",e),l=Yi(i,t+"stroke-line-dash-offset",e),c=Yi(i,t+"stroke-miter-limit",e),h=new Be;return function(u){if(n){let f=n(u);if(f===uu)return null;h.setColor(f)}if(r&&h.setWidth(r(u)),s){let f=s(u);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");h.setLineCap(f)}if(o){let f=o(u);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");h.setLineJoin(f)}return a&&h.setLineDash(a(u)),l&&h.setLineDashOffset(l(u)),c&&h.setMiterLimit(c(u)),h}}function PM(i,t){let e="text-",r=jn(i,e+"value",t);if(!r)return null;let n=Jl(i,e,t),s=Jl(i,e+"background-",t),o=Ql(i,e,t),a=Ql(i,e+"background-",t),l=jn(i,e+"font",t),c=Yi(i,e+"max-angle",t),h=Yi(i,e+"offset-x",t),u=Yi(i,e+"offset-y",t),f=_a(i,e+"overflow",t),d=jn(i,e+"placement",t),m=Yi(i,e+"repeat",t),p=wu(i,e+"scale",t),g=_a(i,e+"rotate-with-view",t),y=Yi(i,e+"rotation",t),_=jn(i,e+"align",t),x=jn(i,e+"justify",t),v=jn(i,e+"baseline",t),E=_a(i,e+"keep-upright",t),b=_v(i,e+"padding",t),S=Su(i,e+"declutter-mode"),T=new cr({declutterMode:S});return function(P){if(T.setText(r(P)),n&&T.setFill(n(P)),s&&T.setBackgroundFill(s(P)),o&&T.setStroke(o(P)),a&&T.setBackgroundStroke(a(P)),l&&T.setFont(l(P)),c&&T.setMaxAngle(c(P)),h&&T.setOffsetX(h(P)),u&&T.setOffsetY(u(P)),f&&T.setOverflow(f(P)),d){let F=d(P);if(F!=="point"&&F!=="line")throw new Error("Expected point or line for text-placement");T.setPlacement(F)}if(m&&T.setRepeat(m(P)),p&&T.setScale(p(P)),g&&T.setRotateWithView(g(P)),y&&T.setRotation(y(P)),_){let F=_(P);if(F!=="left"&&F!=="center"&&F!=="right"&&F!=="end"&&F!=="start")throw new Error("Expected left, right, center, start, or end for text-align");T.setTextAlign(F)}if(x){let F=x(P);if(F!=="left"&&F!=="right"&&F!=="center")throw new Error("Expected left, right, or center for text-justify");T.setJustify(F)}if(v){let F=v(P);if(F!=="bottom"&&F!=="top"&&F!=="middle"&&F!=="alphabetic"&&F!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");T.setTextBaseline(F)}return b&&T.setPadding(b(P)),E&&T.setKeepUpright(E(P)),T}}function RM(i,t){return"icon-src"in i?IM(i,t):"shape-points"in i?AM(i,t):"circle-radius"in i?LM(i,t):null}function IM(i,t){let e="icon-",r=e+"src",n=xv(i[r],r),s=vu(i,e+"anchor",t),o=wu(i,e+"scale",t),a=Yi(i,e+"opacity",t),l=vu(i,e+"displacement",t),c=Yi(i,e+"rotation",t),h=_a(i,e+"rotate-with-view",t),u=pv(i,e+"anchor-origin"),f=gv(i,e+"anchor-x-units"),d=gv(i,e+"anchor-y-units"),m=GM(i,e+"color"),p=NM(i,e+"cross-origin"),g=DM(i,e+"offset"),y=pv(i,e+"offset-origin"),_=Eu(i,e+"width"),x=Eu(i,e+"height"),v=FM(i,e+"size"),E=Su(i,e+"declutter-mode"),b=new Dr({src:n,anchorOrigin:u,anchorXUnits:f,anchorYUnits:d,color:m,crossOrigin:p,offset:g,offsetOrigin:y,height:x,width:_,size:v,declutterMode:E});return function(S){return a&&b.setOpacity(a(S)),l&&b.setDisplacement(l(S)),c&&b.setRotation(c(S)),h&&b.setRotateWithView(h(S)),o&&b.setScale(o(S)),s&&b.setAnchor(s(S)),b}}function AM(i,t){let e="shape-",r=e+"points",n=e+"radius",s=Zp(i[r],r),o=Zp(i[n],n),a=Jl(i,e,t),l=Ql(i,e,t),c=wu(i,e+"scale",t),h=vu(i,e+"displacement",t),u=Yi(i,e+"rotation",t),f=_a(i,e+"rotate-with-view",t),d=Eu(i,e+"radius2"),m=Eu(i,e+"angle"),p=Su(i,e+"declutter-mode"),g=new _u({points:s,radius:o,radius2:d,angle:m,declutterMode:p});return function(y){return a&&g.setFill(a(y)),l&&g.setStroke(l(y)),h&&g.setDisplacement(h(y)),u&&g.setRotation(u(y)),f&&g.setRotateWithView(f(y)),c&&g.setScale(c(y)),g}}function LM(i,t){let e="circle-",r=Jl(i,e,t),n=Ql(i,e,t),s=Yi(i,e+"radius",t),o=wu(i,e+"scale",t),a=vu(i,e+"displacement",t),l=Yi(i,e+"rotation",t),c=_a(i,e+"rotate-with-view",t),h=Su(i,e+"declutter-mode"),u=new zn({radius:5,declutterMode:h});return function(f){return s&&u.setRadius(s(f)),r&&u.setFill(r(f)),n&&u.setStroke(n(f)),a&&u.setDisplacement(a(f)),l&&u.setRotation(l(f)),c&&u.setRotateWithView(c(f)),o&&u.setScale(o(f)),u}}function Yi(i,t,e){if(!(t in i))return;let r=on(i[t],Vt,e);return function(n){return Zp(r(n),t)}}function jn(i,t,e){if(!(t in i))return null;let r=on(i[t],bi,e);return function(n){return xv(r(n),t)}}function OM(i,t,e){let r=jn(i,t+"pattern-src",e),n=mv(i,t+"pattern-offset",e),s=mv(i,t+"pattern-size",e),o=Qp(i,t+"color",e);return function(a){return{src:r(a),offset:n&&n(a),size:s&&s(a),color:o&&o(a)}}}function _a(i,t,e){if(!(t in i))return null;let r=on(i[t],mi,e);return function(n){let s=r(n);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function Qp(i,t,e){if(!(t in i))return null;let r=on(i[t],lr,e);return function(n){return vv(r(n),t)}}function _v(i,t,e){if(!(t in i))return null;let r=on(i[t],As,e);return function(n){return tc(r(n),t)}}function vu(i,t,e){if(!(t in i))return null;let r=on(i[t],As,e);return function(n){let s=tc(r(n),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function mv(i,t,e){if(!(t in i))return null;let r=on(i[t],As,e);return function(n){return Ev(r(n),t)}}function wu(i,t,e){if(!(t in i))return null;let r=on(i[t],As|Vt,e);return function(n){return kM(r(n),t)}}function Eu(i,t){let e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function FM(i,t){let e=i[t];if(e!==void 0){if(typeof e=="number")return me(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function NM(i,t){let e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function pv(i,t){let e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function gv(i,t){let e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function DM(i,t){let e=i[t];if(e!==void 0)return tc(e,t)}function Su(i,t){let e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function GM(i,t){let e=i[t];if(e!==void 0)return vv(e,t)}function tc(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);let e=i.length;for(let r=0;r<e;++r)if(typeof i[r]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function xv(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function Zp(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function vv(i,t){if(typeof i=="string")return i;let e=tc(i,t),r=e.length;if(r<3||r>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function Ev(i,t){let e=tc(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function kM(i,t){return typeof i=="number"?i:Ev(i,t)}var wv={RENDER_ORDER:"renderOrder"},tg=class extends ye{constructor(t){t=t||{};let e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(wv.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){let r=this.getDeclutter();r in t.declutter||(t.declutter[r]=new ma(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(wv.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?$p:t;let e=zM(t);this.styleFunction_=t===null?void 0:dv(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}};function zM(i){if(i===void 0)return $p;if(!i)return null;if(typeof i=="function"||i instanceof ce)return i;if(!Array.isArray(i))return Jp([i]);if(i.length===0)return[];let t=i.length,e=i[0];if(e instanceof ce){let n=new Array(t);for(let s=0;s<t;++s){let o=i[s];if(!(o instanceof ce))throw new Error("Expected a list of style instances");n[s]=o}return n}if("style"in e){let n=new Array(t);for(let s=0;s<t;++s){let o=i[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[s]=o}return yv(n)}return Jp(i)}var Ns=tg;var eg=class extends Re{constructor(t,e,r,n){super(t),this.inversePixelTransform=e,this.frameState=r,this.context=n}},bu=eg;var ig=class extends Hr{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){nt()}calculateMatrices2D(t){let e=t.viewState,r=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;$e(r,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),jh(n,r)}forEachFeatureAtCoordinate(t,e,r,n,s,o,a,l){let c,h=e.viewState;function u(v,E,b,S){return s.call(o,E,v?b:null,S)}let f=h.projection,d=vs(t.slice(),f),m=[[0,0]];if(f.canWrapX()&&n){let v=f.getExtent(),E=it(v);m.push([-E,0],[E,0])}let p=e.layerStatesArray,g=p.length,y=[],_=[];for(let v=0;v<m.length;v++)for(let E=g-1;E>=0;--E){let b=p[E],S=b.layer;if(S.hasRenderer()&&zl(b,h)&&a.call(l,S)){let T=S.getRenderer(),P=S.getSource();if(T&&P){let F=P.getWrapX()?d:t,k=u.bind(null,b.managed);_[0]=F[0]+m[v][0],_[1]=F[1]+m[v][1],c=T.forEachFeatureAtCoordinate(_,e,r,k,y)}if(c)return c}}if(y.length===0)return;let x=1/y.length;return y.forEach((v,E)=>v.distanceSq+=E*x),y.sort((v,E)=>v.distanceSq-E.distanceSq),y.some(v=>c=v.callback(v.feature,v.layer,v.geometry)),c}hasFeatureAtCoordinate(t,e,r,n,s,o){return this.forEachFeatureAtCoordinate(t,e,r,n,Mn,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){nt()}scheduleExpireIconCache(t){pi.canExpireCache()&&t.postRenderFunctions.push(jM)}};function jM(i,t){pi.expire()}var Sv=ig;var rg=class extends Sv{constructor(t){super(t),this.fontChangeListenerKey_=dt(Er,er.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");let e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Bi+" ol-layers";let r=t.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){let r=this.getMap();if(r.hasListener(t)){let n=new bu(t,void 0,e);r.dispatchEvent(n)}}disposeInternal(){Tt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ke.PRECOMPOSE,t);let e=t.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);e.some(a=>a.layer instanceof Ns&&a.layer.getDeclutter())&&(t.declutter={});let n=t.viewState;this.children_.length=0;let s=[],o=null;for(let a=0,l=e.length;a<l;++a){let c=e[a];t.layerIndex=a;let h=c.layer,u=h.getSourceState();if(!zl(c,n)||u!="ready"&&u!="undefined"){h.unrender();continue}let f=h.render(t,o);f&&(f!==o&&(this.children_.push(f),o=f),s.push(c))}this.declutter(t,s),Dl(this.element_,this.children_),this.dispatchRenderEvent(Ke.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let r=e.length-1;r>=0;--r){let n=e[r],s=n.layer;s.getDeclutter()&&s.renderDeclutter(t,n)}e.forEach(r=>r.layer.renderDeferred(t))}}},bv=rg;function Cv(i){if(i instanceof ye){i.setMapInternal(null);return}i instanceof se&&i.getLayers().forEach(Cv)}function Mv(i,t){if(i instanceof ye){i.setMapInternal(t);return}if(i instanceof se){let e=i.getLayers().getArray();for(let r=0,n=e.length;r<n;++r)Mv(e[r],t)}}var ng=class extends Ie{constructor(t){super(),t=t||{},this.on,this.once,this.un;let e=UM(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:b1,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=we(),this.pixelToCoordinateTransform_=we(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||Ox(),this.interactions=e.interactions||ou({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Eh(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Ee.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Ee.VIEW,this.handleViewChanged_),this.addChangeListener(Ee.SIZE,this.handleSizeChanged_),this.addChangeListener(Ee.TARGET,this.handleTargetChanged_),this.setProperties(e.values);let r=this;t.view&&!(t.view instanceof ai)&&t.view.then(function(n){r.setView(new ai(n))}),this.controls.addEventListener(ei.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(ei.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(ei.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(ei.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(ei.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(ei.REMOVE,n=>{let s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Mv(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){let e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,r){if(!this.frameState_||!this.renderer_)return;let n=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};let s=r.hitTolerance!==void 0?r.hitTolerance:0,o=r.layerFilter!==void 0?r.layerFilter:Mn,a=r.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,a,e,null,o,null)}getFeaturesAtPixel(t,e){let r=[];return this.forEachFeatureAtPixel(t,function(n){r.push(n)},e),r}getAllLayers(){let t=[];function e(r){r.forEach(function(n){n instanceof se?e(n.getLayers()):t.push(n)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;let r=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};let n=e.layerFilter!==void 0?e.layerFilter:Mn,s=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,s,o,n,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){let r=this.viewport_.getBoundingClientRect(),n=this.getSize(),s=r.width/n[0],o=r.height/n[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-r.left)/s,(a.clientY-r.top)/o]}getTarget(){return this.get(Ee.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return wl(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){let e=this.frameState_;return e?ne(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){let e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Ee.LAYERGROUP)}setLayers(t){let e=this.getLayerGroup();if(t instanceof pe){e.setLayers(t);return}let r=e.getLayers();r.clear(),r.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let t=this.getLayerGroup().getLayerStatesArray();for(let e=0,r=t.length;e<r;++e){let n=t[e];if(!n.visible)continue;let s=n.layer.getRenderer();if(s&&!s.ready)return!0;let o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){let e=Or(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){let e=this.frameState_;return e?ne(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Ee.SIZE)}getView(){return this.get(Ee.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,r,n){return T1(this.frameState_,t,e,r,n)}handleBrowserEvent(t,e){e=e||t.type;let r=new tn(e,this,t);this.handleMapBrowserEvent(r)}handleMapBrowserEvent(t){if(!this.frameState_)return;let e=t.originalEvent,r=e.type;if(r===ys.POINTERDOWN||r===$.WHEEL||r===$.KEYDOWN){let n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=e.target,a=s instanceof ShadowRoot?s.host===o?s.host.ownerDocument:s:s===n?n.documentElement:s;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){let n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){let o=n[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){let t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,s=n;if(t){let o=t.viewHints;if(o[ie.ANIMATING]||o[ie.INTERACTING]){let a=Date.now()-t.time>8;n=a?0:8,s=a?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Ke.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ke.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new gs(Li.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new gs(Li.LOADSTART,this,t))));let r=this.postRenderFunctions_;if(t)for(let n=0,s=r.length;n<s;++n)r[n](this,t);r.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let r=0,n=this.targetChangeHandlerKeys_.length;r<n;++r)Tt(this.targetChangeHandlerKeys_[r]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener($.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener($.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);let r=this.targetElement_.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.unobserve(r.host),this.setSize(void 0)}let t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new bv(this)),this.mapBrowserEventHandler_=new C1(this,this.moveTolerance_);for(let s in de)this.mapBrowserEventHandler_.addEventListener(de[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener($.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener($.WHEEL,this.boundHandleBrowserEvent_,vh?{passive:!1}:!1);let r;if(this.keyboardEventTarget_)r=this.keyboardEventTarget_;else{let s=e.getRootNode();r=s instanceof ShadowRoot?s.host:e}this.targetChangeHandlerKeys_=[dt(r,$.KEYDOWN,this.handleBrowserEvent,this),dt(r,$.KEYPRESS,this.handleBrowserEvent,this)];let n=e.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Tt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Tt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=dt(t,er.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=dt(t,$.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Tt),this.layerGroupPropertyListenerKeys_=null);let t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Fr("addlayer",t)),this.layerGroupPropertyListenerKeys_=[dt(t,er.PROPERTYCHANGE,this.render,this),dt(t,$.CHANGE,this.render,this),dt(t,"addlayer",this.handleLayerAdd_,this),dt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){let t=this.getLayerGroup().getLayerStatesArray();for(let e=0,r=t.length;e<r;++e){let n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Cv(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){let e=this.getSize(),r=this.getView(),n=this.frameState_,s=null;if(e!==void 0&&Tp(e)&&r&&r.isDef()){let o=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=r.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:An(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:H(this),renderTargets:{}},a.nextCenter&&a.nextResolution){let l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=An(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!Di(this.previousExtent_)&&!ze(s.extent,this.previousExtent_))&&(this.dispatchEvent(new gs(Li.MOVESTART,this,n)),this.previousExtent_=In(this.previousExtent_)),this.previousExtent_&&!s.viewHints[ie.ANIMATING]&&!s.viewHints[ie.INTERACTING]&&!ze(s.extent,this.previousExtent_)&&(this.dispatchEvent(new gs(Li.MOVEEND,this,s)),Ch(s.extent,this.previousExtent_))),this.dispatchEvent(new gs(Li.POSTRENDER,this,s)),this.renderComplete_=(this.hasListener(Li.LOADSTART)||this.hasListener(Li.LOADEND)||this.hasListener(Ke.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){let e=this.getLayerGroup();e&&this.handleLayerRemove_(new Fr("removelayer",e)),this.set(Ee.LAYERGROUP,t)}setSize(t){this.set(Ee.SIZE,t)}setTarget(t){this.set(Ee.TARGET,t)}setView(t){if(!t||t instanceof ai){this.set(Ee.VIEW,t);return}this.set(Ee.VIEW,new ai);let e=this;t.then(function(r){e.setView(new ai(r))})}updateSize(){let t=this.getTargetElement(),e;if(t){let n=getComputedStyle(t),s=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(e=[Math.max(0,s),Math.max(0,o)],!Tp(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Ah("No map visible because the map container's width or height are 0."))}let r=this.getSize();e&&(!r||!ui(e,r))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){let e=this.getView();e&&e.setViewportSize(t)}};function UM(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);let e={},r=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new se({layers:i.layers});e[Ee.LAYERGROUP]=r,e[Ee.TARGET]=i.target,e[Ee.VIEW]=i.view instanceof ai?i.view:new ai;let n;i.controls!==void 0&&(Array.isArray(i.controls)?n=new pe(i.controls.slice()):(Et(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new pe(i.interactions.slice()):(Et(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new pe(i.overlays.slice()):(Et(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new pe,{controls:n,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}var Ds=ng;var gi={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},sg=class extends Ie{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+Ix,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(gi.ELEMENT,this.handleElementChanged),this.addChangeListener(gi.MAP,this.handleMapChanged),this.addChangeListener(gi.OFFSET,this.handleOffsetChanged),this.addChangeListener(gi.POSITION,this.handlePositionChanged),this.addChangeListener(gi.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(gi.ELEMENT)}getId(){return this.id}getMap(){return this.get(gi.MAP)||null}getOffset(){return this.get(gi.OFFSET)}getPosition(){return this.get(gi.POSITION)}getPositioning(){return this.get(gi.POSITIONING)}handleElementChanged(){Zh(this.element);let t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),Tt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let t=this.getMap();if(t){this.mapPostrenderListenerKey=dt(t,Li.POSTRENDER,this.render,this),this.updatePixelPosition();let e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(gi.ELEMENT,t)}setMap(t){this.set(gi.MAP,t)}setOffset(t){this.set(gi.OFFSET,t)}setPosition(t){this.set(gi.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){let e=this.getMap();if(!e||!e.getTargetElement()||!this.get(gi.POSITION))return;let r=this.getRect(e.getTargetElement(),e.getSize()),n=this.getElement(),s=this.getRect(n,[Ax(n),Lx(n)]);t=t||{};let o=t.margin===void 0?20:t.margin;if(!Ce(r,s)){let a=s[0]-r[0],l=r[2]-s[2],c=s[1]-r[1],h=r[3]-s[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),c<0?u[1]=c-o:h<0&&(u[1]=Math.abs(h)+o),u[0]!==0||u[1]!==0){let f=e.getView().getCenterInternal(),d=e.getPixelFromCoordinateInternal(f);if(!d)return;let m=[d[0]+u[0],d[1]+u[1]],p=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(m),duration:p.duration,easing:p.easing})}}}getRect(t,e){let r=t.getBoundingClientRect(),n=r.left+window.pageXOffset,s=r.top+window.pageYOffset;return[n,s,n+e[0],s+e[1]]}setPositioning(t){this.set(gi.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){let t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}let r=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(r,n)}updateRenderedPosition(t,e){let r=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);let o=Math.round(t[0]+n[0])+"px",a=Math.round(t[1]+n[1])+"px",l="0%",c="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?l="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(l="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?c="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(c="-50%");let h=`translate(${l}, ${c}) translate(${o}, ${a})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,r.transform=h)}getOptions(){return this.options}},Cu=sg;var cn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var og=class extends ye{constructor(t){t=t||{};let e=Object.assign({},t),r=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=r,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(cn.PRELOAD)}setPreload(t){this.set(cn.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(cn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(cn.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}},Mu=og;var ag=class extends ye{constructor(t){t=t||{},super(t)}},Tu=ag;var lg=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(aa(),{get:(t,e)=>{if(typeof aa()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,r)=>(this.push_(e,r),!0)})}push_(...t){let e=this.instructions_,r=this.zIndex+this.offset_;e[r]||(e[r]=[]),e[r].push(...t)}pushMethodArgs_=(...t)=>(this.push_(t),this);pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let r=0,n=e.length;r<n;++r){let s=e[r];if(typeof s=="function"){s(t);continue}let o=e[++r];if(typeof t[s]=="function")t[s](...o);else{if(typeof o=="function"){t[s]=o(t);continue}t[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},xa=lg;var BM=5,cg=class extends gh{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=BM}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return nt()}getData(t){return null}prepareFrame(t){return nt()}renderFrame(t,e){return nt()}forEachFeatureAtCoordinate(t,e,r,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){let e=t.target;(e.getState()===K.LOADED||e.getState()===K.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=K.LOADED&&e!=K.ERROR&&t.addEventListener($.CHANGE,this.boundHandleImageChange_),e==K.IDLE&&(t.load(),e=t.getState()),e==K.LOADED}renderIfReadyAndVisible(){let t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},Tv=cg;var ug=[],va=null;function qM(){va=Xt(1,1,void 0,{willReadFrequently:!0})}var hg=class extends Tv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=we(),this.pixelTransform=we(),this.inversePixelTransform=we(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,r){va||qM(),va.clearRect(0,0,1,1);let n;try{va.drawImage(t,e,r,1,1,0,0,1,1),n=va.getImageData(0,0,1,1).data}catch{return va=null,null}return n}getBackground(t){let r=this.getLayer().getBackground();return typeof r=="function"&&(r=r(t.viewState.resolution)),r||void 0}useContainer(t,e,r){let n=this.getLayer().getClassName(),s,o;if(t&&t.className===n&&(!r||t&&t.style.backgroundColor&&ui(ar(t.style.backgroundColor),ar(r)))){let a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&lx(o.canvas.style.transform,e)?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=n;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=Xt();let l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(t,e,r){let n=Ue(r),s=Ko(r),o=xs(r),a=$o(r);ne(e.coordinateToPixelTransform,n),ne(e.coordinateToPixelTransform,s),ne(e.coordinateToPixelTransform,o),ne(e.coordinateToPixelTransform,a);let l=this.inversePixelTransform;ne(l,n),ne(l,s),ne(l,o),ne(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,e){let r=t.extent,n=t.viewState.resolution,s=t.viewState.rotation,o=t.pixelRatio,a=Math.round(it(r)/n*o),l=Math.round(Ft(r)/n*o);$e(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/o,1/o,s,-a/2,-l/2),jh(this.inversePixelTransform,this.pixelTransform);let c=ax(this.pixelTransform);if(this.useContainer(e,c,this.getBackground(t)),!this.containerReused){let h=this.context.canvas;h.width!=a||h.height!=l?(h.width=a,h.height=l):this.context.clearRect(0,0,a,l),c!==h.style.transform&&(h.style.transform=c)}}dispatchRenderEvent_(t,e,r){let n=this.getLayer();if(n.hasListener(t)){let s=new bu(t,this.inversePixelTransform,r,e);n.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Ke.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Ke.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new xa),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Ke.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Ke.POSTRENDER,this.context,t))}getRenderTransform(t,e,r,n,s,o,a){let l=s/2,c=o/2,h=n/e,u=-h,f=-t[0]+a,d=-t[1];return $e(this.tempTransform,l,c,h,u,-r,f,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},Ea=hg;var fg=class extends Ea{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){let e=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,n=t.viewState,s=n.resolution,o=this.getLayer().getSource(),a=t.viewHints,l=t.extent;if(e.extent!==void 0&&(l=je(l,Si(e.extent,n.projection))),!a[ie.ANIMATING]&&!a[ie.INTERACTING]&&!Di(l))if(o){let c=n.projection,h=o.getImage(l,s,r,c);h&&(this.loadImage(h)?this.image=h:h.getState()===K.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){let e=this.frameState;if(!e)return null;let r=this.getLayer(),n=ne(e.pixelToCoordinateTransform,t.slice()),s=r.getExtent();if(s&&!ke(s,n))return null;let o=this.image.getExtent(),a=this.image.getImage(),l=it(o),c=Math.floor(a.width*((n[0]-o[0])/l));if(c<0||c>=a.width)return null;let h=Ft(o),u=Math.floor(a.height*((o[3]-n[1])/h));return u<0||u>=a.height?null:this.getImageData(a,c,u)}renderFrame(t,e){let r=this.image,n=r.getExtent(),s=r.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=r.getPixelRatio(),c=t.layerStatesArray[t.layerIndex],h=t.pixelRatio,u=t.viewState,f=u.center,d=u.resolution,m=h*o/(d*l),p=h*a/(d*l);this.prepareContainer(t,e);let g=this.context.canvas.width,y=this.context.canvas.height,_=this.getRenderContext(t),x=!1,v=!0;if(c.extent){let P=Si(c.extent,u.projection);v=kt(P,t.extent),x=v&&!Ce(P,t.extent),x&&this.clipUnrotated(_,t,P)}let E=r.getImage(),b=$e(this.tempTransform,g/2,y/2,m,p,0,l*(n[0]-f[0])/o,l*(f[1]-n[3])/a);this.renderedResolution=a*h/l;let S=E.width*b[0],T=E.height*b[3];if(this.getLayer().getSource().getInterpolate()||(_.imageSmoothingEnabled=!1),this.preRender(_,t),v&&S>=.5&&T>=.5){let P=b[4],F=b[5],k=c.opacity;k!==1&&(_.save(),_.globalAlpha=k),_.drawImage(E,0,0,+E.width,+E.height,P,F,S,T),k!==1&&_.restore()}return this.postRender(this.context,t),x&&_.restore(),_.imageSmoothingEnabled=!0,this.container}},Pu=fg;var dg=class extends Tu{constructor(t){super(t)}createRenderer(){return new Pu(this)}getData(t){return super.getData(t)}},wa=dg;var mg=class extends Qr{constructor(t,e,r){super(),r=r||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent($.CHANGE)}release(){this.setState(q.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==q.EMPTY){if(this.state!==q.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){nt()}getAlpha(t,e){if(!this.transition_)return 1;let r=this.transitionStarts_[t];if(!r)r=e,this.transitionStarts_[t]=r;else if(r===-1)return 1;let n=e-r+1e3/60;return n>=this.transition_?1:fm(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},hn=mg;function Ru(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}var XM=new Error("disposed");var VM=[256,256],pg=class extends hn{constructor(t){let e=q.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;let t=Ru(this.data_);return t?[t.width,t.height]:VM}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();let t=this;this.loader_().then(function(e){t.data_=e,t.state=q.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=q.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(XM),this.controller_=null),super.disposeInternal()}},gg=pg;var yg=class extends hn{constructor(t,e,r,n,s,o){super(t,e,o),this.crossOrigin_=n,this.src_=r,this.key=r,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=q.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=q.ERROR,this.unlistenImage_(),this.image_=WM(),this.changed()}handleImageLoad_(){let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=q.LOADED:this.state=q.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==q.ERROR&&(this.state=q.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==q.IDLE&&(this.state=q.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=ov(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function WM(){let i=Xt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}var Iu=yg;var Au=class{constructor(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function mo(i,t,e,r,n){return n!==void 0?(n.minX=i,n.maxX=t,n.minY=e,n.maxY=r,n):new Au(i,t,e,r)}var Lu=Au;var _g,po=[];function Pv(i,t,e,r,n){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(r,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,r)+1,Math.max(e,n)),i.restore()}function xg(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function YM(){if(_g===void 0){let i=Xt(6,6,po);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Pv(i,4,5,4,0),Pv(i,4,5,0,5);let t=i.getImageData(0,0,3,3).data;_g=xg(t,0)||xg(t,4)||xg(t,8),On(i),po.push(i.canvas)}return _g}function Gs(i,t,e,r){let n=di(e,t,i),s=ao(t,r,e),o=t.getMetersPerUnit();o!==void 0&&(s*=o);let a=i.getMetersPerUnit();a!==void 0&&(s/=a);let l=i.getExtent();if(!l||ke(l,n)){let c=ao(i,s,n)/s;isFinite(c)&&c>0&&(s/=c)}return s}function Rv(i,t,e,r){let n=re(e),s=Gs(i,t,n,r);return(!isFinite(s)||s<=0)&&Mh(e,function(o){return s=Gs(i,t,o,r),isFinite(s)&&s>0}),s}function Ou(i,t,e,r,n,s,o,a,l,c,h,u,f,d){let m=Xt(Math.round(e*i),Math.round(e*t),po);if(u||(m.imageSmoothingEnabled=!1),l.length===0)return m.canvas;m.scale(e,e);function p(E){return Math.round(E*e)/e}m.globalCompositeOperation="lighter";let g=ge();l.forEach(function(E,b,S){Yo(g,E.extent)});let y,_=e/r,x=(u?1:1+Math.pow(2,-24))/_;if(!f||l.length!==1||c!==0){if(y=Xt(Math.round(it(g)*_),Math.round(Ft(g)*_),po),u||(y.imageSmoothingEnabled=!1),n&&d){let E=(n[0]-g[0])*_,b=-(n[3]-g[3])*_,S=it(n)*_,T=Ft(n)*_;y.rect(E,b,S,T),y.clip()}l.forEach(function(E,b,S){if(E.image.width>0&&E.image.height>0){if(E.clipExtent){y.save();let z=(E.clipExtent[0]-g[0])*_,W=-(E.clipExtent[3]-g[3])*_,G=it(E.clipExtent)*_,O=Ft(E.clipExtent)*_;y.rect(u?z:Math.round(z),u?W:Math.round(W),u?G:Math.round(z+G)-Math.round(z),u?O:Math.round(W+O)-Math.round(W)),y.clip()}let T=(E.extent[0]-g[0])*_,P=-(E.extent[3]-g[3])*_,F=it(E.extent)*_,k=Ft(E.extent)*_;y.drawImage(E.image,c,c,E.image.width-2*c,E.image.height-2*c,u?T:Math.round(T),u?P:Math.round(P),u?F:Math.round(T+F)-Math.round(T),u?k:Math.round(P+k)-Math.round(P)),E.clipExtent&&y.restore()}})}let v=Ue(o);return a.getTriangles().forEach(function(E,b,S){let T=E.source,P=E.target,F=T[0][0],k=T[0][1],z=T[1][0],W=T[1][1],G=T[2][0],O=T[2][1],X=p((P[0][0]-v[0])/s),M=p(-(P[0][1]-v[1])/s),R=p((P[1][0]-v[0])/s),A=p(-(P[1][1]-v[1])/s),L=p((P[2][0]-v[0])/s),w=p(-(P[2][1]-v[1])/s),C=F,V=k;F=0,k=0,z-=C,W-=V,G-=C,O-=V;let ot=[[z,W,0,0,R-X],[G,O,0,0,L-X],[0,0,z,W,A-M],[0,0,G,O,w-M]],xt=P1(ot);if(!xt)return;if(m.save(),m.beginPath(),YM()||!u){m.moveTo(R,A);let lt=4,tt=X-R,st=M-A;for(let ct=0;ct<lt;ct++)m.lineTo(R+p((ct+1)*tt/lt),A+p(ct*st/(lt-1))),ct!=lt-1&&m.lineTo(R+p((ct+1)*tt/lt),A+p((ct+1)*st/(lt-1)));m.lineTo(L,w)}else m.moveTo(R,A),m.lineTo(X,M),m.lineTo(L,w);m.clip(),m.transform(xt[0],xt[2],xt[1],xt[3],X,M),m.translate(g[0]-C,g[3]-V);let J;if(y)J=y.canvas,m.scale(x,-x);else{let lt=l[0],tt=lt.extent;J=lt.image,m.scale(it(tt)/J.width,-Ft(tt)/J.height)}m.drawImage(J,0,0),m.restore()}),y&&(On(y),po.push(y.canvas)),h&&(m.save(),m.globalCompositeOperation="source-over",m.strokeStyle="black",m.lineWidth=1,a.getTriangles().forEach(function(E,b,S){let T=E.target,P=(T[0][0]-v[0])/s,F=-(T[0][1]-v[1])/s,k=(T[1][0]-v[0])/s,z=-(T[1][1]-v[1])/s,W=(T[2][0]-v[0])/s,G=-(T[2][1]-v[1])/s;m.beginPath(),m.moveTo(k,z),m.lineTo(P,F),m.lineTo(W,G),m.closePath(),m.stroke()}),m.restore()),m.canvas}var $M=10,Iv=.25,vg=class{constructor(t,e,r,n,s,o,a){this.sourceProj_=t,this.targetProj_=e;let l={},c=a?kh(x=>ne(a,di(x,this.targetProj_,this.sourceProj_))):wi(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){let v=x[0]+"/"+x[1];return l[v]||(l[v]=c(x)),l[v]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&it(n)>=it(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?it(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?it(this.targetProj_.getExtent()):null;let h=Ue(r),u=Ko(r),f=xs(r),d=$o(r),m=this.transformInv_(h),p=this.transformInv_(u),g=this.transformInv_(f),y=this.transformInv_(d),_=$M+(o?Math.max(0,Math.ceil(Math.log2(yl(r)/(o*o*256*256)))):0);if(this.addQuad_(h,u,f,d,m,p,g,y,_),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(v,E,b){x=Math.min(x,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-x>this.sourceWorldWidth_/2){let E=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];E[0][0]-x>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-x>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-x>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);let b=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-b<this.sourceWorldWidth_/2&&(v.source=E)}})}l={}}addTriangle_(t,e,r,n,s,o){this.triangles_.push({source:[n,s,o],target:[t,e,r]})}addQuad_(t,e,r,n,s,o,a,l,c){let h=pl([s,o,a,l]),u=this.sourceWorldWidth_?it(h)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1,m=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let g=pl([t,e,r,n]);m=it(g)/this.targetWorldWidth_>Iv||m}!d&&this.sourceProj_.isGlobal()&&u&&(m=u>Iv||m)}if(!m&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!kt(h,this.maxSourceExtent_))return;let p=0;if(!m&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)m=!0;else if(p=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),p!=1&&p!=2&&p!=4&&p!=8)return}if(c>0){if(!m){let g=[(t[0]+r[0])/2,(t[1]+r[1])/2],y=this.transformInv_(g),_;d?_=(Fi(s[0],f)+Fi(a[0],f))/2-Fi(y[0],f):_=(s[0]+a[0])/2-y[0];let x=(s[1]+a[1])/2-y[1];m=_*_+x*x>this.errorThresholdSquared_}if(m){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){let g=[(e[0]+r[0])/2,(e[1]+r[1])/2],y=this.transformInv_(g),_=[(n[0]+t[0])/2,(n[1]+t[1])/2],x=this.transformInv_(_);this.addQuad_(t,e,g,_,s,o,y,x,c-1),this.addQuad_(_,g,r,n,x,y,a,l,c-1)}else{let g=[(t[0]+e[0])/2,(t[1]+e[1])/2],y=this.transformInv_(g),_=[(r[0]+n[0])/2,(r[1]+n[1])/2],x=this.transformInv_(_);this.addQuad_(t,g,_,n,s,y,x,l,c-1),this.addQuad_(g,e,r,_,y,o,a,x,c-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(p&11)==0&&this.addTriangle_(t,r,n,s,a,l),(p&14)==0&&this.addTriangle_(t,r,e,s,a,o),p&&((p&13)==0&&this.addTriangle_(e,n,t,o,l,s),(p&7)==0&&this.addTriangle_(e,n,r,o,l,a))}calculateSourceExtent(){let t=ge();return this.triangles_.forEach(function(e,r,n){let s=e.source;ro(t,s[0]),ro(t,s[1]),ro(t,s[2])}),t}getTriangles(){return this.triangles_}},Fu=vg;var Eg=class extends hn{constructor(t,e,r,n,s,o,a,l,c,h,u,f){super(s,q.IDLE,f),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;let d=n.getTileCoordExtent(this.wrappedTileCoord_),m=this.targetTileGrid_.getExtent(),p=this.sourceTileGrid_.getExtent(),g=m?je(d,m):d;if(yl(g)===0){this.state=q.EMPTY;return}let y=t.getExtent();y&&(p?p=je(p,y):p=y);let _=n.getResolution(this.wrappedTileCoord_[0]),x=Rv(t,r,g,_);if(!isFinite(x)||x<=0){this.state=q.EMPTY;return}let v=h!==void 0?h:.5;if(this.triangulation_=new Fu(t,r,g,p,x*v,_),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=e.getZForResolution(x);let E=this.triangulation_.calculateSourceExtent();if(p&&(t.canWrapX()?(E[1]=ht(E[1],p[1],p[3]),E[3]=ht(E[3],p[1],p[3])):E=je(E,p)),!yl(E))this.state=q.EMPTY;else{let b=0,S=0;t.canWrapX()&&(b=it(y),S=Math.floor((E[0]-y[0])/b)),Ph(E.slice(),t,!0).forEach(P=>{let F=e.getTileRangeForExtentAndZ(P,this.sourceZ_);for(let k=F.minX;k<=F.maxX;k++)for(let z=F.minY;z<=F.maxY;z++){let W=c(this.sourceZ_,k,z,a);if(W){let G=S*b;this.sourceTiles_.push({tile:W,offset:G})}}++S}),this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(e=>{let r=e.tile;if(r&&r.getState()==q.LOADED){let n=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);n[0]+=e.offset,n[2]+=e.offset;let s=this.clipExtent_?.slice();s&&(s[0]+=e.offset,s[2]+=e.offset),t.push({extent:n,clipExtent:s,image:r.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{let e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n=typeof r=="number"?r:r[0],s=typeof r=="number"?r:r[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ou(n,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=q.LOADED}this.changed()}load(){if(this.state==q.IDLE){this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{let r=e.getState();if(r==q.IDLE||r==q.LOADING){t++;let n=dt(e,$.CHANGE,s=>{let o=e.getState();(o==q.LOADED||o==q.ERROR||o==q.EMPTY)&&(Tt(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},r,n){e.getState()==q.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Tt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(On(this.canvas_.getContext("2d")),po.push(this.canvas_),this.canvas_=null),super.release()}},Nu=Eg;var wg=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let t=this.pop();t instanceof Hr&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){let r=this.entries_[t];return Et(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(t){let e=this.entries_[t];return Et(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.key_;return t}getValues(){let t=new Array(this.count_),e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Et(!(t in this.entries_),"Tried to set a value for a key that is used already");let r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}setSize(t){this.highWaterMark=t}},Av=wg;function Sa(i,t,e,r){return r!==void 0?(r[0]=i,r[1]=t,r[2]=e,r):[i,t,e]}function Lv(i,t,e){return i+"/"+t+"/"+e}function Du(i){return HM(i[0],i[1],i[2])}function HM(i,t,e){return(t<<i)+e}function Ov(i,t){let e=i[0],r=i[1],n=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;let s=t.getFullTileRange(e);return s?s.containsXY(r,n):!0}function Sg(i,t,e,r){return`${i},${Lv(t,e,r)}`}function bg(i,t,e){if(!(e in i))return i[e]=new Set([t]),!0;let r=i[e],n=r.has(t);return n||r.add(t),!n}function ZM(i,t,e){let r=i[e];return r?r.delete(t):!1}function Fv(i,t){let e=i.layerStatesArray[i.layerIndex];e.extent&&(t=je(t,Si(e.extent,i.viewState.projection)));let r=e.layer.getRenderSource();if(!r.getWrapX()){let n=r.getTileGridForProjection(i.viewState.projection).getExtent();n&&(t=je(t,n))}return t}var Cg=class extends Ea{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=ge(),this.tempTileRange_=new Lu(0,0,0,0),this.tempTileCoord_=Sa(0,0,0);let r=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new Av(r),this.maxStaleKeys=r*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,r,n){let s=this.tileCache_,a=this.getLayer().getSource(),l=Sg(a.getKey(),t,e,r),c;if(s.containsKey(l))c=s.get(l);else{if(c=a.getTile(t,e,r,n.pixelRatio,n.viewState.projection),!c)return null;s.set(l,c)}return c}getTile(t,e,r,n){let s=this.getOrCreateTile(t,e,r,n);return s||null}getData(t){let e=this.frameState;if(!e)return null;let r=this.getLayer(),n=ne(e.pixelToCoordinateTransform,t.slice()),s=r.getExtent();if(s&&!ke(s,n))return null;let o=e.viewState,a=r.getRenderSource(),l=a.getTileGridForProjection(o.projection),c=a.getTilePixelRatio(e.pixelRatio);for(let h=l.getZForResolution(o.resolution);h>=l.getMinZoom();--h){let u=l.getTileCoordForCoordAndZ(n,h),f=this.getTile(h,u[1],u[2],e);if(!f||f.getState()!==q.LOADED)continue;let d=l.getOrigin(h),m=me(l.getTileSize(h)),p=l.getResolution(h),g;if(f instanceof Iu||f instanceof Nu)g=f.getImage();else if(f instanceof gg){if(g=Ru(f.getData()),!g)continue}else continue;let y=Math.floor(c*((n[0]-d[0])/p-u[1]*m[0])),_=Math.floor(c*((d[1]-n[1])/p-u[2]*m[1])),x=Math.round(c*a.getGutterForProjection(o.projection));return this.getImageData(g,y+x,_+x)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;let e=this.getLayer().getSource();if(!e)return!1;let r=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==r&&(this.renderedRevision_=r,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=r,!0}enqueueTiles(t,e,r,n,s){let o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),h=H(l);h in t.wantedTiles||(t.wantedTiles[h]={});let u=t.wantedTiles[h],f=a.getMapInternal(),d=Math.max(r-s,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),m=o.rotation,p=m?lm(o.center,o.resolution,m,t.size):void 0;for(let g=r;g>=d;--g){let y=c.getTileRangeForExtentAndZ(e,g,this.tempTileRange_),_=c.getResolution(g);for(let x=y.minX;x<=y.maxX;++x)for(let v=y.minY;v<=y.maxY;++v){if(m&&!c.tileCoordIntersectsViewport([g,x,v],p))continue;let E=this.getTile(g,x,v,t);if(!E||!bg(n,E,g))continue;let S=E.getKey();if(u[S]=!0,E.getState()===q.IDLE&&!t.tileQueue.isKeyQueued(S)){let T=Sa(g,x,v,this.tempTileCoord_);t.tileQueue.enqueue([E,h,c.getTileCoordCenter(T),_])}}}}findStaleTile_(t,e){let r=this.tileCache_,n=t[0],s=t[1],o=t[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){let c=Sg(a[l],n,s,o);if(r.containsKey(c)){let h=r.peek(c);if(h.getState()===q.LOADED)return h.endTransition(H(this)),bg(e,h,n),!0}}return!1}findAltTiles_(t,e,r,n){let s=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!s)return!1;let o=!0,a=this.tileCache_,c=this.getLayer().getRenderSource().getKey();for(let h=s.minX;h<=s.maxX;++h)for(let u=s.minY;u<=s.maxY;++u){let f=Sg(c,r,h,u),d=!1;if(a.containsKey(f)){let m=a.peek(f);m.getState()===q.LOADED&&(bg(n,m,r),d=!0)}d||(o=!1)}return o}renderFrame(t,e){this.renderComplete=!0;let r=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,o=n.resolution,a=n.center,l=t.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getTileGridForProjection(s),f=u.getZForResolution(o,h.zDirection),d=u.getResolution(f),m=h.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let p=t.extent,g=h.getTilePixelRatio(l);this.prepareContainer(t,e);let y=this.context.canvas.width,_=this.context.canvas.height,x=r.extent&&Si(r.extent,s);x&&(p=je(p,Si(r.extent,s)));let v=d*y/2/g,E=d*_/2/g,b=[a[0]-v,a[1]-E,a[0]+v,a[1]+E],S={};this.renderedTiles.length=0;let T=c.getPreload();if(t.nextExtent){let R=u.getZForResolution(n.nextResolution,h.zDirection),A=Fv(t,t.nextExtent);this.enqueueTiles(t,A,R,S,T)}let P=Fv(t,p);if(this.enqueueTiles(t,P,f,S,0),T>0&&setTimeout(()=>{this.enqueueTiles(t,P,f-1,S,T-1)},0),!(f in S))return this.container;let F=H(this),k=t.time;for(let R of S[f]){let A=R.getState();if(A===q.EMPTY)continue;let L=R.tileCoord;if(A===q.LOADED&&R.getAlpha(F,k)===1){R.endTransition(F);continue}if(A!==q.ERROR&&(this.renderComplete=!1),this.findStaleTile_(L,S)){ZM(S,R,f),t.animate=!0;continue}if(this.findAltTiles_(u,L,f+1,S))continue;let V=u.getMinZoom();for(let ot=f-1;ot>=V&&!this.findAltTiles_(u,L,ot,S);--ot);}let z=d/o*l/g,W=this.getRenderContext(t);$e(this.tempTransform,y/2,_/2,z,z,0,-y/2,-_/2),r.extent&&this.clipUnrotated(W,t,x),h.getInterpolate()||(W.imageSmoothingEnabled=!1),this.preRender(W,t);let G=Object.keys(S).map(Number);G.sort(hi);let O,X=[],M=[];for(let R=G.length-1;R>=0;--R){let A=G[R],L=h.getTilePixelSize(A,l,s),C=u.getResolution(A)/d,V=L[0]*C*z,ot=L[1]*C*z,xt=u.getTileCoordForCoordAndZ(Ue(b),A),J=u.getTileCoordExtent(xt),lt=ne(this.tempTransform,[g*(J[0]-b[0])/d,g*(b[3]-J[3])/d]),tt=g*h.getGutterForProjection(s);for(let st of S[A]){if(st.getState()!==q.LOADED)continue;let ct=st.tileCoord,I=xt[1]-ct[1],St=Math.round(lt[0]-(I-1)*V),Rt=xt[2]-ct[2],et=Math.round(lt[1]-(Rt-1)*ot),Dt=Math.round(lt[0]-I*V),It=Math.round(lt[1]-Rt*ot),Mt=St-Dt,Zt=et-It,At=G.length===1,wt=!1;O=[Dt,It,Dt+Mt,It,Dt+Mt,It+Zt,Dt,It+Zt];for(let vt=0,yt=X.length;vt<yt;++vt)if(!At&&A<M[vt]){let bt=X[vt];kt([Dt,It,Dt+Mt,It+Zt],[bt[0],bt[3],bt[4],bt[7]])&&(wt||(W.save(),wt=!0),W.beginPath(),W.moveTo(O[0],O[1]),W.lineTo(O[2],O[3]),W.lineTo(O[4],O[5]),W.lineTo(O[6],O[7]),W.moveTo(bt[6],bt[7]),W.lineTo(bt[4],bt[5]),W.lineTo(bt[2],bt[3]),W.lineTo(bt[0],bt[1]),W.clip())}X.push(O),M.push(A),this.drawTile(st,t,Dt,It,Mt,Zt,tt,At),wt&&W.restore(),this.renderedTiles.unshift(st),this.updateUsedTiles(t.usedTiles,h,st)}}if(this.renderedResolution=d,this.extentChanged=!this.renderedExtent_||!ze(this.renderedExtent_,b),this.renderedExtent_=b,this.renderedPixelRatio=l,this.postRender(this.context,t),r.extent&&W.restore(),W.imageSmoothingEnabled=!0,this.renderComplete){let R=(A,L)=>{let w=H(h),C=L.wantedTiles[w],V=C?Object.keys(C).length:0;this.updateCacheSize(V),this.tileCache_.expireCache()};t.postRenderFunctions.push(R)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,r,n,s,o,a,l){let c;if(t instanceof gg){if(c=Ru(t.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(t);if(!c)return;let h=this.getRenderContext(e),u=H(this),f=e.layerStatesArray[e.layerIndex],d=f.opacity*(l?t.getAlpha(u,e.time):1),m=d!==h.globalAlpha;m&&(h.save(),h.globalAlpha=d),h.drawImage(c,a,a,c.width-2*a,c.height-2*a,r,n,s,o),m&&h.restore(),d!==f.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){let t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,r){let n=H(e);n in t||(t[n]={}),t[n][r.getKey()]=!0}},Gu=Cg;var Mg=class extends Mu{constructor(t){super(t)}createRenderer(){return new Gu(this,{cacheSize:this.getCacheSize()})}},ks=Mg;var Tg=class{drawCustom(t,e,r,n,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,r){}drawFeature(t,e,r){}drawGeometryCollection(t,e,r){}drawLineString(t,e,r){}drawMultiLineString(t,e,r){}drawMultiPoint(t,e,r){}drawMultiPolygon(t,e,r){}drawPoint(t,e,r){}drawPolygon(t,e,r){}drawText(t,e,r){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},ku=Tg;var ec={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ic=[ec.FILL],un=[ec.STROKE],Un=[ec.BEGIN_PATH],Pg=[ec.CLOSE_PATH],mt=ec;var Rg=class extends ku{constructor(t,e,r,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=r,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let e=this.pixelRatio;return e==1?t:t.map(function(r){return r*e})}appendFlatPointCoordinates(t,e){let r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates,o=s.length;for(let a=0,l=t.length;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],ke(r,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,r,n,s,o){let a=this.coordinates,l=a.length,c=this.getBufferedMaxExtent();o&&(e+=n);let h=t[e],u=t[e+1],f=this.tmpCoordinate_,d=!0,m,p,g;for(m=e+n;m<r;m+=n)f[0]=t[m],f[1]=t[m+1],g=bh(c,f),g!==p?(d&&(a[l++]=h,a[l++]=u,d=!1),a[l++]=f[0],a[l++]=f[1]):g===Ge.INTERSECTING?(a[l++]=f[0],a[l++]=f[1],d=!1):d=!0,h=f[0],u=f[1],p=g;return(s&&d||m===e+n)&&(a[l++]=h,a[l++]=u),l}drawCustomCoordinates_(t,e,r,n,s){for(let o=0,a=r.length;o<a;++o){let l=r[o],c=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);s.push(c),e=l}return e}drawCustom(t,e,r,n,s){this.beginGeometry(t,e,s);let o=t.getType(),a=t.getStride(),l=this.coordinates.length,c,h,u,f,d;switch(o){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),f=[];let m=t.getEndss();d=0;for(let p=0,g=m.length;p<g;++p){let y=[];d=this.drawCustomCoordinates_(c,d,m[p],a,y),f.push(y)}this.instructions.push([mt.CUSTOM,l,f,t,r,Tl,s]),this.hitDetectionInstructions.push([mt.CUSTOM,l,f,t,n||r,Tl,s]);break;case"Polygon":case"MultiLineString":u=[],c=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(c,0,t.getEnds(),a,u),this.instructions.push([mt.CUSTOM,l,u,t,r,Ms,s]),this.hitDetectionInstructions.push([mt.CUSTOM,l,u,t,n||r,Ms,s]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([mt.CUSTOM,l,h,t,r,vr,s]),this.hitDetectionInstructions.push([mt.CUSTOM,l,h,t,n||r,vr,s]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,a),h>l&&(this.instructions.push([mt.CUSTOM,l,h,t,r,vr,s]),this.hitDetectionInstructions.push([mt.CUSTOM,l,h,t,n||r,vr,s]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([mt.CUSTOM,l,h,t,r,void 0,s]),this.hitDetectionInstructions.push([mt.CUSTOM,l,h,t,n||r,void 0,s]);break;default:}this.endGeometry(e)}beginGeometry(t,e,r){this.beginGeometryInstruction1_=[mt.BEGIN_GEOMETRY,e,0,t,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[mt.BEGIN_GEOMETRY,e,0,t,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let e,r=t.length,n,s,o=-1;for(e=0;e<r;++e)n=t[e],s=n[0],s==mt.END_GEOMETRY?o=e:s==mt.BEGIN_GEOMETRY&&(n[2]=e,v1(this.hitDetectionInstructions,o,e),o=-1)}fillStyleToState(t,e={}){if(t){let r=t.getColor();e.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,e.fillStyle=Xi(r||He)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){let r=t.getColor();e.strokeStyle=Xi(r||Dn);let n=t.getLineCap();e.lineCap=n!==void 0?n:an;let s=t.getLineDash();e.lineDash=s?s.slice():Vi;let o=t.getLineDashOffset();e.lineDashOffset=o||Wi;let a=t.getLineJoin();e.lineJoin=a!==void 0?a:ln;let l=t.getWidth();e.lineWidth=l!==void 0?l:kn;let c=t.getMiterLimit();e.miterLimit=c!==void 0?c:Nn,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){let r=this.state;this.fillStyleToState(t,r),this.strokeStyleToState(e,r)}createFill(t){let e=t.fillStyle,r=[mt.SET_FILL_STYLE,e];return typeof e!="string"&&r.push(t.fillPatternScale),r}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[mt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){let r=t.fillStyle;(typeof r!="string"||t.currentFillStyle!=r)&&(r!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=r)}updateStrokeStyle(t,e){let r=t.strokeStyle,n=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||s!=t.currentLineDash&&!ui(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(r!==void 0&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let e=[mt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ch(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;ii(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},fn=Rg;var Ig=class extends fn{constructor(t,e,r,n){super(t,e,r,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,r){if(!this.image_||this.maxExtent&&!ke(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,r);let n=t.getFlatCoordinates(),s=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,s);this.instructions.push([mt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([mt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,r){if(!this.image_)return;this.beginGeometry(t,e,r);let n=t.getFlatCoordinates(),s=[];for(let l=0,c=n.length;l<c;l+=t.getStride())(!this.maxExtent||ke(this.maxExtent,n.slice(l,l+2)))&&s.push(n[l],n[l+1]);let o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([mt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([mt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){let r=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},Nv=Ig;var Ag=class extends fn{constructor(t,e,r,n){super(t,e,r,n)}drawFlatCoordinates_(t,e,r,n){let s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,r,n,!1,!1),a=[mt.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r}drawLineString(t,e,r){let n=this.state,s=n.strokeStyle,o=n.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,r),this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Vi,Wi],Un);let a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(un),this.endGeometry(e)}drawMultiLineString(t,e,r){let n=this.state,s=n.strokeStyle,o=n.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,r),this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Vi,Wi],Un);let a=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),h=0;for(let u=0,f=a.length;u<f;++u)h=this.drawFlatCoordinates_(l,h,a[u],c);this.hitDetectionInstructions.push(un),this.endGeometry(e)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(un),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(un),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Un)}},Dv=Ag;var Lg=class extends fn{constructor(t,e,r,n){super(t,e,r,n)}drawFlatCoordinatess_(t,e,r,n){let s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=r.length;this.instructions.push(Un),this.hitDetectionInstructions.push(Un);for(let c=0;c<l;++c){let h=r[c],u=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,h,n,!0,!a),d=[mt.MOVE_TO_LINE_TO,u,f];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(Pg),this.hitDetectionInstructions.push(Pg)),e=h}return o&&(this.instructions.push(ic),this.hitDetectionInstructions.push(ic)),a&&(this.instructions.push(un),this.hitDetectionInstructions.push(un)),e}drawCircle(t,e,r){let n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([mt.SET_FILL_STYLE,He]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Vi,Wi]);let a=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);let h=[mt.CIRCLE,c];this.instructions.push(Un,h),this.hitDetectionInstructions.push(Un,h),n.fillStyle!==void 0&&(this.instructions.push(ic),this.hitDetectionInstructions.push(ic)),n.strokeStyle!==void 0&&(this.instructions.push(un),this.hitDetectionInstructions.push(un)),this.endGeometry(e)}drawPolygon(t,e,r){let n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([mt.SET_FILL_STYLE,He]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Vi,Wi]);let a=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(e)}drawMultiPolygon(t,e,r){let n=this.state,s=n.fillStyle,o=n.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([mt.SET_FILL_STYLE,He]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Vi,Wi]);let a=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),h=0;for(let u=0,f=a.length;u<f;++u)h=this.drawFlatCoordinatess_(l,h,a[u],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let e=this.coordinates;for(let r=0,n=e.length;r<n;++r)e[r]=Ts(e[r],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}},Og=Lg;function Gv(i,t,e,r,n){let s=[],o=e,a=0,l=t.slice(e,2);for(;a<i&&o+n<r;){let[c,h]=l.slice(-2),u=t[o+n],f=t[o+n+1],d=Math.sqrt((u-c)*(u-c)+(f-h)*(f-h));if(a+=d,a>=i){let m=(i-a+d)/d,p=si(c,u,m),g=si(h,f,m);l.push(p,g),s.push(l),l=[p,g],a==i&&(o+=n),a=0}else if(a<i)l.push(t[o+n],t[o+n+1]),o+=n;else{let m=d-a,p=si(c,u,m/d),g=si(h,f,m/d);l.push(p,g),s.push(l),l=[p,g],a=0,o+=n}}return a>0&&s.push(l),s}function kv(i,t,e,r,n){let s=e,o=e,a=0,l=0,c=e,h,u,f,d,m,p,g,y,_,x;for(u=e;u<r;u+=n){let v=t[u],E=t[u+1];m!==void 0&&(_=v-m,x=E-p,d=Math.sqrt(_*_+x*x),g!==void 0&&(l+=f,h=Math.acos((g*_+y*x)/(f*d)),h>i&&(l>a&&(a=l,s=c,o=u),l=0,c=u-n)),f=d,g=_,y=x),m=v,p=E}return l+=d,l>a?[c,u]:[s,o]}var rc={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Fg=class extends fn{constructor(t,e,r,n){super(t,e,r,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[He]={fillStyle:He},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,r){let n=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!s)return;let a=this.coordinates,l=a.length,c=t.getType(),h=null,u=t.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!kt(this.maxExtent,t.getExtent()))return;let f;if(h=t.getFlatCoordinates(),c=="LineString")f=[h.length];else if(c=="MultiLineString")f=t.getEnds();else if(c=="Polygon")f=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let g=t.getEndss();f=[];for(let y=0,_=g.length;y<_;++y)f.push(g[y][0])}this.beginGeometry(t,e,r);let d=o.repeat,m=d?void 0:o.textAlign,p=0;for(let g=0,y=f.length;g<y;++g){let _;d?_=Gv(d*this.resolution,h,p,f[g],u):_=[h.slice(p,f[g])];for(let x=0,v=_.length;x<v;++x){let E=_[x],b=0,S=E.length;if(m==null){let P=kv(o.maxAngle,E,0,E.length,2);b=P[0],S=P[1]}for(let P=b;P<S;P+=u)a.push(E[P],E[P+1]);let T=a.length;p=f[g],this.drawChars_(l,T),l=T}}this.endGeometry(e)}else{let f=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),o.overflow||f.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":let v=t.getFlatInteriorPoints();h=[];for(let E=0,b=v.length;E<b;E+=3)o.overflow||f.push(v[E+2]/this.resolution),h.push(v[E],v[E+1]);if(h.length===0)return;u=2;break;default:}let d=this.appendFlatPointCoordinates(h,u);if(d===l)return;if(f&&(d-l)/2!==h.length/u){let v=l/2;f=f.filter((E,b)=>{let S=a[(v+b)*2]===h[b*u]&&a[(v+b)*2+1]===h[b*u+1];return S||--v,S})}this.saveTextStates_();let m=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,p=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(t,e,r);let g=o.padding;if(g!=Gn&&(o.scale[0]<0||o.scale[1]<0)){let v=o.padding[0],E=o.padding[1],b=o.padding[2],S=o.padding[3];o.scale[0]<0&&(E=-E,S=-S),o.scale[1]<0&&(v=-v,b=-b),g=[v,E,b,S]}let y=this.pixelRatio;this.instructions.push([mt.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==Gn?Gn:g.map(function(v){return v*y}),m,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);let _=1/y,x=m?m.slice(0):null;x&&(x[1]=He),this.hitDetectionInstructions.push([mt.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,this.declutterMode_,this.declutterImageWithText_,g,x,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?He:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),this.endGeometry(e)}}saveTextStates_(){let t=this.textStrokeState_,e=this.textState_,r=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||Fs,justify:e.justify,textBaseline:e.textBaseline||fo,scale:e.scale});let o=this.fillKey_;r&&(o in this.fillStates||(this.fillStates[o]={fillStyle:r.fillStyle}))}drawChars_(t,e){let r=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=rc[n.textBaseline],h=this.textOffsetY_*l,u=this.text_,f=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([mt.DRAW_CHARS,t,e,c,n.overflow,a,n.maxAngle,l,h,s,f*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([mt.DRAW_CHARS,t,e,c,n.overflow,a&&He,n.maxAngle,l,h,s,f*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let r,n,s;if(!t)this.text_="";else{let o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Xi(o.getColor()||He)):(n=null,this.textFillState_=n);let a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);let p=a.getLineDash(),g=a.getLineDashOffset(),y=a.getWidth(),_=a.getMiterLimit();s.lineCap=a.getLineCap()||an,s.lineDash=p?p.slice():Vi,s.lineDashOffset=g===void 0?Wi:g,s.lineJoin=a.getLineJoin()||ln,s.lineWidth=y===void 0?kn:y,s.miterLimit=_===void 0?Nn:_,s.strokeStyle=Xi(a.getColor()||Dn)}r=this.textState_;let l=t.getFont()||pu;gu(l);let c=t.getScaleArray();r.overflow=t.getOverflow(),r.font=l,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.repeat=t.getRepeat(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||fo,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||Gn,r.scale=c===void 0?[1,1]:c;let h=t.getOffsetX(),u=t.getOffsetY(),f=t.getRotateWithView(),d=t.getKeepUpright(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=f===void 0?!1:f,this.textKeepUpright_=d===void 0?!0:d,this.textRotation_=m===void 0?0:m,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:H(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.repeat||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+H(n.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},zv=Fg;var JM={Circle:Og,Default:fn,Image:Nv,LineString:Dv,Polygon:Og,Text:zv},Ng=class{constructor(t,e,r,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}finish(){let t={};for(let e in this.buildersByZIndex_){t[e]=t[e]||{};let r=this.buildersByZIndex_[e];for(let n in r){let s=r[n].finish();t[e][n]=s}}return t}getBuilder(t,e){let r=t!==void 0?t.toString():"0",n=this.buildersByZIndex_[r];n===void 0&&(n={},this.buildersByZIndex_[r]=n);let s=n[e];if(s===void 0){let o=JM[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s}return s}},zu=Ng;function ba(i,t,e,r){let n=i[t],s=i[t+1],o=0;for(let a=t+r;a<e;a+=r){let l=i[a],c=i[a+1];o+=Math.sqrt((l-n)*(l-n)+(c-s)*(c-s)),n=l,s=c}return o}function jv(i,t,e,r,n,s,o,a,l,c,h,u,f=!0){let d=i[t],m=i[t+1],p=0,g=0,y=0,_=0;function x(){p=d,g=m,t+=r,d=i[t],m=i[t+1],_+=y,y=Math.sqrt((d-p)*(d-p)+(m-g)*(m-g))}do x();while(t<e-r&&_+y<s);let v=y===0?0:(s-_)/y,E=si(p,d,v),b=si(g,m,v),S=t-r,T=_,P=s+a*l(c,n,h);for(;t<e-r&&_+y<P;)x();v=y===0?0:(P-_)/y;let F=si(p,d,v),k=si(g,m,v),z=!1;if(f)if(u){let M=[E,b,F,k];Uh(M,0,4,2,u,M,M),z=M[0]>M[2]}else z=E>F;let W=Math.PI,G=[],O=S+r===t;t=S,y=0,_=T,d=i[t],m=i[t+1];let X;if(O){x(),X=Math.atan2(m-g,d-p),z&&(X+=X>0?-W:W);let M=(F+E)/2,R=(k+b)/2;return G[0]=[M,R,(P-s)/2,X,n],G}n=n.replace(/\n/g," ");for(let M=0,R=n.length;M<R;){x();let A=Math.atan2(m-g,d-p);if(z&&(A+=A>0?-W:W),X!==void 0){let xt=A-X;if(xt+=xt>W?-2*W:xt<-W?2*W:0,Math.abs(xt)>o)return null}X=A;let L=M,w=0;for(;M<R;++M){let xt=z?R-M-1:M,J=a*l(c,n[xt],h);if(t+r<e&&_+y<s+w+J/2)break;w+=J}if(M===L)continue;let C=z?n.substring(R-L,R-M):n.substring(L,M);v=y===0?0:(s+w/2-_)/y;let V=si(p,d,v),ot=si(g,m,v);G.push([V,ot,w/2,A,C]),s+=w}return G}var Ca=ge(),zs=[],Bn=[],qn=[],js=[];function Uv(i){return i[3].declutterBox}var Bv=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function Dg(i,t){return t==="start"?t=Bv.test(i)?"right":"left":t==="end"&&(t=Bv.test(i)?"left":"right"),rc[t]}function QM(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}function tT(i,t,e){return e%2===0&&(i+=t),i}var Gg=class{constructor(t,e,r,n,s){this.overlaps=r,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=we(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new xa:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,r,n){let s=t+e+r+n;if(this.labels_[s])return this.labels_[s];let o=n?this.strokeStates[n]:null,a=r?this.fillStates[r]:null,l=this.textStates[e],c=this.pixelRatio,h=[l.scale[0]*c,l.scale[1]*c],u=l.justify?rc[l.justify]:Dg(Array.isArray(t)?t[0]:t,l.textAlign||Fs),f=n&&o.lineWidth?o.lineWidth:0,d=Array.isArray(t)?t:String(t).split(`
`).reduce(QM,[]),{width:m,height:p,widths:g,heights:y,lineWidths:_}=cv(l,d),x=m+f,v=[],E=(x+2)*h[0],b=(p+f)*h[1],S={width:E<0?Math.floor(E):Math.ceil(E),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:v};(h[0]!=1||h[1]!=1)&&v.push("scale",h),n&&(v.push("strokeStyle",o.strokeStyle),v.push("lineWidth",f),v.push("lineCap",o.lineCap),v.push("lineJoin",o.lineJoin),v.push("miterLimit",o.miterLimit),v.push("setLineDash",[o.lineDash]),v.push("lineDashOffset",o.lineDashOffset)),r&&v.push("fillStyle",a.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");let T=.5-u,P=u*x+T*f,F=[],k=[],z=0,W=0,G=0,O=0,X;for(let M=0,R=d.length;M<R;M+=2){let A=d[M];if(A===`
`){W+=z,z=0,P=u*x+T*f,++O;continue}let L=d[M+1]||l.font;L!==X&&(n&&F.push("font",L),r&&k.push("font",L),X=L),z=Math.max(z,y[G]);let w=[A,P+T*g[G]+u*(g[G]-_[O]),.5*(f+z)+W];P+=g[G],n&&F.push("strokeText",w),r&&k.push("fillText",w),++G}return Array.prototype.push.apply(v,F),Array.prototype.push.apply(v,k),this.labels_[s]=S,S}replayTextBackground_(t,e,r,n,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],t.fillStyle=o[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,r,n,s,o,a,l,c,h,u,f,d,m,p,g){a*=f[0],l*=f[1];let y=r-a,_=n-l,x=s+c>t?t-c:s,v=o+h>e?e-h:o,E=m[3]+x*f[0]+m[1],b=m[0]+v*f[1]+m[2],S=y-m[3],T=_-m[0];(p||u!==0)&&(zs[0]=S,js[0]=S,zs[1]=T,Bn[1]=T,Bn[0]=S+E,qn[0]=Bn[0],qn[1]=T+b,js[1]=qn[1]);let P;return u!==0?(P=$e(we(),r,n,1,1,u,-r,-n),ne(P,zs),ne(P,Bn),ne(P,qn),ne(P,js),ir(Math.min(zs[0],Bn[0],qn[0],js[0]),Math.min(zs[1],Bn[1],qn[1],js[1]),Math.max(zs[0],Bn[0],qn[0],js[0]),Math.max(zs[1],Bn[1],qn[1],js[1]),Ca)):ir(Math.min(S,S+E),Math.min(T,T+b),Math.max(S,S+E),Math.max(T,T+b),Ca),d&&(y=Math.round(y),_=Math.round(_)),{drawImageX:y,drawImageY:_,drawImageW:x,drawImageH:v,originX:c,originY:h,declutterBox:{minX:Ca[0],minY:Ca[1],maxX:Ca[2],maxY:Ca[3],value:g},canvasTransform:P,scale:f}}replayImageOrLabel_(t,e,r,n,s,o,a){let l=!!(o||a),c=n.declutterBox,h=a?a[2]*n.scale[0]/2:0;return c.minX-h<=e[0]&&c.maxX+h>=0&&c.minY-h<=e[1]&&c.maxY+h>=0&&(l&&this.replayTextBackground_(t,zs,Bn,qn,js,o,a),hv(t,n.canvasTransform,s,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){let e=this.alignAndScaleFill_;if(e){let r=ne(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(r[0]%n,r[1]%n),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,r,n){let s=this.textStates[e],o=this.createLabel(t,e,n,r),a=this.strokeStates[r],l=this.pixelRatio,c=Dg(Array.isArray(t)?t[0]:t,s.textAlign||Fs),h=rc[s.textBaseline||fo],u=a&&a.lineWidth?a.lineWidth:0,f=o.width/l-2*s.scale[0],d=c*f+2*(.5-c)*u,m=h*o.height/l+2*(.5-h)*u;return{label:o,anchorX:d,anchorY:m}}execute_(t,e,r,n,s,o,a,l){let c=this.zIndexContext_,h;this.pixelCoordinates_&&ui(r,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=ji(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),sx(this.renderedTransform_,r));let u=0,f=n.length,d=0,m,p,g,y,_,x,v,E,b,S,T,P,F,k=0,z=0,W=this.coordinateCache_,G=this.viewRotation_,O=Math.round(Math.atan2(-r[1],r[0])*1e12)/1e12,X={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:G},M=this.instructions!=n||this.overlaps?0:200,R,A,L,w;for(;u<f;){let C=n[u];switch(C[0]){case mt.BEGIN_GEOMETRY:R=C[1],w=C[3],R.getGeometry()?a!==void 0&&!kt(a,w.getExtent())?u=C[2]+1:++u:u=C[2],c&&(c.zIndex=C[4]);break;case mt.BEGIN_PATH:k>M&&(this.fill_(t),k=0),z>M&&(t.stroke(),z=0),!k&&!z&&(t.beginPath(),_=NaN,x=NaN),++u;break;case mt.CIRCLE:d=C[1];let ot=h[d],xt=h[d+1],J=h[d+2],lt=h[d+3],tt=J-ot,st=lt-xt,ct=Math.sqrt(tt*tt+st*st);t.moveTo(ot+ct,xt),t.arc(ot,xt,ct,0,2*Math.PI,!0),++u;break;case mt.CLOSE_PATH:t.closePath(),++u;break;case mt.CUSTOM:d=C[1],m=C[2];let I=C[3],St=C[4],Rt=C[5];X.geometry=I,X.feature=R,u in W||(W[u]=[]);let et=W[u];Rt?Rt(h,d,m,2,et):(et[0]=h[d],et[1]=h[d+1],et.length=2),c&&(c.zIndex=C[6]),St(et,X),++u;break;case mt.DRAW_IMAGE:d=C[1],m=C[2],b=C[3],p=C[4],g=C[5];let Dt=C[6],It=C[7],Mt=C[8],Zt=C[9],At=C[10],wt=C[11],vt=C[12],yt=C[13];y=C[14]||"declutter";let bt=C[15];if(!b&&C.length>=20){S=C[19],T=C[20],P=C[21],F=C[22];let De=this.drawLabelWithPointPlacement_(S,T,P,F);b=De.label,C[3]=b;let Ri=C[23];p=(De.anchorX-Ri)*this.pixelRatio,C[4]=p;let ti=C[24];g=(De.anchorY-ti)*this.pixelRatio,C[5]=g,Dt=b.height,C[6]=Dt,yt=b.width,C[13]=yt}let he;C.length>25&&(he=C[25]);let qt,jt,Ut;C.length>17?(qt=C[16],jt=C[17],Ut=C[18]):(qt=Gn,jt=null,Ut=null),At&&O?wt+=G:!At&&!O&&(wt-=G);let Ot=0;for(;d<m;d+=2){if(he&&he[Ot++]<yt/this.pixelRatio)continue;let De=this.calculateImageOrLabelDimensions_(b.width,b.height,h[d],h[d+1],yt,Dt,p,g,Mt,Zt,wt,vt,s,qt,!!jt||!!Ut,R),Ri=[t,e,b,De,It,jt,Ut];if(l){let ti,Ii,ci;if(bt){let le=m-d;if(!bt[le]){bt[le]={args:Ri,declutterMode:y};continue}let Ye=bt[le];ti=Ye.args,Ii=Ye.declutterMode,delete bt[le],ci=Uv(ti)}let _r,tr;if(ti&&(Ii!=="declutter"||!l.collides(ci))&&(_r=!0),(y!=="declutter"||!l.collides(De.declutterBox))&&(tr=!0),Ii==="declutter"&&y==="declutter"){let le=_r&&tr;_r=le,tr=le}_r&&(Ii!=="none"&&l.insert(ci),this.replayImageOrLabel_.apply(this,ti)),tr&&(y!=="none"&&l.insert(De.declutterBox),this.replayImageOrLabel_.apply(this,Ri))}else this.replayImageOrLabel_.apply(this,Ri)}++u;break;case mt.DRAW_CHARS:let ft=C[1],pt=C[2],_t=C[3],Wt=C[4];F=C[5];let Kt=C[6],Qe=C[7],Ve=C[8];P=C[9];let ue=C[10];S=C[11],Array.isArray(S)&&(S=S.reduce(tT,"")),T=C[12];let xe=[C[13],C[13]];y=C[14]||"declutter";let te=C[15],fe=this.textStates[T],ve=fe.font,$t=[fe.scale[0]*Qe,fe.scale[1]*Qe],We;ve in this.widths_?We=this.widths_[ve]:(We={},this.widths_[ve]=We);let ds=ba(h,ft,pt,2),Rr=Math.abs($t[0])*jp(ve,S,We);if(Wt||Rr<=ds){let De=this.textStates[T].textAlign,Ri=(ds-Rr)*Dg(S,De),ti=jv(h,ft,pt,2,S,Ri,Kt,Math.abs($t[0]),jp,ve,We,O?0:this.viewRotation_,te);t:if(ti){let Ii=[],ci,_r,tr,le,Ye;if(P)for(ci=0,_r=ti.length;ci<_r;++ci){Ye=ti[ci],tr=Ye[4],le=this.createLabel(tr,T,"",P),p=Ye[2]+($t[0]<0?-ue:ue),g=_t*le.height+(.5-_t)*2*ue*$t[1]/$t[0]-Ve;let Ai=this.calculateImageOrLabelDimensions_(le.width,le.height,Ye[0],Ye[1],le.width,le.height,p,g,0,0,Ye[3],xe,!1,Gn,!1,R);if(l&&y==="declutter"&&l.collides(Ai.declutterBox))break t;Ii.push([t,e,le,Ai,1,null,null])}if(F)for(ci=0,_r=ti.length;ci<_r;++ci){Ye=ti[ci],tr=Ye[4],le=this.createLabel(tr,T,F,""),p=Ye[2],g=_t*le.height-Ve;let Ai=this.calculateImageOrLabelDimensions_(le.width,le.height,Ye[0],Ye[1],le.width,le.height,p,g,0,0,Ye[3],xe,!1,Gn,!1,R);if(l&&y==="declutter"&&l.collides(Ai.declutterBox))break t;Ii.push([t,e,le,Ai,1,null,null])}l&&y!=="none"&&l.load(Ii.map(Uv));for(let Ai=0,sh=Ii.length;Ai<sh;++Ai)this.replayImageOrLabel_.apply(this,Ii[Ai])}}++u;break;case mt.END_GEOMETRY:if(o!==void 0){R=C[1];let De=o(R,w,y);if(De)return De}++u;break;case mt.FILL:M?k++:this.fill_(t),++u;break;case mt.MOVE_TO_LINE_TO:for(d=C[1],m=C[2],A=h[d],L=h[d+1],t.moveTo(A,L),_=A+.5|0,x=L+.5|0,d+=2;d<m;d+=2)A=h[d],L=h[d+1],v=A+.5|0,E=L+.5|0,(d==m-2||v!==_||E!==x)&&(t.lineTo(A,L),_=v,x=E);++u;break;case mt.SET_FILL_STYLE:this.alignAndScaleFill_=C[2],k&&(this.fill_(t),k=0,z&&(t.stroke(),z=0)),t.fillStyle=C[1],++u;break;case mt.SET_STROKE_STYLE:z&&(t.stroke(),z=0),this.setStrokeStyle_(t,C),++u;break;case mt.STROKE:M?z++:t.stroke(),++u;break;default:++u;break}}k&&this.fill_(t),z&&t.stroke()}execute(t,e,r,n,s,o){this.viewRotation_=n,this.execute_(t,e,r,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,r,n,s){return this.viewRotation_=r,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,s)}},qv=Gg;var go=["Polygon","Circle","LineString","Image","Text","Default"],Ma=["Image","Text"],Xv=go.filter(i=>!Ma.includes(i)),zg=class{constructor(t,e,r,n,s,o,a){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=we(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(t,e){let r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()}createExecutors_(t,e){for(let r in t){let n=this.executorsByZIndex_[r];n===void 0&&(n={},this.executorsByZIndex_[r]=n);let s=t[r];for(let o in s){let a=s[o];n[o]=new qv(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(let e in this.executorsByZIndex_){let r=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in r)return!0}return!1}forEachFeatureAtCoordinate(t,e,r,n,s,o){n=Math.round(n);let a=n*2+1,l=$e(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Xt(a,a));let h=this.hitDetectionContext_;h.canvas.width!==a||h.canvas.height!==a?(h.canvas.width=a,h.canvas.height=a):c||h.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=ge(),ro(u,t),ii(u,e*(this.renderBuffer_+n),u));let f=eT(n),d;function m(E,b,S){let T=h.getImageData(0,0,a,a).data;for(let P=0,F=f.length;P<F;P++)if(T[f[P]]>0){if(!o||S==="none"||d!=="Image"&&d!=="Text"||o.includes(E)){let k=(f[P]-3)/4,z=n-k%a,W=n-(k/a|0),G=s(E,b,z*z+W*W);if(G)return G}h.clearRect(0,0,a,a);break}}let p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(hi);let g,y,_,x,v;for(g=p.length-1;g>=0;--g){let E=p[g].toString();for(_=this.executorsByZIndex_[E],y=go.length-1;y>=0;--y)if(d=go[y],x=_[d],x!==void 0&&(v=x.executeHitDetection(h,l,r,m,u),v))return v}}getClipCoords(t){let e=this.maxExtent_;if(!e)return null;let r=e[0],n=e[1],s=e[2],o=e[3],a=[r,n,r,o,s,o,s,n];return ji(a,0,8,2,t,a),a}isEmpty(){return vi(this.executorsByZIndex_)}execute(t,e,r,n,s,o,a){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?x1:hi),o=o||go;let c=go.length;for(let h=0,u=l.length;h<u;++h){let f=l[h].toString(),d=this.executorsByZIndex_[f];for(let m=0,p=o.length;m<p;++m){let g=o[m],y=d[g];if(y!==void 0){let _=a===null?void 0:y.getZIndexContext(),x=_?_.getContext():t,v=this.maxExtent_&&g!=="Image"&&g!=="Text";if(v&&(x.save(),this.clip(x,r)),!_||g==="Text"||g==="Image"?y.execute(x,e,r,n,s,a):_.pushFunction(E=>y.execute(E,e,r,n,s,a)),v&&x.restore(),_){_.offset();let E=l[h]*c+m;this.deferredZIndexContexts_[E]||(this.deferredZIndexContexts_[E]=[]),this.deferredZIndexContexts_[E].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(hi);for(let r=0,n=e.length;r<n;++r)t[e[r]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),t[e[r]].length=0}},kg={};function eT(i){if(kg[i]!==void 0)return kg[i];let t=i*2+1,e=i*i,r=new Array(e+1);for(let s=0;s<=i;++s)for(let o=0;o<=i;++o){let a=s*s+o*o;if(a>e)break;let l=r[a];l||(l=[],r[a]=l),l.push(((i+s)*t+(i+o))*4+3),s>0&&l.push(((i-s)*t+(i+o))*4+3),o>0&&(l.push(((i+s)*t+(i-o))*4+3),s>0&&l.push(((i-s)*t+(i-o))*4+3))}let n=[];for(let s=0,o=r.length;s<o;++s)r[s]&&n.push(...r[s]);return kg[i]=n,n}var ju=zg;var jg=class extends ku{constructor(t,e,r,n,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=r,this.transform_=n,this.transformRotation_=n?Rn(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=we()}drawImages_(t,e,r,n){if(!this.image_)return;let s=ji(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,u=s.length;h<u;h+=2){let f=s[h]-this.imageAnchorX_,d=s[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let m=f+this.imageAnchorX_,p=d+this.imageAnchorY_;$e(a,m,p,1,1,c,-m,-p),o.save(),o.transform.apply(o,a),o.translate(m,p),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,r,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let s=ji(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<r;e+=n){let l=s[e]+this.textOffsetX_,c=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,c),this.textFillState_&&o.fillText(this.text_,l,c))}}moveToLineTo_(t,e,r,n,s){let o=this.context_,a=ji(t,e,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let c=2;c<l;c+=2)o.lineTo(a[c],a[c+1]);return s&&o.closePath(),r}drawRings_(t,e,r,n){for(let s=0,o=r.length;s<o;++s)e=this.moveToLineTo_(t,e,r[s],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!kt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=dx(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break;default:}}drawFeature(t,e){let r=e.getGeometryFunction()(t);r&&(this.setStyle(e),this.drawGeometry(r))}drawGeometryCollection(t){let e=t.getGeometriesArray();for(let r=0,n=e.length;r<n;++r)this.drawGeometry(e[r])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),this.text_!==""&&this.drawText_(e,0,e.length,r)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),this.text_!==""&&this.drawText_(e,0,e.length,r)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!kt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){let e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getExtent();if(kt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getFlatCoordinates(),s=0,o=t.getEnds(),a=t.getStride();r.beginPath();for(let l=0,c=o.length;l<c;++l)s=this.moveToLineTo_(n,s,o[l],a,!1);r.stroke()}if(this.text_!==""){let r=t.getFlatMidpoints();this.drawText_(r,0,r.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!kt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){let e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!kt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_,r=t.getOrientedFlatCoordinates(),n=0,s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){let c=s[a];n=this.drawRings_(r,n,c,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){let e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){let e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=t.lineCap,e.lineCap=t.lineCap),ui(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),r.lineJoin!=t.lineJoin&&(r.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let e=this.context_,r=this.contextTextState_,n=t.textAlign?t.textAlign:Fs;r?(r.font!=t.font&&(r.font=t.font,e.font=t.font),r.textAlign!=n&&(r.textAlign=n,e.textAlign=n),r.textBaseline!=t.textBaseline&&(r.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{let r=t.getColor();this.fillState_={fillStyle:Xi(r||He)}}if(!e)this.strokeState_=null;else{let r=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),h=s||Vi;this.strokeState_={lineCap:n!==void 0?n:an,lineDash:this.pixelRatio_===1?h:h.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Wi)*this.pixelRatio_,lineJoin:a!==void 0?a:ln,lineWidth:(l!==void 0?l:kn)*this.pixelRatio_,miterLimit:c!==void 0?c:Nn,strokeStyle:Xi(r||Dn)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}let r=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*r,this.imageAnchorY_=n[1]*r,this.imageHeight_=e[1]*r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/r,o[1]*this.pixelRatio_/r],this.imageWidth_=e[0]*r}setTextStyle(t){if(!t)this.text_="";else{let e=t.getFill();if(!e)this.textFillState_=null;else{let d=e.getColor();this.textFillState_={fillStyle:Xi(d||He)}}let r=t.getStroke();if(!r)this.textStrokeState_=null;else{let d=r.getColor(),m=r.getLineCap(),p=r.getLineDash(),g=r.getLineDashOffset(),y=r.getLineJoin(),_=r.getWidth(),x=r.getMiterLimit();this.textStrokeState_={lineCap:m!==void 0?m:an,lineDash:p||Vi,lineDashOffset:g||Wi,lineJoin:y!==void 0?y:ln,lineWidth:_!==void 0?_:kn,miterLimit:x!==void 0?x:Nn,strokeStyle:Xi(d||Dn)}}let n=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),h=t.getText(),u=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:n!==void 0?n:pu,textAlign:u!==void 0?u:Fs,textBaseline:f!==void 0?f:fo},this.text_=h!==void 0?Array.isArray(h)?h.reduce((d,m,p)=>d+=p%2?" ":m,""):h:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}},Uu=jg;var Ci=.5;function Bu(i,t,e,r,n,s,o,a,l){let c=l?Ss(n,l):n,h=i[0]*Ci,u=i[1]*Ci,f=Xt(h,u);f.imageSmoothingEnabled=!1;let d=f.canvas,m=new Uu(f,Ci,n,null,o,a,l?zi(sr(),l):null),p=e.length,g=Math.floor((256*256*256-1)/p),y={};for(let x=1;x<=p;++x){let v=e[x-1],E=v.getStyleFunction()||r;if(!E)continue;let b=E(v,s);if(!b)continue;Array.isArray(b)||(b=[b]);let T=(x*g).toString(16).padStart(7,"#00000");for(let P=0,F=b.length;P<F;++P){let k=b[P],z=k.getGeometryFunction()(v);if(!z||!kt(c,z.getExtent()))continue;let W=k.clone(),G=W.getFill();G&&G.setColor(T);let O=W.getStroke();O&&(O.setColor(T),O.setLineDash(null)),W.setText(void 0);let X=k.getImage();if(X){let L=X.getImageSize();if(!L)continue;let w=Xt(L[0],L[1],void 0,{alpha:!1}),C=w.canvas;w.fillStyle=T,w.fillRect(0,0,C.width,C.height),W.setImage(new Dr({img:C,anchor:X.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:X.getOrigin(),opacity:1,size:X.getSize(),scale:X.getScale(),rotation:X.getRotation(),rotateWithView:X.getRotateWithView()}))}let M=W.getZIndex()||0,R=y[M];R||(R={},y[M]=R,R.Polygon=[],R.Circle=[],R.LineString=[],R.Point=[]);let A=z.getType();if(A==="GeometryCollection"){let L=z.getGeometriesArrayRecursive();for(let w=0,C=L.length;w<C;++w){let V=L[w];R[V.getType().replace("Multi","")].push(V,W)}}else R[A.replace("Multi","")].push(z,W)}}let _=Object.keys(y).map(Number).sort(hi);for(let x=0,v=_.length;x<v;++x){let E=y[_[x]];for(let b in E){let S=E[b];for(let T=0,P=S.length;T<P;T+=2){m.setStyle(S[T+1]);for(let F=0,k=t.length;F<k;++F)m.setTransform(t[F]),m.drawGeometry(S[T])}}}return f.getImageData(0,0,d.width,d.height)}function qu(i,t,e){let r=[];if(e){let n=Math.floor(Math.round(i[0])*Ci),s=Math.floor(Math.round(i[1])*Ci),o=(ht(n,0,e.width-1)+ht(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/t.length);h&&h%u===0&&r.push(t[h/u-1])}return r}var iT=.5,Vv={Point:cT,LineString:oT,Polygon:uT,MultiPoint:hT,MultiLineString:aT,MultiPolygon:lT,GeometryCollection:sT,Circle:rT};function Wv(i,t){return parseInt(H(i),10)-parseInt(H(t),10)}function yo(i,t){let e=Ug(i,t);return e*e}function Ug(i,t){return iT*i/t}function rT(i,t,e,r,n){let s=e.getFill(),o=e.getStroke();if(s||o){let l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,r,n)}let a=e.getText();if(a&&a.getText()){let l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r)}}function Ta(i,t,e,r,n,s,o,a){let l=[],c=e.getImage();if(c){let f=!0,d=c.getImageState();d==K.LOADED||d==K.ERROR?f=!1:d==K.IDLE&&c.load(),f&&l.push(c.ready())}let h=e.getFill();h&&h.loading()&&l.push(h.ready());let u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),nT(i,t,e,r,s,o,a),u}function nT(i,t,e,r,n,s,o){let a=e.getGeometryFunction()(t);if(!a)return;let l=a.simplifyTransformed(r,n);if(e.getRenderer())Yv(i,l,e,t,o);else{let h=Vv[l.getType()];h(i,l,e,t,o,s)}}function Yv(i,t,e,r,n){if(t.getType()=="GeometryCollection"){let o=t.getGeometries();for(let a=0,l=o.length;a<l;++a)Yv(i,o[a],e,r,n);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,r,e.getRenderer(),e.getHitDetectionRenderer(),n)}function sT(i,t,e,r,n,s){let o=t.getGeometriesArray(),a,l;for(a=0,l=o.length;a<l;++a){let c=Vv[o[a].getType()];c(i,o[a],e,r,n,s)}}function oT(i,t,e,r,n){let s=e.getStroke();if(s){let a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,r,n)}let o=e.getText();if(o&&o.getText()){let a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,r,n)}}function aT(i,t,e,r,n){let s=e.getStroke();if(s){let a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,r,n)}let o=e.getText();if(o&&o.getText()){let a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,r,n)}}function lT(i,t,e,r,n){let s=e.getFill(),o=e.getStroke();if(o||s){let l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,r,n)}let a=e.getText();if(a&&a.getText()){let l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r,n)}}function cT(i,t,e,r,n,s){let o=e.getImage(),a=e.getText(),l=a&&a.getText(),c=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=K.LOADED)return;let h=i.getBuilder(e.getZIndex(),"Image");h.setImageStyle(o,c),h.drawPoint(t,r,n)}if(l){let h=i.getBuilder(e.getZIndex(),"Text");h.setTextStyle(a,c),h.drawText(t,r,n)}}function hT(i,t,e,r,n,s){let o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),c=l&&l.getText(),h=s&&a&&c?{}:void 0;if(a){if(o.getImageState()!=K.LOADED)return;let u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,h),u.drawMultiPoint(t,r,n)}if(c){let u=i.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,h),u.drawText(t,r,n)}}function uT(i,t,e,r,n){let s=e.getFill(),o=e.getStroke();if(s||o){let l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,r,n)}let a=e.getText();if(a&&a.getText()){let l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r,n)}}var Bg=class extends Ea{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=ge(),this.wrappedRenderedExtent_=ge(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,r){let n=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,c=s.rotation,h=l.getExtent(),u=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),d=e.pixelRatio,m=e.viewHints,p=!(m[ie.ANIMATING]||m[ie.INTERACTING]),g=this.context,y=Math.round(it(n)/a*d),_=Math.round(Ft(n)/a*d),x=u.getWrapX()&&l.canWrapX(),v=x?it(h):null,E=x?Math.ceil((n[2]-h[2])/v)+1:1,b=x?Math.floor((n[0]-h[0])/v):0;do{let S=this.getRenderTransform(o,a,0,d,y,_,b*v);e.declutter&&(S=S.slice(0)),t.execute(g,[g.canvas.width,g.canvas.height],S,c,p,r===void 0?go:r?Ma:Xv,r?f&&e.declutter[f]:void 0)}while(++b<E)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Xt(this.context.canvas.width,this.context.canvas.height,ug))}resetDrawContext_(){if(this.opacity_!==1){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,On(this.context),ug.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){let r=t.layerStatesArray[t.layerIndex];this.opacity_=r.opacity;let n=t.viewState;this.prepareContainer(t,e);let s=this.context,o=this.replayGroup_,a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Ke.PRERENDER)||this.getLayer().hasListener(Ke.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(s,t);let l=n.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){let c=Si(r.extent,l);a=kt(c,t.extent),this.clipped_=a&&!Ce(c,t.extent),this.clipped_&&this.clipUnrotated(s,t,c)}return a&&this.renderWorlds(o,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&s.restore(),this.postRender(s,t),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let r=this.frameState.size.slice(),n=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),h=[],u=r[0]*Ci,f=r[1]*Ci;h.push(this.getRenderTransform(n,s,o,Ci,u,f,0).slice());let d=c.getSource(),m=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!Ce(m,l)){let g=l[0],y=it(m),_=0,x;for(;g<m[0];)--_,x=y*_,h.push(this.getRenderTransform(n,s,o,Ci,u,f,x).slice()),g+=y;for(_=0,g=l[2];g>m[2];)++_,x=y*_,h.push(this.getRenderTransform(n,s,o,Ci,u,f,x).slice()),g-=y}let p=sr();this.hitDetectionImageData_=Bu(r,h,this.renderedFeatures_,c.getStyleFunction(),l,s,o,yo(s,this.renderedPixelRatio_),p?a:null)}e(qu(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,r,n,s){if(!this.replayGroup_)return;let o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),c={},h=function(f,d,m){let p=H(f),g=c[p];if(g){if(g!==!0&&m<g.distanceSq){if(m===0)return c[p]=!0,s.splice(s.lastIndexOf(g),1),n(f,l,d);g.geometry=d,g.distanceSq=m}}else{if(m===0)return c[p]=!0,n(f,l,d);s.push(c[p]={feature:f,layer:l,geometry:d,distanceSq:m,callback:n})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,o,a,r,h,u?e.declutter?.[u]?.all().map(f=>f.value):null)}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let e=this.getLayer(),r=e.getSource();if(!r)return!1;let n=t.viewHints[ie.ANIMATING],s=t.viewHints[ie.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let l=t.extent,c=t.viewState,h=c.projection,u=c.resolution,f=t.pixelRatio,d=e.getRevision(),m=e.getRenderBuffer(),p=e.getRenderOrder();p===void 0&&(p=Wv);let g=c.center.slice(),y=ii(l,m*u),_=y.slice(),x=[y.slice()],v=h.getExtent();if(r.getWrapX()&&h.canWrapX()&&!Ce(v,t.extent)){let O=it(v),X=Math.max(it(y)/2,O);y[0]=v[0]-X,y[2]=v[2]+X,vs(g,h);let M=_l(x[0],h);M[0]<v[0]&&M[2]<v[2]?x.push([M[0]+O,M[1],M[2]+O,M[3]]):M[0]>v[0]&&M[2]>v[2]&&x.push([M[0]-O,M[1],M[2]-O,M[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==d&&this.renderedRenderOrder_==p&&this.renderedFrameDeclutter_===!!t.declutter&&Ce(this.wrappedRenderedExtent_,y))return ui(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let E=new zu(Ug(u,f),y,u,f),b=sr(),S;if(b){for(let O=0,X=x.length;O<X;++O){let M=x[O],R=Ss(M,h);r.loadFeatures(R,ix(u,h),b)}S=zi(b,h)}else for(let O=0,X=x.length;O<X;++O)r.loadFeatures(x[O],u,h);let T=yo(u,f),P=!0,F=(O,X)=>{let M,R=O.getStyleFunction()||e.getStyleFunction();if(R&&(M=R(O,u)),M){let A=this.renderFeature(O,T,M,E,S,this.getLayer().getDeclutter(),X);P=P&&!A}},k=Ss(y,h),z=r.getFeaturesInExtent(k);p&&z.sort(p);for(let O=0,X=z.length;O<X;++O)F(z[O],O);this.renderedFeatures_=z,this.ready=P;let W=E.finish(),G=new ju(y,u,f,r.getOverlaps(),W,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=d,this.renderedRenderOrder_=p,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=_,this.wrappedRenderedExtent_=y,this.renderedCenter_=g,this.renderedProjection_=h,this.renderedPixelRatio_=f,this.replayGroup_=G,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,r,n,s,o,a){if(!r)return!1;let l=!1;if(Array.isArray(r))for(let c=0,h=r.length;c<h;++c)l=Ta(n,t,r[c],e,this.boundHandleStyleImageChange_,s,o,a)||l;else l=Ta(n,t,r,e,this.boundHandleStyleImageChange_,s,o,a);return l}},nc=Bg;var qg=class extends Ns{constructor(t){super(t)}createRenderer(){return new nc(this)}},dn=qg;var fT={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},$v={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},Xg=class extends Gu{constructor(t,e){super(t,e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=we(),this.tileClipContexts_=null}drawTile(t,e,r,n,s,o,a,l){this.updateExecutorGroup_(t,e.pixelRatio,e.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,e),super.drawTile(t,e,r,n,s,o,a,l)}getTile(t,e,r,n){let s=this.getOrCreateTile(t,e,r,n);if(!s)return null;let a=n.viewState.resolution,l=n.viewHints;return(!(l[ie.ANIMATING]||l[ie.INTERACTING])||!s.wantedResolution)&&(s.wantedResolution=a),s}prepareFrame(t){let e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,r){let n=this.getLayer(),s=n.getRevision(),o=n.getRenderOrder()||null,a=t.wantedResolution,l=t.getReplayState(n);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedRenderOrder==o)return;let c=n.getSource(),h=!!n.getDeclutter(),u=c.getTileGrid(),d=c.getTileGridForProjection(r).getTileCoordExtent(t.wrappedTileCoord),m=c.getSourceTiles(e,r,t),p=H(n);delete t.hitDetectionImageData[p],t.executorGroups[p]=[],l.dirty=!1;for(let g=0,y=m.length;g<y;++g){let _=m[g];if(_.getState()!=q.LOADED)continue;let x=_.tileCoord,v=u.getTileCoordExtent(x),E=je(d,v),b=ii(E,n.getRenderBuffer()*a,this.tempExtent),S=ze(v,E)?null:b,T=new zu(0,E,a,e),P=yo(a,e),F=function(O,X){let M,R=O.getStyleFunction()||n.getStyleFunction();if(R&&(M=R(O,a)),M){let A=this.renderFeature(O,P,M,T,h,X);l.dirty=l.dirty||A}},k=_.getFeatures();o&&o!==l.renderedRenderOrder&&k.sort(o);for(let O=0,X=k.length;O<X;++O){let M=k[O];(!S||kt(S,M.getGeometry().getExtent()))&&F.call(this,M,O)}let z=T.finish(),W=n.getRenderMode()!=="vector"&&h&&m.length===1?null:E,G=new ju(W,a,e,c.getOverlaps(),z,n.getRenderBuffer(),!0);t.executorGroups[p].push(G)}l.renderedRevision=s,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(t,e,r,n,s){let o=e.viewState.resolution,a=e.viewState.rotation;r=r??0;let l=this.getLayer(),h=l.getSource().getTileGridForProjection(e.viewState.projection),u=pl([t]);ii(u,o*r,u);let f={},d=function(x,v,E){let b=x.getId();b===void 0&&(b=H(x));let S=f[b];if(S){if(S!==!0&&E<S.distanceSq){if(E===0)return f[b]=!0,s.splice(s.lastIndexOf(S),1),n(x,l,v);S.geometry=v,S.distanceSq=E}}else{if(E===0)return f[b]=!0,n(x,l,v);s.push(f[b]={feature:x,layer:l,geometry:v,distanceSq:E,callback:n})}},m=this.renderedTiles,p=H(l),g=l.getDeclutter(),y=g?e.declutter?.[g]?.all().map(x=>x.value):null,_;t:for(let x=0,v=m.length;x<v;++x){let E=m[x],b=h.getTileCoordExtent(E.wrappedTileCoord);if(!kt(b,u))continue;let S=E.executorGroups[p];for(let T=0,P=S.length;T<P;++T)if(_=S[T].forEachFeatureAtCoordinate(t,o,a,r,d,y),_)break t}return _}getFeatures(t){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((e,r)=>{let n=this.getLayer(),s=n.getSource(),o=this.renderedProjection,a=o.getExtent(),l=this.renderedResolution,c=s.getTileGridForProjection(o),h=ne(this.renderedPixelToCoordinateTransform_,t.slice()),u=c.getTileCoordForCoordAndResolution(h,l).toString(),f=this.renderedTiles.find(x=>x.tileCoord.toString()===u&&x.getState()===q.LOADED);if(!f||f.loadingSourceTiles>0){e([]);return}s.getWrapX()&&o.canWrapX()&&!Ce(a,c.getTileCoordExtent(f.tileCoord))&&vs(h,o);let d=H(n),m=c.getTileCoordExtent(f.wrappedTileCoord),p=Ue(m),g=[(h[0]-p[0])/l,(p[1]-h[1])/l],y=f.getSourceTiles().reduce((x,v)=>x.concat(v.getFeatures()),[]),_=f.hitDetectionImageData[d];if(!_){let x=me(c.getTileSize(c.getZForResolution(l,s.zDirection))),v=this.renderedRotation_,E=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),l,0,Ci,x[0]*Ci,x[1]*Ci,0)];_=Bu(x,E,y,n.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(n).renderedResolution,v),f.hitDetectionImageData[d]=_}e(qu(g,y,_))})}getFeaturesInExtent(t){let e=[],r=this.getTileCache();if(r.getCount()===0)return e;let s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=s.getZForResolution(this.renderedResolution),a={};return r.forEach(l=>{if(l.tileCoord[0]!==o||l.getState()!==q.LOADED)return;let c=l.getSourceTiles();for(let h=0,u=c.length;h<u;++h){let f=c[h],d=f.getKey();if(d in a)continue;a[d]=!0;let m=f.tileCoord;if(kt(t,s.getTileCoordExtent(m))){let p=f.getFeatures();if(p)for(let g=0,y=p.length;g<y;++g){let _=p[g],x=_.getGeometry();kt(t,x.getExtent())&&e.push(_)}}}}),e}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){let r=this.context,n=r.globalAlpha;r.globalAlpha=e.opacity;let s=t.viewHints,o=!(s[ie.ANIMATING]||s[ie.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),c=l?t.declutter?.[l]:void 0,h=H(this.getLayer()),u=this.renderedTiles;for(let f=0,d=u.length;f<d;++f){let m=u[f],p=m.executorGroups[h];if(p)for(let g=p.length-1;g>=0;--g)p[g].execute(this.context,a,this.getTileRenderTransform(m,t),t.viewState.rotation,o,Ma,c)}r.globalAlpha=n}renderDeferredInternal(t){let e=this.renderedTiles,r=H(this.getLayer()),n=e.reduce((l,c,h)=>(c.executorGroups[r].forEach(u=>l.push({executorGroup:u,index:h})),l),[]),s=n.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),o={};for(let l=0,c=n.length;l<c;++l){let h=n[l].executorGroup.getDeferredZIndexContexts();for(let u in h)o[u]=!0}Object.keys(o).map(Number).sort(hi).forEach(l=>{s.forEach((c,h)=>{c[l]&&(c[l].forEach(u=>{let{executorGroup:f,index:d}=n[h],m=f.getRenderedContext(),p=m.globalAlpha;m.globalAlpha=this.renderedOpacity_;let g=this.tileClipContexts_[d];g&&g.draw(m),u.draw(m),g&&m.restore(),m.globalAlpha=p,u.clear()}),c[l].length=0)})})}getTileRenderTransform(t,e){let r=e.pixelRatio,n=e.viewState,s=n.center,o=n.resolution,a=n.rotation,l=e.size,c=Math.round(l[0]*r),h=Math.round(l[1]*r),f=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),d=t.tileCoord,m=f.getTileCoordExtent(t.wrappedTileCoord),p=f.getTileCoordExtent(d,this.tempExtent)[0]-m[0];return ia(ra(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(s,o,a,r,c,h,p))}postRender(t,e){let r=e.viewHints,n=!(r[ie.ANIMATING]||r[ie.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;let s=this.getLayer(),o=s.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;let l=s.getDeclutter(),c=l?$v[o].filter(E=>!Ma.includes(E)):$v[o],h=e.viewState,u=h.rotation,f=s.getSource(),m=f.getTileGridForProjection(h.projection).getZForResolution(h.resolution,f.zDirection),p=this.renderedTiles,g=[],y=[],_=[],x=H(s),v=!0;for(let E=p.length-1;E>=0;--E){let b=p[E];v=v&&!b.getReplayState(s).dirty;let S=b.executorGroups[x].filter(G=>G.hasExecutors(c));if(S.length===0)continue;let T=this.getTileRenderTransform(b,e),P=b.tileCoord[0],F=!1,k=S[0].getClipCoords(T),z=t,W;if(k){W=new xa,z=W.getContext();for(let G=0,O=g.length;G<O;++G)if(m!==P&&P<y[G]){let X=g[G];kt([k[0],k[3],k[4],k[7]],[X[0],X[3],X[4],X[7]])&&(F||(z.save(),F=!0),z.beginPath(),z.moveTo(k[0],k[1]),z.lineTo(k[2],k[3]),z.lineTo(k[4],k[5]),z.lineTo(k[6],k[7]),z.moveTo(X[6],X[7]),z.lineTo(X[4],X[5]),z.lineTo(X[2],X[3]),z.lineTo(X[0],X[1]),z.clip())}g.push(k),y.push(P)}for(let G=0,O=S.length;G<O;++G)S[G].execute(t,[t.canvas.width,t.canvas.height],T,u,n,c,e.declutter?.[l]);F&&(z===t?z.restore():_[E]=W)}t.globalAlpha=a,this.ready=v,this.tileClipContexts_=_,e.declutter||this.renderDeferredInternal(e),super.postRender(t,e)}renderFeature(t,e,r,n,s,o){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,c=r.length;l<c;++l)a=Ta(n,t,r[l],e,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=Ta(n,t,r,e,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(t){let e=this.getLayer();if(e.getRenderMode()==="vector")return!1;let r=t.getReplayState(e),n=e.getRevision(),s=t.wantedResolution;return r.renderedTileResolution!==s||r.renderedTileRevision!==n}renderTileImage_(t,e){let r=this.getLayer(),n=t.getReplayState(r),s=r.getRevision(),o=t.executorGroups[H(r)];n.renderedTileRevision=s;let a=t.wrappedTileCoord,l=a[0],c=r.getSource(),h=e.pixelRatio,f=e.viewState.projection,d=c.getTileGridForProjection(f),m=d.getResolution(t.tileCoord[0]),p=e.pixelRatio/t.wantedResolution*m,g=d.getResolution(l),y=t.getContext();h=Math.round(Math.max(h,p/h));let _=c.getTilePixelSize(l,h,f);y.canvas.width=_[0],y.canvas.height=_[1];let x=h/p;if(x!==1){let S=Mm(this.tmpTransform_);ra(S,x,x),y.setTransform.apply(y,S)}let v=d.getTileCoordExtent(a,this.tempExtent),E=p/g,b=Mm(this.tmpTransform_);ra(b,E,-E),ox(b,-v[0],-v[3]);for(let S=0,T=o.length;S<T;++S)o[S].execute(y,[y.canvas.width*x,y.canvas.height*x],b,0,!0,fT[r.getRenderMode()],null);n.renderedTileResolution=t.wantedResolution}},Kv=Xg;var Vg=class extends Ns{constructor(t){t=t||{};let e=Object.assign({},t);delete e.preload;let r=t.cacheSize===void 0?0:t.cacheSize;delete t.cacheSize,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=r;let n=t.renderMode||"hybrid";Et(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new Kv(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(cn.PRELOAD)}getUseInterimTilesOnError(){return this.get(cn.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(cn.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(cn.USE_INTERIM_TILES_ON_ERROR,t)}},Pa=Vg;var Hv=[],Wg=class extends hn{constructor(t,e,r,n,s){super(t,e,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.removeSourceTiles_=s,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=Xt(1,1,Hv)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(t){let e=H(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){this.context_&&(On(this.context_),Hv.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},Zv=Wg;var Yg=class extends hn{constructor(t,e,r,n,s,o){super(t,e,o),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==q.IDLE&&(this.setState(q.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,e){this.setFeatures(t)}onError(){this.setState(q.ERROR)}setFeatures(t){this.features_=t,this.setState(q.LOADED)}setLoader(t){this.loader_=t}},sc=Yg;var dT=!1;function $g(i,t,e,r,n,s,o){let a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(e,r,n):i,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=dT,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){let c=t.getType();try{let h;c=="text"||c=="json"?h=a.responseText:c=="xml"?h=a.responseXML||a.responseText:c=="arraybuffer"&&(h=a.response),h?s(t.readFeatures(h,{extent:e,featureProjection:n}),t.readProjection(h)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function Kg(i,t){return function(e,r,n,s,o){$g(i,t,e,r,n,(a,l)=>{this.addFeatures(a),s!==void 0&&s(a)},()=>{this.changed(),o!==void 0&&o()})}}var Ra=[0,0,0],Us=5,Hg=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Et(E1(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Et(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let r=t.extent;r!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ue(r)),Et(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Et(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,Et(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=r!==void 0?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((n,s)=>{let o=new Lu(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(r){let a=this.getTileRangeForExtentAndZ(r,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):r&&this.calculateTileRanges_(r)}forEachTileCoord(t,e,r){let n=this.getTileRangeForExtentAndZ(t,e);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let a=n.minY,l=n.maxY;a<=l;++a)r([e,s,a])}forEachTileCoordParentTileRange(t,e,r,n){let s,o,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,n);c>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=mo(o,o,a,a,r)):s=this.getTileRangeForExtentAndZ(l,c,r),e(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,r){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let s=t[1]*2,o=t[2]*2;return mo(s,s+1,o,o+1,e)}let n=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;let n=t[0],s=t[1],o=t[2];if(e===n)return mo(s,o,s,o,r);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,e-n),c=Math.floor(s*l),h=Math.floor(o*l);if(e<n)return mo(c,c,h,h,r);let u=Math.floor(l*(s+1))-1,f=Math.floor(l*(o+1))-1;return mo(c,u,h,f,r)}let a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,r)}getTileRangeForExtentAndZ(t,e,r){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Ra);let n=Ra[1],s=Ra[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Ra);let o=Ra[1],a=Ra[2];return mo(n,o,s,a,r)}getTileCoordCenter(t){let e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=me(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]-(t[2]+.5)*n[1]*r]}getTileCoordExtent(t,e){let r=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=me(this.getTileSize(t[0]),this.tmpSize_),o=r[0]+t[1]*s[0]*n,a=r[1]-(t[2]+1)*s[1]*n,l=o+s[0]*n,c=a+s[1]*n;return ir(o,a,l,c,e)}getTileCoordForCoordAndResolution(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)}getTileCoordForXYAndResolution_(t,e,r,n,s){let o=this.getZForResolution(r),a=r/this.getResolution(o),l=this.getOrigin(o),c=me(this.getTileSize(o),this.tmpSize_),h=a*(t-l[0])/r/c[0],u=a*(l[1]-e)/r/c[1];return n?(h=en(h,Us)-1,u=en(u,Us)-1):(h=_s(h,Us),u=_s(u,Us)),Sa(o,h,u,s)}getTileCoordForXYAndZ_(t,e,r,n,s){let o=this.getOrigin(r),a=this.getResolution(r),l=me(this.getTileSize(r),this.tmpSize_),c=(t-o[0])/a/l[0],h=(o[1]-e)/a/l[1];return n?(c=en(c,Us)-1,h=en(h,Us)-1):(c=_s(c,Us),h=_s(h,Us)),Sa(r,c,h,s)}getTileCoordForCoordAndZ(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){let r=ms(this.resolutions_,t,e||0);return ht(r,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Nm(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let e=this.resolutions_.length,r=new Array(e);for(let n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r}},Gr=Hg;var Zg=class extends Gr{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}},Jv=Zg;function Xu(i){let t=i.getDefaultTileGrid();return t||(t=pT(i),i.setDefaultTileGrid(t)),t}function tE(i,t,e){let r=t[0],n=i.getTileCoordCenter(t),s=Bs(e);if(!ke(s,n)){let o=it(s),a=Math.ceil((s[0]-n[0])/o);return n[0]+=o*a,i.getTileCoordForCoordAndZ(n,r)}return t}function mT(i,t,e,r){r=r!==void 0?r:"top-left";let n=eE(i,t,e);return new Gr({extent:i,origin:A1(i,r),resolutions:n,tileSize:e})}function mn(i){let t=i||{},e=t.extent||Z("EPSG:3857").getExtent(),r={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:eE(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Gr(r)}function eE(i,t,e,r){t=t!==void 0?t:42,e=me(e!==void 0?e:256);let n=Ft(i),s=it(i);r=r>0?r:Math.max(s/e[0],n/e[1]);let o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=r/Math.pow(2,l);return a}function pT(i,t,e,r){let n=Bs(i);return mT(n,t,e,r)}function Bs(i){i=Z(i);let t=i.getExtent();if(!t){let e=180*rr.degrees/i.getMetersPerUnit();t=ir(-e,-e,e,e)}return t}function qs(i,t){let e=[];Object.keys(t).forEach(function(n){t[n]!==null&&t[n]!==void 0&&e.push(n+"="+encodeURIComponent(t[n]))});let r=e.join("&");return i=i.replace(/[?&]$/,""),i+=i.includes("?")?"&":"?",i+r}var gT=/\{z\}/g,yT=/\{x\}/g,_T=/\{y\}/g,xT=/\{-y\}/g;function iE(i,t,e,r,n){return i.replace(gT,t.toString()).replace(yT,e.toString()).replace(_T,r.toString()).replace(xT,function(){if(n===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-r).toString()})}function Vu(i){let t=[],e=/\{([a-z])-([a-z])\}/.exec(i);if(e){let r=e[1].charCodeAt(0),n=e[2].charCodeAt(0),s;for(s=r;s<=n;++s)t.push(i.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){let r=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=r;n++)t.push(i.replace(e[0],n.toString()));return t}return t.push(i),t}function vT(i,t){return function(e,r,n){if(!e)return;let s,o=e[0];if(t){let a=t.getFullTileRange(o);a&&(s=a.getHeight()-1)}return iE(i,o,e[1],e[2],s)}}function Wu(i,t){let e=i.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=vT(i[n],t);return Yu(r)}function Yu(i){return i.length===1?i[0]:function(t,e,r){if(!t)return;let n=Du(t),s=Fi(n,i.length);return i[s](t,e,r)}}var Jg=class extends Ie{constructor(t){super(),this.projection=Z(t.projection),this.attributions_=rE(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let e=this;this.viewPromise_=new Promise(function(r,n){e.viewResolver=r,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=rE(t),this.changed()}setState(t){this.state_=t,this.changed()}};function rE(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}var kr=Jg;var Qg=class extends kr{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let e=[256,256];this.tileGrid&&me(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||H(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){let e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,r,n,s){return nt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Xu(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,r){let n=this.getTileGridForProjection(r),s=this.getTilePixelRatio(e),o=me(n.getTileSize(t),this.tmpSize);return s==1?o:iv(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){let r=e!==void 0?e:this.getProjection(),n=e!==void 0?this.getTileGridForProjection(r):this.tileGrid||this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=tE(n,t,r)),Ov(t,n)?t:null}clear(){}refresh(){this.clear(),super.refresh()}},$u=class extends Re{constructor(t,e){super(t),this.tile=e}},Ia=Qg;var Ku={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var t0=class i extends Ia{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===i.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let e=t.target,r=H(e),n=e.getState(),s;n==q.LOADING?(this.tileLoadingKeys_[r]=!0,s=Ku.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=n==q.ERROR?Ku.TILELOADERROR:n==q.LOADED?Ku.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new $u(s,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){let e=Vu(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;let e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Wu(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,r){}},Hu=t0;var e0=class extends Hu{constructor(t){let e=t.projection||"EPSG:3857",r=t.extent||Bs(e),n=t.tileGrid||mn({extent:r,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,projection:e,state:t.state,tileGrid:n,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:i0,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:sc,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(t,e,r){if(r.getState()===q.IDLE){r.setState(q.LOADING);let n=r.wrappedTileCoord,s=this.getTileGridForProjection(e),o=s.getTileCoordExtent(n),a=n[0],l=s.getResolution(a);ii(o,-l,o);let c=this.tileGrid,h=c.getExtent();h&&je(o,h,o);let u=c.getZForResolution(l,this.zDirection);c.forEachTileCoord(o,u,f=>{let d=this.tileUrlFunction(f,t,e);this.sourceTiles_[d]||(this.sourceTiles_[d]=new this.tileClass(f,d?q.IDLE:q.EMPTY,d,this.format_,this.tileLoadFunction));let m=this.sourceTiles_[d];r.sourceTiles.push(m),this.tileKeysBySourceTileUrl_[d]||(this.tileKeysBySourceTileUrl_[d]=[]),this.tileKeysBySourceTileUrl_[d].push(r.getKey());let p=m.getState();if(p<q.LOADED){let g=y=>{this.handleTileChange(y);let _=m.getState();if(_===q.LOADED||_===q.ERROR){let x=m.getKey();x in r.errorTileKeys?m.getState()===q.LOADED&&delete r.errorTileKeys[x]:r.loadingSourceTiles--,_===q.ERROR?r.errorTileKeys[x]=!0:m.removeEventListener($.CHANGE,g),r.loadingSourceTiles===0&&r.setState(vi(r.errorTileKeys)?q.LOADED:q.ERROR)}};m.addEventListener($.CHANGE,g),r.loadingSourceTiles++}p===q.IDLE&&(m.extent=c.getTileCoordExtent(f),m.projection=e,m.resolution=c.getResolution(f[0]),m.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(f=>f.getState()===q.ERROR)?q.ERROR:q.LOADED)}return r.sourceTiles}removeSourceTiles(t){let e=t.getKey(),r=t.sourceTiles;for(let n=0,s=r.length;n<s;++n){let o=r[n].getTileUrl();if(!this.tileKeysBySourceTileUrl_[o])return;let a=this.tileKeysBySourceTileUrl_[o].indexOf(e);a!==-1&&(this.tileKeysBySourceTileUrl_[o].splice(a,1),this.tileKeysBySourceTileUrl_[o].length===0&&(delete this.tileKeysBySourceTileUrl_[o],delete this.sourceTiles_[o]))}}getTile(t,e,r,n,s){let o=[t,e,r],a=this.getTileCoordForTileUrlFunction(o,s),l=this.getTileGrid().getExtent(),c=this.getTileGridForProjection(s);if(a&&l){let f=c.getTileCoordExtent(a);ii(f,-c.getResolution(t),f),kt(l,f)||(a=null)}let h=!0;if(a!==null){let f=this.tileGrid,d=c.getResolution(t),m=f.getZForResolution(d,1),p=c.getTileCoordExtent(a);ii(p,-d,p),f.forEachTileCoord(p,m,g=>{h=h&&!this.tileUrlFunction(g,n,s)})}let u=new Zv(o,h?q.EMPTY:q.IDLE,a,this.getSourceTiles.bind(this,n,s),this.removeSourceTiles.bind(this));return u.key=this.getKey(),u}getTileGridForProjection(t){let e=t.getCode(),r=this.tileGrids_[e];if(!r){let n=this.getProjection();Et(n===null||fi(n,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection.");let s=this.tileGrid,o=s.getResolutions().slice(),a=o.map(function(h,u){return s.getOrigin(u)}),l=o.map(function(h,u){return s.getTileSize(u)}),c=43;for(let h=o.length;h<c;++h)o.push(o[h-1]/2),a.push(a[h-1]),l.push(l[h-1]);r=new Gr({extent:s.getExtent(),origins:a,resolutions:o,tileSizes:l}),this.tileGrids_[e]=r}return r}getTilePixelRatio(t){return t}getTilePixelSize(t,e,r){let n=this.getTileGridForProjection(r),s=me(n.getTileSize(t),this.tmpSize);return[Math.round(s[0]*e),Math.round(s[1]*e)]}setOverlaps(t){this.overlaps_=t,this.changed()}},oc=e0;function i0(i,t){i.setLoader(function(e,r,n){$g(t,i.getFormat(),e,r,n,i.onLoad.bind(i),i.onError.bind(i))})}var ET=8,wT={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},ST={"*":{type:"source"}},bT=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],CT={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},MT={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},TT={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},PT={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},RT={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},IT={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},AT={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},LT=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],OT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},FT={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},NT={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},DT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},GT={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},kT={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},zT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},UT={type:"array",value:"*"},BT={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},qT={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},XT={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},VT={type:"array",value:"*",minimum:1},WT={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},YT={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},$T={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},KT={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},HT=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],ZT={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},JT={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},QT={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},tP={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},eP={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},iP={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},rP={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},nP={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},sP={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},oP={"*":{type:"string"}},CE={$version:ET,$root:wT,sources:ST,source:bT,source_vector:CT,source_raster:MT,source_raster_dem:TT,source_geojson:PT,source_video:RT,source_image:IT,layer:AT,layout:LT,layout_background:OT,layout_fill:FT,layout_circle:NT,layout_heatmap:DT,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:GT,layout_symbol:kT,layout_raster:zT,layout_hillshade:jT,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:UT,filter_operator:BT,geometry_type:qT,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:XT,expression:VT,light:WT,sky:YT,terrain:$T,projection:KT,paint:HT,paint_fill:ZT,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:JT,paint_circle:QT,paint_heatmap:tP,paint_symbol:eP,paint_raster:iP,paint_hillshade:rP,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:nP,transition:sP,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:oP},aP=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function lP(i,t){let e={};for(let r in i)r!=="ref"&&(e[r]=i[r]);return aP.forEach(r=>{r in t&&(e[r]=t[r])}),e}function ME(i){i=i.slice();let t=Object.create(null);for(let e=0;e<i.length;e++)t[i[e].id]=i[e];for(let e=0;e<i.length;e++)"ref"in i[e]&&(i[e]=lP(i[e],t[i[e].ref]));return i}var B=class{constructor(t,e,r,n){this.message=(t?`${t}: `:"")+r,n&&(this.identifier=n),e!=null&&e.__line__&&(this.line=e.__line__)}};function rf(i,...t){for(let e of t)for(let r in e)i[r]=e[r];return i}var wr=class extends Error{constructor(t,e){super(e),this.message=e,this.key=t}},f0=class i{constructor(t,e=[]){this.parent=t,this.bindings={};for(let[r,n]of e)this.bindings[r]=n}concat(t){return new i(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return this.bindings[t]?!0:this.parent?this.parent.has(t):!1}},Ef={kind:"null"},Y={kind:"number"},zt={kind:"string"},Lt={kind:"boolean"},pn={kind:"color"},wf={kind:"projectionDefinition"},vo={kind:"object"},Pt={kind:"value"},cP={kind:"error"},Sf={kind:"collator"},bf={kind:"formatted"},Cf={kind:"padding"},hc={kind:"colorArray"},Mf={kind:"numberArray"},Sc={kind:"resolvedImage"},Tf={kind:"variableAnchorOffsetCollection"};function hr(i,t){return{kind:"array",itemType:i,N:t}}function Se(i){if(i.kind==="array"){let t=Se(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}else return i.kind}var hP=[Ef,Y,zt,Lt,pn,wf,bf,vo,hr(Pt),Cf,Mf,hc,Sc,Tf];function uc(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!uc(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let e of hP)if(!uc(e,t))return null}}return`Expected ${Se(i)} but found ${Se(t)} instead.`}function L0(i,t){return t.some(e=>e.kind===i.kind)}function Eo(i,t){return t.some(e=>e==="null"?i===null:e==="array"?Array.isArray(i):e==="object"?i&&!Array.isArray(i)&&typeof i=="object":e===typeof i)}function Xs(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}var TE=.96422,PE=1,RE=.82521,IE=4/29,Oa=6/29,AE=3*Oa*Oa,uP=Oa*Oa*Oa,fP=Math.PI/180,dP=180/Math.PI;function LE(i){return i=i%360,i<0&&(i+=360),i}function OE([i,t,e,r]){i=r0(i),t=r0(t),e=r0(e);let n,s,o=n0((.2225045*i+.7168786*t+.0606169*e)/PE);i===t&&t===e?n=s=o:(n=n0((.4360747*i+.3850649*t+.1430804*e)/TE),s=n0((.0139322*i+.0971045*t+.7141733*e)/RE));let a=116*o-16;return[a<0?0:a,500*(n-o),200*(o-s),r]}function r0(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function n0(i){return i>uP?Math.pow(i,1/3):i/AE+IE}function FE([i,t,e,r]){let n=(i+16)/116,s=isNaN(t)?n:n+t/500,o=isNaN(e)?n:n-e/200;return n=PE*o0(n),s=TE*o0(s),o=RE*o0(o),[s0(3.1338561*s-1.6168667*n-.4906146*o),s0(-.9787684*s+1.9161415*n+.033454*o),s0(.0719453*s-.2289914*n+1.4052427*o),r]}function s0(i){return i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055,i<0?0:i>1?1:i}function o0(i){return i>Oa?i*i*i:AE*(i-IE)}function mP(i){let[t,e,r,n]=OE(i),s=Math.sqrt(e*e+r*r);return[Math.round(s*1e4)?LE(Math.atan2(r,e)*dP):NaN,s,t,n]}function pP([i,t,e,r]){return i=isNaN(i)?0:i*fP,FE([e,Math.cos(i)*t,Math.sin(i)*t,r])}function gP([i,t,e,r]){i=LE(i),t/=100,e/=100;function n(s){let o=(s+i/30)%12,a=t*Math.min(e,1-e);return e-a*Math.max(-1,Math.min(o-3,9-o,1))}return[n(0),n(8),n(4),r]}var yP=Object.hasOwn||function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function lc(i,t){return yP(i,t)?i[t]:void 0}function _P(i){if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];let t=lc(xP,i);if(t){let[n,s,o]=t;return[n/255,s/255,o/255,1]}if(i.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(i)){let s=i.length<6?1:2,o=1;return[Zu(i.slice(o,o+=s)),Zu(i.slice(o,o+=s)),Zu(i.slice(o,o+=s)),Zu(i.slice(o,o+s)||"ff")]}if(i.startsWith("rgb")){let n=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=i.match(n);if(s){let[o,a,l,c,h,u,f,d,m,p,g,y]=s,_=[c||" ",f||" ",p].join("");if(_==="  "||_==="  /"||_===",,"||_===",,,"){let x=[l,u,m].join(""),v=x==="%%%"?100:x===""?255:0;if(v){let E=[Aa(+a/v,0,1),Aa(+h/v,0,1),Aa(+d/v,0,1),g?nE(+g,y):1];if(sE(E))return E}}return}}let e=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=i.match(e);if(r){let[n,s,o,a,l,c,h,u,f]=r,d=[o||" ",l||" ",h].join("");if(d==="  "||d==="  /"||d===",,"||d===",,,"){let m=[+s,Aa(+a,0,100),Aa(+c,0,100),u?nE(+u,f):1];if(sE(m))return gP(m)}}}function Zu(i){return parseInt(i.padEnd(2,i),16)/255}function nE(i,t){return Aa(t?i/100:i,0,1)}function Aa(i,t,e){return Math.min(Math.max(t,i),e)}function sE(i){return!i.some(Number.isNaN)}var xP={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ws(i,t,e){return i+e*(t-i)}function Na(i,t,e){return i.map((r,n)=>Ws(r,t[n],e))}var oe=class i{constructor(t,e,r,n=1,s=!0){this.r=t,this.g=e,this.b=r,this.a=n,s||(this.r*=n,this.g*=n,this.b*=n,n||this.overwriteGetter("rgb",[t,e,r,n]))}static parse(t){if(t instanceof i)return t;if(typeof t!="string")return;let e=_P(t);if(e)return new i(...e,!1)}get rgb(){let{r:t,g:e,b:r,a:n}=this,s=n||1/0;return this.overwriteGetter("rgb",[t/s,e/s,r/s,n])}get hcl(){return this.overwriteGetter("hcl",mP(this.rgb))}get lab(){return this.overwriteGetter("lab",OE(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){let[t,e,r,n]=this.rgb;return`rgba(${[t,e,r].map(s=>Math.round(s*255)).join(",")},${n})`}static interpolate(t,e,r,n="rgb"){switch(n){case"rgb":{let[s,o,a,l]=Na(t.rgb,e.rgb,r);return new i(s,o,a,l,!1)}case"hcl":{let[s,o,a,l]=t.hcl,[c,h,u,f]=e.hcl,d,m;if(!isNaN(s)&&!isNaN(c)){let x=c-s;c>s&&x>180?x-=360:c<s&&s-c>180&&(x+=360),d=s+r*x}else isNaN(s)?isNaN(c)?d=NaN:(d=c,(a===1||a===0)&&(m=h)):(d=s,(u===1||u===0)&&(m=o));let[p,g,y,_]=pP([d,m??Ws(o,h,r),Ws(a,u,r),Ws(l,f,r)]);return new i(p,g,y,_,!1)}case"lab":{let[s,o,a,l]=FE(Na(t.lab,e.lab,r));return new i(s,o,a,l,!1)}}}};oe.black=new oe(0,0,0,1);oe.white=new oe(1,1,1,1);oe.transparent=new oe(0,0,0,0);oe.red=new oe(1,0,0,1);var fc=class{constructor(t,e,r){t?this.sensitivity=e?"variant":"case":this.sensitivity=e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},vP=["bottom","center","top"],dc=class{constructor(t,e,r,n,s,o){this.text=t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=s,this.verticalAlign=o}},wo=class i{constructor(t){this.sections=t}static fromString(t){return new i([new dc(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof i?t:i.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}},Vn=class i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof i)return t;if(typeof t=="number")return new i([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let e of t)if(typeof e!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]];break}return new i(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,r){return new i(Na(t.values,e.values,r))}},Wn=class i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof i)return t;if(typeof t=="number")return new i([t]);if(Array.isArray(t)){for(let e of t)if(typeof e!="number")return;return new i(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,r){return new i(Na(t.values,e.values,r))}},jr=class i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof i)return t;if(typeof t=="string"){let r=oe.parse(t);return r?new i([r]):void 0}if(!Array.isArray(t))return;let e=[];for(let r of t){if(typeof r!="string")return;let n=oe.parse(r);if(!n)return;e.push(n)}return new i(e)}toString(){return JSON.stringify(this.values)}static interpolate(t,e,r,n="rgb"){let s=[];if(t.values.length!=e.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${e.values.length}), cannot interpolate.`);for(let o=0;o<t.values.length;o++)s.push(oe.interpolate(t.values[o],e.values[o],r,n));return new i(s)}},_e=class extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}},EP=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]),Yn=class i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof i)return t;if(!(!Array.isArray(t)||t.length<1||t.length%2!==0)){for(let e=0;e<t.length;e+=2){let r=t[e],n=t[e+1];if(typeof r!="string"||!EP.has(r)||!Array.isArray(n)||n.length!==2||typeof n[0]!="number"||typeof n[1]!="number")return}return new i(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,r){let n=t.values,s=e.values;if(n.length!==s.length)throw new _e(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);let o=[];for(let a=0;a<n.length;a+=2){if(n[a]!==s[a])throw new _e(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${n[a]}, to[${a}]: ${s[a]}`);o.push(n[a]);let[l,c]=n[a+1],[h,u]=s[a+1];o.push([Ws(l,h,r),Ws(c,u,r)])}return new i(o)}},Ys=class i{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new i({name:t,available:!1}):null}},So=class i{constructor(t,e,r){this.from=t,this.to=e,this.transition=r}static interpolate(t,e,r){return new i(t,e,r)}static parse(t){if(t instanceof i)return t;if(Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number")return new i(t[0],t[1],t[2]);if(typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number")return new i(t.from,t.to,t.transition);if(typeof t=="string")return new i(t,t,1)}};function NE(i,t,e,r){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[i,t,e,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[i,t,e,r]:[i,t,e]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mc(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof So||i instanceof oe||i instanceof fc||i instanceof wo||i instanceof Vn||i instanceof Wn||i instanceof jr||i instanceof Yn||i instanceof Ys)return!0;if(Array.isArray(i)){for(let t of i)if(!mc(t))return!1;return!0}else if(typeof i=="object"){for(let t in i)if(!mc(i[t]))return!1;return!0}else return!1}function qe(i){if(i===null)return Ef;if(typeof i=="string")return zt;if(typeof i=="boolean")return Lt;if(typeof i=="number")return Y;if(i instanceof oe)return pn;if(i instanceof So)return wf;if(i instanceof fc)return Sf;if(i instanceof wo)return bf;if(i instanceof Vn)return Cf;if(i instanceof Wn)return Mf;if(i instanceof jr)return hc;if(i instanceof Yn)return Tf;if(i instanceof Ys)return Sc;if(Array.isArray(i)){let t=i.length,e;for(let r of i){let n=qe(r);if(!e)e=n;else{if(e===n)continue;e=Pt;break}}return hr(e||Pt,t)}else return vo}function cc(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof oe||i instanceof So||i instanceof wo||i instanceof Vn||i instanceof Wn||i instanceof jr||i instanceof Yn||i instanceof Ys?i.toString():JSON.stringify(i)}var Da=class i{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(t.length!==2)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!mc(t[1]))return e.error("invalid value");let r=t[1],n=qe(r),s=e.expectedType;return n.kind==="array"&&n.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(n=s),new i(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}},Ju={string:zt,number:Y,boolean:Lt,object:vo},zr=class i{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r=1,n,s=t[0];if(s==="array"){let a;if(t.length>2){let c=t[1];if(typeof c!="string"||!(c in Ju)||c==="object")return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=Ju[c],r++}else a=Pt;let l;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);l=t[2],r++}n=hr(a,l)}else{if(!Ju[s])throw new Error(`Types doesn't contain name = ${s}`);n=Ju[s]}let o=[];for(;r<t.length;r++){let a=e.parse(t[r],r,Pt);if(!a)return null;o.push(a)}return new i(n,o)}evaluate(t){for(let e=0;e<this.args.length;e++){let r=this.args[e].evaluate(t);if(uc(this.type,qe(r))){if(e===this.args.length-1)throw new _e(`Expected value to be of type ${Se(this.type)}, but found ${Se(qe(r))} instead.`)}else return r}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}},oE={"to-boolean":Lt,"to-color":pn,"to-number":Y,"to-string":zt},Vs=class i{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r=t[0];if(!oE[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&t.length!==2)return e.error("Expected one argument.");let n=oE[r],s=[];for(let o=1;o<t.length;o++){let a=e.parse(t[o],o,Pt);if(!a)return null;s.push(a)}return new i(n,s)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let e,r;for(let n of this.args){if(e=n.evaluate(t),r=null,e instanceof oe)return e;if(typeof e=="string"){let s=t.parseColor(e);if(s)return s}else if(Array.isArray(e)&&(e.length<3||e.length>4?r=`Invalid rgba value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:r=NE(e[0],e[1],e[2],e[3]),!r))return new oe(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new _e(r||`Could not parse color from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"padding":{let e;for(let r of this.args){e=r.evaluate(t);let n=Vn.parse(e);if(n)return n}throw new _e(`Could not parse padding from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"numberArray":{let e;for(let r of this.args){e=r.evaluate(t);let n=Wn.parse(e);if(n)return n}throw new _e(`Could not parse numberArray from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"colorArray":{let e;for(let r of this.args){e=r.evaluate(t);let n=jr.parse(e);if(n)return n}throw new _e(`Could not parse colorArray from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(let r of this.args){e=r.evaluate(t);let n=Yn.parse(e);if(n)return n}throw new _e(`Could not parse variableAnchorOffsetCollection from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(let r of this.args){if(e=r.evaluate(t),e===null)return 0;let n=Number(e);if(!isNaN(n))return n}throw new _e(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return wo.fromString(cc(this.args[0].evaluate(t)));case"resolvedImage":return Ys.fromString(cc(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return cc(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}},wP=["Unknown","Point","LineString","Polygon"],nf=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wP[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache.get(t);return e||(e=oe.parse(t),this._parseColorCache.set(t,e)),e}},sf=class i{constructor(t,e,r=[],n,s=new f0,o=[]){this.registry=t,this.path=r,this.key=r.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=n,this._isConstant=e}parse(t,e,r,n,s={}){return e?this.concat(e,r,n)._parse(t,s):this._parse(t,s)}_parse(t,e){(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number")&&(t=["literal",t]);function r(n,s,o){return o==="assert"?new zr(s,[n]):o==="coerce"?new Vs(s,[n]):n}if(Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let n=t[0];if(typeof n!="string")return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let s=this.registry[n];if(s){let o=s.parse(t,this);if(!o)return null;if(this.expectedType){let a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=r(o,a,e.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))o=r(o,a,e.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof Da)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){let a=new nf;try{o=new Da(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof t>"u"?this.error("'undefined' value invalid. Use null instead."):typeof t=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof t} instead.`)}concat(t,e,r){let n=typeof t=="number"?this.path.concat(t):this.path,s=r?this.scope.concat(r):this.scope;return new i(this.registry,this._isConstant,n,e||null,s,this.errors)}error(t,...e){let r=`${this.key}${e.map(n=>`[${n}]`).join("")}`;this.errors.push(new wr(r,t))}checkSubtype(t,e){let r=uc(t,e);return r&&this.error(r),r}},of=class i{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let r=[];for(let s=1;s<t.length-1;s+=2){let o=t[s];if(typeof o!="string")return e.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return e.error("Variable names must contain only alphanumeric characters or '_'.",s);let a=e.parse(t[s+1],s+1);if(!a)return null;r.push([o,a])}let n=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return n?new i(r,n):null}outputDefined(){return this.result.outputDefined()}},af=class i{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(t.length!==2||typeof t[1]!="string")return e.error("'var' expression requires exactly one string literal argument.");let r=t[1];return e.scope.has(r)?new i(r,e.scope.get(r)):e.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}},d0=class i{constructor(t,e,r){this.type=t,this.index=e,this.input=r}static parse(t,e){if(t.length!==3)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let r=e.parse(t[1],1,Y),n=e.parse(t[2],2,hr(e.expectedType||Pt));if(!r||!n)return null;let s=n.type;return new i(s.itemType,r,n)}evaluate(t){let e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new _e(`Array index out of bounds: ${e} < 0.`);if(e>=r.length)throw new _e(`Array index out of bounds: ${e} > ${r.length-1}.`);if(e!==Math.floor(e))throw new _e(`Array index must be an integer, but found ${e} instead.`);return r[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}},m0=class i{constructor(t,e){this.type=Lt,this.needle=t,this.haystack=e}static parse(t,e){if(t.length!==3)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let r=e.parse(t[1],1,Pt),n=e.parse(t[2],2,Pt);return!r||!n?null:L0(r.type,[Lt,zt,Y,Ef,Pt])?new i(r,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Se(r.type)} instead`)}evaluate(t){let e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!Eo(e,["boolean","string","number","null"]))throw new _e(`Expected first argument to be of type boolean, string, number or null, but found ${Se(qe(e))} instead.`);if(!Eo(r,["string","array"]))throw new _e(`Expected second argument to be of type array or string, but found ${Se(qe(r))} instead.`);return r.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}},p0=class i{constructor(t,e,r){this.type=Y,this.needle=t,this.haystack=e,this.fromIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let r=e.parse(t[1],1,Pt),n=e.parse(t[2],2,Pt);if(!r||!n)return null;if(!L0(r.type,[Lt,zt,Y,Ef,Pt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Se(r.type)} instead`);if(t.length===4){let s=e.parse(t[3],3,Y);return s?new i(r,n,s):null}else return new i(r,n)}evaluate(t){let e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!Eo(e,["boolean","string","number","null"]))throw new _e(`Expected first argument to be of type boolean, string, number or null, but found ${Se(qe(e))} instead.`);let n;if(this.fromIndex&&(n=this.fromIndex.evaluate(t)),Eo(r,["string"])){let s=r.indexOf(e,n);return s===-1?-1:[...r.slice(0,s)].length}else{if(Eo(r,["array"]))return r.indexOf(e,n);throw new _e(`Expected second argument to be of type array or string, but found ${Se(qe(r))} instead.`)}}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}},g0=class i{constructor(t,e,r,n,s,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=s,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!==1)return e.error("Expected an even number of arguments.");let r,n;e.expectedType&&e.expectedType.kind!=="value"&&(n=e.expectedType);let s={},o=[];for(let c=2;c<t.length-1;c+=2){let h=t[c],u=t[c+1];Array.isArray(h)||(h=[h]);let f=e.concat(c);if(h.length===0)return f.error("Expected at least one branch label.");for(let m of h){if(typeof m!="number"&&typeof m!="string")return f.error("Branch labels must be numbers or strings.");if(typeof m=="number"&&Math.abs(m)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof m=="number"&&Math.floor(m)!==m)return f.error("Numeric branch labels must be integer values.");if(!r)r=qe(m);else if(f.checkSubtype(r,qe(m)))return null;if(typeof s[String(m)]<"u")return f.error("Branch labels must be unique.");s[String(m)]=o.length}let d=e.parse(u,c,n);if(!d)return null;n=n||d.type,o.push(d)}let a=e.parse(t[1],1,Pt);if(!a)return null;let l=e.parse(t[t.length-1],t.length-1,n);return!l||a.type.kind!=="value"&&e.concat(1).checkSubtype(r,a.type)?null:new i(r,n,a,s,o,l)}evaluate(t){let e=this.input.evaluate(t);return(qe(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}},y0=class i{constructor(t,e,r){this.type=t,this.branches=e,this.otherwise=r}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!==0)return e.error("Expected an odd number of arguments.");let r;e.expectedType&&e.expectedType.kind!=="value"&&(r=e.expectedType);let n=[];for(let o=1;o<t.length-1;o+=2){let a=e.parse(t[o],o,Lt);if(!a)return null;let l=e.parse(t[o+1],o+1,r);if(!l)return null;n.push([a,l]),r=r||l.type}let s=e.parse(t[t.length-1],t.length-1,r);if(!s)return null;if(!r)throw new Error("Can't infer output type");return new i(r,n,s)}evaluate(t){for(let[e,r]of this.branches)if(e.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[e,r]of this.branches)t(e),t(r);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}},_0=class i{constructor(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let r=e.parse(t[1],1,Pt),n=e.parse(t[2],2,Y);if(!r||!n)return null;if(!L0(r.type,[hr(Pt),zt,Pt]))return e.error(`Expected first argument to be of type array or string, but found ${Se(r.type)} instead`);if(t.length===4){let s=e.parse(t[3],3,Y);return s?new i(r.type,r,n,s):null}else return new i(r.type,r,n)}evaluate(t){let e=this.input.evaluate(t),r=this.beginIndex.evaluate(t),n;if(this.endIndex&&(n=this.endIndex.evaluate(t)),Eo(e,["string"]))return[...e].slice(r,n).join("");if(Eo(e,["array"]))return e.slice(r,n);throw new _e(`Expected first argument to be of type array or string, but found ${Se(qe(e))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}};function DE(i,t){let e=i.length-1,r=0,n=e,s=0,o,a;for(;r<=n;)if(s=Math.floor((r+n)/2),o=i[s],a=i[s+1],o<=t){if(s===e||t<a)return s;r=s+1}else if(o>t)n=s-1;else throw new _e("Input is not a number.");return 0}var lf=class i{constructor(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(let[n,s]of r)this.labels.push(n),this.outputs.push(s)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");let r=e.parse(t[1],1,Y);if(!r)return null;let n=[],s=null;e.expectedType&&e.expectedType.kind!=="value"&&(s=e.expectedType);for(let o=1;o<t.length;o+=2){let a=o===1?-1/0:t[o],l=t[o+1],c=o,h=o+1;if(typeof a!="number")return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',c);if(n.length&&n[n.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',c);let u=e.parse(l,h,s);if(!u)return null;s=s||u.type,n.push([a,u])}return new i(s,r,n)}evaluate(t){let e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);let n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);let s=e.length;if(n>=e[s-1])return r[s-1].evaluate(t);let o=DE(e,n);return r[o].evaluate(t)}eachChild(t){t(this.input);for(let e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}};function SP(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var a0,aE;function bP(){if(aE)return a0;aE=1,a0=i;function i(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=n}return i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,n=0;n<8;n++){var s=this.sampleCurveX(r)-t;if(Math.abs(s)<e)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r=r-s/o}var a=0,l=1;for(r=t,n=0;n<20&&(s=this.sampleCurveX(r),!(Math.abs(s-t)<e));n++)t>s?a=r:l=r,r=(l-a)*.5+a;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},a0}var CP=bP(),MP=SP(CP),Xn=class i{constructor(t,e,r,n,s){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(let[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(t,e,r,n){let s=0;if(t.name==="exponential")s=l0(e,t.base,r,n);else if(t.name==="linear")s=l0(e,1,r,n);else if(t.name==="cubic-bezier"){let o=t.controlPoints;s=new MP(o[0],o[1],o[2],o[3]).solve(l0(e,1,r,n))}return s}static parse(t,e){let[r,n,s,...o]=t;if(!Array.isArray(n)||n.length===0)return e.error("Expected an interpolation type expression.",1);if(n[0]==="linear")n={name:"linear"};else if(n[0]==="exponential"){let c=n[1];if(typeof c!="number")return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:c}}else if(n[0]==="cubic-bezier"){let c=n.slice(1);if(c.length!==4||c.some(h=>typeof h!="number"||h<0||h>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:c}}else return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");if(s=e.parse(s,2,Y),!s)return null;let a=[],l=null;(r==="interpolate-hcl"||r==="interpolate-lab")&&e.expectedType!=hc?l=pn:e.expectedType&&e.expectedType.kind!=="value"&&(l=e.expectedType);for(let c=0;c<o.length;c+=2){let h=o[c],u=o[c+1],f=c+3,d=c+4;if(typeof h!="number")return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(a.length&&a[a.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);let m=e.parse(u,d,l);if(!m)return null;l=l||m.type,a.push([h,m])}return!Xs(l,Y)&&!Xs(l,wf)&&!Xs(l,pn)&&!Xs(l,Cf)&&!Xs(l,Mf)&&!Xs(l,hc)&&!Xs(l,Tf)&&!Xs(l,hr(Y))?e.error(`Type ${Se(l)} is not interpolatable.`):new i(l,r,n,s,a)}evaluate(t){let e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);let n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);let s=e.length;if(n>=e[s-1])return r[s-1].evaluate(t);let o=DE(e,n),a=e[o],l=e[o+1],c=i.interpolationFactor(this.interpolation,n,a,l),h=r[o].evaluate(t),u=r[o+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ws(h,u,c);case"color":return oe.interpolate(h,u,c);case"padding":return Vn.interpolate(h,u,c);case"colorArray":return jr.interpolate(h,u,c);case"numberArray":return Wn.interpolate(h,u,c);case"variableAnchorOffsetCollection":return Yn.interpolate(h,u,c);case"array":return Na(h,u,c);case"projectionDefinition":return So.interpolate(h,u,c)}case"interpolate-hcl":switch(this.type.kind){case"color":return oe.interpolate(h,u,c,"hcl");case"colorArray":return jr.interpolate(h,u,c,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return oe.interpolate(h,u,c,"lab");case"colorArray":return jr.interpolate(h,u,c,"lab")}}}eachChild(t){t(this.input);for(let e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}};function l0(i,t,e,r){let n=r-e,s=i-e;return n===0?0:t===1?s/n:(Math.pow(t,s)-1)/(Math.pow(t,n)-1)}var SX={color:oe.interpolate,number:Ws,padding:Vn.interpolate,numberArray:Wn.interpolate,colorArray:jr.interpolate,variableAnchorOffsetCollection:Yn.interpolate,array:Na},cf=class i{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r=null,n=e.expectedType;n&&n.kind!=="value"&&(r=n);let s=[];for(let a of t.slice(1)){let l=e.parse(a,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,s.push(l)}if(!r)throw new Error("No output type");return n&&s.some(a=>uc(n,a.type))?new i(Pt,s):new i(r,s)}evaluate(t){let e=null,r=0,n;for(let s of this.args)if(r++,e=s.evaluate(t),e&&e instanceof Ys&&!e.available&&(n||(n=e.name),e=null,r===this.args.length&&(e=n)),e!==null)break;return e}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}};function lE(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function TP(i,t,e){return t===e}function PP(i,t,e){return t!==e}function RP(i,t,e){return t<e}function IP(i,t,e){return t>e}function AP(i,t,e){return t<=e}function LP(i,t,e){return t>=e}function GE(i,t,e,r){return r.compare(t,e)===0}function OP(i,t,e,r){return!GE(i,t,e,r)}function FP(i,t,e,r){return r.compare(t,e)<0}function NP(i,t,e,r){return r.compare(t,e)>0}function DP(i,t,e,r){return r.compare(t,e)<=0}function GP(i,t,e,r){return r.compare(t,e)>=0}function ka(i,t,e){let r=i!=="=="&&i!=="!=";return class kE{constructor(s,o,a){this.type=Lt,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");let a=s[0],l=o.parse(s[1],1,Pt);if(!l)return null;if(!lE(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${Se(l.type)}'.`);let c=o.parse(s[2],2,Pt);if(!c)return null;if(!lE(a,c.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${Se(c.type)}'.`);if(l.type.kind!==c.type.kind&&l.type.kind!=="value"&&c.type.kind!=="value")return o.error(`Cannot compare types '${Se(l.type)}' and '${Se(c.type)}'.`);r&&(l.type.kind==="value"&&c.type.kind!=="value"?l=new zr(c.type,[l]):l.type.kind!=="value"&&c.type.kind==="value"&&(c=new zr(l.type,[c])));let h=null;if(s.length===4){if(l.type.kind!=="string"&&c.type.kind!=="string"&&l.type.kind!=="value"&&c.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(h=o.parse(s[3],3,Sf),!h)return null}return new kE(l,c,h)}evaluate(s){let o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){let l=qe(o),c=qe(a);if(l.kind!==c.kind||!(l.kind==="string"||l.kind==="number"))throw new _e(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${l.kind}, ${c.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){let l=qe(o),c=qe(a);if(l.kind!=="string"||c.kind!=="string")return t(s,o,a)}return this.collator?e(s,o,a,this.collator.evaluate(s)):t(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}var kP=ka("==",TP,GE),zP=ka("!=",PP,OP),jP=ka("<",RP,FP),UP=ka(">",IP,NP),BP=ka("<=",AP,DP),qP=ka(">=",LP,GP),hf=class i{constructor(t,e,r){this.type=Sf,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(t.length!==2)return e.error("Expected one argument.");let r=t[1];if(typeof r!="object"||Array.isArray(r))return e.error("Collator options argument must be an object.");let n=e.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,Lt);if(!n)return null;let s=e.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,Lt);if(!s)return null;let o=null;return r.locale&&(o=e.parse(r.locale,1,zt),!o)?null:new i(n,s,o)}evaluate(t){return new fc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}},x0=class i{constructor(t,e,r,n,s){this.type=zt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=s}static parse(t,e){if(t.length!==3)return e.error("Expected two arguments.");let r=e.parse(t[1],1,Y);if(!r)return null;let n=t[2];if(typeof n!="object"||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let s=null;if(n.locale&&(s=e.parse(n.locale,1,zt),!s))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,zt),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=e.parse(n["min-fraction-digits"],1,Y),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=e.parse(n["max-fraction-digits"],1,Y),!l)?null:new i(r,s,o,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}},v0=class i{constructor(t){this.type=bf,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r=t[1];if(!Array.isArray(r)&&typeof r=="object")return e.error("First argument must be an image or text section.");let n=[],s=!1;for(let o=1;o<=t.length-1;++o){let a=t[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=e.parse(a["font-scale"],1,Y),!l))return null;let c=null;if(a["text-font"]&&(c=e.parse(a["text-font"],1,hr(zt)),!c))return null;let h=null;if(a["text-color"]&&(h=e.parse(a["text-color"],1,pn),!h))return null;let u=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!vP.includes(a["vertical-align"]))return e.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(u=e.parse(a["vertical-align"],1,zt),!u)return null}let f=n[n.length-1];f.scale=l,f.font=c,f.textColor=h,f.verticalAlign=u}else{let l=e.parse(t[o],1,Pt);if(!l)return null;let c=l.type.kind;if(c!=="string"&&c!=="value"&&c!=="null"&&c!=="resolvedImage")return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,n.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new i(n)}evaluate(t){let e=r=>{let n=r.content.evaluate(t);return qe(n)===Sc?new dc("",n,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new dc(cc(n),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)};return new wo(this.sections.map(e))}eachChild(t){for(let e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor),e.verticalAlign&&t(e.verticalAlign)}outputDefined(){return!1}},E0=class i{constructor(t){this.type=Sc,this.input=t}static parse(t,e){if(t.length!==2)return e.error("Expected two arguments.");let r=e.parse(t[1],1,zt);return r?new i(r):e.error("No image name provided.")}evaluate(t){let e=this.input.evaluate(t),r=Ys.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r}eachChild(t){t(this.input)}outputDefined(){return!1}},w0=class i{constructor(t){this.type=Y,this.input=t}static parse(t,e){if(t.length!==2)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);let r=e.parse(t[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?e.error(`Expected argument of type string or array, but found ${Se(r.type)} instead.`):new i(r):null}evaluate(t){let e=this.input.evaluate(t);if(typeof e=="string")return[...e].length;if(Array.isArray(e))return e.length;throw new _e(`Expected value to be of type string or array, but found ${Se(qe(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}},gn=8192;function XP(i,t){let e=VP(i[0]),r=YP(i[1]),n=Math.pow(2,t.z);return[Math.round(e*n*gn),Math.round(r*n*gn)]}function O0(i,t){let e=Math.pow(2,t.z),r=(i[0]/gn+t.x)/e,n=(i[1]/gn+t.y)/e;return[WP(r),$P(n)]}function VP(i){return(180+i)/360}function WP(i){return i*360-180}function YP(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function $P(i){return 360/Math.PI*Math.atan(Math.exp((180-i*360)*Math.PI/180))-90}function bc(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function pc(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function KP(i,t,e){return t[1]>i[1]!=e[1]>i[1]&&i[0]<(e[0]-t[0])*(i[1]-t[1])/(e[1]-t[1])+t[0]}function HP(i,t,e){let r=i[0]-t[0],n=i[1]-t[1],s=i[0]-e[0],o=i[1]-e[1];return r*o-s*n===0&&r*s<=0&&n*o<=0}function Pf(i,t,e,r){let n=[t[0]-i[0],t[1]-i[1]],s=[r[0]-e[0],r[1]-e[1]];return tR(s,n)===0?!1:!!(cE(i,t,e,r)&&cE(e,r,i,t))}function ZP(i,t,e){for(let r of e)for(let n=0;n<r.length-1;++n)if(Pf(i,t,r[n],r[n+1]))return!0;return!1}function za(i,t,e=!1){let r=!1;for(let n of t)for(let s=0;s<n.length-1;s++){if(HP(i,n[s],n[s+1]))return e;KP(i,n[s],n[s+1])&&(r=!r)}return r}function JP(i,t){for(let e of t)if(za(i,e))return!0;return!1}function zE(i,t){for(let e of i)if(!za(e,t))return!1;for(let e=0;e<i.length-1;++e)if(ZP(i[e],i[e+1],t))return!1;return!0}function QP(i,t){for(let e of t)if(zE(i,e))return!0;return!1}function tR(i,t){return i[0]*t[1]-i[1]*t[0]}function cE(i,t,e,r){let n=i[0]-e[0],s=i[1]-e[1],o=t[0]-e[0],a=t[1]-e[1],l=r[0]-e[0],c=r[1]-e[1],h=n*c-l*s,u=o*c-l*a;return h>0&&u<0||h<0&&u>0}function F0(i,t,e){let r=[];for(let n=0;n<i.length;n++){let s=[];for(let o=0;o<i[n].length;o++){let a=XP(i[n][o],e);bc(t,a),s.push(a)}r.push(s)}return r}function jE(i,t,e){let r=[];for(let n=0;n<i.length;n++){let s=F0(i[n],t,e);r.push(s)}return r}function UE(i,t,e,r){if(i[0]<e[0]||i[0]>e[2]){let n=r*.5,s=i[0]-e[0]>n?-r:e[0]-i[0]>n?r:0;s===0&&(s=i[0]-e[2]>n?-r:e[2]-i[0]>n?r:0),i[0]+=s}bc(t,i)}function eR(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function hE(i,t,e,r){let n=Math.pow(2,r.z)*gn,s=[r.x*gn,r.y*gn],o=[];for(let a of i)for(let l of a){let c=[l.x+s[0],l.y+s[1]];UE(c,t,e,n),o.push(c)}return o}function uE(i,t,e,r){let n=Math.pow(2,r.z)*gn,s=[r.x*gn,r.y*gn],o=[];for(let a of i){let l=[];for(let c of a){let h=[c.x+s[0],c.y+s[1]];bc(t,h),l.push(h)}o.push(l)}if(t[2]-t[0]<=n/2){eR(t);for(let a of o)for(let l of a)UE(l,t,e,n)}return o}function iR(i,t){let e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=i.canonicalID();if(t.type==="Polygon"){let s=F0(t.coordinates,r,n),o=hE(i.geometry(),e,r,n);if(!pc(e,r))return!1;for(let a of o)if(!za(a,s))return!1}if(t.type==="MultiPolygon"){let s=jE(t.coordinates,r,n),o=hE(i.geometry(),e,r,n);if(!pc(e,r))return!1;for(let a of o)if(!JP(a,s))return!1}return!0}function rR(i,t){let e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=i.canonicalID();if(t.type==="Polygon"){let s=F0(t.coordinates,r,n),o=uE(i.geometry(),e,r,n);if(!pc(e,r))return!1;for(let a of o)if(!zE(a,s))return!1}if(t.type==="MultiPolygon"){let s=jE(t.coordinates,r,n),o=uE(i.geometry(),e,r,n);if(!pc(e,r))return!1;for(let a of o)if(!QP(a,s))return!1}return!0}var gc=class i{constructor(t,e){this.type=Lt,this.geojson=t,this.geometries=e}static parse(t,e){if(t.length!==2)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(mc(t[1])){let r=t[1];if(r.type==="FeatureCollection"){let n=[];for(let s of r.features){let{type:o,coordinates:a}=s.geometry;o==="Polygon"&&n.push(a),o==="MultiPolygon"&&n.push(...a)}if(n.length){let s={type:"MultiPolygon",coordinates:n};return new i(r,s)}}else if(r.type==="Feature"){let n=r.geometry.type;if(n==="Polygon"||n==="MultiPolygon")return new i(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new i(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return iR(t,this.geometries);if(t.geometryType()==="LineString")return rR(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}},uf=class{constructor(t=[],e=(r,n)=>r<n?-1:r>n?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:e,compare:r}=this,n=e[t];for(;t>0;){let s=t-1>>1,o=e[s];if(r(n,o)>=0)break;e[t]=o,t=s}e[t]=n}_down(t){let{data:e,compare:r}=this,n=this.length>>1,s=e[t];for(;t<n;){let o=(t<<1)+1,a=o+1;if(a<this.length&&r(e[a],e[o])<0&&(o=a),r(e[o],s)>=0)break;e[t]=e[o],t=o}e[t]=s}};function BE(i,t,e=0,r=i.length-1,n=nR){for(;r>e;){if(r-e>600){let l=r-e+1,c=t-e+1,h=Math.log(l),u=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*u*(l-u)/l)*(c-l/2<0?-1:1),d=Math.max(e,Math.floor(t-c*u/l+f)),m=Math.min(r,Math.floor(t+(l-c)*u/l+f));BE(i,t,d,m,n)}let s=i[t],o=e,a=r;for(ac(i,e,t),n(i[r],s)>0&&ac(i,e,r);o<a;){for(ac(i,o,a),o++,a--;n(i[o],s)<0;)o++;for(;n(i[a],s)>0;)a--}n(i[e],s)===0?ac(i,e,a):(a++,ac(i,a,r)),a<=t&&(e=a+1),t<=a&&(r=a-1)}}function ac(i,t,e){let r=i[t];i[t]=i[e],i[e]=r}function nR(i,t){return i<t?-1:i>t?1:0}function sR(i,t){if(i.length<=1)return[i];let r=[],n,s;for(let o of i){let a=aR(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(n&&r.push(n),n=[o]):n.push(o))}if(n&&r.push(n),t>1)for(let o=0;o<r.length;o++)r[o].length<=t||(BE(r[o],t,1,r[o].length-1,oR),r[o]=r[o].slice(0,t));return r}function oR(i,t){return t.area-i.area}function aR(i){let t=0;for(let e=0,r=i.length,n=r-1,s,o;e<r;n=e++)s=i[e],o=i[n],t+=(o.x-s.x)*(s.y+o.y);return t}var lR=6378.137,fE=1/298.257223563,dE=fE*(2-fE),mE=Math.PI/180,yc=class{constructor(t){let e=mE*lR*1e3,r=Math.cos(t*mE),n=1/(1-dE*(1-r*r)),s=Math.sqrt(n);this.kx=e*s*r,this.ky=e*s*n*(1-dE)}distance(t,e){let r=this.wrap(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(r*r+n*n)}pointOnLine(t,e){let r=1/0,n,s,o,a;for(let l=0;l<t.length-1;l++){let c=t[l][0],h=t[l][1],u=this.wrap(t[l+1][0]-c)*this.kx,f=(t[l+1][1]-h)*this.ky,d=0;(u!==0||f!==0)&&(d=(this.wrap(e[0]-c)*this.kx*u+(e[1]-h)*this.ky*f)/(u*u+f*f),d>1?(c=t[l+1][0],h=t[l+1][1]):d>0&&(c+=u/this.kx*d,h+=f/this.ky*d)),u=this.wrap(e[0]-c)*this.kx,f=(e[1]-h)*this.ky;let m=u*u+f*f;m<r&&(r=m,n=c,s=h,o=l,a=d)}return{point:[n,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}},S0=100,b0=50;function qE(i,t){return t[0]-i[0]}function ff(i){return i[1]-i[0]+1}function $n(i,t){return i[1]>=i[0]&&i[1]<t}function C0(i,t){if(i[0]>i[1])return[null,null];let e=ff(i);if(t){if(e===2)return[i,null];let n=Math.floor(e/2);return[[i[0],i[0]+n],[i[0]+n,i[1]]]}if(e===1)return[i,null];let r=Math.floor(e/2)-1;return[[i[0],i[0]+r],[i[0]+r+1,i[1]]]}function M0(i,t){if(!$n(t,i.length))return[1/0,1/0,-1/0,-1/0];let e=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)bc(e,i[r]);return e}function T0(i){let t=[1/0,1/0,-1/0,-1/0];for(let e of i)for(let r of e)bc(t,r);return t}function pE(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function N0(i,t,e){if(!pE(i)||!pE(t))return NaN;let r=0,n=0;return i[2]<t[0]&&(r=t[0]-i[2]),i[0]>t[2]&&(r=i[0]-t[2]),i[1]>t[3]&&(n=i[1]-t[3]),i[3]<t[1]&&(n=t[1]-i[3]),e.distance([0,0],[r,n])}function xo(i,t,e){let r=e.pointOnLine(t,i);return e.distance(i,r.point)}function D0(i,t,e,r,n){let s=Math.min(xo(i,[e,r],n),xo(t,[e,r],n)),o=Math.min(xo(e,[i,t],n),xo(r,[i,t],n));return Math.min(s,o)}function cR(i,t,e,r,n){if(!($n(t,i.length)&&$n(r,e.length)))return 1/0;let o=1/0;for(let a=t[0];a<t[1];++a){let l=i[a],c=i[a+1];for(let h=r[0];h<r[1];++h){let u=e[h],f=e[h+1];if(Pf(l,c,u,f))return 0;o=Math.min(o,D0(l,c,u,f,n))}}return o}function hR(i,t,e,r,n){if(!($n(t,i.length)&&$n(r,e.length)))return NaN;let o=1/0;for(let a=t[0];a<=t[1];++a)for(let l=r[0];l<=r[1];++l)if(o=Math.min(o,n.distance(i[a],e[l])),o===0)return o;return o}function uR(i,t,e){if(za(i,t,!0))return 0;let r=1/0;for(let n of t){let s=n[0],o=n[n.length-1];if(s!==o&&(r=Math.min(r,xo(i,[o,s],e)),r===0))return r;let a=e.pointOnLine(n,i);if(r=Math.min(r,e.distance(i,a.point)),r===0)return r}return r}function fR(i,t,e,r){if(!$n(t,i.length))return NaN;for(let s=t[0];s<=t[1];++s)if(za(i[s],e,!0))return 0;let n=1/0;for(let s=t[0];s<t[1];++s){let o=i[s],a=i[s+1];for(let l of e)for(let c=0,h=l.length,u=h-1;c<h;u=c++){let f=l[u],d=l[c];if(Pf(o,a,f,d))return 0;n=Math.min(n,D0(o,a,f,d,r))}}return n}function gE(i,t){for(let e of i)for(let r of e)if(za(r,t,!0))return!0;return!1}function dR(i,t,e,r=1/0){let n=T0(i),s=T0(t);if(r!==1/0&&N0(n,s,e)>=r)return r;if(pc(n,s)){if(gE(i,t))return 0}else if(gE(t,i))return 0;let o=1/0;for(let a of i)for(let l=0,c=a.length,h=c-1;l<c;h=l++){let u=a[h],f=a[l];for(let d of t)for(let m=0,p=d.length,g=p-1;m<p;g=m++){let y=d[g],_=d[m];if(Pf(u,f,y,_))return 0;o=Math.min(o,D0(u,f,y,_,e))}}return o}function yE(i,t,e,r,n,s){if(!s)return;let o=N0(M0(r,s),n,e);o<t&&i.push([o,s,[0,0]])}function Qu(i,t,e,r,n,s,o){if(!s||!o)return;let a=N0(M0(r,s),M0(n,o),e);a<t&&i.push([a,s,o])}function df(i,t,e,r,n=1/0){let s=Math.min(r.distance(i[0],e[0][0]),n);if(s===0)return s;let o=new uf([[0,[0,i.length-1],[0,0]]],qE),a=T0(e);for(;o.length>0;){let l=o.pop();if(l[0]>=s)continue;let c=l[1],h=t?b0:S0;if(ff(c)<=h){if(!$n(c,i.length))return NaN;if(t){let u=fR(i,c,e,r);if(isNaN(u)||u===0)return u;s=Math.min(s,u)}else for(let u=c[0];u<=c[1];++u){let f=uR(i[u],e,r);if(s=Math.min(s,f),s===0)return 0}}else{let u=C0(c,t);yE(o,s,r,i,a,u[0]),yE(o,s,r,i,a,u[1])}}return s}function mf(i,t,e,r,n,s=1/0){let o=Math.min(s,n.distance(i[0],e[0]));if(o===0)return o;let a=new uf([[0,[0,i.length-1],[0,e.length-1]]],qE);for(;a.length>0;){let l=a.pop();if(l[0]>=o)continue;let c=l[1],h=l[2],u=t?b0:S0,f=r?b0:S0;if(ff(c)<=u&&ff(h)<=f){if(!$n(c,i.length)&&$n(h,e.length))return NaN;let d;if(t&&r)d=cR(i,c,e,h,n),o=Math.min(o,d);else if(t&&!r){let m=i.slice(c[0],c[1]+1);for(let p=h[0];p<=h[1];++p)if(d=xo(e[p],m,n),o=Math.min(o,d),o===0)return o}else if(!t&&r){let m=e.slice(h[0],h[1]+1);for(let p=c[0];p<=c[1];++p)if(d=xo(i[p],m,n),o=Math.min(o,d),o===0)return o}else d=hR(i,c,e,h,n),o=Math.min(o,d)}else{let d=C0(c,t),m=C0(h,r);Qu(a,o,n,i,e,d[0],m[0]),Qu(a,o,n,i,e,d[0],m[1]),Qu(a,o,n,i,e,d[1],m[0]),Qu(a,o,n,i,e,d[1],m[1])}}return o}function mR(i,t){let e=i.geometry(),r=e.flat().map(o=>O0([o.x,o.y],i.canonical));if(e.length===0)return NaN;let n=new yc(r[0][1]),s=1/0;for(let o of t){switch(o.type){case"Point":s=Math.min(s,mf(r,!1,[o.coordinates],!1,n,s));break;case"LineString":s=Math.min(s,mf(r,!1,o.coordinates,!0,n,s));break;case"Polygon":s=Math.min(s,df(r,!1,o.coordinates,n,s));break}if(s===0)return s}return s}function pR(i,t){let e=i.geometry(),r=e.flat().map(o=>O0([o.x,o.y],i.canonical));if(e.length===0)return NaN;let n=new yc(r[0][1]),s=1/0;for(let o of t){switch(o.type){case"Point":s=Math.min(s,mf(r,!0,[o.coordinates],!1,n,s));break;case"LineString":s=Math.min(s,mf(r,!0,o.coordinates,!0,n,s));break;case"Polygon":s=Math.min(s,df(r,!0,o.coordinates,n,s));break}if(s===0)return s}return s}function gR(i,t){let e=i.geometry();if(e.length===0||e[0].length===0)return NaN;let r=sR(e,0).map(o=>o.map(a=>a.map(l=>O0([l.x,l.y],i.canonical)))),n=new yc(r[0][0][0][1]),s=1/0;for(let o of t)for(let a of r){switch(o.type){case"Point":s=Math.min(s,df([o.coordinates],!1,a,n,s));break;case"LineString":s=Math.min(s,df(o.coordinates,!0,a,n,s));break;case"Polygon":s=Math.min(s,dR(a,o.coordinates,n,s));break}if(s===0)return s}return s}function c0(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}var _c=class i{constructor(t,e){this.type=Y,this.geojson=t,this.geometries=e}static parse(t,e){if(t.length!==2)return e.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(mc(t[1])){let r=t[1];if(r.type==="FeatureCollection")return new i(r,r.features.map(n=>c0(n.geometry)).flat());if(r.type==="Feature")return new i(r,c0(r.geometry));if("type"in r&&"coordinates"in r)return new i(r,c0(r))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return mR(t,this.geometries);if(t.geometryType()==="LineString")return pR(t,this.geometries);if(t.geometryType()==="Polygon")return gR(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},xc=class i{constructor(t){this.type=Pt,this.key=t}static parse(t,e){if(t.length!==2)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);let r=t[1];return r==null?e.error("Global state property must be defined."):typeof r!="string"?e.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new i(r)}evaluate(t){var e;let r=(e=t.globals)===null||e===void 0?void 0:e.globalState;return!r||Object.keys(r).length===0?null:lc(r,this.key)}eachChild(){}outputDefined(){return!1}},Cc={"==":kP,"!=":zP,">":UP,"<":jP,">=":qP,"<=":BP,array:zr,at:d0,boolean:zr,case:y0,coalesce:cf,collator:hf,format:v0,image:E0,in:m0,"index-of":p0,interpolate:Xn,"interpolate-hcl":Xn,"interpolate-lab":Xn,length:w0,let:of,literal:Da,match:g0,number:zr,"number-format":x0,object:zr,slice:_0,step:lf,string:zr,"to-boolean":Vs,"to-color":Vs,"to-number":Vs,"to-string":Vs,var:af,within:gc,distance:_c,"global-state":xc},Ur=class i{constructor(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){let r=t[0],n=i.definitions[r];if(!n)return e.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);let s=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter(([c])=>!Array.isArray(c)||c.length===t.length-1),l=null;for(let[c,h]of a){l=new sf(e.registry,pf,e.path,null,e.scope);let u=[],f=!1;for(let d=1;d<t.length;d++){let m=t[d],p=Array.isArray(c)?c[d-1]:c.type,g=l.parse(m,1+u.length,p);if(!g){f=!0;break}u.push(g)}if(!f){if(Array.isArray(c)&&c.length!==u.length){l.error(`Expected ${c.length} arguments, but found ${u.length} instead.`);continue}for(let d=0;d<u.length;d++){let m=Array.isArray(c)?c[d]:c.type,p=u[d];l.concat(d+1).checkSubtype(m,p.type)}if(l.errors.length===0)return new i(r,s,h,u)}}if(a.length===1)e.errors.push(...l.errors);else{let h=(a.length?a:o).map(([f])=>_R(f)).join(" | "),u=[];for(let f=1;f<t.length;f++){let d=e.parse(t[f],1+u.length);if(!d)return null;u.push(Se(d.type))}e.error(`Expected arguments of type ${h}, but found (${u.join(", ")}) instead.`)}return null}static register(t,e){i.definitions=e;for(let r in e)t[r]=i}};function _E(i,[t,e,r,n]){t=t.evaluate(i),e=e.evaluate(i),r=r.evaluate(i);let s=n?n.evaluate(i):1,o=NE(t,e,r,s);if(o)throw new _e(o);return new oe(t/255,e/255,r/255,s,!1)}function xE(i,t){return i in t}function h0(i,t){let e=t[i];return typeof e>"u"?null:e}function yR(i,t,e,r){for(;e<=r;){let n=e+r>>1;if(t[n]===i)return!0;t[n]>i?r=n-1:e=n+1}return!1}function _o(i){return{type:i}}Ur.register(Cc,{error:[cP,[zt],(i,[t])=>{throw new _e(t.evaluate(i))}],typeof:[zt,[Pt],(i,[t])=>Se(qe(t.evaluate(i)))],"to-rgba":[hr(Y,4),[pn],(i,[t])=>{let[e,r,n,s]=t.evaluate(i).rgb;return[e*255,r*255,n*255,s]}],rgb:[pn,[Y,Y,Y],_E],rgba:[pn,[Y,Y,Y,Y],_E],has:{type:Lt,overloads:[[[zt],(i,[t])=>xE(t.evaluate(i),i.properties())],[[zt,vo],(i,[t,e])=>xE(t.evaluate(i),e.evaluate(i))]]},get:{type:Pt,overloads:[[[zt],(i,[t])=>h0(t.evaluate(i),i.properties())],[[zt,vo],(i,[t,e])=>h0(t.evaluate(i),e.evaluate(i))]]},"feature-state":[Pt,[zt],(i,[t])=>h0(t.evaluate(i),i.featureState||{})],properties:[vo,[],i=>i.properties()],"geometry-type":[zt,[],i=>i.geometryType()],id:[Pt,[],i=>i.id()],zoom:[Y,[],i=>i.globals.zoom],"heatmap-density":[Y,[],i=>i.globals.heatmapDensity||0],elevation:[Y,[],i=>i.globals.elevation||0],"line-progress":[Y,[],i=>i.globals.lineProgress||0],accumulated:[Pt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Y,_o(Y),(i,t)=>{let e=0;for(let r of t)e+=r.evaluate(i);return e}],"*":[Y,_o(Y),(i,t)=>{let e=1;for(let r of t)e*=r.evaluate(i);return e}],"-":{type:Y,overloads:[[[Y,Y],(i,[t,e])=>t.evaluate(i)-e.evaluate(i)],[[Y],(i,[t])=>-t.evaluate(i)]]},"/":[Y,[Y,Y],(i,[t,e])=>t.evaluate(i)/e.evaluate(i)],"%":[Y,[Y,Y],(i,[t,e])=>t.evaluate(i)%e.evaluate(i)],ln2:[Y,[],()=>Math.LN2],pi:[Y,[],()=>Math.PI],e:[Y,[],()=>Math.E],"^":[Y,[Y,Y],(i,[t,e])=>Math.pow(t.evaluate(i),e.evaluate(i))],sqrt:[Y,[Y],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Y,[Y],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Y,[Y],(i,[t])=>Math.log(t.evaluate(i))],log2:[Y,[Y],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Y,[Y],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Y,[Y],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Y,[Y],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Y,[Y],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Y,[Y],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Y,[Y],(i,[t])=>Math.atan(t.evaluate(i))],min:[Y,_o(Y),(i,t)=>Math.min(...t.map(e=>e.evaluate(i)))],max:[Y,_o(Y),(i,t)=>Math.max(...t.map(e=>e.evaluate(i)))],abs:[Y,[Y],(i,[t])=>Math.abs(t.evaluate(i))],round:[Y,[Y],(i,[t])=>{let e=t.evaluate(i);return e<0?-Math.round(-e):Math.round(e)}],floor:[Y,[Y],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Y,[Y],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Lt,[zt,Pt],(i,[t,e])=>i.properties()[t.value]===e.value],"filter-id-==":[Lt,[Pt],(i,[t])=>i.id()===t.value],"filter-type-==":[Lt,[zt],(i,[t])=>i.geometryType()===t.value],"filter-<":[Lt,[zt,Pt],(i,[t,e])=>{let r=i.properties()[t.value],n=e.value;return typeof r==typeof n&&r<n}],"filter-id-<":[Lt,[Pt],(i,[t])=>{let e=i.id(),r=t.value;return typeof e==typeof r&&e<r}],"filter->":[Lt,[zt,Pt],(i,[t,e])=>{let r=i.properties()[t.value],n=e.value;return typeof r==typeof n&&r>n}],"filter-id->":[Lt,[Pt],(i,[t])=>{let e=i.id(),r=t.value;return typeof e==typeof r&&e>r}],"filter-<=":[Lt,[zt,Pt],(i,[t,e])=>{let r=i.properties()[t.value],n=e.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[Lt,[Pt],(i,[t])=>{let e=i.id(),r=t.value;return typeof e==typeof r&&e<=r}],"filter->=":[Lt,[zt,Pt],(i,[t,e])=>{let r=i.properties()[t.value],n=e.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[Lt,[Pt],(i,[t])=>{let e=i.id(),r=t.value;return typeof e==typeof r&&e>=r}],"filter-has":[Lt,[Pt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Lt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Lt,[hr(zt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Lt,[hr(Pt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Lt,[zt,hr(Pt)],(i,[t,e])=>e.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Lt,[zt,hr(Pt)],(i,[t,e])=>yR(i.properties()[t.value],e.value,0,e.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(i,[t,e])=>t.evaluate(i)&&e.evaluate(i)],[_o(Lt),(i,t)=>{for(let e of t)if(!e.evaluate(i))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(i,[t,e])=>t.evaluate(i)||e.evaluate(i)],[_o(Lt),(i,t)=>{for(let e of t)if(e.evaluate(i))return!0;return!1}]]},"!":[Lt,[Lt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Lt,[zt],(i,[t])=>{let e=i.globals&&i.globals.isSupportedScript;return e?e(t.evaluate(i)):!0}],upcase:[zt,[zt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[zt,[zt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[zt,_o(Pt),(i,t)=>t.map(e=>cc(e.evaluate(i))).join("")],"resolved-locale":[zt,[Sf],(i,[t])=>t.evaluate(i).resolvedLocale()]});function _R(i){return Array.isArray(i)?`(${i.map(Se).join(", ")})`:`(${Se(i.type)}...)`}function pf(i){if(i instanceof af)return pf(i.boundExpression);if(i instanceof Ur&&i.name==="error")return!1;if(i instanceof hf)return!1;if(i instanceof gc)return!1;if(i instanceof _c)return!1;if(i instanceof xc)return!1;let t=i instanceof Vs||i instanceof zr,e=!0;return i.eachChild(r=>{t?e=e&&pf(r):e=e&&r instanceof Da}),e?Rf(i)&&If(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Rf(i){if(i instanceof Ur){if(i.name==="get"&&i.args.length===1)return!1;if(i.name==="feature-state")return!1;if(i.name==="has"&&i.args.length===1)return!1;if(i.name==="properties"||i.name==="geometry-type"||i.name==="id")return!1;if(/^filter-/.test(i.name))return!1}if(i instanceof gc||i instanceof _c)return!1;let t=!0;return i.eachChild(e=>{t&&!Rf(e)&&(t=!1)}),t}function vc(i){if(i instanceof Ur&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(e=>{t&&!vc(e)&&(t=!1)}),t}function If(i,t){if(i instanceof Ur&&t.indexOf(i.name)>=0)return!1;let e=!0;return i.eachChild(r=>{e&&!If(r,t)&&(e=!1)}),e}function P0(i){return{result:"success",value:i}}function La(i){return{result:"error",value:i}}function gf(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function XE(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function VE(i){return!!i.expression&&i.expression.interpolated}function Bt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Mc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&qe(i)===vo}var R0=class{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new nf,this._defaultValue=e?vR(e):null,this._enumValues=e&&e.type==="enum"?e.values:null}evaluateWithoutErrorHandling(t,e,r,n,s,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,r,n,s,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{let a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new _e(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}};function Af(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Cc}function G0(i,t){let e=new sf(Cc,pf,[],t?xR(t):void 0),r=e.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?P0(new R0(r,t)):La(e.errors)}var yf=class{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent=t!=="constant"&&!vc(e.expression),this.globalStateRefs=Lf(e.expression)}evaluateWithoutErrorHandling(t,e,r,n,s,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,s,o)}evaluate(t,e,r,n,s,o){return this._styleExpression.evaluate(t,e,r,n,s,o)}},_f=class{constructor(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent=t!=="camera"&&!vc(e.expression),this.globalStateRefs=Lf(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,r,n,s,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,s,o)}evaluate(t,e,r,n,s,o){return this._styleExpression.evaluate(t,e,r,n,s,o)}interpolationFactor(t,e,r){return this.interpolationType?Xn.interpolationFactor(this.interpolationType,t,e,r):0}};function k0(i,t){let e=G0(i,t);if(e.result==="error")return e;let r=e.value.expression,n=Rf(r);if(!n&&!gf(t))return La([new wr("","data expressions not supported")]);let s=If(r,["zoom"]);if(!s&&!XE(t))return La([new wr("","zoom expressions not supported")]);let o=ef(r);if(!o&&!s)return La([new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof wr)return La([o]);if(o instanceof Xn&&!VE(t))return La([new wr("",'"interpolate" expressions cannot be used with this property')]);if(!o)return P0(n?new yf("constant",e.value):new yf("source",e.value));let a=o instanceof Xn?o.interpolation:void 0;return P0(n?new _f("camera",e.value,o.labels,a):new _f("composite",e.value,o.labels,a))}function ef(i){let t=null;if(i instanceof of)t=ef(i.result);else if(i instanceof cf){for(let e of i.args)if(t=ef(e),t)break}else(i instanceof lf||i instanceof Xn)&&i.input instanceof Ur&&i.input.name==="zoom"&&(t=i);return t instanceof wr||i.eachChild(e=>{let r=ef(e);r instanceof wr?t=r:!t&&r?t=new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Lf(i,t=new Set){return i instanceof xc&&t.add(i.key),i.eachChild(e=>{Lf(e,t)}),t}function xR(i){let t={color:pn,string:zt,number:Y,enum:zt,boolean:Lt,formatted:bf,padding:Cf,numberArray:Mf,colorArray:hc,projectionDefinition:wf,resolvedImage:Sc,variableAnchorOffsetCollection:Tf};return i.type==="array"?hr(t[i.value]||Pt,i.length):t[i.type]}function vR(i){if(i.type==="color"&&Mc(i.default))return new oe(0,0,0,0);switch(i.type){case"color":return oe.parse(i.default)||null;case"padding":return Vn.parse(i.default)||null;case"numberArray":return Wn.parse(i.default)||null;case"colorArray":return jr.parse(i.default)||null;case"variableAnchorOffsetCollection":return Yn.parse(i.default)||null;case"projectionDefinition":return So.parse(i.default)||null;default:return i.default===void 0?null:i.default}}function z0(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!z0(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}var ER={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function WE(i){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};z0(i)||(i=xf(i));let t=G0(i,ER);if(t.result==="error")throw new Error(t.value.map(e=>`${e.key}: ${e.message}`).join(", "));{let e=YE(i);return{filter:(r,n,s)=>t.value.evaluate(r,n,{},s),needGeometry:e,getGlobalStateRefs:()=>Lf(t.value.expression)}}}function wR(i,t){return i<t?-1:i>t?1:0}function YE(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(YE(i[t]))return!0;return!1}function xf(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?u0(i[1],i[2],"=="):t==="!="?tf(u0(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?u0(i[1],i[2],t):t==="any"?SR(i.slice(1)):t==="all"?["all"].concat(i.slice(1).map(xf)):t==="none"?["all"].concat(i.slice(1).map(xf).map(tf)):t==="in"?vE(i[1],i.slice(2)):t==="!in"?tf(vE(i[1],i.slice(2))):t==="has"?EE(i[1]):t==="!has"?tf(EE(i[1])):!0}function u0(i,t,e){switch(i){case"$type":return[`filter-type-${e}`,t];case"$id":return[`filter-id-${e}`,t];default:return[`filter-${e}`,i,t]}}function SR(i){return["any"].concat(i.map(xf))}function vE(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",i,["literal",t.sort(wR)]]:["filter-in-small",i,["literal",t]]}}function EE(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function tf(i){return["!",i]}function Ec(i){return typeof i=="object"?["literal",i]:i}function $E(i,t){let e=i.stops;if(!e)return bR(i,t);let r=e&&typeof e[0][0]=="object",n=r||i.property!==void 0,s=r||!n;return e=e.map(o=>!n&&t.tokens&&typeof o[1]=="string"?[o[0],PR(o[1])]:[o[0],Ec(o[1])]),r?CR(i,t,e):s?TR(i,t,e):I0(i,t,e)}function bR(i,t){let e=["get",i.property];if(i.default===void 0)return t.type==="string"?["string",e]:e;if(t.type==="enum")return["match",e,Object.keys(t.values),e,i.default];{let r=[t.type==="color"?"to-color":t.type,e,Ec(i.default)];return t.type==="array"&&r.splice(1,0,t.value,t.length||null),r}}function j0(i){switch(i.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function CR(i,t,e){let r={},n={},s=[];for(let a=0;a<e.length;a++){let l=e[a],c=l[0].zoom;r[c]===void 0&&(r[c]={zoom:c,type:i.type,property:i.property,default:i.default},n[c]=[],s.push(c)),n[c].push([l[0].value,l[1]])}if(B0({},t)==="exponential"){let a=[j0(i),["linear"],["zoom"]];for(let l of s){let c=I0(r[l],t,n[l]);Fa(a,l,c,!1)}return a}else{let a=["step",["zoom"]];for(let l of s){let c=I0(r[l],t,n[l]);Fa(a,l,c,!0)}return U0(a),a}}function MR(i,t){if(i!==void 0)return i;if(t!==void 0)return t}function wE(i,t){let e=Ec(MR(i.default,t.default));return e===void 0&&t.type==="resolvedImage"?"":e}function I0(i,t,e){let r=B0(i,t),n=["get",i.property];if(r==="categorical"&&typeof e[0][0]=="boolean"){let s=["case"];for(let o of e)s.push(["==",n,o[0]],o[1]);return s.push(wE(i,t)),s}else if(r==="categorical"){let s=["match",n];for(let o of e)Fa(s,o[0],o[1],!1);return s.push(wE(i,t)),s}else if(r==="interval"){let s=["step",["number",n]];for(let o of e)Fa(s,o[0],o[1],!0);return U0(s),i.default===void 0?s:["case",["==",["typeof",n],"number"],s,Ec(i.default)]}else if(r==="exponential"){let s=i.base!==void 0?i.base:1,o=[j0(i),s===1?["linear"]:["exponential",s],["number",n]];for(let a of e)Fa(o,a[0],a[1],!1);return i.default===void 0?o:["case",["==",["typeof",n],"number"],o,Ec(i.default)]}else throw new Error(`Unknown property function type ${r}`)}function TR(i,t,e,r=["zoom"]){let n=B0(i,t),s,o=!1;if(n==="interval")s=["step",r],o=!0;else if(n==="exponential"){let a=i.base!==void 0?i.base:1;s=[j0(i),a===1?["linear"]:["exponential",a],r]}else throw new Error(`Unknown zoom function type "${n}"`);for(let a of e)Fa(s,a[0],a[1],o);return U0(s),s}function U0(i){i[0]==="step"&&i.length===3&&(i.push(0),i.push(i[3]))}function Fa(i,t,e,r){i.length>3&&t===i[i.length-2]||(r&&i.length===2||i.push(t),i.push(e))}function B0(i,t){return i.type?i.type:t.expression.interpolated?"exponential":"interval"}function PR(i){let t=["concat"],e=/{([^{}]+)}/g,r=0;for(let n=e.exec(i);n!==null;n=e.exec(i)){let s=i.slice(r,e.lastIndex-n[0].length);r=e.lastIndex,s.length>0&&t.push(s),t.push(["get",n[1]])}if(t.length===1)return i;if(r<i.length)t.push(i.slice(r));else if(t.length===2)return["to-string",t[1]];return t}function KE(i){let t=i.key,e=i.value;return e?[new B(t,e,"constants have been deprecated as of v8")]:[]}function Oe(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function bo(i){if(Array.isArray(i))return i.map(bo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let e in i)t[e]=bo(i[e]);return t}return Oe(i)}function Sr(i){let t=i.key,e=i.value,r=i.valueSpec||{},n=i.objectElementValidators||{},s=i.style,o=i.styleSpec,a=i.validateSpec,l=[],c=Bt(e);if(c!=="object")return[new B(t,e,`object expected, ${c} found`)];for(let h in e){let u=h.split(".")[0],f=lc(r,u)||r["*"],d;if(lc(n,u))d=n[u];else if(lc(r,u))d=a;else if(n["*"])d=n["*"];else if(r["*"])d=a;else{l.push(new B(t,e[h],`unknown property "${h}"`));continue}l=l.concat(d({key:(t&&`${t}.`)+h,value:e[h],valueSpec:f,style:s,styleSpec:o,object:e,objectKey:h,validateSpec:a},e))}for(let h in r)n[h]||r[h].required&&r[h].default===void 0&&e[h]===void 0&&l.push(new B(t,e,`missing required property "${h}"`));return l}function q0(i){let t=i.value,e=i.valueSpec,r=i.validateSpec,n=i.style,s=i.styleSpec,o=i.key,a=i.arrayElementValidator||r;if(Bt(t)!=="array")return[new B(o,t,`array expected, ${Bt(t)} found`)];if(e.length&&t.length!==e.length)return[new B(o,t,`array length ${e.length} expected, length ${t.length} found`)];if(e["min-length"]&&t.length<e["min-length"])return[new B(o,t,`array length at least ${e["min-length"]} expected, length ${t.length} found`)];let l={type:e.value,values:e.values};s.$version<7&&(l.function=e.function),Bt(e.value)==="object"&&(l=e.value);let c=[];for(let h=0;h<t.length;h++)c=c.concat(a({array:t,arrayIndex:h,value:t[h],valueSpec:l,validateSpec:i.validateSpec,style:n,styleSpec:s,key:`${o}[${h}]`}));return c}function Of(i){let t=i.key,e=i.value,r=i.valueSpec,n=Bt(e);return n==="number"&&e!==e&&(n="NaN"),n!=="number"?[new B(t,e,`number expected, ${n} found`)]:"minimum"in r&&e<r.minimum?[new B(t,e,`${e} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&e>r.maximum?[new B(t,e,`${e} is greater than the maximum value ${r.maximum}`)]:[]}function HE(i){let t=i.valueSpec,e=Oe(i.value.type),r,n={},s,o,a=e!=="categorical"&&i.value.property===void 0,l=!a,c=Bt(i.value.stops)==="array"&&Bt(i.value.stops[0])==="array"&&Bt(i.value.stops[0][0])==="object",h=Sr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:u,default:m}});return e==="identity"&&a&&h.push(new B(i.key,i.value,'missing required property "property"')),e!=="identity"&&!i.value.stops&&h.push(new B(i.key,i.value,'missing required property "stops"')),e==="exponential"&&i.valueSpec.expression&&!VE(i.valueSpec)&&h.push(new B(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(l&&!gf(i.valueSpec)?h.push(new B(i.key,i.value,"property functions not supported")):a&&!XE(i.valueSpec)&&h.push(new B(i.key,i.value,"zoom functions not supported"))),(e==="categorical"||c)&&i.value.property===void 0&&h.push(new B(i.key,i.value,'"property" property is required')),h;function u(p){if(e==="identity")return[new B(p.key,p.value,'identity function may not have a "stops" property')];let g=[],y=p.value;return g=g.concat(q0({key:p.key,value:y,valueSpec:p.valueSpec,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,arrayElementValidator:f})),Bt(y)==="array"&&y.length===0&&g.push(new B(p.key,y,"array must have at least one stop")),g}function f(p){let g=[],y=p.value,_=p.key;if(Bt(y)!=="array")return[new B(_,y,`array expected, ${Bt(y)} found`)];if(y.length!==2)return[new B(_,y,`array length 2 expected, length ${y.length} found`)];if(c){if(Bt(y[0])!=="object")return[new B(_,y,`object expected, ${Bt(y[0])} found`)];if(y[0].zoom===void 0)return[new B(_,y,"object stop key must have zoom")];if(y[0].value===void 0)return[new B(_,y,"object stop key must have value")];if(o&&o>Oe(y[0].zoom))return[new B(_,y[0].zoom,"stop zoom values must appear in ascending order")];Oe(y[0].zoom)!==o&&(o=Oe(y[0].zoom),s=void 0,n={}),g=g.concat(Sr({key:`${_}[0]`,value:y[0],valueSpec:{zoom:{}},validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{zoom:Of,value:d}}))}else g=g.concat(d({key:`${_}[0]`,value:y[0],validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec},y));return Af(bo(y[1]))?g.concat([new B(`${_}[1]`,y[1],"expressions are not allowed in function stops.")]):g.concat(p.validateSpec({key:`${_}[1]`,value:y[1],valueSpec:t,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec}))}function d(p,g){let y=Bt(p.value),_=Oe(p.value),x=p.value!==null?p.value:g;if(!r)r=y;else if(y!==r)return[new B(p.key,x,`${y} stop domain type must match previous stop domain type ${r}`)];if(y!=="number"&&y!=="string"&&y!=="boolean")return[new B(p.key,x,"stop domain value must be a number, string, or boolean")];if(y!=="number"&&e!=="categorical"){let v=`number expected, ${y} found`;return gf(t)&&e===void 0&&(v+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new B(p.key,x,v)]}return e==="categorical"&&y==="number"&&(!isFinite(_)||Math.floor(_)!==_)?[new B(p.key,x,`integer expected, found ${_}`)]:e!=="categorical"&&y==="number"&&s!==void 0&&_<s?[new B(p.key,x,"stop domain values must appear in ascending order")]:(s=_,e==="categorical"&&_ in n?[new B(p.key,x,"stop domain values must be unique")]:(n[_]=!0,[]))}function m(p){return p.validateSpec({key:p.key,value:p.value,valueSpec:t,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec})}}function Ga(i){let t=(i.expressionContext==="property"?k0:G0)(bo(i.value),i.valueSpec);if(t.result==="error")return t.value.map(r=>new B(`${i.key}${r.key}`,i.value,r.message));let e=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!e.outputDefined())return[new B(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!vc(e))return[new B(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!vc(e))return[new B(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!If(e,["zoom","feature-state"]))return[new B(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Rf(e))return[new B(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function RR(i){let t=i.value,e=i.key,r=Bt(t);return r!=="boolean"?[new B(e,t,`boolean expected, ${r} found`)]:[]}function A0(i){let t=i.key,e=i.value,r=Bt(e);return r!=="string"?[new B(t,e,`color expected, ${r} found`)]:oe.parse(String(e))?[]:[new B(t,e,`color expected, "${e}" found`)]}function wc(i){let t=i.key,e=i.value,r=i.valueSpec,n=[];return Array.isArray(r.values)?r.values.indexOf(Oe(e))===-1&&n.push(new B(t,e,`expected one of [${r.values.join(", ")}], ${JSON.stringify(e)} found`)):Object.keys(r.values).indexOf(Oe(e))===-1&&n.push(new B(t,e,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(e)} found`)),n}function X0(i){return z0(bo(i.value))?Ga(rf({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ZE(i)}function ZE(i){let t=i.value,e=i.key;if(Bt(t)!=="array")return[new B(e,t,`array expected, ${Bt(t)} found`)];let r=i.styleSpec,n,s=[];if(t.length<1)return[new B(e,t,"filter array must have at least 1 element")];switch(s=s.concat(wc({key:`${e}[0]`,value:t[0],valueSpec:r.filter_operator,style:i.style,styleSpec:i.styleSpec})),Oe(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Oe(t[1])==="$type"&&s.push(new B(e,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&s.push(new B(e,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n=Bt(t[1]),n!=="string"&&s.push(new B(`${e}[1]`,t[1],`string expected, ${n} found`)));for(let o=2;o<t.length;o++)n=Bt(t[o]),Oe(t[1])==="$type"?s=s.concat(wc({key:`${e}[${o}]`,value:t[o],valueSpec:r.geometry_type,style:i.style,styleSpec:i.styleSpec})):n!=="string"&&n!=="number"&&n!=="boolean"&&s.push(new B(`${e}[${o}]`,t[o],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let o=1;o<t.length;o++)s=s.concat(ZE({key:`${e}[${o}]`,value:t[o],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":n=Bt(t[1]),t.length!==2?s.push(new B(e,t,`filter array for "${t[0]}" operator must have 2 elements`)):n!=="string"&&s.push(new B(`${e}[1]`,t[1],`string expected, ${n} found`));break}return s}function JE(i,t){let e=i.key,r=i.validateSpec,n=i.style,s=i.styleSpec,o=i.value,a=i.objectKey,l=s[`${t}_${i.layerType}`];if(!l)return[];let c=a.match(/^(.*)-transition$/);if(t==="paint"&&c&&l[c[1]]&&l[c[1]].transition)return r({key:e,value:o,valueSpec:s.transition,style:n,styleSpec:s});let h=i.valueSpec||l[a];if(!h)return[new B(e,o,`unknown property "${a}"`)];let u;if(Bt(o)==="string"&&gf(h)&&!h.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new B(e,o,`"${a}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];let f=[];return i.layerType==="symbol"&&(a==="text-field"&&n&&!n.glyphs&&f.push(new B(e,o,'use of "text-field" requires a style "glyphs" property')),a==="text-font"&&Mc(bo(o))&&Oe(o.type)==="identity"&&f.push(new B(e,o,'"text-font" does not support identity functions'))),f.concat(r({key:i.key,value:o,valueSpec:h,style:n,styleSpec:s,expressionContext:"property",propertyType:t,propertyKey:a}))}function QE(i){return JE(i,"paint")}function tw(i){return JE(i,"layout")}function ew(i){let t=[],e=i.value,r=i.key,n=i.style,s=i.styleSpec;if(Bt(e)!=="object")return[new B(r,e,`object expected, ${Bt(e)} found`)];!e.type&&!e.ref&&t.push(new B(r,e,'either "type" or "ref" is required'));let o=Oe(e.type),a=Oe(e.ref);if(e.id){let l=Oe(e.id);for(let c=0;c<i.arrayIndex;c++){let h=n.layers[c];Oe(h.id)===l&&t.push(new B(r,e.id,`duplicate layer id "${e.id}", previously used at line ${h.id.__line__}`))}}if("ref"in e){["type","source","source-layer","filter","layout"].forEach(c=>{c in e&&t.push(new B(r,e[c],`"${c}" is prohibited for ref layers`))});let l;n.layers.forEach(c=>{Oe(c.id)===a&&(l=c)}),l?l.ref?t.push(new B(r,e.ref,"ref cannot reference another ref layer")):o=Oe(l.type):t.push(new B(r,e.ref,`ref layer "${a}" not found`))}else if(o!=="background")if(!e.source)t.push(new B(r,e,'missing required property "source"'));else{let l=n.sources&&n.sources[e.source],c=l&&Oe(l.type);l?c==="vector"&&o==="raster"?t.push(new B(r,e.source,`layer "${e.id}" requires a raster source`)):c!=="raster-dem"&&o==="hillshade"?t.push(new B(r,e.source,`layer "${e.id}" requires a raster-dem source`)):c!=="raster-dem"&&o==="color-relief"?t.push(new B(r,e.source,`layer "${e.id}" requires a raster-dem source`)):c==="raster"&&o!=="raster"?t.push(new B(r,e.source,`layer "${e.id}" requires a vector source`)):c==="vector"&&!e["source-layer"]?t.push(new B(r,e,`layer "${e.id}" must specify a "source-layer"`)):c==="raster-dem"&&o!=="hillshade"&&o!=="color-relief"?t.push(new B(r,e.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):o==="line"&&e.paint&&e.paint["line-gradient"]&&(c!=="geojson"||!l.lineMetrics)&&t.push(new B(r,e,`layer "${e.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new B(r,e.source,`source "${e.source}" not found`))}return t=t.concat(Sr({key:r,value:e,valueSpec:s.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*"(){return[]},type(){return i.validateSpec({key:`${r}.type`,value:e.type,valueSpec:s.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:e,objectKey:"type"})},filter:X0,layout(l){return Sr({layer:e,key:l.key,value:l.value,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*"(c){return tw(rf({layerType:o},c))}}})},paint(l){return Sr({layer:e,key:l.key,value:l.value,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*"(c){return QE(rf({layerType:o},c))}}})}}})),t}function Co(i){let t=i.value,e=i.key,r=Bt(t);return r!=="string"?[new B(e,t,`string expected, ${r} found`)]:[]}function IR(i){var t;let e=(t=i.sourceName)!==null&&t!==void 0?t:"",r=i.value,n=i.styleSpec,s=n.source_raster_dem,o=i.style,a=[],l=Bt(r);if(r===void 0)return a;if(l!=="object")return a.push(new B("source_raster_dem",r,`object expected, ${l} found`)),a;let h=Oe(r.encoding)==="custom",u=["redFactor","greenFactor","blueFactor","baseShift"],f=i.value.encoding?`"${i.value.encoding}"`:"Default";for(let d in r)!h&&u.includes(d)?a.push(new B(d,r[d],`In "${e}": "${d}" is only valid when "encoding" is set to "custom". ${f} encoding found`)):s[d]?a=a.concat(i.validateSpec({key:d,value:r[d],valueSpec:s[d],validateSpec:i.validateSpec,style:o,styleSpec:n})):a.push(new B(d,r[d],`unknown property "${d}"`));return a}var SE={promoteId:AR};function iw(i){let t=i.value,e=i.key,r=i.styleSpec,n=i.style,s=i.validateSpec;if(!t.type)return[new B(e,t,'"type" is required')];let o=Oe(t.type),a;switch(o){case"vector":case"raster":return a=Sr({key:e,value:t,valueSpec:r[`source_${o.replace("-","_")}`],style:i.style,styleSpec:r,objectElementValidators:SE,validateSpec:s}),a;case"raster-dem":return a=IR({sourceName:e,value:t,style:i.style,styleSpec:r,validateSpec:s}),a;case"geojson":if(a=Sr({key:e,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:s,objectElementValidators:SE}),t.cluster)for(let l in t.clusterProperties){let[c,h]=t.clusterProperties[l],u=typeof c=="string"?[c,["accumulated"],["get",l]]:c;a.push(...Ga({key:`${e}.${l}.map`,value:h,expressionContext:"cluster-map"})),a.push(...Ga({key:`${e}.${l}.reduce`,value:u,expressionContext:"cluster-reduce"}))}return a;case"video":return Sr({key:e,value:t,valueSpec:r.source_video,style:n,validateSpec:s,styleSpec:r});case"image":return Sr({key:e,value:t,valueSpec:r.source_image,style:n,validateSpec:s,styleSpec:r});case"canvas":return[new B(e,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wc({key:`${e}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function AR({key:i,value:t}){if(Bt(t)==="string")return Co({key:i,value:t});{let e=[];for(let r in t)e.push(...Co({key:`${i}.${r}`,value:t[r]}));return e}}function rw(i){let t=i.value,e=i.styleSpec,r=e.light,n=i.style,s=[],o=Bt(t);if(t===void 0)return s;if(o!=="object")return s=s.concat([new B("light",t,`object expected, ${o} found`)]),s;for(let a in t){let l=a.match(/^(.*)-transition$/);l&&r[l[1]]&&r[l[1]].transition?s=s.concat(i.validateSpec({key:a,value:t[a],valueSpec:e.transition,validateSpec:i.validateSpec,style:n,styleSpec:e})):r[a]?s=s.concat(i.validateSpec({key:a,value:t[a],valueSpec:r[a],validateSpec:i.validateSpec,style:n,styleSpec:e})):s=s.concat([new B(a,t[a],`unknown property "${a}"`)])}return s}function nw(i){let t=i.value,e=i.styleSpec,r=e.sky,n=i.style,s=Bt(t);if(t===void 0)return[];if(s!=="object")return[new B("sky",t,`object expected, ${s} found`)];let o=[];for(let a in t)r[a]?o=o.concat(i.validateSpec({key:a,value:t[a],valueSpec:r[a],style:n,styleSpec:e})):o=o.concat([new B(a,t[a],`unknown property "${a}"`)]);return o}function sw(i){let t=i.value,e=i.styleSpec,r=e.terrain,n=i.style,s=[],o=Bt(t);if(t===void 0)return s;if(o!=="object")return s=s.concat([new B("terrain",t,`object expected, ${o} found`)]),s;for(let a in t)r[a]?s=s.concat(i.validateSpec({key:a,value:t[a],valueSpec:r[a],validateSpec:i.validateSpec,style:n,styleSpec:e})):s=s.concat([new B(a,t[a],`unknown property "${a}"`)]);return s}function LR(i){return Co(i).length===0?[]:Ga(i)}function OR(i){return Co(i).length===0?[]:Ga(i)}function FR(i){let t=i.key,e=i.value;if(Bt(e)==="array"){if(e.length<1||e.length>4)return[new B(t,e,`padding requires 1 to 4 values; ${e.length} values found`)];let n={type:"number"},s=[];for(let o=0;o<e.length;o++)s=s.concat(i.validateSpec({key:`${t}[${o}]`,value:e[o],validateSpec:i.validateSpec,valueSpec:n}));return s}else return Of({key:t,value:e,valueSpec:{}})}function NR(i){let t=i.key,e=i.value;if(Bt(e)==="array"){let n={type:"number"};if(e.length<1)return[new B(t,e,"array length at least 1 expected, length 0 found")];let s=[];for(let o=0;o<e.length;o++)s=s.concat(i.validateSpec({key:`${t}[${o}]`,value:e[o],validateSpec:i.validateSpec,valueSpec:n}));return s}else return Of({key:t,value:e,valueSpec:{}})}function DR(i){let t=i.key,e=i.value;if(Bt(e)==="array"){if(e.length<1)return[new B(t,e,"array length at least 1 expected, length 0 found")];let n=[];for(let s=0;s<e.length;s++)n=n.concat(A0({key:`${t}[${s}]`,value:e[s]}));return n}else return A0({key:t,value:e})}function GR(i){let t=i.key,e=i.value,r=Bt(e),n=i.styleSpec;if(r!=="array"||e.length<1||e.length%2!==0)return[new B(t,e,"variableAnchorOffsetCollection requires a non-empty array of even length")];let s=[];for(let o=0;o<e.length;o+=2)s=s.concat(wc({key:`${t}[${o}]`,value:e[o],valueSpec:n.layout_symbol["text-anchor"]})),s=s.concat(q0({key:`${t}[${o+1}]`,value:e[o+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:n}));return s}function ow(i){let t=[],e=i.value,r=i.key;if(Array.isArray(e)){let n=[],s=[];for(let o in e){e[o].id&&n.includes(e[o].id)&&t.push(new B(r,e,`all the sprites' ids must be unique, but ${e[o].id} is duplicated`)),n.push(e[o].id),e[o].url&&s.includes(e[o].url)&&t.push(new B(r,e,`all the sprites' URLs must be unique, but ${e[o].url} is duplicated`)),s.push(e[o].url);let a={id:{type:"string",required:!0},url:{type:"string",required:!0}};t=t.concat(Sr({key:`${r}[${o}]`,value:e[o],valueSpec:a,validateSpec:i.validateSpec}))}return t}else return Co({key:r,value:e})}function kR(i){let t=i.value,e=i.styleSpec,r=e.projection,n=i.style,s=Bt(t);if(t===void 0)return[];if(s!=="object")return[new B("projection",t,`object expected, ${s} found`)];let o=[];for(let a in t)r[a]?o=o.concat(i.validateSpec({key:a,value:t[a],valueSpec:r[a],style:n,styleSpec:e})):o=o.concat([new B(a,t[a],`unknown property "${a}"`)]);return o}function zR(i){let t=i.key,e=i.value;e=e instanceof String?e.valueOf():e;let r=Bt(e);return r==="array"&&!UR(e)&&!jR(e)?[new B(t,e,`projection expected, invalid array ${JSON.stringify(e)} found`)]:["array","string"].includes(r)?[]:[new B(t,e,`projection expected, invalid type "${r}" found`)]}function jR(i){return!!["interpolate","step","literal"].includes(i[0])}function UR(i){return Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"}function BR(i){return!!i&&i.constructor===Object}function aw(i){return BR(i.value)?[]:[new B(i.key,i.value,`object expected, ${Bt(i.value)} found`)]}var bE={"*"(){return[]},array:q0,boolean:RR,number:Of,color:A0,constants:KE,enum:wc,filter:X0,function:HE,layer:ew,object:Sr,source:iw,light:rw,sky:nw,terrain:sw,projection:kR,projectionDefinition:zR,string:Co,formatted:LR,resolvedImage:OR,padding:FR,numberArray:NR,colorArray:DR,variableAnchorOffsetCollection:GR,sprite:ow,state:aw};function vf(i){let t=i.value,e=i.valueSpec,r=i.styleSpec;return i.validateSpec=vf,e.expression&&Mc(Oe(t))?HE(i):e.expression&&Af(bo(t))?Ga(i):e.type&&bE[e.type]?bE[e.type](i):Sr(rf({},i,{valueSpec:e.type?r[e.type]:e}))}function lw(i){let t=i.value,e=i.key,r=Co(i);return r.length||(t.indexOf("{fontstack}")===-1&&r.push(new B(e,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&r.push(new B(e,t,'"glyphs" url must include a "{range}" token'))),r}function Br(i,t=CE){let e=[];return e=e.concat(vf({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:vf,objectElementValidators:{glyphs:lw,"*"(){return[]}}})),i.constants&&(e=e.concat(KE({key:"constants",value:i.constants}))),cw(e)}Br.source=Xr(qr(iw));Br.sprite=Xr(qr(ow));Br.glyphs=Xr(qr(lw));Br.light=Xr(qr(rw));Br.sky=Xr(qr(nw));Br.terrain=Xr(qr(sw));Br.state=Xr(qr(aw));Br.layer=Xr(qr(ew));Br.filter=Xr(qr(X0));Br.paintProperty=Xr(qr(QE));Br.layoutProperty=Xr(qr(tw));function qr(i){return function(t){return i(Bo(Ir({},t),{validateSpec:vf}))}}function cw(i){return[].concat(i).sort((t,e)=>t.line-e.line)}function Xr(i){return function(...t){return cw(i.apply(this,t))}}var hw=CE;var uw={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},Tc=" ",fw=/(italic|oblique)$/i,dw={};function Pc(i,t,e){var r=dw[i];if(!r){Array.isArray(i)||(i=[i]);for(var n=400,s="normal",o=[],a,l,c=0,h=i.length;c<h;++c){var u=i[c],f=u.split(" "),d=f[f.length-1].toLowerCase();d=="normal"||d=="italic"||d=="oblique"?(s=l?s:d,l=!0,f.pop(),d=f[f.length-1].toLowerCase()):fw.test(d)&&(d=d.replace(fw,""),s=l?s:f[f.length-1].replace(d,""),l=!0);for(var m in uw){var p=f.length>1?f[f.length-2].toLowerCase():"";if(d==m||d==m.replace("-","")||p+"-"+d==m){n=a?n:uw[m],f.pop(),p&&m.startsWith(p)&&f.pop();break}}!a&&typeof d=="number"&&(n=d,a=!0);var g=f.join(Tc).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");g.indexOf(Tc)!==-1&&(g='"'+g+'"'),o.push(g)}r=dw[i]=[s,n,o]}return r[0]+Tc+r[1]+Tc+t+"px"+(e?"/"+e:"")+Tc+r[2]}var V0=class i extends Ie{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let e=t;this.setGeometry(e)}else{let e=t;this.setProperties(e)}}clone(){let t=new i(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let e=this.getGeometry();e&&t.setGeometry(e.clone());let r=this.getStyle();return r&&t.setStyle(r),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Tt(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=dt(t,$.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?qR(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function qR(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(Et(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}var yn=V0;function Ff(i,t,e,r){let n=[],s=ge();for(let o=0,a=e.length;o<a;++o){let l=e[o];s=Wo(i,t,l[0],r),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return n}function Mo(i,t,e,r,n,s,o){let a,l,c=(e-t)/r;if(c===1)a=t;else if(c===2)a=t,l=n;else if(c!==0){let h=i[t],u=i[t+1],f=0,d=[0];for(let g=t+r;g<e;g+=r){let y=i[g],_=i[g+1];f+=Math.sqrt((y-h)*(y-h)+(_-u)*(_-u)),d.push(f),h=y,u=_}let m=n*f,p=_1(d,m);p<0?(l=(m-d[-p-2])/(d[-p-1]-d[-p-2]),a=t+(-p-2)*r):a=t+p*r}o=o>1?o:2,s=s||new Array(o);for(let h=0;h<o;++h)s[h]=a===void 0?NaN:l===void 0?i[a+h]:si(i[a+h],i[a+r+h],l);return s}function Nf(i,t,e,r,n,s){if(e==t)return null;let o;if(n<i[t+r-1])return s?(o=i.slice(t,t+r),o[r-1]=n,o):null;if(i[e-1]<n)return s?(o=i.slice(e-r,e),o[r-1]=n,o):null;if(n==i[t+r-1])return i.slice(t,t+r);let a=t/r,l=e/r;for(;a<l;){let f=a+l>>1;n<i[(f+1)*r-1]?l=f:a=f+1}let c=i[a*r-1];if(n==c)return i.slice((a-1)*r,(a-1)*r+r);let h=i[(a+1)*r-1],u=(n-c)/(h-c);o=[];for(let f=0;f<r-1;++f)o.push(si(i[(a-1)*r+f],i[a*r+f],u));return o.push(n),o}function mw(i,t,e,r,n,s,o){if(o)return Nf(i,t,e[e.length-1],r,n,s);let a;if(n<i[r-1])return s?(a=i.slice(0,r),a[r-1]=n,a):null;if(i[i.length-1]<n)return s?(a=i.slice(i.length-r),a[r-1]=n,a):null;for(let l=0,c=e.length;l<c;++l){let h=e[l];if(t!=h){if(n<i[t+r-1])return null;if(n<=i[h-1])return Nf(i,t,h,r,n,!1);t=h}}return null}var Y0=class i extends Bh{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Tt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){let t=this.geometries_;for(let e=0,r=t.length;e<r;++e)this.changeEventsKeys_.push(dt(t[e],$.CHANGE,this.changed,this))}clone(){let t=new i(W0(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,r,n){if(n<Ni(this.getExtent(),t,e))return n;let s=this.geometries_;for(let o=0,a=s.length;o<a;++o)n=s[o].closestPointXY(t,e,r,n);return n}containsXY(t,e){let r=this.geometries_;for(let n=0,s=r.length;n<s;++n)if(r[n].containsXY(t,e))return!0;return!1}computeExtent(t){In(t);let e=this.geometries_;for(let r=0,n=e.length;r<n;++r)Yo(t,e[r].getExtent());return t}getGeometries(){return W0(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[],e=this.geometries_;for(let r=0,n=e.length;r<n;++r)e[r].getType()===this.getType()?t=t.concat(e[r].getGeometriesArrayRecursive()):t.push(e[r]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;let e=[],r=this.geometries_,n=!1;for(let s=0,o=r.length;s<o;++s){let a=r[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(n=!0)}return n?new i(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){let e=this.geometries_;for(let r=0,n=e.length;r<n;++r)if(e[r].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){let r=this.geometries_;for(let n=0,s=r.length;n<s;++n)r[n].rotate(t,e);this.changed()}scale(t,e,r){r||(r=re(this.getExtent()));let n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].scale(t,e,r);this.changed()}setGeometries(t){this.setGeometriesArray(W0(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){let e=this.geometries_;for(let r=0,n=e.length;r<n;++r)e[r].applyTransform(t);this.changed()}translate(t,e){let r=this.geometries_;for(let n=0,s=r.length;n<s;++n)r[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function W0(i){return i.map(t=>t.clone())}var Vr=Y0;var $0=class i extends Ui{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Gt(this.flatCoordinates,t),this.changed()}clone(){let t=new i(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,n){return n<Ni(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Sl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Cl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,n))}forEachSegment(t){return Wh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Nf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return vr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ba(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){let e=[];return e.length=co(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new i(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Al(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=lo(this.flatCoordinates,0,t,this.stride),this.changed()}},$i=$0;var K0=class i extends Ui{constructor(t,e,r){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&r)this.setFlatCoordinates(e,t),this.ends_=r;else{let n=t,s=[],o=[];for(let l=0,c=n.length;l<c;++l){let h=n[l];Gt(s,h.getFlatCoordinates()),o.push(s.length)}let a=n.length===0?this.getLayout():n[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(t){Gt(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new i(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,n){return n<Ni(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(bl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ml(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,n))}getCoordinateAtM(t,e,r){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,r=r!==void 0?r:!1,mw(this.flatCoordinates,0,this.ends_,this.stride,t,e,r))}getCoordinates(){return Ms(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new $i(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){let t=this.flatCoordinates,e=this.ends_,r=this.layout,n=[],s=0;for(let o=0,a=e.length;o<a;++o){let l=e[o],c=new $i(t.slice(s,l),r);n.push(c),s=l}return n}getLength(){let t=this.ends_,e=0,r=0;for(let n=0,s=t.length;n<s;++n)r+=ba(this.flatCoordinates,e,t[n],this.stride),e=t[n];return r}getFlatMidpoints(){let t=[],e=this.flatCoordinates,r=0,n=this.ends_,s=this.stride;for(let o=0,a=n.length;o<a;++o){let l=n[o],c=Mo(e,r,l,s,.5);Gt(t,c),r=l}return t}getSimplifiedGeometryInternal(t){let e=[],r=[];return e.length=Xh(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,r),new i(e,"XY",r)}getType(){return"MultiLineString"}intersectsExtent(t){return wx(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let r=Cs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}},$s=K0;var H0=class i extends Ui{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Gt(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){let t=new i(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,n){if(n<Ni(this.getExtent(),t,e))return n;let s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){let c=Ar(t,e,s[a],s[a+1]);if(c<n){n=c;for(let h=0;h<o;++h)r[h]=s[a+h];r.length=o}}return n}getCoordinates(){return vr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){let e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new oi(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){let t=this.flatCoordinates,e=this.layout,r=this.stride,n=[];for(let s=0,o=t.length;s<o;s+=r){let a=new oi(t.slice(s,s+r),e);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(t){let e=this.flatCoordinates,r=this.stride;for(let n=0,s=e.length;n<s;n+=r){let o=e[n],a=e[n+1];if(gl(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=lo(this.flatCoordinates,0,t,this.stride),this.changed()}},Kn=H0;var Z0=class i extends Ui{constructor(t,e,r){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!r&&!Array.isArray(t[0])){let n=t,s=[],o=[];for(let a=0,l=n.length;a<l;++a){let c=n[a],h=s.length,u=c.getEnds();for(let f=0,d=u.length;f<d;++f)u[f]+=h;Gt(s,c.getFlatCoordinates()),o.push(u)}e=n.length===0?this.getLayout():n[0].getLayout(),t=s,r=o}e!==void 0&&r?(this.setFlatCoordinates(e,t),this.endss_=r):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{let r=this.flatCoordinates.length;Gt(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let n=0,s=e.length;n<s;++n)e[n]+=r}this.endss_.push(e),this.changed()}clone(){let t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();let r=new i(this.flatCoordinates.slice(),this.layout,e);return r.applyProperties(this),r}closestPointXY(t,e,r,n){return n<Ni(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gx(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yx(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,r,n))}containsXY(t,e){return Ex(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return mx(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ol(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Tl(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let t=Ff(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Vh(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Kn(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;Yh(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ol(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let e=[],r=[];return e.length=xx(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,r),new i(e,"XY",r)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{let s=this.endss_[t-1];e=s[s.length-1]}let r=this.endss_[t].slice(),n=r[r.length-1];if(e!==0)for(let s=0,o=r.length;s<o;++s)r[s]-=e;return new or(this.flatCoordinates.slice(e,n),this.layout,r)}getPolygons(){let t=this.layout,e=this.flatCoordinates,r=this.endss_,n=[],s=0;for(let o=0,a=r.length;o<a;++o){let l=r[o].slice(),c=l[l.length-1];if(s!==0)for(let u=0,f=l.length;u<f;++u)l[u]-=s;let h=new or(e.slice(s,c),t,l);n.push(h),s=c}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return Sx(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);let r=qh(this.flatCoordinates,0,t,this.stride,this.endss_);if(r.length===0)this.flatCoordinates.length=0;else{let n=r[r.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}},To=Z0;var pw=we(),Rc=class i{constructor(t,e,r,n,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r||null,this.properties_=s,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Vo(this.flatCoordinates_):Wo(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=re(this.getExtent());this.flatInteriorPoints_=Il(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=$h(this.flatCoordinates_,this.ends_),e=Ff(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Vh(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Mo(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,e=0,r=this.ends_;for(let n=0,s=r.length;n<s;++n){let o=r[n],a=Mo(t,e,o,2,.5);Gt(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Z(t);let e=t.getExtent(),r=t.getWorldExtent();if(e&&r){let n=Ft(r)/Ft(e);$e(pw,r[0],r[3],n,-n,0,0,0),ji(this.flatCoordinates_,0,this.flatCoordinates_.length,2,pw,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new i(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=ph((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);let r=this.simplifiedGeometry_.getFlatCoordinates(),n;switch(this.type_){case"LineString":r.length=co(r,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,r,0),n=[r.length];break;case"MultiLineString":n=[],r.length=Xh(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,r,0,n);break;case"Polygon":n=[],r.length=Pl(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),r,0,n);break;default:}return n&&(this.simplifiedGeometry_=new i(this.type_,r,n,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};Rc.prototype.getFlatCoordinates=Rc.prototype.getOrientedFlatCoordinates;var yi=Rc;function gw(i,t,e){let r=[],n=i(0),s=i(1),o=t(n),a=t(s),l=[s,n],c=[a,o],h=[1,0],u={},f=1e5,d,m,p,g,y,_;for(;--f>0&&h.length>0;)p=h.pop(),n=l.pop(),o=c.pop(),_=p.toString(),_ in u||(r.push(o[0],o[1]),u[_]=!0),g=h.pop(),s=l.pop(),a=c.pop(),y=(p+g)/2,d=i(y),m=t(d),wh(m[0],m[1],o[0],o[1],a[0],a[1])<e?(r.push(a[0],a[1]),_=g.toString(),u[_]=!0):(h.push(g,y,y,p),c.push(a,m,m,o),l.push(s,d,d,n));return r}function yw(i,t,e,r,n){let s=Z("EPSG:4326");return gw(function(o){return[i,t+(e-t)*o]},wi(s,r),n)}function _w(i,t,e,r,n){let s=Z("EPSG:4326");return gw(function(o){return[t+(e-t)*o,i]},wi(s,r),n)}function xw(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");let t=i.inversePixelTransform[0],e=i.inversePixelTransform[1],r=Math.sqrt(t*t+e*e),n=i.frameState,s=ia(i.inversePixelTransform.slice(),n.coordinateToPixelTransform),o=yo(n.viewState.resolution,r),a,l=sr();return l&&(a=zi(l,n.viewState.projection)),new Uu(i.context,r,n.extent,s,n.viewState.rotation,o,a)}function cW(i,t){return ne(i.inversePixelTransform,t.slice(0))}function vw(i,t){return[[-1/0,-1/0,1/0,1/0]]}function Ew(i,t){return[i]}var J0=class{constructor(t){this.rbush_=new ma(t),this.items_={}}insert(t,e){let r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[H(e)]=r}load(t,e){let r=new Array(e.length);for(let n=0,s=e.length;n<s;n++){let o=t[n],a=e[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};r[n]=l,this.items_[H(a)]=l}this.rbush_.load(r)}remove(t){let e=H(t),r=this.items_[e];return delete this.items_[e],this.rbush_.remove(r)!==null}update(t,e){let r=this.items_[H(e)],n=[r.minX,r.minY,r.maxX,r.maxY];ze(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){let e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let r;for(let n=0,s=t.length;n<s;n++)if(r=e(t[n]),r)return r;return r}isEmpty(){return vi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){let e=this.rbush_.toJSON();return ir(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(let e in t.items_)this.items_[e]=t.items_[e]}},Q0=J0;var ur={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};var _n=class extends Re{constructor(t,e,r){super(t),this.feature=e,this.features=r}},ty=class extends kr{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Pn,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Et(this.format_,"`format` must be set when `url` is set"),this.loader_=Kg(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:vw;let e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Q0:null,this.loadedExtentsRtree_=new Q0,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,n;Array.isArray(t.features)?n=t.features:t.features&&(r=t.features,n=r.getArray()),!e&&r===void 0&&(r=new pe(n)),n!==void 0&&this.addFeaturesInternal(n),r!==void 0&&this.bindFeaturesCollection_(r)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){let e=H(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);let r=t.getGeometry();if(r){let n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new _n(ur.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof yi||(this.featureChangeKeys_[t]=[dt(e,$.CHANGE,this.handleFeatureChange_,this),dt(e,er.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let r=!0;if(e.getId()!==void 0){let n=String(e.getId());if(!(n in this.idIndex_))this.idIndex_[n]=e;else if(e instanceof yi){let s=this.idIndex_[n];s instanceof yi?Array.isArray(s)?s.push(e):this.idIndex_[n]=[s,e]:r=!1}else r=!1}return r&&(Et(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),r}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){let e=[],r=[],n=[];for(let s=0,o=t.length;s<o;s++){let a=t[s],l=H(a);this.addToIndex_(l,a)&&r.push(a)}for(let s=0,o=r.length;s<o;s++){let a=r[s],l=H(a);this.setupChangeEvents_(l,a);let c=a.getGeometry();if(c){let h=c.getExtent();e.push(h),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(ur.ADDFEATURE))for(let s=0,o=r.length;s<o;s++)this.dispatchEvent(new _n(ur.ADDFEATURE,r[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(ur.ADDFEATURE,function(r){e||(e=!0,t.push(r.feature),e=!1)}),this.addEventListener(ur.REMOVEFEATURE,function(r){e||(e=!0,t.remove(r.feature),e=!1)}),t.addEventListener(ei.ADD,r=>{e||(e=!0,this.addFeature(r.element),e=!1)}),t.addEventListener(ei.REMOVE,r=>{e||(e=!0,this.removeFeature(r.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(let r in this.featureChangeKeys_)this.featureChangeKeys_[r].forEach(Tt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(r=>{this.removeFeatureInternal(r)});for(let r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let e=new _n(ur.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){let r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,function(n){let s=n.getGeometry();if(s instanceof yi||s.intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(r){let n=r.getGeometry();if(n instanceof yi||n.intersectsExtent(t)){let s=e(r);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),vi(this.nullGeometryFeatures_)||Gt(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){let e=[];return this.forEachFeatureAtCoordinateDirect(t,function(r){e.push(r)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);let n=Ph(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){let r=t[0],n=t[1],s=null,o=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0];return e=e||Mn,this.featuresRtree_.forEachInExtent(l,function(c){if(e(c)){let h=c.getGeometry(),u=a;if(a=h instanceof yi?0:h.closestPointXY(r,n,o,a),a<u){s=c;let f=Math.sqrt(a);l[0]=r-f,l[1]=n-f,l[2]=r+f,l[3]=n+f}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){let e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){let e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){let e=t.target,r=H(e),n=e.getGeometry();if(!n)r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[r]=e);else{let o=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}let s=e.getId();if(s!==void 0){let o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[r]=e;this.changed(),this.dispatchEvent(new _n(ur.CHANGEFEATURE,e))}hasFeature(t){let e=t.getId();return e!==void 0?e in this.idIndex_:H(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&vi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,r){let n=this.loadedExtentsRtree_,s=this.strategy_(t,e,r);for(let o=0,a=s.length;o<a;++o){let l=s[o];n.forEachInExtent(l,function(h){return Ce(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new _n(ur.FEATURESLOADSTART)),this.loader_.call(this,l,e,r,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new _n(ur.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new _n(ur.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){let e=this.loadedExtentsRtree_,r=e.forEachInExtent(t,function(n){if(ze(n.extent,t))return n});r&&e.remove(r)}removeFeatures(t){let e=!1;for(let r=0,n=t.length;r<n;++r)e=this.removeFeatureInternal(t[r])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){let e=H(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(Tt),delete this.featureChangeKeys_[e];let n=t.getId();if(n!==void 0){let s=n.toString(),o=this.idIndex_[s];o===t?delete this.idIndex_[s]:Array.isArray(o)&&(o.splice(o.indexOf(t),1),o.length===1&&(this.idIndex_[s]=o[0]))}return delete this.uidIndex_[e],this.hasListener(ur.REMOVEFEATURE)&&this.dispatchEvent(new _n(ur.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(let e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Et(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Kg(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}},ni=ty;var XR=new Be({color:"rgba(0,0,0,0.2)"}),VR=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600],ey=class extends dn{constructor(t){t=t||{};let e=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},t);delete e.maxLines,delete e.strokeStyle,delete e.targetSize,delete e.showLabels,delete e.lonLabelFormatter,delete e.latLabelFormatter,delete e.lonLabelPosition,delete e.latLabelPosition,delete e.lonLabelStyle,delete e.latLabelStyle,delete e.intervals,super(e),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=t.targetSize!==void 0?t.targetSize:100,this.maxLines_=t.maxLines!==void 0?t.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=t.strokeStyle!==void 0?t.strokeStyle:XR,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,t.showLabels&&(this.lonLabelFormatter_=t.lonLabelFormatter==null?hm.bind(this,"EW"):t.lonLabelFormatter,this.latLabelFormatter_=t.latLabelFormatter==null?hm.bind(this,"NS"):t.latLabelFormatter,this.lonLabelPosition_=t.lonLabelPosition==null?0:t.lonLabelPosition,this.latLabelPosition_=t.latLabelPosition==null?1:t.latLabelPosition,this.lonLabelStyleBase_=new ce({text:t.lonLabelStyle!==void 0?t.lonLabelStyle.clone():new cr({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Le({color:"rgba(0,0,0,1)"}),stroke:new Be({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=r=>{let n=r.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(n),this.lonLabelStyleBase_},this.latLabelStyleBase_=new ce({text:t.latLabelStyle!==void 0?t.latLabelStyle.clone():new cr({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Le({color:"rgba(0,0,0,1)"}),stroke:new Be({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=r=>{let n=r.get("graticule_label");return this.latLabelStyleBase_.getText().setText(n),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Ke.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=t.intervals!==void 0?t.intervals:VR,this.setSource(new ni({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new pe,overlaps:!1,useSpatialIndex:!1,wrapX:t.wrapX})),this.featurePool_=[],this.lineStyle_=new ce({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(t,e){let r=t.slice();return this.projection_&&this.getSource().getWrapX()&&_l(r,this.projection_),this.loadedExtent_&&(I1(this.loadedExtent_,r,e)?r=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[r]}loaderFunction(t,e,r){this.loadedExtent_=t;let n=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=je(s,t);if(this.renderedExtent_&&ze(this.renderedExtent_,o)&&this.renderedResolution_===e||(this.renderedExtent_=o,this.renderedResolution_=e,Di(o)))return;let a=re(o),l=e*e/4;(!this.projection_||!fi(this.projection_,r))&&this.updateProjectionInfo_(r),this.createGraticule_(o,a,e,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let u;for(;h>this.featurePool_.length;)u=new yn,this.featurePool_.push(u);let f=n.getFeaturesCollection();f.clear();let d=0,m,p;for(m=0,p=this.meridians_.length;m<p;++m)u=this.featurePool_[d++],u.setGeometry(this.meridians_[m]),u.setStyle(this.lineStyle_),f.push(u);for(m=0,p=this.parallels_.length;m<p;++m)u=this.featurePool_[d++],u.setGeometry(this.parallels_[m]),u.setStyle(this.lineStyle_),f.push(u)}addMeridian_(t,e,r,n,s,o){let a=this.getMeridian_(t,e,r,n,o);if(kt(a.getExtent(),s)){if(this.meridiansLabels_){let l=this.lonLabelFormatter_(t);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new oi([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(t,e,r,n,s,o){let a=this.getParallel_(t,e,r,n,o);if(kt(a.getExtent(),s)){if(this.parallelsLabels_){let l=this.latLabelFormatter_(t);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new oi([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(t){let e=t.frameState.viewState.rotation,r=t.frameState.viewState.resolution,n=t.frameState.size,s=t.frameState.extent,o=re(s),a=s;if(e){let m=n[0]*r,p=n[1]*r;a=[o[0]-m/2,o[1]-p/2,o[0]+m/2,o[1]+p/2]}let l=0,c=0,h=this.latLabelPosition_<.5,u=this.projection_.getExtent(),f=it(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ce(u,s)){l=Math.floor((s[0]-u[0])/f),c=Math.ceil((s[2]-u[2])/f);let m=Math.abs(e)>Math.PI/2;h=h!==m}let d=xw(t);for(let m=l;m<=c;++m){let p=this.meridians_.length+this.parallels_.length,g,y,_,x;if(this.meridiansLabels_)for(y=0,_=this.meridiansLabels_.length;y<_;++y){let v=this.meridians_[y];if(!e&&m===0)x=this.getMeridianPoint_(v,s,y);else{let E=v.clone();E.translate(m*f,0),E.rotate(-e,o),x=this.getMeridianPoint_(E,a,y),x.rotate(e,o)}g=this.featurePool_[p++],g.setGeometry(x),g.set("graticule_label",this.meridiansLabels_[y].text),d.drawFeature(g,this.lonLabelStyle_(g))}if(this.parallelsLabels_&&(m===l&&h||m===c&&!h))for(y=0,_=this.parallels_.length;y<_;++y){let v=this.parallels_[y];if(!e&&m===0)x=this.getParallelPoint_(v,s,y);else{let E=v.clone();E.translate(m*f,0),E.rotate(-e,o),x=this.getParallelPoint_(E,a,y),x.rotate(e,o)}g=this.featurePool_[p++],g.setGeometry(x),g.set("graticule_label",this.parallelsLabels_[y].text),d.drawFeature(g,this.latLabelStyle_(g))}}}createGraticule_(t,e,r,n){let s=this.getInterval_(r);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1,a=this.projection_.getExtent(),l=it(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ce(a,t)&&(it(t)>=l?(t[0]=a[0],t[2]=a[2]):o=!0);let c=[ht(e[0],this.minX_,this.maxX_),ht(e[1],this.minY_,this.maxY_)],h=this.toLonLatTransform_(c);isNaN(h[1])&&(h[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=ht(h[0],this.minLon_,this.maxLon_),f=ht(h[1],this.minLat_,this.maxLat_),d=this.maxLines_,m,p,g,y,_=t;o||(_=[ht(t[0],this.minX_,this.maxX_),ht(t[1],this.minY_,this.maxY_),ht(t[2],this.minX_,this.maxX_),ht(t[3],this.minY_,this.maxY_)]);let x=no(_,this.toLonLatTransform_,void 0,8),v=x[3],E=x[2],b=x[1],S=x[0];if(o||(ke(_,this.bottomLeft_)&&(S=this.minLon_,b=this.minLat_),ke(_,this.bottomRight_)&&(E=this.maxLon_,b=this.minLat_),ke(_,this.topLeft_)&&(S=this.minLon_,v=this.maxLat_),ke(_,this.topRight_)&&(E=this.maxLon_,v=this.maxLat_),v=ht(v,f,this.maxLat_),E=ht(E,u,this.maxLon_),b=ht(b,this.minLat_,f),S=ht(S,this.minLon_,u)),u=Math.floor(u/s)*s,y=ht(u,this.minLon_,this.maxLon_),p=this.addMeridian_(y,b,v,n,t,0),m=0,o)for(;(y-=s)>=S&&m++<d;)p=this.addMeridian_(y,b,v,n,t,p);else for(;y!=this.minLon_&&m++<d;)y=Math.max(y-s,this.minLon_),p=this.addMeridian_(y,b,v,n,t,p);if(y=ht(u,this.minLon_,this.maxLon_),m=0,o)for(;(y+=s)<=E&&m++<d;)p=this.addMeridian_(y,b,v,n,t,p);else for(;y!=this.maxLon_&&m++<d;)y=Math.min(y+s,this.maxLon_),p=this.addMeridian_(y,b,v,n,t,p);for(this.meridians_.length=p,this.meridiansLabels_&&(this.meridiansLabels_.length=p),f=Math.floor(f/s)*s,g=ht(f,this.minLat_,this.maxLat_),p=this.addParallel_(g,S,E,n,t,0),m=0;g!=this.minLat_&&m++<d;)g=Math.max(g-s,this.minLat_),p=this.addParallel_(g,S,E,n,t,p);for(g=ht(f,this.minLat_,this.maxLat_),m=0;g!=this.maxLat_&&m++<d;)g=Math.min(g+s,this.maxLat_),p=this.addParallel_(g,S,E,n,t,p);this.parallels_.length=p,this.parallelsLabels_&&(this.parallelsLabels_.length=p)}getInterval_(t){let e=this.projectionCenterLonLat_[0],r=this.projectionCenterLonLat_[1],n=-1,s=Math.pow(this.targetSize_*t,2),o=[],a=[];for(let l=0,c=this.intervals_.length;l<c;++l){let h=ht(this.intervals_[l]/2,0,90),u=ht(r,-90+h,90-h);if(o[0]=e-h,o[1]=u-h,a[0]=e+h,a[1]=u+h,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;n=this.intervals_[l]}return n}getMeridian_(t,e,r,n,s){let o=yw(t,e,r,this.projection_,n),a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new $i(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(t,e,r){let n=t.getFlatCoordinates(),s=1,o=n.length-1;n[s]>n[o]&&(s=o,o=1);let a=Math.max(e[1],n[s]),l=Math.min(e[3],n[o]),c=ht(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,a,l),u=[n[s-1]+(n[o-1]-n[s-1])*(c-n[s])/(n[o]-n[s]),c],f=this.meridiansLabels_[r].geom;return f.setCoordinates(u),f}getMeridians(){return this.meridians_}getParallel_(t,e,r,n,s){let o=_w(t,e,r,this.projection_,n),a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new $i(o,"XY"),a}getParallelPoint_(t,e,r){let n=t.getFlatCoordinates(),s=0,o=n.length-2;n[s]>n[o]&&(s=o,o=0);let a=Math.max(e[0],n[s]),l=Math.min(e[2],n[o]),c=ht(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,a,l),h=n[s+1]+(n[o+1]-n[s+1])*(c-n[s])/(n[o]-n[s]),u=[c,h],f=this.parallelsLabels_[r].geom;return f.setCoordinates(u),f}getParallels(){return this.parallels_}updateProjectionInfo_(t){let e=Z("EPSG:4326"),r=t.getWorldExtent();this.maxLat_=r[3],this.maxLon_=r[2],this.minLat_=r[1],this.minLon_=r[0];let n=wi(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=n;else{let o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,c){c=c||2;let h=n(a,l,c);for(let u=0,f=h.length;u<f;u+=c)h[u]<o&&(h[u]+=360);return h}}this.fromLonLatTransform_=wi(e,t);let s=no([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(re(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t}},WR=ey;var iy=class extends Os{constructor(t,e,r,n,s){let o=s!==void 0?K.IDLE:K.LOADED;super(t,e,r,o),this.loader_=s!==void 0?s:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=K.ERROR):this.state=K.LOADED,this.changed()}load(){this.state==K.IDLE&&(this.state=K.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}},Df=iy;var Sw="https://api.mapbox.com";function ry(i){let t="mapbox://";return i.indexOf(t)!==0?"":i.slice(t.length)}function bw(i,t,e){if(typeof i=="string")return[{id:"default",url:ww(i,t,e)}];for(let r of i)r.url=ww(r.url,t,e);return i}function ww(i,t,e){let r=ry(i);if(!r)return decodeURI(new URL(i,e).href);let n="sprites/";if(r.indexOf(n)!==0)throw new Error(`unexpected sprites url: ${i}`);let s=r.slice(n.length);return`${Sw}/styles/v1/${s}/sprite?access_token=${t}`}function Gf(i,t){let e=ry(i);if(!e)return decodeURI(new URL(i,location.href).href);let r="styles/";if(e.indexOf(r)!==0)throw new Error(`unexpected style url: ${i}`);let n=e.slice(r.length);return`${Sw}/styles/v1/${n}?&access_token=${t}`}var YR=["a","b","c","d"];function ja(i,t,e,r){let n=new URL(i,r||location.href),s=ry(i);if(!s)return t?(n.searchParams.has(e)||n.searchParams.set(e,t),[decodeURI(n.href)]):[decodeURI(n.href)];if(s==="mapbox.satellite"){let o=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${t}`]}return YR.map(o=>`https://${o}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${t}`)}var Po=Object.freeze({}),Cw={},Mw={},$R=0;function ny(i){return i.id||(i.id=$R++),i.id}function sy(i,t){return ny(i)+"."+H(t)}function oy(i){let t=Cw[i.id];return t||(t={},Cw[ny(i)]=t),t}function ay(i){let t=Mw[i.id];return t||(t={},Mw[ny(i)]=t),t}function kf(i){return i*Math.PI/180}var Ba=function(){let i=[];for(let t=78271.51696402048;i.length<=24;t/=2)i.push(t);return i}();function qa(i,t){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(i,t);let e=document.createElement("canvas");return e.width=i,e.height=t,e}function zf(i,t){let e=0,r=t.length;for(;e<r;++e)if(t[e]<i&&e+1<r){let s=t[e]/t[e+1];return e+Math.log(t[e]/i)/Math.log(s)}return r-1}function Pw(i,t){let e=Math.floor(i),r=Math.pow(2,i-e);return t[e]/r}var Ua={};function Ro(i,t,e={},r){if(t in Ua)return r&&(r.url=Ua[t][0].url),Ua[t][1];let n=e.transformRequest&&e.transformRequest(t,i)||t,s=function(l){return delete Ua[t],Promise.reject(new Error("Error fetching source "+t))},o=function(l){return delete Ua[t],l.ok?l.json():Promise.reject(new Error("Error fetching source "+t))},a=Zr(()=>n).then(l=>l instanceof Response?(r&&(r.url=l.url),o(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),r&&(r.url=l.url),fetch(l).then(o).catch(s))).catch(s);return Ua[t]=[n,a],a}function ly(i,t){if(typeof i=="string")if(i.trim().startsWith("{"))try{let e=JSON.parse(i);return Promise.resolve(e)}catch(e){return Promise.reject(e)}else return i=Gf(i,t.accessToken),Ro("Style",i,t);else return Promise.resolve(i)}var Tw={};function Rw(i,t,e={}){let r=[t,JSON.stringify(i)].toString(),n=Tw[r];if(!n||e.transformRequest){let s;e.transformRequest&&(s=(a,l)=>{let c=e.transformRequest&&e.transformRequest(l,"Tiles")||l;if(a instanceof sc)a.setLoader((h,u,f)=>{let d=function(m){m.arrayBuffer().then(p=>{let y=a.getFormat().readFeatures(p,{extent:h,featureProjection:f});a.setFeatures(y)})};Zr(()=>c).then(m=>{if(m instanceof Response)return d(m);fetch(m).then(d).catch(p=>a.setState(q.ERROR))}).catch(m=>a.setState(q.ERROR))});else{let h=a.getImage();Zr(()=>c).then(u=>{if(typeof u=="string"){h.src=u;return}let f=d=>d.blob().then(m=>{let p=URL.createObjectURL(m);h.addEventListener("load",()=>URL.revokeObjectURL(p)),h.addEventListener("error",()=>URL.revokeObjectURL(p)),h.src=p});if(u instanceof Response)return f(u);fetch(u).then(f).catch(d=>a.setState(q.ERROR))}).catch(u=>a.setState(q.ERROR))}});let o=i.url;if(o&&!i.tiles){let a=ja(o,e.accessToken,e.accessTokenParam||"access_token",t||location.href);if(o.startsWith("mapbox://"))n=Promise.resolve({tileJson:Object.assign({},i,{url:void 0,tiles:a}),tileLoadFunction:s});else{let l={};n=Ro("Source",a[0],e,l).then(function(c){return c.tiles=c.tiles.map(function(h){return c.scheme==="tms"&&(h=h.replace("{y}","{-y}")),ja(h,e.accessToken,e.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:c,tileLoadFunction:s})})}}else i.tiles?(i=Object.assign({},i,{tiles:i.tiles.map(function(a){return i.scheme==="tms"&&(a=a.replace("{y}","{-y}")),ja(a,e.accessToken,e.accessTokenParam||"access_token",t||location.href)[0]})}),n=Promise.resolve({tileJson:Object.assign({},i),tileLoadFunction:s})):n=Promise.reject(new Error("source has no `tiles` nor `url`"));Tw[r]=n}return n}function cy(i,t,e,r){let n=[2*e*t.pixelRatio+t.width,2*e*t.pixelRatio+t.height],s=qa(n[0],n[1]),o=s.getContext("2d");o.drawImage(i,t.x,t.y,t.width,t.height,e*t.pixelRatio,e*t.pixelRatio,t.width,t.height);let a=o.getImageData(0,0,n[0],n[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${r.r*255},${r.g*255},${r.b*255},${r.a})`;let l=a.data;for(let c=0,h=a.width;c<h;++c)for(let u=0,f=a.height;u<f;++u){let d=(u*h+c)*4;l[d+3]>0&&o.arc(c,u,e*t.pixelRatio,0,2*Math.PI)}return o.fill(),s}function KR(i,t,e){let r=Math.max(0,Math.min(1,(e-i)/(t-i)));return r*r*(3-2*r)}function hy(i,t,e){let r=qa(t.width,t.height),n=r.getContext("2d");n.drawImage(i,t.x,t.y,t.width,t.height,0,0,t.width,t.height);let s=n.getImageData(0,0,t.width,t.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let c=0,h=s.height;c<h;++c){let u=(c*l+a)*4,f=o[u+3]/255,d=.75,m=.1,p=KR(d-m,d+m,f);p>0?(o[u+0]=Math.round(255*e.r*p),o[u+1]=Math.round(255*e.g*p),o[u+2]=Math.round(255*e.b*p),o[u+3]=Math.round(255*p)):o[u+3]=0}return n.putImageData(s,0,0),r}var HR=Array(256).join("\u200A");function Uf(i,t){if(t>=.05){let e="",r=i.split(`
`),n=HR.slice(0,Math.round(t/.1));for(let s=0,o=r.length;s<o;++s)s>0&&(e+=`
`),e+=r[s].split("").join(n);return e}return i}var uy;function Aw(){return uy||(uy=qa(1,1).getContext("2d")),uy}function Io(i,t){return Aw().measureText(i).width+(i.length-1)*t}var Iw={};function Bf(i,t,e,r){if(i.indexOf(`
`)!==-1){let o=i.split(`
`),a=[];for(let l=0,c=o.length;l<c;++l)a.push(Bf(o[l],t,e,r));return a.join(`
`)}let n=e+","+t+","+i+","+r,s=Iw[n];if(!s){let o=i.split(" ");if(o.length>1){let a=Aw();a.font=t;let c=a.measureText("M").width*e,h="",u=[];for(let f=0,d=o.length;f<d;++f){let m=o[f],p=h+(h?" ":"")+m;Io(p,r)<=c?h=p:(h&&u.push(h),h=m)}h&&u.push(h);for(let f=0,d=u.length;f<d&&d>1;++f){let m=u[f];if(Io(m,r)<c*.35){let p=f>0?Io(u[f-1],r):1/0,g=f<d-1?Io(u[f+1],r):1/0;u.splice(f,1),d-=1,p<g?(u[f-1]+=" "+m,f-=1):u[f]=m+" "+u[f]}}for(let f=0,d=u.length-1;f<d;++f){let m=u[f],p=u[f+1];if(Io(m,r)>c*.7&&Io(p,r)<c*.6){let g=m.split(" "),y=g.pop();Io(y,r)<c*.2&&(u[f]=g.join(" "),u[f+1]=y+" "+p),d-=1}}s=u.join(`
`)}else s=i;s=Uf(s,r),Iw[n]=s}return s}var ZR=/font-family: ?([^;]*);/,JR=/("|')/g,jf;function QR(i){if(!jf){jf={};let t=document.styleSheets;for(let e=0,r=t.length;e<r;++e){let n=t[e];try{let s=n.rules||n.cssRules;if(s)for(let o=0,a=s.length;o<a;++o){let l=s[o];if(l.type==5){let c=l.cssText.match(ZR);jf[c[1].replace(JR,"")]=!0}}}catch{}}}return i in jf}var fy={};function Lw(i,t="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){let e=i.toString();if(e in fy)return fy[e];let r=[];for(let n=0,s=i.length;n<s;++n){i[n]=i[n].replace("Arial Unicode MS","Arial");let o=i[n],a=Pc(o,1);gu(a);let l=a.split(" ");r.push([l.slice(3).join(" ").replace(/"/g,""),l[1],l[0]])}for(let n=0,s=r.length;n<s;++n){let o=r[n],a=o[0];if(!QR(a)&&Er.get(`${o[2]}
${o[1]} 
${a}`)!==100){let l=t.replace("{font-family}",a.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",a.replace(/ /g,"+")).replace("{fontweight}",o[1]).replace("{-fontstyle}",o[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",o[2]);if(!document.querySelector('link[href="'+l+'"]')){let c=document.createElement("link");c.href=l,c.rel="stylesheet",document.head.appendChild(c)}}}return fy[e]=i,i}var tI={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},eI={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},iI=function(i,t){let e=k0(i,t);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return e.value},xn={zoom:0,distanceFromCenter:0};Ur.register(Cc,Bo(Ir({},Ur.definitions),{pitch:[{kind:"number"},[],i=>xn.pitch||90],"distance-from-center":[{kind:"number"},[],i=>xn.distanceFromCenter||0]}));var qf,dy;function ut(i,t,e,r,n,s){let o=i.id;n||(n={},console.warn("No functionCache provided to getValue()")),n[o]||(n[o]={});let a=n[o];if(!a[e]){let l=(i[t]||Po)[e],c=hw[`${t}_${i.type}`][e];l===void 0&&(l=c.default);let h=Af(l);if(!h&&Mc(l)&&(l=$E(l,c),h=!0),h){let u=iI(l,c);a[e]=u.evaluate.bind(u)}else c.type=="color"&&(l=oe.parse(l)),a[e]=function(){return l}}return a[e](xn,r,s)}function Ow(i,t,e,r){return ut(i,"layout",`${e}-allow-overlap`,t,r)?ut(i,"layout",`${e}-ignore-placement`,t,r)?"none":"obstacle":"declutter"}function rI(i,t,e,r){if(r||console.warn("No filterCache provided to evaluateFilter()"),!(i in r))try{r[i]=WE(t).filter}catch(n){console.warn("Filter will evaluate to false: "+n.message),r[i]=function(){return!1}}return r[i](xn,e)}var nI=!1;function Hn(i,t){if(i){if(!nI&&(i.a===0||t===0))return;let e=i.a;return t=t===void 0?1:t,e===0?"transparent":"rgba("+Math.round(i.r*255/e)+","+Math.round(i.g*255/e)+","+Math.round(i.b*255/e)+","+e*t+")"}return i}var sI=/\{[^{}}]*\}/g;function my(i,t){return i.replace(sI,function(e){return t[e.slice(1,-1)]||""})}function Fw(i,t){let e=i.split(":")[0];return e===i&&(e="default"),t[e]}var oI=!1;var Nw={};function py(i,t,e,r=Ba,n=void 0,s=void 0,o=void 0,a=void 0){if(typeof t=="string"&&(t=JSON.parse(t)),t.version!=8)throw new Error("glStyle version 8 required.");Nw[sy(t,i)]=Array.from(arguments);let l={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(let E in s){let b=s[E];Zr(()=>b).then(S=>to(null,null,function*(){let T;if(typeof Image<"u"){let P=new Image;if(typeof S=="string")P.crossOrigin="anonymous",P.src=S;else{let F;S instanceof Request?F=yield fetch(S):S instanceof Response&&(F=S);let k=yield F.blob();T=URL.createObjectURL(k),P.src=T}P.addEventListener("load",function F(){P.removeEventListener("load",F),l[E]={image:P,size:[P.width,P.height]},i.changed(),T&&URL.revokeObjectURL(T)}),P.addEventListener("error",function F(){URL.revokeObjectURL(T),P.removeEventListener("error",F)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){let P=self;P.postMessage({action:"loadImage",src:S}),P.addEventListener("message",function(k){k.data.action==="imageLoaded"&&k.data.src===S&&(l[E]={image:k.data.image,size:[k.data.image.width,k.data.image.height]})})}}))}let c=ME(t.layers),h={},u=[],f={},d={},m=oy(t),p=ay(t),g;for(let E=0,b=c.length;E<b;++E){let S=c[E],T=S.id;if(typeof e=="string"&&S.source==e||Array.isArray(e)&&e.indexOf(T)!==-1){let P=S["source-layer"];if(g){if(S.source!==g)throw new Error(`Layer "${T}" does not use source "${g}`)}else{g=S.source;let k=t.sources[g];if(!k)throw new Error(`Source "${g}" is not defined`);let z=k.type;if(z!=="vector"&&z!=="geojson")throw new Error(`Source "${g}" is not of type "vector" or "geojson", but "${z}"`)}let F=h[P];F||(F=[],h[P]=F),F.push({layer:S,index:E}),u.push(T)}}let y=new Be,_=new Le,x=[],v=function(E,b,S){let T=E.getProperties(),P=h[T.layer];if(!P)return;let F=r.indexOf(b);F==-1&&(F=zf(b,r)),xn.zoom=F,xn.distanceFromCenter=0;let k=E.getGeometry(),z=tI[k.getType()],W=i.get("map");if(W&&W instanceof Ds&&z===1){let R=W.getSize();if(R){let A=W.getView().getCenter(),L=re(k.getExtent());xn.distanceFromCenter=F1(A,L)/b/R[1]}}let G={id:E.getId(),properties:T,type:z},O=i.get("mapbox-featurestate")[E.getId()],X=-1,M;for(let R=0,A=P.length;R<A;++R){let L=P[R],w=L.layer,C=w.id;if(S!==void 0&&S!==C)continue;let V=w.layout||Po,ot=w.paint||Po;if(V.visibility==="none"||"minzoom"in w&&F<w.minzoom||"maxzoom"in w&&F>=w.maxzoom)continue;let xt=w.filter;if(!xt||rI(C,xt,G,p)){M=w;let J,lt,tt,st,ct,I,St=L.index;if(z==3&&(w.type=="fill"||w.type=="fill-extrusion"))if(lt=ut(w,"paint",w.type+"-opacity",G,m,O),w.type+"-pattern"in ot){let qt=ut(w,"paint",w.type+"-pattern",G,m,O);if(qt){let jt=typeof qt=="string"?my(qt,T):qt.toString(),Ut=Fw(jt,l);if(n&&n[jt]&&Ut){++X,I=x[X],(!I||!I.getFill()||I.getStroke()||I.getText())&&(I=new ce({fill:new Le}),x[X]=I),tt=I.getFill(),I.setZIndex(St);let Ot=jt+"."+lt,ft=d[Ot];if(!ft){let pt=n[jt],_t=qa(pt.width,pt.height),Wt=_t.getContext("2d");Wt.globalAlpha=lt,Wt.drawImage(Ut.image,pt.x,pt.y,pt.width,pt.height,0,0,pt.width,pt.height),ft=Wt.createPattern(_t,"repeat"),d[Ot]=ft}tt.setColor(ft)}}}else J=Hn(ut(w,"paint",w.type+"-color",G,m,O),lt),w.type+"-outline-color"in ot&&(ct=Hn(ut(w,"paint",w.type+"-outline-color",G,m,O),lt)),ct||(ct=J),(J||ct)&&(++X,I=x[X],(!I||J&&!I.getFill()||!J&&I.getFill()||ct&&!I.getStroke()||!ct&&I.getStroke()||I.getText())&&(I=new ce({fill:J?new Le:void 0,stroke:ct?new Be:void 0}),x[X]=I),J&&(tt=I.getFill(),tt.setColor(J)),ct&&(st=I.getStroke(),st.setColor(ct),st.setWidth(.5)),I.setZIndex(St));if(z!=1&&w.type=="line"){"line-pattern"in ot?J=void 0:J=Hn(ut(w,"paint","line-color",G,m,O),ut(w,"paint","line-opacity",G,m,O));let qt=ut(w,"paint","line-width",G,m,O);J&&qt>0&&(++X,I=x[X],(!I||!I.getStroke()||I.getFill()||I.getText())&&(I=new ce({stroke:new Be}),x[X]=I),st=I.getStroke(),st.setLineCap(ut(w,"layout","line-cap",G,m,O)),st.setLineJoin(ut(w,"layout","line-join",G,m,O)),st.setMiterLimit(ut(w,"layout","line-miter-limit",G,m,O)),st.setColor(J),st.setWidth(qt),st.setLineDash(ot["line-dasharray"]?ut(w,"paint","line-dasharray",G,m,O).map(function(jt){return jt*qt}):null),I.setZIndex(St))}let Rt=!1,et=null,Dt=0,It,Mt,Zt;if((z==1||z==2)&&"icon-image"in V){let qt=ut(w,"layout","icon-image",G,m,O);if(qt){It=typeof qt=="string"?my(qt,T):qt.toString();let jt,Ut=a?a(i,It):void 0,Ot=Fw(It,l);if(n&&n[It]&&Ot||Ut){let ft=ut(w,"layout","icon-rotation-alignment",G,m,O);if(z==2){let pt=E.getGeometry();if(pt.getFlatMidpoint||pt.getFlatMidpoints){let _t=pt.getExtent();if(Math.sqrt(Math.max(Math.pow((_t[2]-_t[0])/b,2),Math.pow((_t[3]-_t[1])/b,2)))>150){let Kt=pt.getType()==="MultiLineString"?pt.getFlatMidpoints():pt.getFlatMidpoint();if(dy||(qf=[NaN,NaN],dy=new yi("Point",qf,[],2,{},void 0)),jt=dy,qf[0]=Kt[0],qf[1]=Kt[1],ut(w,"layout","symbol-placement",G,m,O)==="line"&&ft==="map"){let Ve=pt.getStride(),ue=pt.getFlatCoordinates();for(let xe=0,te=ue.length-Ve;xe<te;xe+=Ve){let fe=ue[xe],ve=ue[xe+1],$t=ue[xe+Ve],We=ue[xe+Ve+1],ds=Math.min(fe,$t),Rr=Math.max(fe,$t),De=Kt[0],Ri=Kt[1],ti=(We-ve)*(De-fe)-($t-fe)*(Ri-ve);if(Math.abs(ti)<.001&&De<=Rr&&De>=ds){Dt=Math.atan2(ve-We,$t-fe);break}}}}}}if(z!==2||jt){let pt=ut(w,"layout","icon-size",G,m,O),_t=ot["icon-color"]!==void 0?ut(w,"paint","icon-color",G,m,O):null;if(!_t||_t.a!==0){let Wt=ut(w,"paint","icon-halo-color",G,m,O),Kt=ut(w,"paint","icon-halo-width",G,m,O),Qe=`${It}.${pt}.${Kt}.${Wt}`;if(_t!==null&&(Qe+=`.${_t}`),Mt=f[Qe],!Mt){let Ve=Ow(w,G,"icon",m),ue;"icon-offset"in V&&(ue=ut(w,"layout","icon-offset",G,m,O).slice(0),ue[0]*=pt,ue[1]*=-pt);let xe=_t?[_t.r*255,_t.g*255,_t.b*255,_t.a]:void 0;if(Ut){let te={color:xe,rotateWithView:ft==="map",displacement:ue,declutterMode:Ve,scale:pt};typeof Ut=="string"?te.src=Ut:(te.img=Ut,te.imgSize=[Ut.width,Ut.height]),Mt=new Dr(te)}else{let te=n[It],fe,ve,$t;if(Kt)te.sdf?(fe=cy(hy(Ot.image,te,_t||[0,0,0,1]),{x:0,y:0,width:te.width,height:te.height,pixelRatio:te.pixelRatio},Kt,Wt),xe=void 0):fe=cy(Ot.image,te,Kt,Wt);else{if(te.sdf&&!Ot.unSDFed){let We=hy(Ot.image,{x:0,y:0,width:Ot.size[0],height:Ot.size[1]},{r:1,g:1,b:1,a:1});Ot.image=We,Ot.unSDFed=!0}fe=Ot.image,ve=[te.width,te.height],$t=[te.x,te.y]}Mt=new Dr({color:xe,img:fe,imgSize:Ot.size,size:ve,offset:$t,rotateWithView:ft==="map",scale:pt/te.pixelRatio,displacement:ue,declutterMode:Ve})}f[Qe]=Mt}}Mt&&(++X,I=x[X],(!I||!I.getImage()||I.getFill()||I.getStroke())&&(I=new ce,x[X]=I),I.setGeometry(jt),Mt.setRotation(Dt+kf(ut(w,"layout","icon-rotate",G,m,O))),Mt.setOpacity(ut(w,"paint","icon-opacity",G,m,O)),Mt.setAnchor(eI[ut(w,"layout","icon-anchor",G,m,O)]),I.setImage(Mt),et=I.getText(),I.setText(void 0),I.setZIndex(St),Rt=!0,Zt=!1)}else Zt=!0}}}if(z==1&&w.type==="circle"){++X,I=x[X],(!I||!I.getImage()||I.getFill()||I.getStroke())&&(I=new ce,x[X]=I);let qt="circle-radius"in ot?ut(w,"paint","circle-radius",G,m,O):5,jt=Hn(ut(w,"paint","circle-stroke-color",G,m,O),ut(w,"paint","circle-stroke-opacity",G,m,O)),Ut=ut(w,"paint","circle-translate",G,m,O),Ot=Hn(ut(w,"paint","circle-color",G,m,O),ut(w,"paint","circle-opacity",G,m,O)),ft=ut(w,"paint","circle-stroke-width",G,m,O),pt=qt+"."+jt+"."+Ot+"."+ft+"."+Ut[0]+"."+Ut[1];Mt=f[pt],Mt||(Mt=new zn({radius:qt,displacement:[Ut[0],-Ut[1]],stroke:jt&&ft>0?new Be({width:ft,color:jt}):void 0,fill:Ot?new Le({color:Ot}):void 0,declutterMode:"none"}),f[pt]=Mt),I.setImage(Mt),et=I.getText(),I.setText(void 0),I.setGeometry(void 0),I.setZIndex(St),Rt=!0}let At,wt,vt,yt,bt,he;if("text-field"in V){yt=Math.round(ut(w,"layout","text-size",G,m,O));let qt=ut(w,"layout","text-font",G,m,O);vt=ut(w,"layout","text-line-height",G,m,O),wt=Pc(o?o(qt,t.metadata?t.metadata["ol:webfonts"]:void 0):qt,yt,vt),wt.includes("sans-serif")||(wt+=",sans-serif"),bt=ut(w,"layout","text-letter-spacing",G,m,O),he=ut(w,"layout","text-max-width",G,m,O);let jt=ut(w,"layout","text-field",G,m,O);typeof jt=="object"&&jt.sections?jt.sections.length===1?At=jt.toString():At=jt.sections.reduce((Ut,Ot,ft)=>{let pt=Ot.fontStack?Ot.fontStack.split(","):qt,_t=Pc(o?o(pt):pt,yt*(Ot.scale||1),vt),Wt=Ot.text;if(Wt===`
`)return Ut.push(`
`,""),Ut;if(z==2)return Ut.push(Uf(Wt,bt),_t),Ut;Wt=Bf(Wt,_t,he,bt).split(`
`);for(let Kt=0,Qe=Wt.length;Kt<Qe;++Kt)Kt>0&&Ut.push(`
`,""),Ut.push(Wt[Kt],_t);return Ut},[]):At=my(jt,T).trim(),lt=ut(w,"paint","text-opacity",G,m,O)}if(At&&lt&&!Zt){Rt||(++X,I=x[X],(!I||!I.getText()||I.getFill()||I.getStroke())&&(I=new ce,x[X]=I),I.setImage(void 0),I.setGeometry(void 0));let qt=Ow(w,G,"text",m);I.getText()||I.setText(et),et=I.getText(),(!et||"getDeclutterMode"in et&&et.getDeclutterMode()!==qt)&&(et=new cr({padding:[2,2,2,2],declutterMode:qt}),I.setText(et));let jt=ut(w,"layout","text-transform",G,m,O);jt=="uppercase"?At=Array.isArray(At)?At.map(($t,We)=>We%2?$t:$t.toUpperCase()):At.toUpperCase():jt=="lowercase"&&(At=Array.isArray(At)?At.map(($t,We)=>We%2?$t:$t.toLowerCase()):At.toLowerCase());let Ut=Array.isArray(At)?At:z==2?Uf(At,bt):Bf(At,wt,he,bt);if(et.setText(Ut),et.setFont(wt),et.setRotation(kf(ut(w,"layout","text-rotate",G,m,O))),typeof et.setKeepUpright=="function"){let $t=ut(w,"layout","text-keep-upright",G,m,O);et.setKeepUpright($t)}let Ot=ut(w,"layout","text-anchor",G,m,O),ft=Rt||z==1?"point":ut(w,"layout","symbol-placement",G,m,O),pt;if(ft==="line-center"?(et.setPlacement("line"),pt="center"):et.setPlacement(ft),ft==="line"&&typeof et.setRepeat=="function"){let $t=ut(w,"layout","symbol-spacing",G,m,O);et.setRepeat($t*2)}et.setOverflow(ft==="point");let _t=ut(w,"paint","text-halo-width",G,m,O),Wt=ut(w,"layout","text-offset",G,m,O),Kt=ut(w,"paint","text-translate",G,m,O),Qe=0,Ve=0;if(ft=="point"){pt="center",Ot.indexOf("left")!==-1?(pt="left",Ve=_t):Ot.indexOf("right")!==-1&&(pt="right",Ve=-_t);let $t=ut(w,"layout","text-rotation-alignment",G,m,O);et.setRotateWithView($t=="map")}else et.setMaxAngle(kf(ut(w,"layout","text-max-angle",G,m,O))*At.length/Ut.length),et.setRotateWithView(!1);et.setTextAlign(pt);let ue="middle";Ot.indexOf("bottom")==0?(ue="bottom",Qe=-_t-.5*(vt-1)*yt):Ot.indexOf("top")==0&&(ue="top",Qe=_t+.5*(vt-1)*yt),et.setTextBaseline(ue);let xe=ut(w,"layout","text-justify",G,m,O);et.setJustify(xe==="auto"?void 0:xe),et.setOffsetX(Wt[0]*yt+Ve+Kt[0]),et.setOffsetY(Wt[1]*yt+Qe+Kt[1]),_.setColor(Hn(ut(w,"paint","text-color",G,m,O),lt)),et.setFill(_);let te=Hn(ut(w,"paint","text-halo-color",G,m,O),lt);if(te&&_t>0){y.setColor(te),_t*=2;let $t=.5*yt;y.setWidth(_t<=$t?_t:$t),et.setStroke(y)}else et.setStroke(void 0);let fe=ut(w,"layout","text-padding",G,m,O),ve=et.getPadding();fe!==ve[0]&&(ve[0]=fe,ve[1]=fe,ve[2]=fe,ve[3]=fe),I.setZIndex(St)}}}if(X>-1)return x.length=X+1,oI&&("set"in E?E.set("mapbox-layer",M):E.getProperties()["mapbox-layer"]=M),x};return i.setStyle(v),i.set("mapbox-layers",u),i.set("mapbox-source",g),i.set("mapbox-featurestate",i.get("mapbox-featurestate")||{}),v}var gy=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=yn,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let r=e.dataProjection?Z(e.dataProjection):this.readProjection(t);e.extent&&r&&r.getUnits()==="tile-pixels"&&(r=Z(r),r.setWorldExtent(e.extent)),e={dataProjection:r,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return nt()}readFeature(t,e){return nt()}readFeatures(t,e){return nt()}readGeometry(t,e){return nt()}readProjection(t){return nt()}writeFeature(t,e){return nt()}writeFeatures(t,e){return nt()}writeGeometry(t,e){return nt()}},Xa=gy;function Zn(i,t,e){let r=e?Z(e.featureProjection):null,n=e?Z(e.dataProjection):null,s=i;if(r&&n&&!fi(r,n)){t&&(s=i.clone());let o=t?r:n,a=t?n:r;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(wi(o,a))}if(t&&e&&e.decimals!==void 0){let o=Math.pow(10,e.decimals),a=function(l){for(let c=0,h=l.length;c<h;++c)l[c]=Math.round(l[c]*o)/o;return l};s===i&&(s=i.clone()),s.applyTransform(a)}return s}var aI={Point:oi,LineString:$i,Polygon:or,MultiPoint:Kn,MultiLineString:$s,MultiPolygon:To};function lI(i,t,e){return Array.isArray(t[0])?(Yh(i,0,t,e)||(i=i.slice(),Ol(i,0,t,e)),i):(Ll(i,0,t,e)||(i=i.slice(),na(i,0,t,e)),i)}function yy(i,t){let e=i.geometry;if(!e)return[];if(Array.isArray(e))return e.map(s=>yy(Bo(Ir({},i),{geometry:s}))).flat();let r=e.type==="MultiPolygon"?"Polygon":e.type;if(r==="GeometryCollection"||r==="Circle")throw new Error("Unsupported geometry type: "+r);let n=e.layout.length;return Zn(new yi(r,r==="Polygon"?lI(e.flatCoordinates,e.ends,n):e.flatCoordinates,e.ends?.flat(),n,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function Xf(i,t){if(!i)return null;if(Array.isArray(i)){let r=i.map(n=>Xf(n,t));return new Vr(r)}let e=aI[i.type];return Zn(new e(i.flatCoordinates,i.layout||"XY",i.ends),!1,t)}var _y=class extends Xa{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Vf(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Vf(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return nt()}readFeaturesFromObject(t,e){return nt()}readGeometry(t,e){return this.readGeometryFromObject(Vf(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return nt()}readProjection(t){return this.readProjectionFromObject(Vf(t))}readProjectionFromObject(t){return nt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return nt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return nt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return nt()}};function Vf(i){if(typeof i=="string"){let t=JSON.parse(i);return t||null}return i!==null?i:null}var Dw=_y;var xy=class extends Dw{constructor(t){t=t||{},super(),this.dataProjection=Z(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Z(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let r=null;t.type==="Feature"?r=t:r={type:"Feature",geometry:t,properties:null};let n=Ey(r.geometry,e);if(this.featureClass===yi)return yy({geometry:n,id:r.id,properties:r.properties},e);let s=new yn;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&r.geometry_name&&s.setGeometryName(r.geometry_name),s.setGeometry(Xf(n,e)),"id"in r&&s.setId(r.id),r.properties&&s.setProperties(r.properties,!0),s}readFeaturesFromObject(t,e){let r=t,n=null;if(r.type==="FeatureCollection"){let s=t;n=[];let o=s.features;for(let a=0,l=o.length;a<l;++a){let c=this.readFeatureFromObject(o[a],e);c&&n.push(c)}}else n=[this.readFeatureFromObject(t,e)];return n.flat()}readGeometryFromObject(t,e){return cI(t,e)}readProjectionFromObject(t){let e=t.crs,r;if(e)if(e.type=="name")r=Z(e.properties.name);else if(e.type==="EPSG")r=Z("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else r=this.dataProjection;return r}writeFeatureObject(t,e){e=this.adaptOptions(e);let r={type:"Feature",geometry:null,properties:null},n=t.getId();if(n!==void 0&&(r.id=n),!t.hasProperties())return r;let s=t.getProperties(),o=t.getGeometry();return o&&(r.geometry=vy(o,e),delete s[t.getGeometryName()]),vi(s)||(r.properties=s),r}writeFeaturesObject(t,e){e=this.adaptOptions(e);let r=[];for(let n=0,s=t.length;n<s;++n)r.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:r}}writeGeometryObject(t,e){return vy(t,this.adaptOptions(e))}};function Ey(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=uI(i);break}case"LineString":{e=fI(i);break}case"Polygon":{e=gI(i);break}case"MultiPoint":{e=mI(i);break}case"MultiLineString":{e=dI(i);break}case"MultiPolygon":{e=pI(i);break}case"GeometryCollection":{e=hI(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function cI(i,t){let e=Ey(i,t);return Xf(e,t)}function hI(i,t){return i.geometries.map(function(r){return Ey(r,t)})}function uI(i){let t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:bs(t.length)}}function fI(i){let t=i.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:bs(t[0]?.length||2)}}function dI(i){let t=i.coordinates,e=t[0]?.[0]?.length||2,r=[],n=Cs(r,0,t,e);return{type:"MultiLineString",flatCoordinates:r,ends:n,layout:bs(e)}}function mI(i){let t=i.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:bs(t[0]?.length||2)}}function pI(i){let t=i.coordinates,e=[],r=t[0]?.[0]?.[0].length||2,n=qh(e,0,t,r);return{type:"MultiPolygon",flatCoordinates:e,ends:n,layout:bs(r)}}function gI(i){let t=i.coordinates,e=[],r=t[0]?.[0]?.length,n=Cs(e,0,t,r);return{type:"Polygon",flatCoordinates:e,ends:n,layout:bs(r)}}function vy(i,t){i=Zn(i,!0,t);let e=i.getType(),r;switch(e){case"Point":{r=wI(i,t);break}case"LineString":{r=_I(i,t);break}case"Polygon":{r=SI(i,t);break}case"MultiPoint":{r=vI(i,t);break}case"MultiLineString":{r=xI(i,t);break}case"MultiPolygon":{r=EI(i,t);break}case"GeometryCollection":{r=yI(i,t);break}case"Circle":{r={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return r}function yI(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(r){return vy(r,t)})}}function _I(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function xI(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function vI(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function EI(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function wI(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function SI(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}var Jn=xy;var Gw=23283064365386963e-26,bI=12,kw=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),wy=0,Wf=1,Ic=2,Yf=5,$f=class{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e,r=this.length){for(;this.pos<r;){let n=this.readVarint(),s=n>>3,o=this.pos;this.type=n&7,t(s,e,this),this.pos===o&&this.skip(n)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let e=this.buf,r,n;return n=e[this.pos++],r=n&127,n<128||(n=e[this.pos++],r|=(n&127)<<7,n<128)||(n=e[this.pos++],r|=(n&127)<<14,n<128)||(n=e[this.pos++],r|=(n&127)<<21,n<128)?r:(n=e[this.pos],r|=(n&15)<<28,CI(r,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=bI&&kw?kw.decode(this.buf.subarray(e,t)):kI(this.buf,e,t)}readBytes(){let t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(t=[],e){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readVarint(e));return t}readPackedSVarint(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===Ic?this.readVarint()+this.pos:this.pos+1}skip(t){let e=t&7;if(e===wy)for(;this.buf[this.pos++]>127;);else if(e===Ic)this.pos=this.readVarint()+this.pos;else if(e===Yf)this.pos+=4;else if(e===Wf)this.pos+=8;else throw new Error(`Unimplemented type: ${e}`)}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){let r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Gw),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Gw),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){MI(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;let e=this.pos;this.pos=zI(this.buf,t,this.pos);let r=this.pos-e;r>=128&&zw(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let e=t.length;this.writeVarint(e),this.realloc(e);for(let r=0;r<e;r++)this.buf[this.pos++]=t[r]}writeRawMessage(t,e){this.pos++;let r=this.pos;t(e,this);let n=this.pos-r;n>=128&&zw(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeMessage(t,e,r){this.writeTag(t,Ic),this.writeRawMessage(e,r)}writePackedVarint(t,e){e.length&&this.writeMessage(t,RI,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,II,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,OI,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,AI,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,LI,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,FI,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,NI,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,DI,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,GI,e)}writeBytesField(t,e){this.writeTag(t,Ic),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,Yf),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,Yf),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,Wf),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,Wf),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,wy),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,wy),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,Ic),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,Yf),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,Wf),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}};function CI(i,t,e){let r=e.buf,n,s;if(s=r[e.pos++],n=(s&112)>>4,s<128||(s=r[e.pos++],n|=(s&127)<<3,s<128)||(s=r[e.pos++],n|=(s&127)<<10,s<128)||(s=r[e.pos++],n|=(s&127)<<17,s<128)||(s=r[e.pos++],n|=(s&127)<<24,s<128)||(s=r[e.pos++],n|=(s&1)<<31,s<128))return Va(i,n,t);throw new Error("Expected varint not more than 10 bytes")}function Va(i,t,e){return e?t*4294967296+(i>>>0):(t>>>0)*4294967296+(i>>>0)}function MI(i,t){let e,r;if(i>=0?(e=i%4294967296|0,r=i/4294967296|0):(e=~(-i%4294967296),r=~(-i/4294967296),e^4294967295?e=e+1|0:(e=0,r=r+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),TI(e,r,t),PI(r,t)}function TI(i,t,e){e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos]=i&127}function PI(i,t){let e=(i&7)<<4;t.buf[t.pos++]|=e|((i>>>=3)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127)))))}function zw(i,t,e){let r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(r);for(let n=e.pos-1;n>=i;n--)e.buf[n+r]=e.buf[n]}function RI(i,t){for(let e=0;e<i.length;e++)t.writeVarint(i[e])}function II(i,t){for(let e=0;e<i.length;e++)t.writeSVarint(i[e])}function AI(i,t){for(let e=0;e<i.length;e++)t.writeFloat(i[e])}function LI(i,t){for(let e=0;e<i.length;e++)t.writeDouble(i[e])}function OI(i,t){for(let e=0;e<i.length;e++)t.writeBoolean(i[e])}function FI(i,t){for(let e=0;e<i.length;e++)t.writeFixed32(i[e])}function NI(i,t){for(let e=0;e<i.length;e++)t.writeSFixed32(i[e])}function DI(i,t){for(let e=0;e<i.length;e++)t.writeFixed64(i[e])}function GI(i,t){for(let e=0;e<i.length;e++)t.writeSFixed64(i[e])}function kI(i,t,e){let r="",n=t;for(;n<e;){let s=i[n],o=null,a=s>239?4:s>223?3:s>191?2:1;if(n+a>e)break;let l,c,h;a===1?s<128&&(o=s):a===2?(l=i[n+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=i[n+1],c=i[n+2],(l&192)===128&&(c&192)===128&&(o=(s&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=i[n+1],c=i[n+2],h=i[n+3],(l&192)===128&&(c&192)===128&&(h&192)===128&&(o=(s&15)<<18|(l&63)<<12|(c&63)<<6|h&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),n+=a}return r}function zI(i,t,e){for(let r=0,n,s;r<t.length;r++){if(n=t.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){i[e++]=239,i[e++]=191,i[e++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===t.length?(i[e++]=239,i[e++]=191,i[e++]=189):s=n;continue}else s&&(i[e++]=239,i[e++]=191,i[e++]=189,s=null);n<128?i[e++]=n:(n<2048?i[e++]=n>>6|192:(n<65536?i[e++]=n>>12|224:(i[e++]=n>>18|240,i[e++]=n>>12&63|128),i[e++]=n>>6&63|128),i[e++]=n&63|128)}return e}var Sy=class extends Xa{constructor(t){super(),t=t||{},this.dataProjection=new ki({code:"",units:"tile-pixels"}),this.featureClass=t.featureClass?t.featureClass:yi,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,r,n){t.pos=e.geometry;let s=t.readVarint()+t.pos,o=1,a=0,l=0,c=0,h=0,u=0;for(;t.pos<s;){if(!a){let f=t.readVarint();o=f&7,a=f>>3}if(a--,o===1||o===2)l+=t.readSVarint(),c+=t.readSVarint(),o===1&&h>u&&(n.push(h),u=h),r.push(l,c),h+=2;else if(o===7)h>u&&(r.push(r[u],r[u+1]),h+=2);else throw new Error("Invalid command found in the PBF")}h>u&&(n.push(h),u=h)}createFeature_(t,e,r){let n=e.type;if(n===0)return null;let s,o=e.properties,a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=e.id,o[this.layerName_]=e.layer.name;let l=[],c=[];this.readRawGeometry_(t,e,l,c);let h=XI(n,c.length);if(this.featureClass===yi)s=new this.featureClass(h,l,c,2,o,a),s.transform(r.dataProjection);else{let u;if(h=="Polygon"){let m=$h(l,c);u=m.length>1?new To(l,"XY",m):new or(l,"XY",c)}else u=h==="Point"?new oi(l,"XY"):h==="LineString"?new $i(l,"XY"):h==="MultiPoint"?new Kn(l,"XY"):h==="MultiLineString"?new $s(l,"XY",c):null;let f=this.featureClass;s=new f,this.geometryName_&&s.setGeometryName(this.geometryName_);let d=Zn(u,!1,r);s.setGeometry(d),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(t,e){let r=this.layers_;e=this.adaptOptions(e);let n=Z(e.dataProjection);n.setWorldExtent(e.extent),e.dataProjection=n;let s=new $f(t),o=s.readFields(jI,{}),a=[];for(let l in o){if(r&&!r.includes(l))continue;let c=o[l],h=c?[0,0,c.extent,c.extent]:null;n.setExtent(h);for(let u=0,f=c.length;u<f;++u){let d=qI(s,c,u),m=this.createFeature_(s,d,e);m!==null&&a.push(m)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}};function jI(i,t,e){if(i===3){let r={keys:[],values:[],features:[]},n=e.readVarint()+e.pos;e.readFields(UI,r,n),r.length=r.features.length,r.length&&(t[r.name]=r)}}function UI(i,t,e){if(i===15)t.version=e.readVarint();else if(i===1)t.name=e.readString();else if(i===5)t.extent=e.readVarint();else if(i===2)t.features.push(e.pos);else if(i===3)t.keys.push(e.readString());else if(i===4){let r=null,n=e.readVarint()+e.pos;for(;e.pos<n;)i=e.readVarint()>>3,r=i===1?e.readString():i===2?e.readFloat():i===3?e.readDouble():i===4?e.readVarint64():i===5?e.readVarint():i===6?e.readSVarint():i===7?e.readBoolean():null;t.values.push(r)}}function BI(i,t,e){if(i==1)t.id=e.readVarint();else if(i==2){let r=e.readVarint()+e.pos;for(;e.pos<r;){let n=t.layer.keys[e.readVarint()],s=t.layer.values[e.readVarint()];t.properties[n]=s}}else i==3?t.type=e.readVarint():i==4&&(t.geometry=e.pos)}function qI(i,t,e){i.pos=t.features[e];let r=i.readVarint()+i.pos,n={layer:t,type:0,properties:{}};return i.readFields(BI,n,r),n}function XI(i,t){let e;return i===1?e=t===1?"Point":"MultiPoint":i===2?e=t===1?"LineString":"MultiLineString":i===3&&(e="Polygon"),e}var Kf=Sy;function Ac(i){return Array.isArray(i)?Math.min(...i):i}var by=class extends Os{constructor(t,e,r,n,s,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let c=e.getExtent();c&&e.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);let h=c?je(r,c):r,u=re(h),f=Gs(t,e,u,n),d=.5,m=new Fu(t,e,h,l,f*d,n),p=m.calculateSourceExtent(),g=Di(p)?null:o(p,f,s),y=g?K.IDLE:K.EMPTY,_=g?g.getPixelRatio():1;super(r,n,_,y),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=m,this.targetResolution_=n,this.targetExtent_=r,this.sourceImage_=g,this.sourcePixelRatio_=_,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==K.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){let t=this.sourceImage_.getState();if(t==K.LOADED){let e=it(this.targetExtent_)/this.targetResolution_,r=Ft(this.targetExtent_)/this.targetResolution_;this.canvas_=Ou(e,r,this.sourcePixelRatio_,Ac(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==K.IDLE){this.state=K.LOADING,this.changed();let t=this.sourceImage_.getState();t==K.LOADED||t==K.ERROR?this.reproject_():(this.sourceListenerKey_=dt(this.sourceImage_,$.CHANGE,e=>{let r=this.sourceImage_.getState();(r==K.LOADED||r==K.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){Tt(this.sourceListenerKey_),this.sourceListenerKey_=null}},jw=by;var Cy={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"},My=class extends Re{constructor(t,e){super(t),this.image=e}},Ty=class extends kr{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){let e=this.getResolutions();if(e){let r=ms(e,t,0);t=e[r]}return t}getImage(t,e,r,n){let s=this.getProjection();if(!s||!n||fi(s,n))return s&&(n=s),this.getImageInternal(t,e,r,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&fi(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&ze(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new jw(s,n,t,e,r,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,r,n){if(this.loader){let s=Py(t,e,r,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&Ce(this.wantedExtent_,s)||Ce(this.image.getExtent(),s))&&(this.wantedResolution_&&Ac(this.wantedResolution_)===o||Ac(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Os(s,o,r,this.loader),this.image.addEventListener($.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){let e=t.target,r;switch(e.getState()){case K.LOADING:this.loading=!0,r=Cy.IMAGELOADSTART;break;case K.LOADED:this.loading=!1,r=Cy.IMAGELOADEND;break;case K.ERROR:this.loading=!1,r=Cy.IMAGELOADERROR;break;default:return}this.hasListener(r)&&this.dispatchEvent(new My(r,e))}};function Hf(i,t){i.getImage().src=t}function Py(i,t,e,r){let n=t/e,s=re(i),o=en(it(i)/n,4),a=en(Ft(i)/n,4),l=en((r-1)*o/2,4),c=o+2*l,h=en((r-1)*a/2,4),u=a+2*h;return An(s,n,0,[c,u])}var Wr=Ty;function Bw(i){return function(t){let e=t.buffers,r=t.meta,n=t.imageOps,s=t.width,o=t.height,a=e.length,l=e[0].byteLength;if(n){let f=new Array(a);for(let m=0;m<a;++m)f[m]=new ImageData(new Uint8ClampedArray(e[m]),s,o);return i(f,r).data.buffer}let c=new Uint8ClampedArray(l),h=new Array(a),u=new Array(a);for(let f=0;f<a;++f)h[f]=new Uint8ClampedArray(e[f]),u[f]=[0,0,0,0];for(let f=0;f<l;f+=4){for(let m=0;m<a;++m){let p=h[m];u[m][0]=p[f],u[m][1]=p[f+1],u[m][2]=p[f+2],u[m][3]=p[f+3]}let d=i(u,r);c[f]=d[0],c[f+1]=d[1],c[f+2]=d[2],c[f+3]=d[3]}return c.buffer}}function VI(i,t){let r=Object.keys(i.lib||{}).map(function(s){return"const "+s+" = "+i.lib[s].toString()+";"}).concat(["const __minion__ = ("+Bw.toString()+")(",i.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return n.addEventListener("message",t),n}function WI(i,t){let e=Bw(i.operation),r=!1;return{postMessage:function(n){setTimeout(function(){r||t({data:{buffer:e(n),meta:n.meta}})},0)},terminate:function(){r=!0}}}var Ry=class extends Hr{constructor(t){super(),this.imageOps_=!!t.imageOps;let e;t.threads===0?e=0:this.imageOps_?e=1:e=t.threads||1;let r=new Array(e);if(e)for(let n=0;n<e;++n)r[n]=VI(t,this.onWorkerMessage_.bind(this,n));else r[0]=WI(t,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=t.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(t,e,r){this.enqueue_({inputs:t,meta:e,callback:r}),this.dispatch_()}enqueue_(t){for(this.queue_.push(t);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;let t=this.queue_.shift();this.job_=t;let e=t.inputs[0].width,r=t.inputs[0].height,n=t.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:n,meta:t.meta,imageOps:this.imageOps_,width:e,height:r},n);return}let o=t.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){let c=l*a,h=[];for(let u=0,f=n.length;u<f;++u)h.push(n[u].slice(c,c+a));this.workers_[l].postMessage({buffers:h,meta:t.meta,imageOps:this.imageOps_,width:e,height:r},h)}}onWorkerMessage_(t,e){this.disposed||(this.dataLookup_[t]=e.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){let t=this.job_,e=this.workers_.length,r,n;if(e===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),n=this.dataLookup_[0].meta;else{let s=t.inputs[0].data.length;r=new Uint8ClampedArray(s),n=new Array(e);let o=4*Math.ceil(s/4/e);for(let a=0;a<e;++a){let l=this.dataLookup_[a].buffer,c=a*o;r.set(new Uint8ClampedArray(l),c),n[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},t.callback(null,new ImageData(r,t.inputs[0].width,t.inputs[0].height),n),this.dispatch_()}disposeInternal(){for(let t=0;t<this.workers_.length;++t)this.workers_[t].terminate();this.workers_.length=0}},Uw={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"},Zf=class extends Re{constructor(t,e,r){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=r}},Jf=class extends Wr{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=KI(t.sources);let e=this.changed.bind(this);for(let r=0,n=this.layers_.length;r<n;++r)this.layers_[r].addEventListener($.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new Eh(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:we(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:$I(this.layers_),pixelRatio:1,pixelToCoordinateTransform:we(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:H(this),renderTargets:{}},this.setAttributions(function(r){let n=[];for(let s=0,o=t.sources.length;s<o;++s){let a=t.sources[s],l=a instanceof kr?a:a.getSource();if(!l)continue;let c=l.getAttributions()?.(r);typeof c=="string"?n.push(c):c!==void 0&&n.push(...c)}return n}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new Ry({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,r){let n=Object.assign({},this.frameState_);n.viewState=Object.assign({},n.viewState);let s=re(t);n.size[0]=Math.ceil(it(t)/e),n.size[1]=Math.ceil(Ft(t)/e),n.extent=[s[0]-n.size[0]*e/2,s[1]-n.size[1]*e/2,s[0]+n.size[0]*e/2,s[1]+n.size[1]*e/2],n.time=Date.now();let o=n.viewState;return o.center=s,o.projection=r,o.resolution=e,n}allSourcesReady_(){let t=!0,e;for(let r=0,n=this.layers_.length;r<n;++r)if(e=this.layers_[r].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,r,n){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);let s=this.updateFrameState_(t,e,n);if(this.requestedFrameState_=s,this.renderedImageCanvas_){let o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(e!==o||!ze(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){let t=this.requestedFrameState_,e=this.layers_.length,r=new Array(e);for(let s=0;s<e;++s){t.layerIndex=s,t.renderTargets={};let o=YI(this.layers_[s],t);if(o)r[s]=o;else return}let n={};this.dispatchEvent(new Zf(Uw.BEFOREOPERATIONS,t,n)),this.processor_.process(r,n,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,r,n){if(e||!r)return;let s=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!ze(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{let l=Math.round(it(s)/o),c=Math.round(Ft(s)/o);a=Xt(l,c),this.renderedImageCanvas_=new Df(s,o,1,a.canvas)}a.putImageData(r,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Zf(Uw.AFTEROPERATIONS,t,n))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let r=0,n=this.layers_.length;r<n&&(e=this.layers_[r].getSource().getResolutions(t),!e);++r);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}};Jf.prototype.dispose;var Lo=null;function YI(i,t){let e=i.getRenderer();if(!e)throw new Error("Unsupported layer type: "+i);if(!e.prepareFrame(t))return null;let r=t.size[0],n=t.size[1];if(r===0||n===0)return null;let s=e.renderFrame(t,null),o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===n)return o.getContext("2d").getImageData(0,0,r,n)}if(!Lo)Lo=Xt(r,n,void 0,{willReadFrequently:!0});else{let a=Lo.canvas;a.width!==r||a.height!==n?Lo=Xt(r,n,void 0,{willReadFrequently:!0}):Lo.clearRect(0,0,r,n)}return Lo.drawImage(o,0,0,r,n),Lo.getImageData(0,0,r,n)}function $I(i){return i.map(function(t){return t.getLayerState()})}function KI(i){let t=i.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=HI(i[r]);return e}function HI(i){let t;return i instanceof kr?i instanceof Ia?t=new ks({source:i}):i instanceof Wr&&(t=new wa({source:i})):t=i,t}var Wa=Jf;function qw(i,t,e,r){let n=document.createElement("script"),s="olc_"+H(t);function o(){delete window[s],n.parentNode.removeChild(n)}n.async=!0,n.src=i+(i.includes("?")?"&":"?")+(r||"callback")+"="+s;let a=setTimeout(function(){o(),e&&e()},1e4);window[s]=function(l){clearTimeout(a),o(),t(l)},document.head.appendChild(n)}var Iy=class extends Hu{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ZI,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Iu,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!fi(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){let e=this.getProjection();if(this.tileGrid&&(!e||fi(e,t)))return this.tileGrid;let r=H(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=Xu(t)),this.tileGridForProjection[r]}createTile_(t,e,r,n,s,o){let a=[t,e,r],l=this.getTileCoordForTileUrlFunction(a,s),c=l?this.tileUrlFunction(l,n,s):void 0,h=new this.tileClass(a,c!==void 0?q.IDLE:q.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=o,h.addEventListener($.CHANGE,this.handleTileChange.bind(this)),h}getTile(t,e,r,n,s){let o=this.getProjection();if(!o||!s||fi(o,s))return this.getTileInternal(t,e,r,n,o||s);let a=[t,e,r],l=this.getKey(),c=this.getTileGridForProjection(o),h=this.getTileGridForProjection(s),u=this.getTileCoordForTileUrlFunction(a,s),f=new Nu(o,c,s,h,a,u,this.getTilePixelRatio(n),this.getGutter(),(d,m,p,g)=>this.getTileInternal(d,m,p,g,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=l,f}getTileInternal(t,e,r,n,s){let o=this.getKey();return this.createTile_(t,e,r,n,s,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){let r=Z(t);if(r){let n=H(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}};function ZI(i,t){i.getImage().src=t}var vn=Iy;var Ay=class extends vn{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:Z("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)qw(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{let e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){let e=t.target;if(!e.status||e.status>=200&&e.status<300){let r;try{r=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){let e=Z("EPSG:4326"),r=this.getProjection(),n;if(t.bounds!==void 0){let c=zi(e,r);n=no(t.bounds,c)}let s=Bs(r),o=t.minzoom||0,a=t.maxzoom||22,l=mn({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=Wu(t.tiles,l),t.attribution&&!this.getAttributions()){let c=n!==void 0?n:s;this.setAttributions(function(h){return kt(c,h.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}},Xw=Ay;function JI(i,t=512){return i.getExtent()?mn({extent:i.getExtent(),tileSize:t,maxZoom:22}).getResolutions():Ba}function QI(i,t){return t.accessToken||(t=Object.assign({},t),new URL(i).searchParams.forEach((r,n)=>{t.accessToken=r,t.accessTokenParam=n})),t}function Ya(i,t,e="",r={},n=void 0){let s,o,a,l,c=!0;return typeof e!="string"&&!Array.isArray(e)?(a=e,l=a.source||a.layers,r=a):l=e,typeof r=="string"?(s=r,a={}):(s=r.styleUrl,a=r),a.updateSource===!1&&(c=!1),n||(n=a.resolutions),!s&&typeof t=="string"&&!t.trim().startsWith("{")&&(s=t),s&&(s=s.startsWith("data:")?location.href:Gf(s,a.accessToken),a=QI(s,a)),new Promise(function(h,u){ly(t,a).then(function(f){if(f.version!=8)return u(new Error("glStyle version 8 required."));if(!(i instanceof dn||i instanceof Pa))return u(new Error("Can only apply to VectorLayer or VectorTileLayer"));let d=i instanceof Pa?"vector":"geojson";if(l?Array.isArray(l)?o=f.layers.find(function(v){return v.id===l[0]}).source:o=l:(o=f.layers.find(function(v){return v.source&&f.sources[v.source].type===d}).source,l=o),!o)return u(new Error(`No ${d} source found in the glStyle.`));function m(){if(!c)return Promise.resolve();if(i instanceof Pa)return nA(f.sources[o],s,a).then(function(S){let T=i.getSource();T?S!==T&&(T.setTileUrlFunction(S.getTileUrlFunction()),typeof T.setUrls=="function"&&typeof S.getUrls=="function"&&T.setUrls(S.getUrls()),T.format_||(T.format_=S.format_),T.getAttributions()||T.setAttributions(S.getAttributions()),T.getTileLoadFunction()===i0&&T.setTileLoadFunction(S.getTileLoadFunction()),fi(T.getProjection(),S.getProjection())&&(T.tileGrid=S.getTileGrid())):i.setSource(S);let P=i.getSource().getTileGrid();!isFinite(i.getMaxResolution())&&!isFinite(i.getMinZoom())&&P.getMinZoom()>0&&i.setMaxResolution(Pw(Math.max(0,P.getMinZoom()-1e-12),P.getResolutions()))});let v=f.sources[o],E=i.getSource();(!E||E.get("mapbox-source")!==v)&&(E=oA(v,s,a));let b=i.getSource();return b?E!==b&&(b.getAttributions()||b.setAttributions(E.getAttributions()),b.format_||(b.format_=E.getFormat()),b.url_=E.getUrl()):i.setSource(E),Promise.resolve()}let p,g,y={},_={};function x(){if(!g&&(!f.sprite||y)){if(a.projection&&!n){let E=Z(a.projection).getUnits();E!=="m"&&(n=Ba.map(b=>b/rr[E]))}g=py(i,f,l,n,y,_,(v,E=a.webfonts)=>Lw(v,E),a.getImage),i.getStyle()?m().then(h).catch(u):u(new Error(`Nothing to show for source [${o}]`))}else g?(i.setStyle(g),m().then(h).catch(u)):u(new Error("Something went wrong trying to apply style."))}if(f.sprite){let v=bw(f.sprite,a.accessToken,s||location.href);p=window.devicePixelRatio>=1.5?.5:1;let E=p==.5?"@2x":"";Promise.all(v.map(function(b){let S=new URL(b.url),T=S.origin+S.pathname+E+".json"+S.search;return new Promise(function(P,F){Ro("Sprite",T,a).then(P).catch(function(k){T=S.origin+S.pathname+".json"+S.search,Ro("Sprite",T,a).then(P).catch(F)})}).then(function(P){P===void 0&&u(new Error("No sprites found."));let F;if(F=S.origin+S.pathname+E+".png"+S.search,a.transformRequest){let k=a.transformRequest(F,"SpriteImage")||F;(k instanceof Request||k instanceof Promise)&&(F=k)}_[b.id]=F;for(let k in P){let z=b.id=="default"?k:`${b.id}:${k}`;y[z]=P[k]}}).catch(function(P){u(new Error(`Sprites cannot be loaded: ${T}: ${P.message}`))})})).then(x).catch(u)}else x()}).catch(u)})}function tA(i,t,e){t.layers.some(function(r){if(r.type==="background"){if(i instanceof ye)return i.setBackground(function(n){return Vw(r,n,e,{})}),!0;if(i instanceof Ds||i instanceof se)return i.getLayers().insertAt(0,rA(r,e,{})),!0}})}function Qf(i,t,e={}){return ly(t,e).then(function(r){tA(i,r,e)})}function eA(i,t){let e=i.bounds;if(e){let r=bm([e[0],e[1]],t),n=bm([e[2],e[3]],t);return[r[0],r[1],n[0],n[1]]}return Z(t).getExtent()}function iA(i,t,e){let r=new Xw({tileJSON:t,tileSize:i.tileSize||t.tileSize||512}),n=r.getTileJSON(),s=r.getTileGrid(),o=Z(e.projection||"EPSG:3857"),a=eA(n,o),l=o.getExtent(),c=n.minzoom||0,h=n.maxzoom||22,u={attributions:r.getAttributions(),projection:o,tileGrid:new Gr({origin:l?Ue(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:c,resolutions:JI(o,t.tileSize).slice(0,h+1),tileSize:s.getTileSize(0)})};return Array.isArray(n.tiles)?u.urls=n.tiles:u.url=n.tiles,u}function Vw(i,t,e,r){let n={id:i.id,type:i.type},s=i.layout||{},o=i.paint||{};n.paint=o,xn.zoom=zf(t,e.resolutions||Ba),xn.distanceFromCenter=0;let a,l=ut(n,"paint","background-color",Po,r);return o["background-opacity"]!==void 0&&(a=ut(n,"paint","background-opacity",Po,r)),s.visibility=="none"?void 0:Hn(l,a)}function rA(i,t,e){let r=document.createElement("div");return r.className="ol-mapbox-style-background",r.style.position="absolute",r.style.width="100%",r.style.height="100%",new ye({source:new kr({}),render(n){let s=Vw(i,n.viewState.resolution,t,e);return r.style.backgroundColor=s,r}})}function nA(i,t,e){return new Promise(function(r,n){Rw(i,t,e).then(function({tileJson:s,tileLoadFunction:o}){let a=iA(i,s,e);a.tileLoadFunction=o,a.format=new Kf;let l=new oc(a);l.set("mapbox-source",i),r(l)}).catch(n)})}function sA(i){return`{bbox-${(i?i.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function oA(i,t,e){let r=e.projection?new Jn({dataProjection:e.projection}):new Jn,n=i.data,s={};if(typeof n=="string"){let[a]=ja(n,e.accessToken,e.accessTokenParam||"access_token",t||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){let c=(u,f,d)=>{let m=sA(d);return a.replace(m,`${u.join(",")}`)},h=new ni({attributions:i.attribution,format:r,loader:(u,f,d,m,p)=>{let g=typeof c=="function"?c(u,f,d):c;Ro("GeoJSON",g,e).then(y=>{let _=h.getFormat().readFeatures(y,{featureProjection:d});h.addFeatures(_),m(_)}).catch(y=>{h.removeLoadedExtent(u),p()})},strategy:Ew});return h.set("mapbox-source",i),h}let l=new ni({attributions:i.attribution,format:r,url:a,loader:(c,h,u,f,d)=>{Ro("GeoJSON",a,e).then(m=>{let p=l.getFormat().readFeatures(m,{featureProjection:u});l.addFeatures(p),f(p)}).catch(m=>{l.removeLoadedExtent(c),d()})}});return l}s.features=r.readFeatures(n,{featureProjection:sr()||"EPSG:3857"});let o=new ni(Object.assign({attributions:i.attribution,format:r},s));return o.set("mapbox-source",i),o}var Ly=class extends vn{constructor(t){t=t||{};let e=t.projection!==void 0?t.projection:"EPSG:3857",r=t.tileGrid!==void 0?t.tileGrid:mn({extent:Bs(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}},td=Ly;var Lc="1.3.0",Ww=[101,101];function Yw(i,t,e,r,n){n.WIDTH=e[0],n.HEIGHT=e[1];let s=r.getAxisOrientation(),o=xl(n.VERSION,"1.3")>=0;n[o?"CRS":"SRS"]=r.getCode();let a=o&&s.startsWith("ne")?[t[1],t[0],t[3],t[2]]:t;return n.BBOX=a.join(","),qs(i,n)}function Oy(i,t,e,r,n,s,o){s=Object.assign({REQUEST:"GetMap"},s);let a=t/e,l=[sm(it(i)/a,4),sm(Ft(i)/a,4)];if(e!=1)switch(o){case"geoserver":let h=90*e+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+h:s.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":s.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":s.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return Yw(n,i,l,r,s)}function Oc(i,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:Lc,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},i)}function $w(i){let t=i.hidpi===void 0?!0:i.hidpi,e=Z(i.projection||"EPSG:3857"),r=i.ratio||1.5,n=i.load||Ls,s=i.crossOrigin??null;return(o,a,l)=>{o=Py(o,a,l,r),l!=1&&(!t||i.serverType===void 0)&&(l=1);let c=Oy(o,a,l,e,i.url,Oc(i.params,"GetMap"),i.serverType),h=new Image;return h.crossOrigin=s,n(h,c).then(u=>({image:u,extent:o,pixelRatio:l}))}}function Kw(i,t,e){if(i.url===void 0)return;let r=Z(i.projection||"EPSG:3857"),n=An(t,e,0,Ww),s={QUERY_LAYERS:i.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,Oc(i.params,"GetFeatureInfo"),i.params);let o=_s((t[0]-n[0])/e,4),a=_s((n[3]-t[1])/e,4),l=xl(s.VERSION,"1.3")>=0;return s[l?"I":"X"]=o,s[l?"J":"Y"]=a,Yw(i.url,n,Ww,r,s)}function Hw(i,t){if(i.url===void 0)return;let e={SERVICE:"WMS",VERSION:Lc,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t!==void 0){let r=Z(i.projection||"EPSG:3857").getMetersPerUnit()||1,n=28e-5;e.SCALE=t*r/n}if(Object.assign(e,i.params),i.params!==void 0&&e.LAYER===void 0){let r=e.LAYERS;if(!(!Array.isArray(r)||r.length!==1))return;e.LAYER=r}return qs(i.url,e)}var Fy=class extends vn{constructor(t){t=t||{};let e=Object.assign({},t.params);super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=ge(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,r,n){let s=Z(r),o=this.getProjection()||s,a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));let l=di(t,s,o),c=Gs(o,s,t,e),h=a.getZForResolution(c,this.zDirection),u=a.getResolution(h),f=a.getTileCoordForCoordAndZ(l,h);if(a.getResolutions().length<=f[0])return;let d=a.getTileCoordExtent(f,this.tmpExtent_),m=this.gutter_;m!==0&&(d=ii(d,u*m,d));let p={QUERY_LAYERS:this.params_.LAYERS};Object.assign(p,Oc(this.params_,"GetFeatureInfo"),n);let g=Math.floor((l[0]-d[0])/u),y=Math.floor((d[3]-l[1])/u);return p[this.v13_?"I":"X"]=g,p[this.v13_?"J":"Y"]=y,this.getRequestUrl_(f,d,1,o||s,p)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;let r={SERVICE:"WMS",VERSION:Lc,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){let n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;r.LAYER=n}if(t!==void 0){let n=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;r.SCALE=t*n/s}return Object.assign(r,e),qs(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,r,n,s){let o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{let l=Fi(Du(t),o.length);a=o[l]}return Oy(e,(this.tileGrid||this.getTileGridForProjection(n)).getResolution(t[0]),r,n,a,s,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0,e=[];for(let r in this.params_)e[t++]=r+"-"+this.params_[r];return e.join("/")}setParams_(t){this.params_=t,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(t){this.setParams_(Object.assign({},t))}updateParams(t){this.setParams_(Object.assign(this.params_,t))}updateV13_(){let t=this.params_.VERSION||Lc;this.v13_=xl(t,"1.3")>=0}tileUrlFunction(t,e,r){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(r)),n.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);let s=n.getResolution(t[0]),o=n.getTileCoordExtent(t,this.tmpExtent_),a=this.gutter_;a!==0&&(o=ii(o,s*a,o));let l=Object.assign({},Oc(this.params_,"GetMap"));return this.getRequestUrl_(t,o,e,r,l)}},Ny=Fy;var Dy=class extends Wr{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Hf,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,e,r,n){let s=Z(r),o=this.getProjection();o&&o!==s&&(e=Gs(o,s,t,e),t=di(t,s,o));let a={url:this.url_,params:Ir(Ir({},this.params_),n),projection:o||s};return Kw(a,t,e)}getLegendUrl(t,e){return Hw({url:this.url_,params:Ir(Ir({},this.params_),e)},t)}getParams(){return this.params_}getImageInternal(t,e,r,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=$w({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),Ls(s))})),super.getImageInternal(t,e,r,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}setParams(t){this.params_=Object.assign({},t),this.changed()}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}},Gy=Dy;var ky=class extends vn{constructor(t){let e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",r=t.tileGrid,n=t.urls;n===void 0&&t.url!==void 0&&(n=Vu(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:n,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=Yu(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;let e=t.join(`
`);this.setTileUrlFunction(Yu(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){let t=this.urls?this.urls.slice(0):[];for(let e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){let e=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?qs(t,r):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in r?r[a.toLowerCase()]:o});let n=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;let c={TileMatrix:n.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(c,s);let h=t;return e=="KVP"?h=qs(h,c):h=h.replace(/\{(\w+?)\}/g,function(u,f){return encodeURIComponent(c[f])}),h}}},Zw=ky;var zy=class extends ni{constructor(t){t=t||{},super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(e){let r=e.getGeometry();return Et(!r||r.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),r},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,r){this.source?.loadFeatures(t,e,r),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener($.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener($.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){let r=t===0?0:Math.min(e,t)/t,n=t!==this.distance||this.interpolationRatio!==r;this.distance=t,this.minDistance=e,this.interpolationRatio=r,n&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;let t=ge(),e=this.distance*this.resolution,r=this.source.getFeatures(),n={};for(let s=0,o=r.length;s<o;s++){let a=r[s];if(!(H(a)in n)){let l=this.geometryFunction(a);if(l){let c=l.getCoordinates();Vo(c,t),ii(t,e,t);let h=this.source.getFeaturesInExtent(t).filter(function(u){let f=H(u);return f in n?!1:(n[f]=!0,!0)});this.features.push(this.createCluster(h,t))}}}}createCluster(t,e){let r=[0,0];for(let a=t.length-1;a>=0;--a){let l=this.geometryFunction(t[a]);l?Rh(r,l.getCoordinates()):t.splice(a,1)}Ih(r,1/t.length);let n=re(e),s=this.interpolationRatio,o=new oi([r[0]*(1-s)+n[0]*s,r[1]*(1-s)+n[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new yn({geometry:o,features:t})}},Qn=zy;var By="http://www.w3.org/2001/XMLSchema-instance";function $a(i,t){return Fc().createElementNS(i,t)}function br(i,t){return Jw(i,t,[]).join("")}function Jw(i,t,e){if(i.nodeType==Node.CDATA_SECTION_NODE||i.nodeType==Node.TEXT_NODE)t?e.push(String(i.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(i.nodeValue);else{let r;for(r=i.firstChild;r;r=r.nextSibling)Jw(r,t,e)}return e}function En(i){return"documentElement"in i}function wn(i){return new DOMParser().parseFromString(i,"application/xml")}function qy(i,t){return function(e,r){let n=i.call(t??this,e,r);if(n!==void 0){let s=r[r.length-1];Gt(s,n)}}}function ts(i,t){return function(e,r){let n=i.call(t??this,e,r);n!==void 0&&r[r.length-1].push(n)}}function ed(i,t){return function(e,r){let n=i.call(t??this,e,r);n!==void 0&&(r[r.length-1]=n)}}function QH(i,t,e){return function(r,n){let s=i.call(e??this,r,n);if(s!==void 0){let o=n[n.length-1],a=t!==void 0?t:r.localName,l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function Q(i,t,e){return function(r,n){let s=i.call(e??this,r,n);if(s!==void 0){let o=n[n.length-1],a=t!==void 0?t:r.localName;o[a]=s}}}function gt(i,t){return function(e,r,n){i.call(t??this,e,r,n),n[n.length-1].node.appendChild(e)}}function Sn(i,t){return function(e,r,n){let o=r[r.length-1].node,a=i;a===void 0&&(a=n);let l=t!==void 0?t:o.namespaceURI;return $a(l,a)}}var fr=Sn();function Cr(i,t){let e=t.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=i[t[n]];return r}function at(i,t,e){e=e!==void 0?e:{};let r,n;for(r=0,n=i.length;r<n;++r)e[i[r]]=t;return e}function Oo(i,t,e,r){let n;for(n=t.firstElementChild;n;n=n.nextElementSibling){let s=i[n.namespaceURI];if(s!==void 0){let o=s[n.localName];o!==void 0&&o.call(r,n,e)}}}function ae(i,t,e,r,n){return r.push(i),Oo(t,e,r,n),r.pop()}function lA(i,t,e,r,n,s){let o=(n!==void 0?n:e).length,a,l;for(let c=0;c<o;++c)a=e[c],a!==void 0&&(l=t.call(s,a,r,n!==void 0?n[c]:void 0),l!==void 0&&i[l.namespaceURI][l.localName].call(s,l,a,r))}function Fe(i,t,e,r,n,s,o){return n.push(i),lA(t,e,r,n,s,o),n.pop()}var jy;function Qw(){return jy===void 0&&typeof XMLSerializer<"u"&&(jy=new XMLSerializer),jy}var Uy;function Fc(){return Uy===void 0&&typeof document<"u"&&(Uy=document.implementation.createDocument("","",null)),Uy}var Xy=class extends Xa{constructor(){super(),this.xmlSerializer_=Qw()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){let r=wn(t);return this.readFeatureFromDocument(r,e)}return En(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){let r=this.readFeaturesFromDocument(t,e);return r.length>0?r[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){let r=wn(t);return this.readFeaturesFromDocument(r,e)}return En(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){let r=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Gt(r,this.readFeaturesFromNode(n,e));return r}readFeaturesFromNode(t,e){return nt()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){let r=wn(t);return this.readGeometryFromDocument(r,e)}return En(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){let e=wn(t);return this.readProjectionFromDocument(e)}return En(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){let r=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(r)}writeFeatureNode(t,e){return null}writeFeatures(t,e){let r=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(r)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){let r=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(r)}writeGeometryNode(t,e){return null}},tS=Xy;function es(i){let t=br(i,!1);return cA(t)}function cA(i){let t=/^\s*(true|1)|(false|0)\s*$/.exec(i);if(t)return t[1]!==void 0||!1}function be(i){let t=br(i,!1);return hA(t)}function hA(i){let t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(i);if(t)return parseFloat(t[1])}function aZ(i){let t=br(i,!1);return uA(t)}function uA(i){let t=/^\s*(\d+)\s*$/.exec(i);if(t)return parseInt(t[1],10)}function li(i){return br(i,!1).trim()}function Fo(i,t){dr(i,t?"1":"0")}function fA(i,t){i.appendChild(Fc().createCDATASection(t))}function Ks(i,t){let e=t.toPrecision();i.appendChild(Fc().createTextNode(e))}var dA=/^\s/,mA=/\s$/,pA=/(\n|\t|\r|<|&| {2})/;function dr(i,t){typeof t=="string"&&(dA.test(t)||mA.test(t)||pA.test(t))?t.split("]]>").forEach((e,r,n)=>{r<n.length-1&&(e+="]]"),r>0&&(e=">"+e),fA(i,e)}):i.appendChild(Fc().createTextNode(t))}var is=["http://www.google.com/kml/ext/2.2"],rt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],gA="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",eS={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},yA=at(rt,{ExtendedData:ES,Region:wS,MultiGeometry:Q(_S,"geometry"),LineString:Q(gS,"geometry"),LinearRing:Q(yS,"geometry"),Point:Q(xS,"geometry"),Polygon:Q(vS,"geometry"),Style:Q(e_),StyleMap:QA,address:Q(li),description:Q(li),name:Q(li),open:Q(es),phoneNumber:Q(li),styleUrl:Q(uS),visibility:Q(es)},at(is,{MultiTrack:Q(jA,"geometry"),Track:Q(pS,"geometry")})),_A=at(rt,{ExtendedData:ES,Region:wS,Link:uL,address:Q(li),description:Q(li),name:Q(li),open:Q(es),phoneNumber:Q(li),visibility:Q(es)}),xA=at(rt,{href:Q(hS)}),vA=at(rt,{Altitude:Q(be),Longitude:Q(be),Latitude:Q(be),Tilt:Q(be),AltitudeMode:Q(li),Heading:Q(be),Roll:Q(be)}),aS=at(rt,{LatLonAltBox:nL,Lod:oL}),EA=at(rt,["Document","Placemark"]),wA=at(rt,{Document:gt(xL),Placemark:gt(CS)}),Ka,rd=null;var Yy,Nc,Dc,Gc,sd,$y=null;var Qy,Ky=null;var Hy,No=null;var iS=null;var Zy=null;function od(i){return 32/Math.min(i[0],i[1])}function SA(){Ka=[255,255,255,1],rd=new Le({color:Ka}),Yy=[20,2],Nc="pixels",Dc="pixels",Gc=[64,64],sd="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",$y=new Dr({anchor:Yy,anchorOrigin:"bottom-left",anchorXUnits:Nc,anchorYUnits:Dc,crossOrigin:"anonymous",rotation:0,scale:od(Gc),size:Gc,src:sd}),Qy="NO_IMAGE",Ky=new Be({color:Ka,width:1}),Hy=new Be({color:[51,51,51,1],width:2}),No=new cr({font:"bold 16px Helvetica",fill:rd,stroke:Hy,scale:.8}),iS=new ce({fill:rd,image:$y,text:No,stroke:Ky,zIndex:0}),Zy=[iS]}var id;function bA(i){return i}var Jy=class extends tS{constructor(t){super(),t=t||{},Zy||SA(),this.dataProjection=Z("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:Zy,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:bA,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){let r=at(rt,{Document:qy(this.readDocumentOrFolder_,this),Folder:qy(this.readDocumentOrFolder_,this),Placemark:ts(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),n=ae([],r,t,e,this);if(n)return n}readPlacemark_(t,e){let r=ae({geometry:null},yA,t,e,this);if(!r)return;let n=new yn,s=t.getAttribute("id");s!==null&&n.setId(s);let o=e[0],a=r.geometry;if(a&&Zn(a,!1,o),n.setGeometry(a),delete r.geometry,this.extractStyles_){let l=r.Style,c=r.styleUrl,h=MA(l,c,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(h)}return delete r.Style,n.setProperties(r,!0),n}readSharedStyle_(t,e){let r=t.getAttribute("id");if(r!==null){let n=e_.call(this,t,e);if(n){let s,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+r,o).href:s="#"+r,this.sharedStyles_[s]=n}}}readSharedStyleMap_(t,e){let r=t.getAttribute("id");if(r===null)return;let n=dS.call(this,t,e);if(!n)return;let s,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+r,o).href:s="#"+r,this.sharedStyles_[s]=n}readFeatureFromNode(t,e){if(!rt.includes(t.namespaceURI))return null;let r=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return r||null}readFeaturesFromNode(t,e){if(!rt.includes(t.namespaceURI))return[];let r,n=t.localName;if(n=="Document"||n=="Folder")return r=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),r||[];if(n=="Placemark"){let s=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return s?[s]:[]}if(n=="kml"){r=[];for(let s=t.firstElementChild;s;s=s.nextElementSibling){let o=this.readFeaturesFromNode(s,e);o&&Gt(r,o)}return r}return[]}readName(t){if(t){if(typeof t=="string"){let e=wn(t);return this.readNameFromDocument(e)}return En(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){let r=this.readNameFromNode(e);if(r)return r}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(rt.includes(e.namespaceURI)&&e.localName=="name")return li(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){let r=e.localName;if(rt.includes(e.namespaceURI)&&(r=="Document"||r=="Folder"||r=="Placemark"||r=="kml")){let n=this.readNameFromNode(e);if(n)return n}}}readNetworkLinks(t){let e=[];if(typeof t=="string"){let r=wn(t);Gt(e,this.readNetworkLinksFromDocument(r))}else En(t)?Gt(e,this.readNetworkLinksFromDocument(t)):Gt(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){let e=[];for(let r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Gt(e,this.readNetworkLinksFromNode(r));return e}readNetworkLinksFromNode(t){let e=[];for(let r=t.firstElementChild;r;r=r.nextElementSibling)if(rt.includes(r.namespaceURI)&&r.localName=="NetworkLink"){let n=ae({},_A,r,[]);e.push(n)}for(let r=t.firstElementChild;r;r=r.nextElementSibling){let n=r.localName;rt.includes(r.namespaceURI)&&(n=="Document"||n=="Folder"||n=="kml")&&Gt(e,this.readNetworkLinksFromNode(r))}return e}readRegion(t){let e=[];if(typeof t=="string"){let r=wn(t);Gt(e,this.readRegionFromDocument(r))}else En(t)?Gt(e,this.readRegionFromDocument(t)):Gt(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){let e=[];for(let r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Gt(e,this.readRegionFromNode(r));return e}readRegionFromNode(t){let e=[];for(let r=t.firstElementChild;r;r=r.nextElementSibling)if(rt.includes(r.namespaceURI)&&r.localName=="Region"){let n=ae({},aS,r,[]);e.push(n)}for(let r=t.firstElementChild;r;r=r.nextElementSibling){let n=r.localName;rt.includes(r.namespaceURI)&&(n=="Document"||n=="Folder"||n=="kml")&&Gt(e,this.readRegionFromNode(r))}return e}readCamera(t){let e=[];if(typeof t=="string"){let r=wn(t);Gt(e,this.readCameraFromDocument(r))}else En(t)?Gt(e,this.readCameraFromDocument(t)):Gt(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){let e=[];for(let r=t.firstChild;r;r=r.nextSibling)r.nodeType===Node.ELEMENT_NODE&&Gt(e,this.readCameraFromNode(r));return e}readCameraFromNode(t){let e=[];for(let r=t.firstElementChild;r;r=r.nextElementSibling)if(rt.includes(r.namespaceURI)&&r.localName==="Camera"){let n=ae({},vA,r,[]);e.push(n)}for(let r=t.firstElementChild;r;r=r.nextElementSibling){let n=r.localName;rt.includes(r.namespaceURI)&&(n==="Document"||n==="Folder"||n==="Placemark"||n==="kml")&&Gt(e,this.readCameraFromNode(r))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);let r=$a(rt[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",is[0]),r.setAttributeNS(n,"xmlns:xsi",By),r.setAttributeNS(By,"xsi:schemaLocation",gA);let s={node:r},o={};t.length>1?o.Document=t:t.length==1&&(o.Placemark=t[0]);let a=EA[r.namespaceURI],l=Cr(o,a);return Fe(s,wA,fr,l,[e],a,this),r}};function CA(i,t){let e=[0,0],r="start",n=i.getImage();if(n){let a=n.getSize();if(a&&a.length==2){let l=n.getScaleArray(),c=n.getAnchor();e[0]=l[0]*(a[0]-c[0]),e[1]=l[1]*(a[1]/2-c[1]),r="left"}}let s=i.getText();return s?(s=s.clone(),s.setFont(s.getFont()||No.getFont()),s.setScale(s.getScale()||No.getScale()),s.setFill(s.getFill()||No.getFill()),s.setStroke(s.getStroke()||Hy)):s=No.clone(),s.setText(t),s.setOffsetX(e[0]),s.setOffsetY(e[1]),s.setTextAlign(r),new ce({image:n,text:s})}function MA(i,t,e,r,n){return function(s,o){let a=n,l="",c=[];if(a){let u=s.getGeometry();if(u)if(u instanceof Vr)c=u.getGeometriesArrayRecursive().filter(function(f){let d=f.getType();return d==="Point"||d==="MultiPoint"}),a=c.length>0;else{let f=u.getType();a=f==="Point"||f==="MultiPoint"}}a&&(l=s.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(id||(id=document.createElement("textarea")),id.innerHTML=l,l=id.value));let h=e;if(i?h=i:t&&(h=lS(t,e,r)),a){let u=CA(h[0],l);if(c.length>0){u.setGeometry(new Vr(c));let f=new ce({geometry:h[0].getGeometry(),image:null,fill:h[0].getFill(),stroke:h[0].getStroke(),text:null});return[u,f].concat(h.slice(1))}return u}return h}}function lS(i,t,e){return Array.isArray(i)?i:typeof i=="string"?lS(e[i],t,e):t}function ad(i){let t=br(i,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){let r=e[1];return[parseInt(r.substr(6,2),16),parseInt(r.substr(4,2),16),parseInt(r.substr(2,2),16),parseInt(r.substr(0,2),16)/255]}}function cS(i){let t=br(i,!1),e=[];t=t.replace(/\s*,\s*/g,",");let r=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i,n;for(;n=r.exec(t);){let s=parseFloat(n[1]),o=parseFloat(n[2]),a=n[3]?parseFloat(n[3]):0;e.push(s,o,a),t=t.substr(n[0].length)}if(t==="")return e}function hS(i){let t=br(i,!1).trim(),e=i.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function uS(i){let t=br(i,!1).trim().replace(/^(?!.*#)/,"#"),e=i.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function TA(i){let t=i.getAttribute("xunits"),e=i.getAttribute("yunits"),r;return t!=="insetPixels"?e!=="insetPixels"?r="bottom-left":r="top-left":e!=="insetPixels"?r="bottom-right":r="top-right",{x:parseFloat(i.getAttribute("x")),xunits:eS[t],y:parseFloat(i.getAttribute("y")),yunits:eS[e],origin:r}}function fS(i){return be(i)}var PA=at(rt,{Pair:JA});function dS(i,t){return ae(void 0,PA,i,t,this)}var RA=at(rt,{Icon:Q(qA),color:Q(ad),heading:Q(be),hotSpot:Q(TA),scale:Q(fS)});function IA(i,t){let e=ae({},RA,i,t);if(!e)return;let r=t[t.length-1],n="Icon"in e?e.Icon:{},s=!("Icon"in e)||Object.keys(n).length>0,o,a=n.href;a?o=a:s&&(o=sd);let l,c,h,u="bottom-left",f=e.hotSpot;f?(l=[f.x,f.y],c=f.xunits,h=f.yunits,u=f.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=Yy,c=Nc,h=Dc):o.includes("arrow-reverse")?(l=[54,42],c=Nc,h=Dc):o.includes("paddle")&&(l=[32,1],c=Nc,h=Dc));let d,m=n.x,p=n.y;m!==void 0&&p!==void 0&&(d=[m,p]);let g,y=n.w,_=n.h;y!==void 0&&_!==void 0&&(g=[y,_]);let x,v=e.heading;v!==void 0&&(x=Oi(v));let E=e.scale,b=e.color;if(s){o==sd&&(g=Gc);let S=new Dr({anchor:l,anchorOrigin:u,anchorXUnits:c,anchorYUnits:h,crossOrigin:this.crossOrigin_,offset:d,offsetOrigin:"bottom-left",rotation:x,scale:E,size:g,src:this.iconUrlFunction_(o),color:b}),T=S.getScaleArray()[0],P=S.getSize();if(P===null){let F=S.getImageState();if(F===K.IDLE||F===K.LOADING){let k=function(){let z=S.getImageState();if(!(z===K.IDLE||z===K.LOADING)){let W=S.getSize();if(W&&W.length==2){let G=od(W);S.setScale(T*G)}S.unlistenImageChange(k)}};S.listenImageChange(k),F===K.IDLE&&S.load()}}else if(P.length==2){let F=od(P);S.setScale(T*F)}r.imageStyle=S}else r.imageStyle=Qy}var AA=at(rt,{color:Q(ad),scale:Q(fS)});function LA(i,t){let e=ae({},AA,i,t);if(!e)return;let r=t[t.length-1],n=new cr({fill:new Le({color:"color"in e?e.color:Ka}),scale:e.scale});r.textStyle=n}var OA=at(rt,{color:Q(ad),width:Q(be)});function FA(i,t){let e=ae({},OA,i,t);if(!e)return;let r=t[t.length-1],n=new Be({color:"color"in e?e.color:Ka,width:"width"in e?e.width:1});r.strokeStyle=n}var NA=at(rt,{color:Q(ad),fill:Q(es),outline:Q(es)});function DA(i,t){let e=ae({},NA,i,t);if(!e)return;let r=t[t.length-1],n=new Le({color:"color"in e?e.color:Ka});r.fillStyle=n;let s=e.fill;s!==void 0&&(r.fill=s);let o=e.outline;o!==void 0&&(r.outline=o)}var GA=at(rt,{coordinates:ed(cS)});function mS(i,t){return ae(null,GA,i,t)}function kA(i,t){let r=t[t.length-1].coordinates,n=br(i,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(o){let a=parseFloat(o[1]),l=parseFloat(o[2]),c=parseFloat(o[3]);r.push([a,l,c])}else r.push([])}var zA=at(is,{Track:ts(pS)});function jA(i,t){let e=ae([],zA,i,t);if(e)return new $s(e)}var UA=at(rt,{when:fL},at(is,{coord:kA}));function pS(i,t){let e=ae({coordinates:[],whens:[]},UA,i,t);if(!e)return;let r=[],n=e.coordinates,s=e.whens;for(let o=0,a=Math.min(n.length,s.length);o<a;++o)n[o].length==3&&r.push(n[o][0],n[o][1],n[o][2],s[o]);return new $i(r,"XYZM")}var BA=at(rt,{href:Q(hS)},at(is,{x:Q(be),y:Q(be),w:Q(be),h:Q(be)}));function qA(i,t){let e=ae({},BA,i,t);return e||null}var XA=at(rt,{coordinates:ed(cS)});function t_(i,t){return ae(null,XA,i,t)}var ld=at(rt,{extrude:Q(es),tessellate:Q(es),altitudeMode:Q(li)});function gS(i,t){let e=ae({},ld,i,t),r=t_(i,t);if(r){let n=new $i(r,"XYZ");return n.setProperties(e,!0),n}}function yS(i,t){let e=ae({},ld,i,t),r=t_(i,t);if(r){let n=new or(r,"XYZ",[r.length]);return n.setProperties(e,!0),n}}var VA=at(rt,{LineString:ts(gS),LinearRing:ts(yS),MultiGeometry:ts(_S),Point:ts(xS),Polygon:ts(vS)});function _S(i,t){let e=ae([],VA,i,t);if(!e)return null;if(e.length===0)return new Vr(e);let r,n=!0,s=e[0].getType(),o;for(let a=1,l=e.length;a<l;++a)if(o=e[a],o.getType()!=s){n=!1;break}if(n){let a,l;if(s=="Point"){let c=e[0];a=c.getLayout(),l=c.getFlatCoordinates();for(let h=1,u=e.length;h<u;++h)o=e[h],Gt(l,o.getFlatCoordinates());r=new Kn(l,a),Vy(r,e)}else if(s=="LineString")r=new $s(e),Vy(r,e);else if(s=="Polygon")r=new To(e),Vy(r,e);else if(s=="GeometryCollection"||s.startsWith("Multi"))r=new Vr(e);else throw new Error("Unknown geometry type found")}else r=new Vr(e);return r}function xS(i,t){let e=ae({},ld,i,t),r=t_(i,t);if(r){let n=new oi(r,"XYZ");return n.setProperties(e,!0),n}}var WA=at(rt,{innerBoundaryIs:lL,outerBoundaryIs:hL});function vS(i,t){let e=ae({},ld,i,t),r=ae([null],WA,i,t);if(r&&r[0]){let n=r[0],s=[n.length];for(let a=1,l=r.length;a<l;++a)Gt(n,r[a]),s.push(n.length);let o=new or(n,"XYZ",s);return o.setProperties(e,!0),o}}var YA=at(rt,{IconStyle:IA,LabelStyle:LA,LineStyle:FA,PolyStyle:DA});function e_(i,t){let e=ae({},YA,i,t,this);if(!e)return null;let r="fillStyle"in e?e.fillStyle:rd,n=e.fill;n!==void 0&&!n&&(r=null);let s;"imageStyle"in e?e.imageStyle!=Qy&&(s=e.imageStyle):s=$y;let o="textStyle"in e?e.textStyle:No,a="strokeStyle"in e?e.strokeStyle:Ky,l=e.outline;return l!==void 0&&!l?[new ce({geometry:function(c){let h=c.getGeometry(),u=h.getType();if(u==="GeometryCollection"){let f=h;return new Vr(f.getGeometriesArrayRecursive().filter(function(d){let m=d.getType();return m!=="Polygon"&&m!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return h},fill:r,image:s,stroke:a,text:o,zIndex:void 0}),new ce({geometry:function(c){let h=c.getGeometry(),u=h.getType();if(u==="GeometryCollection"){let f=h;return new Vr(f.getGeometriesArrayRecursive().filter(function(d){let m=d.getType();return m==="Polygon"||m==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return h},fill:r,stroke:null,zIndex:void 0})]:[new ce({fill:r,image:s,stroke:a,text:o,zIndex:void 0})]}function Vy(i,t){let e=t.length,r=new Array(t.length),n=new Array(t.length),s=new Array(t.length),o,a,l;o=!1,a=!1,l=!1;for(let c=0;c<e;++c){let h=t[c];r[c]=h.get("extrude"),n[c]=h.get("tessellate"),s[c]=h.get("altitudeMode"),o=o||r[c]!==void 0,a=a||n[c]!==void 0,l=l||s[c]}o&&i.set("extrude",r),a&&i.set("tessellate",n),l&&i.set("altitudeMode",s)}var $A=at(rt,{displayName:Q(li),value:Q(li)});function KA(i,t){let e=i.getAttribute("name");Oo($A,i,t);let r=t[t.length-1];e&&r.displayName?r[e]={value:r.value,displayName:r.displayName,toString:function(){return r.value}}:e!==null?r[e]=r.value:r.displayName!==null&&(r[r.displayName]=r.value),delete r.value}var HA=at(rt,{Data:KA,SchemaData:eL});function ES(i,t){Oo(HA,i,t)}function wS(i,t){Oo(aS,i,t)}var ZA=at(rt,{Style:Q(e_),key:Q(li),styleUrl:Q(uS)});function JA(i,t){let e=ae({},ZA,i,t,this);if(!e)return;let r=e.key;if(r&&r=="normal"){let n=e.styleUrl;n&&(t[t.length-1]=n);let s=e.Style;s&&(t[t.length-1]=s)}}function QA(i,t){let e=dS.call(this,i,t);if(!e)return;let r=t[t.length-1];if(Array.isArray(e))r.Style=e;else if(typeof e=="string")r.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}var tL=at(rt,{SimpleData:iL});function eL(i,t){Oo(tL,i,t)}function iL(i,t){let e=i.getAttribute("name");if(e!==null){let r=li(i),n=t[t.length-1];n[e]=r}}var rL=at(rt,{altitudeMode:Q(li),minAltitude:Q(be),maxAltitude:Q(be),north:Q(be),south:Q(be),east:Q(be),west:Q(be)});function nL(i,t){let e=ae({},rL,i,t);if(!e)return;let r=t[t.length-1],n=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];r.extent=n,r.altitudeMode=e.altitudeMode,r.minAltitude=parseFloat(e.minAltitude),r.maxAltitude=parseFloat(e.maxAltitude)}var sL=at(rt,{minLodPixels:Q(be),maxLodPixels:Q(be),minFadeExtent:Q(be),maxFadeExtent:Q(be)});function oL(i,t){let e=ae({},sL,i,t);if(!e)return;let r=t[t.length-1];r.minLodPixels=parseFloat(e.minLodPixels),r.maxLodPixels=parseFloat(e.maxLodPixels),r.minFadeExtent=parseFloat(e.minFadeExtent),r.maxFadeExtent=parseFloat(e.maxFadeExtent)}var aL=at(rt,{LinearRing:ts(mS)});function lL(i,t){let e=ae([],aL,i,t);e.length>0&&t[t.length-1].push(...e)}var cL=at(rt,{LinearRing:ed(mS)});function hL(i,t){let e=ae(void 0,cL,i,t);if(e){let r=t[t.length-1];r[0]=e}}function uL(i,t){Oo(xA,i,t)}function fL(i,t){let r=t[t.length-1].whens,n=br(i,!1),s=Date.parse(n);r.push(isNaN(s)?0:s)}function cd(i,t){let e=ar(t),n=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let s=0;s<4;++s){let o=Math.floor(n[s]).toString(16);n[s]=o.length==1?"0"+o:o}dr(i,n.join(""))}function dL(i,t,e){let r=e[e.length-1],n=r.layout,s=r.stride,o;if(n=="XY"||n=="XYM")o=2;else if(n=="XYZ"||n=="XYZM")o=3;else throw new Error("Invalid geometry layout");let a=t.length,l="";if(a>0){l+=t[0];for(let c=1;c<o;++c)l+=","+t[c];for(let c=s;c<a;c+=s){l+=" "+t[c];for(let h=1;h<o;++h)l+=","+t[c+h]}}dr(i,l)}var nd=at(rt,{Data:gt(mL),value:gt(gL),displayName:gt(pL)});function mL(i,t,e){i.setAttribute("name",t.name);let r={node:i},n=t.value;typeof n=="object"?(n!==null&&n.displayName&&Fe(r,nd,fr,[n.displayName],e,["displayName"]),n!==null&&n.value&&Fe(r,nd,fr,[n.value],e,["value"])):Fe(r,nd,fr,[n],e,["value"])}function pL(i,t){dr(i,t)}function gL(i,t){dr(i,t)}var yL=at(rt,{Placemark:gt(CS)}),_L=function(i,t,e){let r=t[t.length-1].node;return $a(r.namespaceURI,"Placemark")};function xL(i,t,e){Fe({node:i},yL,_L,t,e,void 0,this)}var vL=Sn("Data");function EL(i,t,e){let r={node:i},n=t.names,s=t.values,o=n.length;for(let a=0;a<o;a++)Fe(r,nd,vL,[{name:n[a],value:s[a]}],e)}var rS=at(rt,["href"],at(is,["x","y","w","h"])),nS=at(rt,{href:gt(dr)},at(is,{x:gt(Ks),y:gt(Ks),w:gt(Ks),h:gt(Ks)})),wL=function(i,t,e){return $a(is[0],"gx:"+e)};function SL(i,t,e){let r={node:i},n=e[e.length-1].node,s=rS[n.namespaceURI],o=Cr(t,s);Fe(r,nS,fr,o,e,s),s=rS[is[0]],o=Cr(t,s),Fe(r,nS,wL,o,e,s)}var bL=at(rt,["scale","heading","Icon","color","hotSpot"]),CL=at(rt,{Icon:gt(SL),color:gt(cd),heading:gt(Ks),hotSpot:gt(JL),scale:gt(TS)});function ML(i,t,e){let r={node:i},n={},s=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:s};if(o){l.w=o[0],l.h=o[1];let g=t.getAnchor(),y=t.getOrigin();if(y&&a&&y[0]!==0&&y[1]!==o[1]&&(l.x=y[0],l.y=a[1]-(y[1]+o[1])),g&&(g[0]!==o[0]/2||g[1]!==o[1]/2)){let _={x:g[0],xunits:"pixels",y:o[1]-g[1],yunits:"pixels"};n.hotSpot=_}}n.Icon=l;let c=t.getScaleArray()[0],h=o;if(h===null&&(h=Gc),h.length==2){let g=od(h);c=c/g}c!==1&&(n.scale=c);let u=t.getRotation();u!==0&&(n.heading=u);let f=t.getColor();f&&(n.color=f);let d=e[e.length-1].node,m=bL[d.namespaceURI],p=Cr(n,m);Fe(r,CL,fr,p,e,m)}var TL=at(rt,["color","scale"]),PL=at(rt,{color:gt(cd),scale:gt(TS)});function RL(i,t,e){let r={node:i},n={},s=t.getFill();s&&(n.color=s.getColor());let o=t.getScale();o&&o!==1&&(n.scale=o);let a=e[e.length-1].node,l=TL[a.namespaceURI],c=Cr(n,l);Fe(r,PL,fr,c,e,l)}var IL=at(rt,["color","width"]),AL=at(rt,{color:gt(cd),width:gt(Ks)});function LL(i,t,e){let r={node:i},n={color:t.getColor(),width:Number(t.getWidth())||1},s=e[e.length-1].node,o=IL[s.namespaceURI],a=Cr(n,o);Fe(r,AL,fr,a,e,o)}var OL={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},SS=function(i,t,e){if(i){let r=t[t.length-1].node;return $a(r.namespaceURI,OL[i.getType()])}},FL=Sn("Point"),NL=Sn("LineString"),DL=Sn("LinearRing"),GL=Sn("Polygon"),kL=at(rt,{LineString:gt(Ha),Point:gt(Ha),Polygon:gt(MS),GeometryCollection:gt(bS)});function bS(i,t,e){let r={node:i},n=t.getType(),s=[],o;if(n==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){let l=a.getType();if(l==="MultiPoint")s=s.concat(a.getPoints());else if(l==="MultiLineString")s=s.concat(a.getLineStrings());else if(l==="MultiPolygon")s=s.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")s.push(a);else throw new Error("Unknown geometry type")}),o=SS;else if(n==="MultiPoint")s=t.getPoints(),o=FL;else if(n==="MultiLineString")s=t.getLineStrings(),o=NL;else if(n==="MultiPolygon")s=t.getPolygons(),o=GL;else throw new Error("Unknown geometry type");Fe(r,kL,o,s,e)}var zL=at(rt,{LinearRing:gt(Ha)});function sS(i,t,e){Fe({node:i},zL,DL,[t],e)}var Wy=at(rt,{ExtendedData:gt(EL),MultiGeometry:gt(bS),LineString:gt(Ha),LinearRing:gt(Ha),Point:gt(Ha),Polygon:gt(MS),Style:gt(ZL),address:gt(dr),description:gt(dr),name:gt(dr),open:gt(Fo),phoneNumber:gt(dr),styleUrl:gt(dr),visibility:gt(Fo)}),jL=at(rt,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),UL=Sn("ExtendedData");function CS(i,t,e){let r={node:i};t.getId()&&i.setAttribute("id",t.getId());let n=t.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[t.getGeometryName()]=1;let o=Object.keys(n||{}).sort().filter(function(d){return!s[d]}),a=t.getStyleFunction();if(a){let d=a(t,0);if(d){let m=Array.isArray(d)?d:[d],p=m;if(t.getGeometry()&&(p=m.filter(function(g){let y=g.getGeometryFunction()(t);if(y){let _=y.getType();return _==="GeometryCollection"?y.getGeometriesArrayRecursive().filter(function(x){let v=x.getType();return v==="Point"||v==="MultiPoint"}).length:_==="Point"||_==="MultiPoint"}})),this.writeStyles_){let g=m,y=m;t.getGeometry()&&(g=m.filter(function(_){let x=_.getGeometryFunction()(t);if(x){let v=x.getType();return v==="GeometryCollection"?x.getGeometriesArrayRecursive().filter(function(E){let b=E.getType();return b==="LineString"||b==="MultiLineString"}).length:v==="LineString"||v==="MultiLineString"}}),y=m.filter(function(_){let x=_.getGeometryFunction()(t);if(x){let v=x.getType();return v==="GeometryCollection"?x.getGeometriesArrayRecursive().filter(function(E){let b=E.getType();return b==="Polygon"||b==="MultiPolygon"}).length:v==="Polygon"||v==="MultiPolygon"}})),n.Style={pointStyles:p,lineStyles:g,polyStyles:y}}if(p.length&&n.name===void 0){let g=p[0].getText();g&&(n.name=g.getText())}}}let l=e[e.length-1].node,c=jL[l.namespaceURI],h=Cr(n,c);if(Fe(r,Wy,fr,h,e,c),o.length>0){let d=Cr(n,o);Fe(r,Wy,UL,[{names:o,values:d}],e)}let u=e[0],f=t.getGeometry();f&&(f=Zn(f,!0,u)),Fe(r,Wy,SS,[f],e)}var BL=at(rt,["extrude","tessellate","altitudeMode","coordinates"]),qL=at(rt,{extrude:gt(Fo),tessellate:gt(Fo),altitudeMode:gt(dr),coordinates:gt(dL)});function Ha(i,t,e){let r=t.getFlatCoordinates(),n={node:i};n.layout=t.getLayout(),n.stride=t.getStride();let s=t.getProperties();s.coordinates=r;let o=e[e.length-1].node,a=BL[o.namespaceURI],l=Cr(s,a);Fe(n,qL,fr,l,e,a)}var XL=at(rt,["color","fill","outline"]),oS=at(rt,{outerBoundaryIs:gt(sS),innerBoundaryIs:gt(sS)}),VL=Sn("innerBoundaryIs"),WL=Sn("outerBoundaryIs");function MS(i,t,e){let r=t.getLinearRings(),n=r.shift(),s={node:i};Fe(s,oS,VL,r,e),Fe(s,oS,WL,[n],e)}var YL=at(rt,{color:gt(cd),fill:gt(Fo),outline:gt(Fo)});function $L(i,t,e){let r={node:i},n=t.getFill(),s=t.getStroke(),o={color:n?n.getColor():void 0,fill:n?void 0:!1,outline:s?void 0:!1},a=e[e.length-1].node,l=XL[a.namespaceURI],c=Cr(o,l);Fe(r,YL,fr,c,e,l)}function TS(i,t){Ks(i,Math.round(t*1e6)/1e6)}var KL=at(rt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),HL=at(rt,{IconStyle:gt(ML),LabelStyle:gt(RL),LineStyle:gt(LL),PolyStyle:gt($L)});function ZL(i,t,e){let r={node:i},n={};if(t.pointStyles.length){let l=t.pointStyles[0].getText();l&&(n.LabelStyle=l);let c=t.pointStyles[0].getImage();c&&typeof c.getSrc=="function"&&(n.IconStyle=c)}if(t.lineStyles.length){let l=t.lineStyles[0].getStroke();l&&(n.LineStyle=l)}if(t.polyStyles.length){let l=t.polyStyles[0].getStroke();l&&!n.LineStyle&&(n.LineStyle=l),n.PolyStyle=t.polyStyles[0]}let s=e[e.length-1].node,o=KL[s.namespaceURI],a=Cr(n,o);Fe(r,HL,fr,a,e,o)}function JL(i,t){i.setAttribute("x",String(t.x)),i.setAttribute("y",String(t.y)),i.setAttribute("xunits",t.xunits),i.setAttribute("yunits",t.yunits)}var hd=Jy;var QL=null;function PS(i){QL=i;let t=Object.keys(i.defs),e=t.length,r,n;for(r=0;r<e;++r){let s=t[r];if(!Jo(s)){let o=i.defs(s),a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),El(new ki({code:s,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(r=0;r<e;++r){let s=t[r],o=Jo(s);for(n=0;n<e;++n){let a=t[n],l=Jo(a);if(!ta(s,a))if(i.defs[s]===i.defs[a])Gh([o,l]);else{let c=i(s,a);ex(o,l,Cm(o,l,c.forward),Cm(l,o,c.inverse))}}}}function RS(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)i("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),i("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var Yr=1,$r=2,rs=3,IS=4,kc=5,i_=6378137,AS=6356752314e-3,r_=.0066943799901413165,Do=484813681109536e-20,D=Math.PI/2,LS=.16666666666666666,OS=.04722222222222222,FS=.022156084656084655,U=1e-10,Ht=.017453292519943295,Ki=57.29577951308232,Yt=Math.PI/4,Hs=Math.PI*2,Me=3.14159265359;var Mi={};Mi.greenwich=0;Mi.lisbon=-9.131906111111;Mi.paris=2.337229166667;Mi.bogota=-74.080916666667;Mi.madrid=-3.687938888889;Mi.rome=12.452333333333;Mi.bern=7.439583333333;Mi.jakarta=106.807719444444;Mi.ferro=-17.666666666667;Mi.brussels=4.367975;Mi.stockholm=18.058277777778;Mi.athens=23.7163375;Mi.oslo=10.722916666667;var NS={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var DS=/[\s_\-\/\(\)]/g;function mr(i,t){if(i[t])return i[t];for(var e=Object.keys(i),r=t.toLowerCase().replace(DS,""),n=-1,s,o;++n<e.length;)if(s=e[n],o=s.toLowerCase().replace(DS,""),o===r)return i[s]}function zc(i){var t={},e=i.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var c=l.split("=");return c.push(!0),a[c[0].toLowerCase()]=c[1],a},{}),r,n,s,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*Ht},lat_1:function(a){t.lat1=a*Ht},lat_2:function(a){t.lat2=a*Ht},lat_ts:function(a){t.lat_ts=a*Ht},lon_0:function(a){t.long0=a*Ht},lon_1:function(a){t.long1=a*Ht},lon_2:function(a){t.long2=a*Ht},alpha:function(a){t.alpha=parseFloat(a)*Ht},gamma:function(a){t.rectified_grid_angle=parseFloat(a)*Ht},lonc:function(a){t.longc=a*Ht},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var l=mr(NS,a);l&&(t.to_meter=l.to_meter)},from_greenwich:function(a){t.from_greenwich=a*Ht},pm:function(a){var l=mr(Mi,a);t.from_greenwich=(l||parseFloat(a))*Ht},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(r in e)n=e[r],r in o?(s=o[r],typeof s=="function"?s(n):t[s]=n):t[r]=n;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var n_=class{static getId(t){let e=t.find(r=>Array.isArray(r)&&r[0]==="ID");return e&&e.length>=3?{authority:e[1],code:parseInt(e[2],10)}:null}static convertUnit(t,e="unit"){if(!t||t.length<3)return{type:e,name:"unknown",conversion_factor:null};let r=t[1],n=parseFloat(t[2])||null,s=t.find(a=>Array.isArray(a)&&a[0]==="ID"),o=s?{authority:s[1],code:parseInt(s[2],10)}:null;return{type:e,name:r,conversion_factor:n,id:o}}static convertAxis(t){let e=t[1]||"Unknown",r,n=e.match(/^\((.)\)$/);if(n){let c=n[1].toUpperCase();if(c==="E")r="east";else if(c==="N")r="north";else if(c==="U")r="up";else throw new Error(`Unknown axis abbreviation: ${c}`)}else r=t[2]?t[2].toLowerCase():"unknown";let s=t.find(c=>Array.isArray(c)&&c[0]==="ORDER"),o=s?parseInt(s[1],10):null,a=t.find(c=>Array.isArray(c)&&(c[0]==="LENGTHUNIT"||c[0]==="ANGLEUNIT"||c[0]==="SCALEUNIT")),l=this.convertUnit(a);return{name:e,direction:r,unit:l,order:o}}static extractAxes(t){return t.filter(e=>Array.isArray(e)&&e[0]==="AXIS").map(e=>this.convertAxis(e)).sort((e,r)=>(e.order||0)-(r.order||0))}static convert(t,e={}){switch(t[0]){case"PROJCRS":e.type="ProjectedCRS",e.name=t[1],e.base_crs=t.find(d=>Array.isArray(d)&&d[0]==="BASEGEOGCRS")?this.convert(t.find(d=>Array.isArray(d)&&d[0]==="BASEGEOGCRS")):null,e.conversion=t.find(d=>Array.isArray(d)&&d[0]==="CONVERSION")?this.convert(t.find(d=>Array.isArray(d)&&d[0]==="CONVERSION")):null;let r=t.find(d=>Array.isArray(d)&&d[0]==="CS");r&&(e.coordinate_system={type:r[1],axis:this.extractAxes(t)});let n=t.find(d=>Array.isArray(d)&&d[0]==="LENGTHUNIT");if(n){let d=this.convertUnit(n);e.coordinate_system.unit=d}e.id=this.getId(t);break;case"BASEGEOGCRS":case"GEOGCRS":e.type="GeographicCRS",e.name=t[1];let s=t.find(d=>Array.isArray(d)&&(d[0]==="DATUM"||d[0]==="ENSEMBLE"));if(s){let d=this.convert(s);s[0]==="ENSEMBLE"?e.datum_ensemble=d:e.datum=d;let m=t.find(p=>Array.isArray(p)&&p[0]==="PRIMEM");m&&m[1]!=="Greenwich"&&(d.prime_meridian={name:m[1],longitude:parseFloat(m[2])})}e.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(t)},e.id=this.getId(t);break;case"DATUM":e.type="GeodeticReferenceFrame",e.name=t[1],e.ellipsoid=t.find(d=>Array.isArray(d)&&d[0]==="ELLIPSOID")?this.convert(t.find(d=>Array.isArray(d)&&d[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":e.type="DatumEnsemble",e.name=t[1],e.members=t.filter(d=>Array.isArray(d)&&d[0]==="MEMBER").map(d=>({type:"DatumEnsembleMember",name:d[1],id:this.getId(d)}));let o=t.find(d=>Array.isArray(d)&&d[0]==="ENSEMBLEACCURACY");o&&(e.accuracy=parseFloat(o[1]));let a=t.find(d=>Array.isArray(d)&&d[0]==="ELLIPSOID");a&&(e.ellipsoid=this.convert(a)),e.id=this.getId(t);break;case"ELLIPSOID":e.type="Ellipsoid",e.name=t[1],e.semi_major_axis=parseFloat(t[2]),e.inverse_flattening=parseFloat(t[3]);let l=t.find(d=>Array.isArray(d)&&d[0]==="LENGTHUNIT")?this.convert(t.find(d=>Array.isArray(d)&&d[0]==="LENGTHUNIT"),e):null;break;case"CONVERSION":e.type="Conversion",e.name=t[1],e.method=t.find(d=>Array.isArray(d)&&d[0]==="METHOD")?this.convert(t.find(d=>Array.isArray(d)&&d[0]==="METHOD")):null,e.parameters=t.filter(d=>Array.isArray(d)&&d[0]==="PARAMETER").map(d=>this.convert(d));break;case"METHOD":e.type="Method",e.name=t[1],e.id=this.getId(t);break;case"PARAMETER":e.type="Parameter",e.name=t[1],e.value=parseFloat(t[2]),e.unit=this.convertUnit(t.find(d=>Array.isArray(d)&&(d[0]==="LENGTHUNIT"||d[0]==="ANGLEUNIT"||d[0]==="SCALEUNIT"))),e.id=this.getId(t);break;case"BOUNDCRS":e.type="BoundCRS";let c=t.find(d=>Array.isArray(d)&&d[0]==="SOURCECRS");if(c){let d=c.find(m=>Array.isArray(m));e.source_crs=d?this.convert(d):null}let h=t.find(d=>Array.isArray(d)&&d[0]==="TARGETCRS");if(h){let d=h.find(m=>Array.isArray(m));e.target_crs=d?this.convert(d):null}let u=t.find(d=>Array.isArray(d)&&d[0]==="ABRIDGEDTRANSFORMATION");u?e.transformation=this.convert(u):e.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(e.type="Transformation",e.name=t[1],e.method=t.find(d=>Array.isArray(d)&&d[0]==="METHOD")?this.convert(t.find(d=>Array.isArray(d)&&d[0]==="METHOD")):null,e.parameters=t.filter(d=>Array.isArray(d)&&(d[0]==="PARAMETER"||d[0]==="PARAMETERFILE")).map(d=>{if(d[0]==="PARAMETER")return this.convert(d);if(d[0]==="PARAMETERFILE")return{name:d[1],value:d[2],id:{authority:"EPSG",code:8656}}}),e.parameters.length===7){let d=e.parameters[6];d.name==="Scale difference"&&(d.value=Math.round((d.value-1)*1e12)/1e6)}e.id=this.getId(t);break;case"AXIS":e.coordinate_system||(e.coordinate_system={type:"unspecified",axis:[]}),e.coordinate_system.axis.push(this.convertAxis(t));break;case"LENGTHUNIT":let f=this.convertUnit(t,"LinearUnit");e.coordinate_system&&e.coordinate_system.axis&&e.coordinate_system.axis.forEach(d=>{d.unit||(d.unit=f)}),f.conversion_factor&&f.conversion_factor!==1&&e.semi_major_axis&&(e.semi_major_axis={value:e.semi_major_axis,unit:f});break;default:e.keyword=t[0];break}return e}},ud=n_;var s_=class extends ud{static convert(t,e={}){return super.convert(t,e),e.coordinate_system&&e.coordinate_system.subtype==="Cartesian"&&delete e.coordinate_system,e.usage&&delete e.usage,e}},GS=s_;var o_=class extends ud{static convert(t,e={}){super.convert(t,e);let r=t.find(s=>Array.isArray(s)&&s[0]==="CS");r&&(e.coordinate_system={subtype:r[1],axis:this.extractAxes(t)});let n=t.find(s=>Array.isArray(s)&&s[0]==="USAGE");if(n){let s=n.find(l=>Array.isArray(l)&&l[0]==="SCOPE"),o=n.find(l=>Array.isArray(l)&&l[0]==="AREA"),a=n.find(l=>Array.isArray(l)&&l[0]==="BBOX");e.usage={},s&&(e.usage.scope=s[1]),o&&(e.usage.area=o[1]),a&&(e.usage.bbox=a.slice(1))}return e}},kS=o_;function t4(i){return i.find(t=>Array.isArray(t)&&t[0]==="USAGE")?"2019":(i.find(t=>Array.isArray(t)&&t[0]==="CS")||i[0]==="BOUNDCRS"||i[0]==="PROJCRS"||i[0]==="GEOGCRS","2015")}function zS(i){return(t4(i)==="2019"?kS:GS).convert(i)}function jS(i){let t=i.toUpperCase();return t.includes("PROJCRS")||t.includes("GEOGCRS")||t.includes("BOUNDCRS")||t.includes("VERTCRS")||t.includes("LENGTHUNIT")||t.includes("ANGLEUNIT")||t.includes("SCALEUNIT")?"WKT2":(t.includes("PROJCS")||t.includes("GEOGCS")||t.includes("LOCAL_CS")||t.includes("VERT_CS")||t.includes("UNIT"),"WKT1")}var US=n4,jc=1,BS=2,qS=3,fd=4,XS=5,a_=-1,e4=/\s/,i4=/[A-Za-z]/,r4=/[A-Za-z84_]/,dd=/[,\]]/,VS=/[\d\.E\-\+]/;function ns(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=jc}ns.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==fd)for(;e4.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case jc:return this.neutral(i);case BS:return this.keyword(i);case fd:return this.quoted(i);case XS:return this.afterquote(i);case qS:return this.number(i);case a_:return}};ns.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=fd;return}if(dd.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};ns.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=jc;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=jc,this.currentObject=this.stack.pop(),this.currentObject||(this.state=a_);return}};ns.prototype.number=function(i){if(VS.test(i)){this.word+=i;return}if(dd.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};ns.prototype.quoted=function(i){if(i==='"'){this.state=XS;return}this.word+=i};ns.prototype.keyword=function(i){if(r4.test(i)){this.word+=i;return}if(i==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=jc;return}if(dd.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};ns.prototype.neutral=function(i){if(i4.test(i)){this.word=i,this.state=BS;return}if(i==='"'){this.word="",this.state=fd;return}if(VS.test(i)){this.word=i,this.state=qS;return}if(dd.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};ns.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===a_)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function n4(i){var t=new ns(i);return t.output()}function l_(i,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var r=t?{}:i,n=e.reduce(function(s,o){return Go(o,s),s},r);t&&(i[t]=n)}function Go(i,t){if(!Array.isArray(i)){t[i]=!0;return}var e=i.shift();if(e==="PARAMETER"&&(e=i.shift()),i.length===1){if(Array.isArray(i[0])){t[e]={},Go(i[0],t[e]);return}t[e]=i[0];return}if(!i.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=i;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(i);return}Array.isArray(e)||(t[e]={});var r;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&Go(i[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:i[0],a:i[1],rf:i[2]},i.length===4&&Go(i[3],t[e]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":i[0]=["name",i[0]],l_(t,e,i);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":i[0]=["name",i[0]],l_(t,e,i),t[e].type=e;return;default:for(r=-1;++r<i.length;)if(!Array.isArray(i[r]))return Go(i,t[e]);return l_(t,e,i)}}var s4=.017453292519943295;function Mr(i){return i*s4}function md(i){let t=(i.projName||"").toLowerCase().replace(/_/g," ");!i.long0&&i.longc&&(t==="albers conic equal area"||t==="lambert azimuthal equal area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(t==="stereographic south pole"||t==="polar stereographic (variant b)")?(i.lat0=Mr(i.lat1>0?90:-90),i.lat_ts=i.lat1,delete i.lat1):!i.lat_ts&&i.lat0&&(t==="polar stereographic"||t==="polar stereographic (variant a)")&&(i.lat_ts=i.lat0,i.lat0=Mr(i.lat0>0?90:-90),delete i.lat1)}function WS(i){let t={units:null,to_meter:void 0};return typeof i=="string"?(t.units=i.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.units==="meter"&&(t.to_meter=1)):i&&i.name&&(t.units=i.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.to_meter=i.conversion_factor),t}function YS(i){return typeof i=="object"?i.value*i.unit.conversion_factor:i}function $S(i,t){i.ellipsoid.radius?(t.a=i.ellipsoid.radius,t.rf=0):(t.a=YS(i.ellipsoid.semi_major_axis),i.ellipsoid.inverse_flattening!==void 0?t.rf=i.ellipsoid.inverse_flattening:i.ellipsoid.semi_major_axis!==void 0&&i.ellipsoid.semi_minor_axis!==void 0&&(t.rf=t.a/(t.a-YS(i.ellipsoid.semi_minor_axis))))}function Uc(i,t={}){return!i||typeof i!="object"?i:i.type==="BoundCRS"?(Uc(i.source_crs,t),i.transformation&&(i.transformation.method&&i.transformation.method.name==="NTv2"?t.nadgrids=i.transformation.parameters[0].value:t.datum_params=i.transformation.parameters.map(e=>e.value)),t):(Object.keys(i).forEach(e=>{let r=i[e];if(r!==null)switch(e){case"name":if(t.srsCode)break;t.name=r,t.srsCode=r;break;case"type":r==="GeographicCRS"?t.projName="longlat":r==="ProjectedCRS"&&i.conversion&&i.conversion.method&&(t.projName=i.conversion.method.name);break;case"datum":case"datum_ensemble":r.ellipsoid&&(t.ellps=r.ellipsoid.name,$S(r,t)),r.prime_meridian&&(t.from_greenwich=r.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":t.ellps=r.name,$S(r,t);break;case"prime_meridian":t.long0=(r.longitude||0)*Math.PI/180;break;case"coordinate_system":if(r.axis){if(t.axis=r.axis.map(n=>{let s=n.direction;if(s==="east")return"e";if(s==="north")return"n";if(s==="west")return"w";if(s==="south")return"s";throw new Error(`Unknown axis direction: ${s}`)}).join("")+"u",r.unit){let{units:n,to_meter:s}=WS(r.unit);t.units=n,t.to_meter=s}else if(r.axis[0]&&r.axis[0].unit){let{units:n,to_meter:s}=WS(r.axis[0].unit);t.units=n,t.to_meter=s}}break;case"id":r.authority&&r.code&&(t.title=r.authority+":"+r.code);break;case"conversion":r.method&&r.method.name&&(t.projName=r.method.name),r.parameters&&r.parameters.forEach(n=>{let s=n.name.toLowerCase().replace(/\s+/g,"_"),o=n.value;n.unit&&n.unit.conversion_factor?t[s]=o*n.unit.conversion_factor:n.unit==="degree"?t[s]=o*Math.PI/180:t[s]=o});break;case"unit":r.name&&(t.units=r.name.toLowerCase(),t.units==="metre"&&(t.units="meter")),r.conversion_factor&&(t.to_meter=r.conversion_factor);break;case"base_crs":Uc(r,t),t.datumCode=r.id?r.id.authority+"_"+r.id.code:r.name;break;default:break}}),t.latitude_of_false_origin!==void 0&&(t.lat0=t.latitude_of_false_origin),t.longitude_of_false_origin!==void 0&&(t.long0=t.longitude_of_false_origin),t.latitude_of_standard_parallel!==void 0&&(t.lat0=t.latitude_of_standard_parallel,t.lat1=t.latitude_of_standard_parallel),t.latitude_of_1st_standard_parallel!==void 0&&(t.lat1=t.latitude_of_1st_standard_parallel),t.latitude_of_2nd_standard_parallel!==void 0&&(t.lat2=t.latitude_of_2nd_standard_parallel),t.latitude_of_projection_centre!==void 0&&(t.lat0=t.latitude_of_projection_centre),t.longitude_of_projection_centre!==void 0&&(t.longc=t.longitude_of_projection_centre),t.easting_at_false_origin!==void 0&&(t.x0=t.easting_at_false_origin),t.northing_at_false_origin!==void 0&&(t.y0=t.northing_at_false_origin),t.latitude_of_natural_origin!==void 0&&(t.lat0=t.latitude_of_natural_origin),t.longitude_of_natural_origin!==void 0&&(t.long0=t.longitude_of_natural_origin),t.longitude_of_origin!==void 0&&(t.long0=t.longitude_of_origin),t.false_easting!==void 0&&(t.x0=t.false_easting),t.easting_at_projection_centre&&(t.x0=t.easting_at_projection_centre),t.false_northing!==void 0&&(t.y0=t.false_northing),t.northing_at_projection_centre&&(t.y0=t.northing_at_projection_centre),t.standard_parallel_1!==void 0&&(t.lat1=t.standard_parallel_1),t.standard_parallel_2!==void 0&&(t.lat2=t.standard_parallel_2),t.scale_factor_at_natural_origin!==void 0&&(t.k0=t.scale_factor_at_natural_origin),t.scale_factor_at_projection_centre!==void 0&&(t.k0=t.scale_factor_at_projection_centre),t.scale_factor_on_pseudo_standard_parallel!==void 0&&(t.k0=t.scale_factor_on_pseudo_standard_parallel),t.azimuth!==void 0&&(t.alpha=t.azimuth),t.azimuth_at_projection_centre!==void 0&&(t.alpha=t.azimuth_at_projection_centre),t.angle_from_rectified_to_skew_grid&&(t.rectified_grid_angle=t.angle_from_rectified_to_skew_grid),md(t),t)}var o4=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function a4(i,t){var e=t[0],r=t[1];!(e in i)&&r in i&&(i[e]=i[r],t.length===3&&(i[e]=t[2](i[e])))}function KS(i){for(var t=Object.keys(i),e=0,r=t.length;e<r;++e){var n=t[e];o4.indexOf(n)!==-1&&l4(i[n]),typeof i[n]=="object"&&KS(i[n])}}function l4(i){if(i.AUTHORITY){var t=Object.keys(i.AUTHORITY)[0];t&&t in i.AUTHORITY&&(i.title=t+":"+i.AUTHORITY[t])}if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var e="",r=0,n=i.AXIS.length;r<n;++r){var s=[i.AXIS[r][0].toLowerCase(),i.AXIS[r][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(i.axis=e)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var o=i.GEOGCS;i.type==="GEOGCS"&&(o=i),o&&(o.DATUM?i.datumCode=o.DATUM.name.toLowerCase():i.datumCode=o.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),i.datumCode==="new_zealand_1949"&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode==="belge_1972"&&(i.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(i.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=o.DATUM.SPHEROID.a,i.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(i.datum_params=o.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a),i.rectified_grid_angle&&(i.rectified_grid_angle=Mr(i.rectified_grid_angle));function a(h){var u=i.to_meter||1;return h*u}var l=function(h){return a4(i,h)},c=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Mr],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Mr],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",Mr],["lat0","latitude_of_origin",Mr],["lat0","standard_parallel_1",Mr],["lat1","standard_parallel_1",Mr],["lat2","standard_parallel_2",Mr],["azimuth","Azimuth"],["alpha","azimuth",Mr],["srsCode","name"]];c.forEach(l),md(i)}function Bc(i){if(typeof i=="object")return Uc(i);let t=jS(i);var e=US(i);if(t==="WKT2"){let s=zS(e);return Uc(s)}var r=e[0],n={};return Go(e,n),KS(n),n[r]}function Tr(i){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?Tr[i]=zc(arguments[1]):Tr[i]=Bc(arguments[1]):Tr[i]=e}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(r){Array.isArray(r)?Tr.apply(t,r):Tr(r)});if(typeof i=="string"){if(i in Tr)return Tr[i]}else"EPSG"in i?Tr["EPSG:"+i.EPSG]=i:"ESRI"in i?Tr["ESRI:"+i.ESRI]=i:"IAU2000"in i?Tr["IAU2000:"+i.IAU2000]=i:console.log(i);return}}RS(Tr);var Za=Tr;function c4(i){return typeof i=="string"}function h4(i){return i in Za}function u4(i){return i.indexOf("+")!==0&&i.indexOf("[")!==-1||typeof i=="object"&&!("srsCode"in i)}var f4=["3857","900913","3785","102113"];function d4(i){var t=mr(i,"authority");if(t){var e=mr(t,"epsg");return e&&f4.indexOf(e)>-1}}function m4(i){var t=mr(i,"extension");if(t)return mr(t,"proj4")}function p4(i){return i[0]==="+"}function g4(i){if(c4(i)){if(h4(i))return Za[i];if(u4(i)){var t=Bc(i);if(d4(t))return Za["EPSG:3857"];var e=m4(t);return e?zc(e):t}if(p4(i))return zc(i)}else return i.projName?i:Bc(i)}var HS=g4;function c_(i,t){i=i||{};var e,r;if(!t)return i;for(r in t)e=t[r],e!==void 0&&(i[r]=e);return i}function _i(i,t,e){var r=i*t;return e/Math.sqrt(1-r*r)}function bn(i){return i<0?-1:1}function j(i){return Math.abs(i)<=Me?i:i-bn(i)*Hs}function Ti(i,t,e){var r=i*e,n=.5*i;return r=Math.pow((1-r)/(1+r),n),Math.tan(.5*(D-t))/r}function ss(i,t){for(var e=.5*i,r,n,s=D-2*Math.atan(t),o=0;o<=15;o++)if(r=i*Math.sin(s),n=D-2*Math.atan(t*Math.pow((1-r)/(1+r),e))-s,s+=n,Math.abs(n)<=1e-10)return s;return-9999}function y4(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=_i(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function _4(i){var t=i.x,e=i.y;if(e*Ki>90&&e*Ki<-90&&t*Ki>180&&t*Ki<-180)return null;var r,n;if(Math.abs(Math.abs(e)-D)<=U)return null;if(this.sphere)r=this.x0+this.a*this.k0*j(t-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(Yt+.5*e));else{var s=Math.sin(e),o=Ti(this.e,e,s);r=this.x0+this.a*this.k0*j(t-this.long0),n=this.y0-this.a*this.k0*Math.log(o)}return i.x=r,i.y=n,i}function x4(i){var t=i.x-this.x0,e=i.y-this.y0,r,n;if(this.sphere)n=D-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var s=Math.exp(-e/(this.a*this.k0));if(n=ss(this.e,s),n===-9999)return null}return r=j(this.long0+t/(this.a*this.k0)),i.x=r,i.y=n,i}var v4=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"],ZS={init:y4,forward:_4,inverse:x4,names:v4};function E4(){}function JS(i){return i}var w4=["longlat","identity"],QS={init:E4,forward:JS,inverse:JS,names:w4};var S4=[ZS,QS],ko={},Ja=[];function t2(i,t){var e=Ja.length;return i.names?(Ja[e]=i,i.names.forEach(function(r){ko[r.toLowerCase()]=e}),this):(console.log(t),!0)}function h_(i){return i.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function b4(i){if(!i)return!1;var t=i.toLowerCase();if(typeof ko[t]<"u"&&Ja[ko[t]]||(t=h_(t),t in ko&&Ja[ko[t]]))return Ja[ko[t]]}function C4(){S4.forEach(t2)}var e2={start:C4,add:t2,get:b4};var M4={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},u_=M4;var T4=u_.WGS84;function i2(i,t,e,r){var n=i*i,s=t*t,o=(n-s)/n,a=0;r?(i*=1-o*(LS+o*(OS+o*FS)),n=i*i,o=0):a=Math.sqrt(o);var l=(n-s)/s;return{es:o,e:a,ep2:l}}function r2(i,t,e,r,n){if(!i){var s=mr(u_,r);s||(s=T4),i=s.a,t=s.b,e=s.rf}return e&&!t&&(t=(1-1/e)*i),(e===0||Math.abs(i-t)<U)&&(n=!0,t=i),{a:i,b:t,rf:e,sphere:n}}var gd={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(n2 in gd)pd=gd[n2],pd.datumName&&(gd[pd.datumName]=pd);var pd,n2,s2=gd;function P4(i,t,e,r,n,s,o){var a={};return i===void 0||i==="none"?a.datum_type=kc:a.datum_type=IS,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Yr),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=$r,a.datum_params[3]*=Do,a.datum_params[4]*=Do,a.datum_params[5]*=Do,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=rs,a.grids=o),a.a=e,a.b=r,a.es=n,a.ep2=s,a}var o2=P4;var d_={};function m_(i,t,e){return t instanceof ArrayBuffer?R4(i,t,e):{ready:I4(i,t)}}function R4(i,t,e){var r=!0;e!==void 0&&e.includeErrorFields===!1&&(r=!1);var n=new DataView(t),s=L4(n),o=O4(n,s),a=F4(n,o,s,r),l={header:o,subgrids:a};return d_[i]=l,l}function I4(i,t){return to(this,null,function*(){for(var e=[],r=yield t.getImageCount(),n=r-1;n>=0;n--){var s=yield t.getImage(n),o=yield s.readRasters(),a=o,l=[s.getWidth(),s.getHeight()],c=s.getBoundingBox().map(a2),h=[s.fileDirectory.ModelPixelScale[0],s.fileDirectory.ModelPixelScale[1]].map(a2),u=c[0]+(l[0]-1)*h[0],f=c[3]-(l[1]-1)*h[1],d=a[0],m=a[1],p=[];for(let _=l[1]-1;_>=0;_--)for(let x=l[0]-1;x>=0;x--){var g=_*l[0]+x;p.push([-Zs(m[g]),Zs(d[g])])}e.push({del:h,lim:l,ll:[-u,f],cvs:p})}var y={header:{nSubgrids:r},subgrids:e};return d_[i]=y,y})}function l2(i){if(i===void 0)return null;var t=i.split(",");return t.map(A4)}function A4(i){if(i.length===0)return null;var t=i[0]==="@";return t&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:i,mandatory:!t,grid:d_[i]||null,isNull:!1}}function a2(i){return i*Math.PI/180}function Zs(i){return i/3600*Math.PI/180}function L4(i){var t=i.getInt32(8,!1);return t===11?!1:(t=i.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function O4(i,t){return{nFields:i.getInt32(8,t),nSubgridFields:i.getInt32(24,t),nSubgrids:i.getInt32(40,t),shiftType:f_(i,56,64).trim(),fromSemiMajorAxis:i.getFloat64(120,t),fromSemiMinorAxis:i.getFloat64(136,t),toSemiMajorAxis:i.getFloat64(152,t),toSemiMinorAxis:i.getFloat64(168,t)}}function f_(i,t,e){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(t,e)))}function F4(i,t,e,r){for(var n=176,s=[],o=0;o<t.nSubgrids;o++){var a=D4(i,n,e),l=G4(i,n,a,e,r),c=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);s.push({ll:[Zs(a.lowerLongitude),Zs(a.lowerLatitude)],del:[Zs(a.longitudeInterval),Zs(a.latitudeInterval)],lim:[c,h],count:a.gridNodeCount,cvs:N4(l)});var u=16;r===!1&&(u=8),n+=176+a.gridNodeCount*u}return s}function N4(i){return i.map(function(t){return[Zs(t.longitudeShift),Zs(t.latitudeShift)]})}function D4(i,t,e){return{name:f_(i,t+8,t+16).trim(),parent:f_(i,t+24,t+24+8).trim(),lowerLatitude:i.getFloat64(t+72,e),upperLatitude:i.getFloat64(t+88,e),lowerLongitude:i.getFloat64(t+104,e),upperLongitude:i.getFloat64(t+120,e),latitudeInterval:i.getFloat64(t+136,e),longitudeInterval:i.getFloat64(t+152,e),gridNodeCount:i.getInt32(t+168,e)}}function G4(i,t,e,r,n){var s=t+176,o=16;n===!1&&(o=8);for(var a=[],l=0;l<e.gridNodeCount;l++){var c={latitudeShift:i.getFloat32(s+l*o,r),longitudeShift:i.getFloat32(s+l*o+4,r)};n!==!1&&(c.latitudeAccuracy=i.getFloat32(s+l*o+8,r),c.longitudeAccuracy=i.getFloat32(s+l*o+12,r)),a.push(c)}return a}function Qa(i,t){if(!(this instanceof Qa))return new Qa(i);t=t||function(c){if(c)throw c};var e=HS(i);if(typeof e!="object"){t("Could not parse to valid json: "+i);return}var r=Qa.projections.get(e.projName);if(!r){t("Could not get projection name from: "+i);return}if(e.datumCode&&e.datumCode!=="none"){var n=mr(s2,e.datumCode);n&&(e.datum_params=e.datum_params||(n.towgs84?n.towgs84.split(","):null),e.ellps=n.ellipse,e.datumName=n.datumName?n.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var s=r2(e.a,e.b,e.rf,e.ellps,e.sphere),o=i2(s.a,s.b,s.rf,e.R_A),a=l2(e.nadgrids),l=e.datum||o2(e.datumCode,e.datum_params,s.a,s.b,o.es,o.ep2,a);c_(this,e),c_(this,r),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),t(null,this)}Qa.projections=e2;Qa.projections.start();var Js=Qa;function c2(i,t){return i.datum_type!==t.datum_type||i.a!==t.a||Math.abs(i.es-t.es)>5e-11?!1:i.datum_type===Yr?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]:i.datum_type===$r?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]&&i.datum_params[3]===t.datum_params[3]&&i.datum_params[4]===t.datum_params[4]&&i.datum_params[5]===t.datum_params[5]&&i.datum_params[6]===t.datum_params[6]:!0}function yd(i,t,e){var r=i.x,n=i.y,s=i.z?i.z:0,o,a,l,c;if(n<-D&&n>-1.001*D)n=-D;else if(n>D&&n<1.001*D)n=D;else{if(n<-D)return{x:-1/0,y:-1/0,z:i.z};if(n>D)return{x:1/0,y:1/0,z:i.z}}return r>Math.PI&&(r-=2*Math.PI),a=Math.sin(n),c=Math.cos(n),l=a*a,o=e/Math.sqrt(1-t*l),{x:(o+s)*c*Math.cos(r),y:(o+s)*c*Math.sin(r),z:(o*(1-t)+s)*a}}function _d(i,t,e,r){var n=1e-12,s=n*n,o=30,a,l,c,h,u,f,d,m,p,g,y,_,x,v=i.x,E=i.y,b=i.z?i.z:0,S,T,P;if(a=Math.sqrt(v*v+E*E),l=Math.sqrt(v*v+E*E+b*b),a/e<n){if(S=0,l/e<n)return T=D,P=-r,{x:i.x,y:i.y,z:i.z}}else S=Math.atan2(E,v);c=b/l,h=a/l,u=1/Math.sqrt(1-t*(2-t)*h*h),m=h*(1-t)*u,p=c*u,x=0;do x++,d=e/Math.sqrt(1-t*p*p),P=a*m+b*p-d*(1-t*p*p),f=t*d/(d+P),u=1/Math.sqrt(1-f*(2-f)*h*h),g=h*(1-f)*u,y=c*u,_=y*m-g*p,m=g,p=y;while(_*_>s&&x<o);return T=Math.atan(y/Math.abs(g)),{x:S,y:T,z:P}}function h2(i,t,e){if(t===Yr)return{x:i.x+e[0],y:i.y+e[1],z:i.z+e[2]};if(t===$r){var r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6];return{x:c*(i.x-l*i.y+a*i.z)+r,y:c*(l*i.x+i.y-o*i.z)+n,z:c*(-a*i.x+o*i.y+i.z)+s}}}function u2(i,t,e){if(t===Yr)return{x:i.x-e[0],y:i.y-e[1],z:i.z-e[2]};if(t===$r){var r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=(i.x-r)/c,u=(i.y-n)/c,f=(i.z-s)/c;return{x:h+l*u-a*f,y:-l*h+u+o*f,z:a*h-o*u+f}}}function xd(i){return i===Yr||i===$r}function m2(i,t,e){if(c2(i,t)||i.datum_type===kc||t.datum_type===kc)return e;var r=i.a,n=i.es;if(i.datum_type===rs){var s=f2(i,!1,e);if(s!==0)return;r=i_,n=r_}var o=t.a,a=t.b,l=t.es;if(t.datum_type===rs&&(o=i_,a=AS,l=r_),n===l&&r===o&&!xd(i.datum_type)&&!xd(t.datum_type))return e;if(e=yd(e,n,r),xd(i.datum_type)&&(e=h2(e,i.datum_type,i.datum_params)),xd(t.datum_type)&&(e=u2(e,t.datum_type,t.datum_params)),e=_d(e,l,o,a),t.datum_type===rs){var c=f2(t,!0,e);if(c!==0)return}return e}function f2(i,t,e){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;var r={x:-e.x,y:e.y},n={x:Number.NaN,y:Number.NaN},s=[];t:for(var o=0;o<i.grids.length;o++){var a=i.grids[o];if(s.push(a.name),a.isNull){n=r;break}if(a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var l=a.grid.subgrids,c=0,h=l.length;c<h;c++){var u=l[c],f=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,d=u.ll[0]-f,m=u.ll[1]-f,p=u.ll[0]+(u.lim[0]-1)*u.del[0]+f,g=u.ll[1]+(u.lim[1]-1)*u.del[1]+f;if(!(m>r.y||d>r.x||g<r.y||p<r.x)&&(n=k4(r,t,u),!isNaN(n.x)))break t}}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*Ki+" "+r.y*Ki+" tried: '"+s+"'"),-1):(e.x=-n.x,e.y=n.y,0)}function k4(i,t,e){var r={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return r;var n={x:i.x,y:i.y};n.x-=e.ll[0],n.y-=e.ll[1],n.x=j(n.x-Math.PI)+Math.PI;var s=d2(n,e);if(t){if(isNaN(s.x))return r;s.x=n.x-s.x,s.y=n.y-s.y;var o=9,a=1e-12,l,c;do{if(c=d2(s,e),isNaN(c.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:n.x-(c.x+s.x),y:n.y-(c.y+s.y)},s.x+=l.x,s.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=j(s.x+e.ll[0]),r.y=s.y+e.ll[1]}else isNaN(s.x)||(r.x=i.x+s.x,r.y=i.y+s.y);return r}function d2(i,t){var e={x:i.x/t.del[0],y:i.y/t.del[1]},r={x:Math.floor(e.x),y:Math.floor(e.y)},n={x:e.x-1*r.x,y:e.y-1*r.y},s={x:Number.NaN,y:Number.NaN},o;if(r.x<0||r.x>=t.lim[0]||r.y<0||r.y>=t.lim[1])return s;o=r.y*t.lim[0]+r.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var l={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var c={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var h={x:t.cvs[o][0],y:t.cvs[o][1]},u=n.x*n.y,f=n.x*(1-n.y),d=(1-n.x)*(1-n.y),m=(1-n.x)*n.y;return s.x=d*a.x+f*l.x+m*h.x+u*c.x,s.y=d*a.y+f*l.y+m*h.y+u*c.y,s}function p_(i,t,e){var r=e.x,n=e.y,s=e.z||0,o,a,l,c={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(o=r,"ew".indexOf(i.axis[l])!==-1?a="x":a="y"):l===1?(o=n,"ns".indexOf(i.axis[l])!==-1?a="y":a="x"):(o=s,a="z"),i.axis[l]){case"e":c[a]=o;break;case"w":c[a]=-o;break;case"n":c[a]=o;break;case"s":c[a]=-o;break;case"u":e[a]!==void 0&&(c.z=o);break;case"d":e[a]!==void 0&&(c.z=-o);break;default:return null}return c}function vd(i){var t={x:i[0],y:i[1]};return i.length>2&&(t.z=i[2]),i.length>3&&(t.m=i[3]),t}function g2(i){p2(i.x),p2(i.y)}function p2(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function z4(i,t){return(i.datum.datum_type===Yr||i.datum.datum_type===$r||i.datum.datum_type===rs)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Yr||t.datum.datum_type===$r||t.datum.datum_type===rs)&&i.datumCode!=="WGS84"}function zo(i,t,e,r){var n;Array.isArray(e)?e=vd(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var s=e.z!==void 0;if(g2(e),i.datum&&t.datum&&z4(i,t)&&(n=new Js("WGS84"),e=zo(i,n,e,r),i=n),r&&i.axis!=="enu"&&(e=p_(i,!1,e)),i.projName==="longlat")e={x:e.x*Ht,y:e.y*Ht,z:e.z||0};else if(i.to_meter&&(e={x:e.x*i.to_meter,y:e.y*i.to_meter,z:e.z||0}),e=i.inverse(e),!e)return;if(i.from_greenwich&&(e.x+=i.from_greenwich),e=m2(i.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*Ki,y:e.y*Ki,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),r&&t.axis!=="enu"?p_(t,!0,e):(e&&!s&&delete e.z,e)}var y2=Js("WGS84");function g_(i,t,e,r){var n,s,o;return Array.isArray(e)?(n=zo(i,t,e,r)||{x:NaN,y:NaN},e.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof n.z=="number"?[n.x,n.y,n.z].concat(e.slice(3)):[n.x,n.y,e[2]].concat(e.slice(3)):[n.x,n.y].concat(e.slice(2)):[n.x,n.y]):(s=zo(i,t,e,r),o=Object.keys(e),o.length===2||o.forEach(function(a){if(typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;s[a]=e[a]}),s)}function _2(i){return i instanceof Js?i:i.oProj?i.oProj:Js(i)}function j4(i,t,e){i=_2(i);var r=!1,n;return typeof t>"u"?(t=i,i=y2,r=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=i,i=y2,r=!0),t=_2(t),e?g_(i,t,e):(n={forward:function(s,o){return g_(i,t,s,o)},inverse:function(s,o){return g_(t,i,s,o)}},r&&(n.oProj=t),n)}var Hi=j4;var x2=6,E2="AJSAJS",w2="AFAFAF",tl=65,Zi=73,Pr=79,qc=86,Xc=90,S2={forward:__,inverse:U4,toPoint:x_};function __(i,t){return t=t||5,X4(B4({lat:i[1],lon:i[0]}),t)}function U4(i){var t=v_(C2(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function x_(i){var t=v_(C2(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function y_(i){return i*(Math.PI/180)}function v2(i){return 180*(i/Math.PI)}function B4(i){var t=i.lat,e=i.lon,r=6378137,n=.00669438,s=.9996,o,a,l,c,h,u,f,d=y_(t),m=y_(e),p,g;g=Math.floor((e+180)/6)+1,e===180&&(g=60),t>=56&&t<64&&e>=3&&e<12&&(g=32),t>=72&&t<84&&(e>=0&&e<9?g=31:e>=9&&e<21?g=33:e>=21&&e<33?g=35:e>=33&&e<42&&(g=37)),o=(g-1)*6-180+3,p=y_(o),a=n/(1-n),l=r/Math.sqrt(1-n*Math.sin(d)*Math.sin(d)),c=Math.tan(d)*Math.tan(d),h=a*Math.cos(d)*Math.cos(d),u=Math.cos(d)*(m-p),f=r*((1-n/4-3*n*n/64-5*n*n*n/256)*d-(3*n/8+3*n*n/32+45*n*n*n/1024)*Math.sin(2*d)+(15*n*n/256+45*n*n*n/1024)*Math.sin(4*d)-35*n*n*n/3072*Math.sin(6*d));var y=s*l*(u+(1-c+h)*u*u*u/6+(5-18*c+c*c+72*h-58*a)*u*u*u*u*u/120)+5e5,_=s*(f+l*Math.tan(d)*(u*u/2+(5-c+9*h+4*h*h)*u*u*u*u/24+(61-58*c+c*c+600*h-330*a)*u*u*u*u*u*u/720));return t<0&&(_+=1e7),{northing:Math.round(_),easting:Math.round(y),zoneNumber:g,zoneLetter:q4(t)}}function v_(i){var t=i.northing,e=i.easting,r=i.zoneLetter,n=i.zoneNumber;if(n<0||n>60)return null;var s=.9996,o=6378137,a=.00669438,l,c=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),h,u,f,d,m,p,g,y,_,x=e-5e5,v=t;r<"N"&&(v-=1e7),g=(n-1)*6-180+3,l=a/(1-a),p=v/s,y=p/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),_=y+(3*c/2-27*c*c*c/32)*Math.sin(2*y)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*y)+151*c*c*c/96*Math.sin(6*y),h=o/Math.sqrt(1-a*Math.sin(_)*Math.sin(_)),u=Math.tan(_)*Math.tan(_),f=l*Math.cos(_)*Math.cos(_),d=o*(1-a)/Math.pow(1-a*Math.sin(_)*Math.sin(_),1.5),m=x/(h*s);var E=_-h*Math.tan(_)/d*(m*m/2-(5+3*u+10*f-4*f*f-9*l)*m*m*m*m/24+(61+90*u+298*f+45*u*u-252*l-3*f*f)*m*m*m*m*m*m/720);E=v2(E);var b=(m-(1+2*u+f)*m*m*m/6+(5-2*f+28*u-3*f*f+8*l+24*u*u)*m*m*m*m*m/120)/Math.cos(_);b=g+v2(b);var S;if(i.accuracy){var T=v_({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});S={top:T.lat,right:T.lon,bottom:E,left:b}}else S={lat:E,lon:b};return S}function q4(i){var t="Z";return 84>=i&&i>=72?t="X":72>i&&i>=64?t="W":64>i&&i>=56?t="V":56>i&&i>=48?t="U":48>i&&i>=40?t="T":40>i&&i>=32?t="S":32>i&&i>=24?t="R":24>i&&i>=16?t="Q":16>i&&i>=8?t="P":8>i&&i>=0?t="N":0>i&&i>=-8?t="M":-8>i&&i>=-16?t="L":-16>i&&i>=-24?t="K":-24>i&&i>=-32?t="J":-32>i&&i>=-40?t="H":-40>i&&i>=-48?t="G":-48>i&&i>=-56?t="F":-56>i&&i>=-64?t="E":-64>i&&i>=-72?t="D":-72>i&&i>=-80&&(t="C"),t}function X4(i,t){var e="00000"+i.easting,r="00000"+i.northing;return i.zoneNumber+i.zoneLetter+V4(i.easting,i.northing,i.zoneNumber)+e.substr(e.length-5,t)+r.substr(r.length-5,t)}function V4(i,t,e){var r=b2(e),n=Math.floor(i/1e5),s=Math.floor(t/1e5)%20;return W4(n,s,r)}function b2(i){var t=i%x2;return t===0&&(t=x2),t}function W4(i,t,e){var r=e-1,n=E2.charCodeAt(r),s=w2.charCodeAt(r),o=n+i-1,a=s+t,l=!1;o>Xc&&(o=o-Xc+tl-1,l=!0),(o===Zi||n<Zi&&o>Zi||(o>Zi||n<Zi)&&l)&&o++,(o===Pr||n<Pr&&o>Pr||(o>Pr||n<Pr)&&l)&&(o++,o===Zi&&o++),o>Xc&&(o=o-Xc+tl-1),a>qc?(a=a-qc+tl-1,l=!0):l=!1,(a===Zi||s<Zi&&a>Zi||(a>Zi||s<Zi)&&l)&&a++,(a===Pr||s<Pr&&a>Pr||(a>Pr||s<Pr)&&l)&&(a++,a===Zi&&a++),a>qc&&(a=a-qc+tl-1);var c=String.fromCharCode(o)+String.fromCharCode(a);return c}function C2(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var t=i.length,e=null,r="",n,s=0;!/[A-Z]/.test(n=i.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+i;r+=n,s++}var o=parseInt(r,10);if(s===0||s+3>t)throw"MGRSPoint bad conversion from: "+i;var a=i.charAt(s++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+i;e=i.substring(s,s+=2);for(var l=b2(o),c=Y4(e.charAt(0),l),h=$4(e.charAt(1),l);h<K4(a);)h+=2e6;var u=t-s;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var f=u/2,d=0,m=0,p,g,y,_,x;return f>0&&(p=1e5/Math.pow(10,f),g=i.substring(s,s+f),d=parseFloat(g)*p,y=i.substring(s+f),m=parseFloat(y)*p),_=d+c,x=m+h,{easting:_,northing:x,zoneLetter:a,zoneNumber:o,accuracy:p}}function Y4(i,t){for(var e=E2.charCodeAt(t-1),r=1e5,n=!1;e!==i.charCodeAt(0);){if(e++,e===Zi&&e++,e===Pr&&e++,e>Xc){if(n)throw"Bad character: "+i;e=tl,n=!0}r+=1e5}return r}function $4(i,t){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var e=w2.charCodeAt(t-1),r=0,n=!1;e!==i.charCodeAt(0);){if(e++,e===Zi&&e++,e===Pr&&e++,e>qc){if(n)throw"Bad character: "+i;e=tl,n=!0}r+=1e5}return r}function K4(i){var t;switch(i){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+i}function el(i,t,e){if(!(this instanceof el))return new el(i,t,e);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof t>"u"){var r=i.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=i,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}el.fromMGRS=function(i){return new el(x_(i))};el.prototype.toMGRS=function(i){return __([this.x,this.y],i)};var M2=el;var H4=1,Z4=.25,T2=.046875,P2=.01953125,R2=.01068115234375,J4=.75,Q4=.46875,t3=.013020833333333334,e3=.007120768229166667,i3=.3645833333333333,r3=.005696614583333333,n3=.3076171875;function il(i){var t=[];t[0]=H4-i*(Z4+i*(T2+i*(P2+i*R2))),t[1]=i*(J4-i*(T2+i*(P2+i*R2)));var e=i*i;return t[2]=e*(Q4-i*(t3+i*e3)),e*=i,t[3]=e*(i3-i*r3),t[4]=e*i*n3,t}function Cn(i,t,e,r){return e*=t,t*=t,r[0]*i-e*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))}var s3=20;function rl(i,t,e){for(var r=1/(1-t),n=i,s=s3;s;--s){var o=Math.sin(n),a=1-t*o*o;if(a=(Cn(n,o,Math.cos(n),e)-i)*(a*Math.sqrt(a))*r,n-=a,Math.abs(a)<U)return n}return n}function o3(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=il(this.es),this.ml0=Cn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function a3(i){var t=i.x,e=i.y,r=j(t-this.long0),n,s,o,a=Math.sin(e),l=Math.cos(e);if(this.es){var h=l*r,u=Math.pow(h,2),f=this.ep2*Math.pow(l,2),d=Math.pow(f,2),m=Math.abs(l)>U?Math.tan(e):0,p=Math.pow(m,2),g=Math.pow(p,2);n=1-this.es*Math.pow(a,2),h=h/Math.sqrt(n);var y=Cn(e,a,l,this.en);s=this.a*(this.k0*h*(1+u/6*(1-p+f+u/20*(5-18*p+g+14*f-58*p*f+u/42*(61+179*g-g*p-479*p)))))+this.x0,o=this.a*(this.k0*(y-this.ml0+a*r*h/2*(1+u/12*(5-p+9*f+4*d+u/30*(61+g-58*p+270*f-330*p*f+u/56*(1385+543*g-g*p-3111*p))))))+this.y0}else{var c=l*Math.sin(r);if(Math.abs(Math.abs(c)-1)<U)return 93;if(s=.5*this.a*this.k0*Math.log((1+c)/(1-c))+this.x0,o=l*Math.cos(r)/Math.sqrt(1-Math.pow(c,2)),c=Math.abs(o),c>=1){if(c-1>U)return 93;o=0}else o=Math.acos(o);e<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return i.x=s,i.y=o,i}function l3(i){var t,e,r,n,s=(i.x-this.x0)*(1/this.a),o=(i.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,e=rl(t,this.es,this.en),Math.abs(e)<D){var u=Math.sin(e),f=Math.cos(e),d=Math.abs(f)>U?Math.tan(e):0,m=this.ep2*Math.pow(f,2),p=Math.pow(m,2),g=Math.pow(d,2),y=Math.pow(g,2);t=1-this.es*Math.pow(u,2);var _=s*Math.sqrt(t)/this.k0,x=Math.pow(_,2);t=t*d,r=e-t*x/(1-this.es)*.5*(1-x/12*(5+3*g-9*m*g+m-4*p-x/30*(61+90*g-252*m*g+45*y+46*m-x/56*(1385+3633*g+4095*y+1574*y*g)))),n=j(this.long0+_*(1-x/6*(1+2*g+m-x/20*(5+28*g+24*y+8*m*g+6*m-x/42*(61+662*g+1320*y+720*y*g))))/f)}else r=D*bn(o),n=0;else{var a=Math.exp(s/this.k0),l=.5*(a-1/a),c=this.lat0+o/this.k0,h=Math.cos(c);t=Math.sqrt((1-Math.pow(h,2))/(1+Math.pow(l,2))),r=Math.asin(t),o<0&&(r=-r),l===0&&h===0?n=0:n=j(Math.atan2(l,h)+this.long0)}return i.x=n,i.y=r,i}var c3=["Fast_Transverse_Mercator","Fast Transverse Mercator"],nl={init:o3,forward:a3,inverse:l3,names:c3};function Ed(i){var t=Math.exp(i);return t=(t-1/t)/2,t}function Xe(i,t){i=Math.abs(i),t=Math.abs(t);var e=Math.max(i,t),r=Math.min(i,t)/(e||1);return e*Math.sqrt(1+Math.pow(r,2))}function I2(i){var t=1+i,e=t-1;return e===0?i:i*Math.log(t)/e}function A2(i){var t=Math.abs(i);return t=I2(t*(1+t/(Xe(1,t)+1))),i<0?-t:t}function wd(i,t){for(var e=2*Math.cos(2*t),r=i.length-1,n=i[r],s=0,o;--r>=0;)o=-s+e*n+i[r],s=n,n=o;return t+o*Math.sin(2*t)}function L2(i,t){for(var e=2*Math.cos(t),r=i.length-1,n=i[r],s=0,o;--r>=0;)o=-s+e*n+i[r],s=n,n=o;return Math.sin(t)*o}function O2(i){var t=Math.exp(i);return t=(t+1/t)/2,t}function E_(i,t,e){for(var r=Math.sin(t),n=Math.cos(t),s=Ed(e),o=O2(e),a=2*n*o,l=-2*r*s,c=i.length-1,h=i[c],u=0,f=0,d=0,m,p;--c>=0;)m=f,p=u,f=h,u=d,h=-m+a*f-l*u+i[c],d=-p+l*f+a*u;return a=r*o,l=n*s,[a*h-l*d,a*d+l*h]}function h3(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(nl.init.apply(this),this.forward=nl.forward,this.inverse=nl.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),t=i/(2-i),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var r=wd(this.cbg,this.lat0);this.Zb=-this.Qn*(r+L2(this.gtu,2*r))}function u3(i){var t=j(i.x-this.long0),e=i.y;e=wd(this.cbg,e);var r=Math.sin(e),n=Math.cos(e),s=Math.sin(t),o=Math.cos(t);e=Math.atan2(r,o*n),t=Math.atan2(s*n,Xe(r,n*o)),t=A2(Math.tan(t));var a=E_(this.gtu,2*e,2*t);e=e+a[0],t=t+a[1];var l,c;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,c=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,c=1/0),i.x=l,i.y=c,i}function f3(i){var t=(i.x-this.x0)*(1/this.a),e=(i.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var r,n;if(Math.abs(t)<=2.623395162778){var s=E_(this.utg,2*e,2*t);e=e+s[0],t=t+s[1],t=Math.atan(Ed(t));var o=Math.sin(e),a=Math.cos(e),l=Math.sin(t),c=Math.cos(t);e=Math.atan2(o*c,Xe(l,c*a)),t=Math.atan2(l,c*a),r=j(t+this.long0),n=wd(this.cgb,e)}else r=1/0,n=1/0;return i.x=r,i.y=n,i}var d3=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"],sl={init:h3,forward:u3,inverse:f3,names:d3};function F2(i,t){if(i===void 0){if(i=Math.floor((j(t)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var m3="etmerc";function p3(){var i=F2(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*Ht,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,sl.init.apply(this),this.forward=sl.forward,this.inverse=sl.inverse}var g3=["Universal Transverse Mercator System","utm"],N2={init:p3,names:g3,dependsOn:m3};function Sd(i,t){return Math.pow((1-i)/(1+i),t)}var y3=20;function _3(){var i=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Yt)/(Math.pow(Math.tan(.5*this.lat0+Yt),this.C)*Sd(this.e*i,this.ratexp))}function x3(i){var t=i.x,e=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Yt),this.C)*Sd(this.e*Math.sin(e),this.ratexp))-D,i.x=this.C*t,i}function v3(i){for(var t=1e-14,e=i.x/this.C,r=i.y,n=Math.pow(Math.tan(.5*r+Yt)/this.K,1/this.C),s=y3;s>0&&(r=2*Math.atan(n*Sd(this.e*Math.sin(i.y),-.5*this.e))-D,!(Math.abs(r-i.y)<t));--s)i.y=r;return s?(i.x=e,i.y=r,i):null}var E3=["gauss"],bd={init:_3,forward:x3,inverse:v3,names:E3};function w3(){bd.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function S3(i){var t,e,r,n;return i.x=j(i.x-this.long0),bd.forward.apply(this,[i]),t=Math.sin(i.y),e=Math.cos(i.y),r=Math.cos(i.x),n=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*r),i.x=n*e*Math.sin(i.x),i.y=n*(this.cosc0*t-this.sinc0*e*r),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function b3(i){var t,e,r,n,s;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,s=Xe(i.x,i.y)){var o=2*Math.atan2(s,this.R2);t=Math.sin(o),e=Math.cos(o),n=Math.asin(e*this.sinc0+i.y*t*this.cosc0/s),r=Math.atan2(i.x*t,s*this.cosc0*e-i.y*this.sinc0*t)}else n=this.phic0,r=0;return i.x=r,i.y=n,bd.inverse.apply(this,[i]),i.x=j(i.x+this.long0),i}var C3=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],D2={init:w3,forward:S3,inverse:b3,names:C3};function M3(i,t,e){return t*=e,Math.tan(.5*(D+i))*Math.pow((1-t)/(1+t),.5*e)}function T3(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=U&&(this.k0=.5*(1+bn(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=U&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=U&&Math.abs(Math.cos(this.lat_ts))>U&&(this.k0=.5*this.cons*_i(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ti(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=_i(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-D,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function P3(i){var t=i.x,e=i.y,r=Math.sin(e),n=Math.cos(e),s,o,a,l,c,h,u=j(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=U&&Math.abs(e+this.lat0)<=U?(i.x=NaN,i.y=NaN,i):this.sphere?(s=2*this.k0/(1+this.sinlat0*r+this.coslat0*n*Math.cos(u)),i.x=this.a*s*n*Math.sin(u)+this.x0,i.y=this.a*s*(this.coslat0*r-this.sinlat0*n*Math.cos(u))+this.y0,i):(o=2*Math.atan(this.ssfn_(e,r,this.e))-D,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=U?(c=Ti(this.e,e*this.con,this.con*r),h=2*this.a*this.k0*c/this.cons,i.x=this.x0+h*Math.sin(t-this.long0),i.y=this.y0-this.con*h*Math.cos(t-this.long0),i):(Math.abs(this.sinlat0)<U?(s=2*this.a*this.k0/(1+l*Math.cos(u)),i.y=s*a):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(u))),i.y=s*(this.cosX0*a-this.sinX0*l*Math.cos(u))+this.y0),i.x=s*l*Math.sin(u)+this.x0,i))}function R3(i){i.x-=this.x0,i.y-=this.y0;var t,e,r,n,s,o=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,e=this.lat0,o<=U?(i.x=t,i.y=e,i):(e=Math.asin(Math.cos(a)*this.sinlat0+i.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<U?this.lat0>0?t=j(this.long0+Math.atan2(i.x,-1*i.y)):t=j(this.long0+Math.atan2(i.x,i.y)):t=j(this.long0+Math.atan2(i.x*Math.sin(a),o*this.coslat0*Math.cos(a)-i.y*this.sinlat0*Math.sin(a))),i.x=t,i.y=e,i)}else if(Math.abs(this.coslat0)<=U){if(o<=U)return e=this.lat0,t=this.long0,i.x=t,i.y=e,i;i.x*=this.con,i.y*=this.con,r=o*this.cons/(2*this.a*this.k0),e=this.con*ss(this.e,r),t=this.con*j(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else n=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=U?s=this.X0:(s=Math.asin(Math.cos(n)*this.sinX0+i.y*Math.sin(n)*this.cosX0/o),t=j(this.long0+Math.atan2(i.x*Math.sin(n),o*this.cosX0*Math.cos(n)-i.y*this.sinX0*Math.sin(n)))),e=-1*ss(this.e,Math.tan(.5*(D+s)));return i.x=t,i.y=e,i}var I3=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"],G2={init:T3,forward:P3,inverse:R3,names:I3,ssfn_:M3};function A3(){var i=this.lat0;this.lambda0=this.long0;var t=Math.sin(i),e=this.a,r=this.rf,n=1/r,s=2*n-Math.pow(n,2),o=this.e=Math.sqrt(s);this.R=this.k0*e*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+i/2)),c=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*l+this.alpha*o/2*c}function L3(i){var t=Math.log(Math.tan(Math.PI/4-i.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),r=-this.alpha*(t+e)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),s=this.alpha*(i.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(s));return i.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,i.x=this.R*o+this.x0,i}function O3(i){for(var t=i.x-this.x0,e=i.y-this.y0,r=t/this.R,n=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),o=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),a=this.lambda0+o/this.alpha,l=0,c=s,h=-1e3,u=0;Math.abs(c-h)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),h=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=a,i.y=c,i}var F3=["somerc"],k2={init:A3,forward:L3,inverse:O3,names:F3};var ol=1e-7;function N3(i){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof i.projName=="object"?Object.keys(i.projName)[0]:i.projName;return"no_uoff"in i||"no_off"in i||t.indexOf(e)!==-1||t.indexOf(h_(e))!==-1}function D3(){var i,t,e,r,n,s,o,a,l,c,h=0,u,f=0,d=0,m=0,p=0,g=0,y=0;this.no_off=N3(this),this.no_rot="no_rot"in this;var _=!1;"alpha"in this&&(_=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),_&&(y=this.alpha),x&&(h=this.rectified_grid_angle),_||x)f=this.longc;else if(d=this.long1,p=this.lat1,m=this.long2,g=this.lat2,Math.abs(p-g)<=ol||(i=Math.abs(p))<=ol||Math.abs(i-D)<=ol||Math.abs(Math.abs(this.lat0)-D)<=ol||Math.abs(Math.abs(g)-D)<=ol)throw new Error;var v=1-this.es;t=Math.sqrt(v),Math.abs(this.lat0)>U?(a=Math.sin(this.lat0),e=Math.cos(this.lat0),i=1-this.es*a*a,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/v),this.A=this.B*this.k0*t/i,r=this.B*t/(e*Math.sqrt(i)),n=r*r-1,n<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=r,this.E*=Math.pow(Ti(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=r=n=1),_||x?(_?(u=Math.asin(Math.sin(y)/r),x||(h=y)):(u=h,y=Math.asin(r*Math.sin(u))),this.lam0=f-Math.asin(.5*(n-1/n)*Math.tan(u))/this.B):(s=Math.pow(Ti(this.e,p,Math.sin(p)),this.B),o=Math.pow(Ti(this.e,g,Math.sin(g)),this.B),n=this.E/s,l=(o-s)/(o+s),c=this.E*this.E,c=(c-o*s)/(c+o*s),i=d-m,i<-Math.pi?m-=Hs:i>Math.pi&&(m+=Hs),this.lam0=j(.5*(d+m)-Math.atan(c*Math.tan(.5*this.B*(d-m))/l)/this.B),u=Math.atan(2*Math.sin(this.B*j(d-this.lam0))/(n-1/n)),h=y=Math.asin(r*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(h),this.cosrot=Math.cos(h),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(y))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Yt-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(Yt+n))}function G3(i){var t={},e,r,n,s,o,a,l,c;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-D)>U){if(o=this.E/Math.pow(Ti(this.e,i.y,Math.sin(i.y)),this.B),a=1/o,e=.5*(o-a),r=.5*(o+a),s=Math.sin(this.B*i.x),n=(e*this.singam-s*this.cosgam)/r,Math.abs(Math.abs(n)-1)<U)throw new Error;c=.5*this.ArB*Math.log((1-n)/(1+n)),a=Math.cos(this.B*i.x),Math.abs(a)<ol?l=this.A*i.x:l=this.ArB*Math.atan2(e*this.cosgam+s*this.singam,a)}else c=i.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*i.y;return this.no_rot?(t.x=l,t.y=c):(l-=this.u_0,t.x=c*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-c*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function k3(i){var t,e,r,n,s,o,a,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(e=i.y,t=i.x):(e=i.x*this.cosrot-i.y*this.sinrot,t=i.y*this.cosrot+i.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*e),n=.5*(r-1/r),s=.5*(r+1/r),o=Math.sin(this.BrA*t),a=(o*this.cosgam+n*this.singam)/s,Math.abs(Math.abs(a)-1)<U)l.x=0,l.y=a<0?-D:D;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=ss(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(n*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var z3=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],z2={init:D3,forward:G3,inverse:k3,names:z3};function j3(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<U)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),r=_i(this.e,t,e),n=Ti(this.e,this.lat1,t),s=Math.sin(this.lat2),o=Math.cos(this.lat2),a=_i(this.e,s,o),l=Ti(this.e,this.lat2,s),c=Math.abs(Math.abs(this.lat0)-D)<U?0:Ti(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>U?this.ns=Math.log(r/a)/Math.log(n/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=r/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function U3(i){var t=i.x,e=i.y;Math.abs(2*Math.abs(e)-Math.PI)<=U&&(e=bn(e)*(D-2*U));var r=Math.abs(Math.abs(e)-D),n,s;if(r>U)n=Ti(this.e,e,Math.sin(e)),s=this.a*this.f0*Math.pow(n,this.ns);else{if(r=e*this.ns,r<=0)return null;s=0}var o=this.ns*j(t-this.long0);return i.x=this.k0*(s*Math.sin(o))+this.x0,i.y=this.k0*(this.rh-s*Math.cos(o))+this.y0,i}function B3(i){var t,e,r,n,s,o=(i.x-this.x0)/this.k0,a=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),e=1):(t=-Math.sqrt(o*o+a*a),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*o,e*a)),t!==0||this.ns>0){if(e=1/this.ns,r=Math.pow(t/(this.a*this.f0),e),n=ss(this.e,r),n===-9999)return null}else n=-D;return s=j(l/this.ns+this.long0),i.x=s,i.y=n,i}var q3=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"],j2={init:j3,forward:U3,inverse:B3,names:q3};function X3(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function V3(i){var t,e,r,n,s,o,a,l=i.x,c=i.y,h=j(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),r=-h*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(r)),s=Math.asin(Math.cos(e)*Math.sin(r)/Math.cos(n)),o=this.n*s,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),i.y=a*Math.cos(o)/1,i.x=a*Math.sin(o)/1,this.czech||(i.y*=-1,i.x*=-1),i}function W3(i){var t,e,r,n,s,o,a,l,c=i.x;i.x=i.y,i.y=c,this.czech||(i.y*=-1,i.x*=-1),o=Math.sqrt(i.x*i.x+i.y*i.y),s=Math.atan2(i.y,i.x),n=s/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),e=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(t)),i.x=this.long0-e/this.alfa,a=t,l=0;var h=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-i.y)<1e-10&&(l=1),a=i.y,h+=1;while(l===0&&h<15);return h>=15?null:i}var Y3=["Krovak","krovak"],U2={init:X3,forward:V3,inverse:W3,names:Y3};function Ze(i,t,e,r,n){return i*n-t*Math.sin(2*n)+e*Math.sin(4*n)-r*Math.sin(6*n)}function os(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function as(i){return .375*i*(1+.25*i*(1+.46875*i))}function ls(i){return .05859375*i*i*(1+.75*i)}function cs(i){return i*i*i*(35/3072)}function Vc(i,t,e){var r=t*e;return i/Math.sqrt(1-r*r)}function Ji(i){return Math.abs(i)<D?i:i-bn(i)*Math.PI}function jo(i,t,e,r,n){var s,o;s=i/t;for(var a=0;a<15;a++)if(o=(i-(t*s-e*Math.sin(2*s)+r*Math.sin(4*s)-n*Math.sin(6*s)))/(t-2*e*Math.cos(2*s)+4*r*Math.cos(4*s)-6*n*Math.cos(6*s)),s+=o,Math.abs(o)<=1e-10)return s;return NaN}function $3(){this.sphere||(this.e0=os(this.es),this.e1=as(this.es),this.e2=ls(this.es),this.e3=cs(this.es),this.ml0=this.a*Ze(this.e0,this.e1,this.e2,this.e3,this.lat0))}function K3(i){var t,e,r=i.x,n=i.y;if(r=j(r-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(n)*Math.sin(r)),e=this.a*(Math.atan2(Math.tan(n),Math.cos(r))-this.lat0);else{var s=Math.sin(n),o=Math.cos(n),a=Vc(this.a,this.e,s),l=Math.tan(n)*Math.tan(n),c=r*Math.cos(n),h=c*c,u=this.es*o*o/(1-this.es),f=this.a*Ze(this.e0,this.e1,this.e2,this.e3,n);t=a*c*(1-h*l*(1/6-(8-l+8*u)*h/120)),e=f-this.ml0+a*s/o*h*(.5+(5-l+6*u)*h/24)}return i.x=t+this.x0,i.y=e+this.y0,i}function H3(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,r,n;if(this.sphere){var s=e+this.lat0;r=Math.asin(Math.sin(s)*Math.cos(t)),n=Math.atan2(Math.tan(t),Math.cos(s))}else{var o=this.ml0/this.a+e,a=jo(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-D)<=U)return i.x=this.long0,i.y=D,e<0&&(i.y*=-1),i;var l=Vc(this.a,this.e,Math.sin(a)),c=l*l*l/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(a),2),u=t*this.a/l,f=u*u;r=a-l*Math.tan(a)/c*u*u*(.5-(1+3*h)*u*u/24),n=u*(1-f*(h/3+(1+3*h)*h*f/15))/Math.cos(a)}return i.x=j(n+this.long0),i.y=Ji(r),i}var Z3=["Cassini","Cassini_Soldner","cass"],B2={init:$3,forward:K3,inverse:H3,names:Z3};function Kr(i,t){var e;return i>1e-7?(e=i*t,(1-i*i)*(t/(1-e*e)-.5/i*Math.log((1-e)/(1+e)))):2*t}var J3=1,Q3=2,tO=3,eO=4;function iO(){var i=Math.abs(this.lat0);if(Math.abs(i-D)<U?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(i)<U?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=Kr(this.e,1),this.mmf=.5/(1-this.es),this.apa=uO(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Kr(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function rO(i){var t,e,r,n,s,o,a,l,c,h,u=i.x,f=i.y;if(u=j(u-this.long0),this.sphere){if(s=Math.sin(f),h=Math.cos(f),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+h*r:1+this.sinph0*s+this.cosph0*h*r,e<=U)return null;e=Math.sqrt(2/e),t=e*h*Math.sin(u),e*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*h*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(f+this.lat0)<U)return null;e=Yt-f*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(u),e*=r}}else{switch(a=0,l=0,c=0,r=Math.cos(u),n=Math.sin(u),s=Math.sin(f),o=Kr(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:c=1+this.sinb1*a+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=D+f,o=this.qp-o;break;case this.S_POLE:c=f-D,o=this.qp+o;break}if(Math.abs(c)<U)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),this.mode===this.OBLIQ?e=this.ymf*c*(this.cosb1*a-this.sinb1*l*r):e=(c=Math.sqrt(2/(1+l*r)))*a*this.ymf,t=this.xmf*c*l*n;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(c=Math.sqrt(o))*n,e=r*(this.mode===this.S_POLE?c:-c)):t=e=0;break}}return i.x=this.a*t+this.x0,i.y=this.a*e+this.y0,i}function nO(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,r,n,s,o,a,l,c;if(this.sphere){var h=0,u,f=0;if(u=Math.sqrt(t*t+e*e),n=u*.5,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(n),h=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(u)<=U?0:Math.asin(e*f/u),t*=f,e=h*u;break;case this.OBLIQ:n=Math.abs(u)<=U?this.lat0:Math.asin(h*this.sinph0+e*f*this.cosph0/u),t*=f*this.cosph0,e=(h-Math.sin(n)*this.sinph0)*u;break;case this.N_POLE:e=-e,n=D-n;break;case this.S_POLE:n-=D;break}r=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<U)return i.x=this.long0,i.y=this.lat0,i;o=2*Math.asin(.5*l/this.rq),s=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(c=s*this.sinb1+e*o*this.cosb1/l,a=this.qp*c,e=l*this.cosb1*s-e*this.sinb1*o):(c=e*o/l,a=this.qp*c,e=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),a=t*t+e*e,!a)return i.x=this.long0,i.y=this.lat0,i;c=1-a/this.qp,this.mode===this.S_POLE&&(c=-c)}r=Math.atan2(t,e),n=fO(Math.asin(c),this.apa)}return i.x=j(this.long0+r),i.y=n,i}var sO=.3333333333333333,oO=.17222222222222222,aO=.10257936507936508,lO=.06388888888888888,cO=.0664021164021164,hO=.016415012942191543;function uO(i){var t,e=[];return e[0]=i*sO,t=i*i,e[0]+=t*oO,e[1]=t*lO,t*=i,e[0]+=t*aO,e[1]+=t*cO,e[2]=t*hO,e}function fO(i,t){var e=i+i;return i+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var dO=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],q2={init:iO,forward:rO,inverse:nO,names:dO,S_POLE:J3,N_POLE:Q3,EQUIT:tO,OBLIQ:eO};function Qi(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function mO(){Math.abs(this.lat1+this.lat2)<U||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=_i(this.e3,this.sin_po,this.cos_po),this.qs1=Kr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=_i(this.e3,this.sin_po,this.cos_po),this.qs2=Kr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Kr(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>U?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function pO(i){var t=i.x,e=i.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var r=Kr(this.e3,this.sin_phi),n=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,s=this.ns0*j(t-this.long0),o=n*Math.sin(s)+this.x0,a=this.rh-n*Math.cos(s)+this.y0;return i.x=o,i.y=a,i}function gO(i){var t,e,r,n,s,o;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1),n=0,t!==0&&(n=Math.atan2(r*i.x,r*i.y)),r=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-r*r)/(2*this.ns0)):(e=(this.c-r*r)/this.ns0,o=this.phi1z(this.e3,e)),s=j(n/this.ns0+this.long0),i.x=s,i.y=o,i}function yO(i,t){var e,r,n,s,o,a=Qi(.5*t);if(i<U)return a;for(var l=i*i,c=1;c<=25;c++)if(e=Math.sin(a),r=Math.cos(a),n=i*e,s=1-n*n,o=.5*s*s/r*(t/(1-l)-e/s+.5/i*Math.log((1-n)/(1+n))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var _O=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"],X2={init:mO,forward:pO,inverse:gO,names:_O,phi1z:yO};function xO(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function vO(i){var t,e,r,n,s,o,a,l,c=i.x,h=i.y;return r=j(c-this.long0),t=Math.sin(h),e=Math.cos(h),n=Math.cos(r),o=this.sin_p14*t+this.cos_p14*e*n,s=1,o>0||Math.abs(o)<=U?(a=this.x0+this.a*s*e*Math.sin(r)/o,l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*n)/o):(a=this.x0+this.infinity_dist*e*Math.sin(r),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*n)),i.x=a,i.y=l,i}function EO(i){var t,e,r,n,s,o;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(t=Math.sqrt(i.x*i.x+i.y*i.y))?(n=Math.atan2(t,this.rc),e=Math.sin(n),r=Math.cos(n),o=Qi(r*this.sin_p14+i.y*e*this.cos_p14/t),s=Math.atan2(i.x*e,t*this.cos_p14*r-i.y*this.sin_p14*e),s=j(this.long0+s)):(o=this.phic0,s=0),i.x=s,i.y=o,i}var wO=["gnom"],V2={init:xO,forward:vO,inverse:EO,names:wO};function W2(i,t){var e=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*D:D;for(var r=Math.asin(.5*t),n,s,o,a,l=0;l<30;l++)if(s=Math.sin(r),o=Math.cos(r),a=i*s,n=Math.pow(1-a*a,2)/(2*o)*(t/(1-i*i)-s/(1-a*a)+.5/i*Math.log((1-a)/(1+a))),r+=n,Math.abs(n)<=1e-10)return r;return NaN}function SO(){this.sphere||(this.k0=_i(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function bO(i){var t=i.x,e=i.y,r,n,s=j(t-this.long0);if(this.sphere)r=this.x0+this.a*s*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var o=Kr(this.e,Math.sin(e));r=this.x0+this.a*this.k0*s,n=this.y0+this.a*o*.5/this.k0}return i.x=r,i.y=n,i}function CO(i){i.x-=this.x0,i.y-=this.y0;var t,e;return this.sphere?(t=j(this.long0+i.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(e=W2(this.e,2*i.y*this.k0/this.a),t=j(this.long0+i.x/(this.a*this.k0))),i.x=t,i.y=e,i}var MO=["cea"],Y2={init:SO,forward:bO,inverse:CO,names:MO};function TO(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function PO(i){var t=i.x,e=i.y,r=j(t-this.long0),n=Ji(e-this.lat0);return i.x=this.x0+this.a*r*this.rc,i.y=this.y0+this.a*n,i}function RO(i){var t=i.x,e=i.y;return i.x=j(this.long0+(t-this.x0)/(this.a*this.rc)),i.y=Ji(this.lat0+(e-this.y0)/this.a),i}var IO=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"],$2={init:TO,forward:PO,inverse:RO,names:IO};var K2=20;function AO(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=os(this.es),this.e1=as(this.es),this.e2=ls(this.es),this.e3=cs(this.es),this.ml0=this.a*Ze(this.e0,this.e1,this.e2,this.e3,this.lat0)}function LO(i){var t=i.x,e=i.y,r,n,s,o=j(t-this.long0);if(s=o*Math.sin(e),this.sphere)Math.abs(e)<=U?(r=this.a*o,n=-1*this.a*this.lat0):(r=this.a*Math.sin(s)/Math.tan(e),n=this.a*(Ji(e-this.lat0)+(1-Math.cos(s))/Math.tan(e)));else if(Math.abs(e)<=U)r=this.a*o,n=-1*this.ml0;else{var a=Vc(this.a,this.e,Math.sin(e))/Math.tan(e);r=a*Math.sin(s),n=this.a*Ze(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+a*(1-Math.cos(s))}return i.x=r+this.x0,i.y=n+this.y0,i}function OO(i){var t,e,r,n,s,o,a,l,c;if(r=i.x-this.x0,n=i.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=U)t=j(r/this.a+this.long0),e=0;else{o=this.lat0+n/this.a,a=r*r/this.a/this.a+o*o,l=o;var h;for(s=K2;s;--s)if(h=Math.tan(l),c=-1*(o*(l*h+1)-l-.5*(l*l+a)*h)/((l-o)/h-1),l+=c,Math.abs(c)<=U){e=l;break}t=j(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(n+this.ml0)<=U)e=0,t=j(this.long0+r/this.a);else{o=(this.ml0+n)/this.a,a=r*r/this.a/this.a+o*o,l=o;var u,f,d,m,p;for(s=K2;s;--s)if(p=this.e*Math.sin(l),u=Math.sqrt(1-p*p)*Math.tan(l),f=this.a*Ze(this.e0,this.e1,this.e2,this.e3,l),d=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),m=f/this.a,c=(o*(u*m+1)-m-.5*u*(m*m+a))/(this.es*Math.sin(2*l)*(m*m+a-2*o*m)/(4*u)+(o-m)*(u*d-2/Math.sin(2*l))-d),l-=c,Math.abs(c)<=U){e=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=j(this.long0+Math.asin(r*u/this.a)/Math.sin(e))}return i.x=t,i.y=e,i}var FO=["Polyconic","American_Polyconic","poly"],H2={init:AO,forward:LO,inverse:OO,names:FO};function NO(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function DO(i){var t,e=i.x,r=i.y,n=r-this.lat0,s=e-this.long0,o=n/Do*1e-5,a=s,l=1,c=0;for(t=1;t<=10;t++)l=l*o,c=c+this.A[t]*l;var h=c,u=a,f=1,d=0,m,p,g=0,y=0;for(t=1;t<=6;t++)m=f*h-d*u,p=d*h+f*u,f=m,d=p,g=g+this.B_re[t]*f-this.B_im[t]*d,y=y+this.B_im[t]*f+this.B_re[t]*d;return i.x=y*this.a+this.x0,i.y=g*this.a+this.y0,i}function GO(i){var t,e=i.x,r=i.y,n=e-this.x0,s=r-this.y0,o=s/this.a,a=n/this.a,l=1,c=0,h,u,f=0,d=0;for(t=1;t<=6;t++)h=l*o-c*a,u=c*o+l*a,l=h,c=u,f=f+this.C_re[t]*l-this.C_im[t]*c,d=d+this.C_im[t]*l+this.C_re[t]*c;for(var m=0;m<this.iterations;m++){var p=f,g=d,y,_,x=o,v=a;for(t=2;t<=6;t++)y=p*f-g*d,_=g*f+p*d,p=y,g=_,x=x+(t-1)*(this.B_re[t]*p-this.B_im[t]*g),v=v+(t-1)*(this.B_im[t]*p+this.B_re[t]*g);p=1,g=0;var E=this.B_re[1],b=this.B_im[1];for(t=2;t<=6;t++)y=p*f-g*d,_=g*f+p*d,p=y,g=_,E=E+t*(this.B_re[t]*p-this.B_im[t]*g),b=b+t*(this.B_im[t]*p+this.B_re[t]*g);var S=E*E+b*b;f=(x*E+v*b)/S,d=(v*E-x*b)/S}var T=f,P=d,F=1,k=0;for(t=1;t<=9;t++)F=F*T,k=k+this.D[t]*F;var z=this.lat0+k*Do*1e5,W=this.long0+P;return i.x=W,i.y=z,i}var kO=["New_Zealand_Map_Grid","nzmg"],Z2={init:NO,forward:DO,inverse:GO,names:kO};function zO(){}function jO(i){var t=i.x,e=i.y,r=j(t-this.long0),n=this.x0+this.a*r,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return i.x=n,i.y=s,i}function UO(i){i.x-=this.x0,i.y-=this.y0;var t=j(this.long0+i.x/this.a),e=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=t,i.y=e,i}var BO=["Miller_Cylindrical","mill"],J2={init:zO,forward:jO,inverse:UO,names:BO};var qO=20;function XO(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=il(this.es)}function VO(i){var t,e,r=i.x,n=i.y;if(r=j(r-this.long0),this.sphere){if(!this.m)n=this.n!==1?Math.asin(this.n*Math.sin(n)):n;else for(var s=this.n*Math.sin(n),o=qO;o;--o){var a=(this.m*n+Math.sin(n)-s)/(this.m+Math.cos(n));if(n-=a,Math.abs(a)<U)break}t=this.a*this.C_x*r*(this.m+Math.cos(n)),e=this.a*this.C_y*n}else{var l=Math.sin(n),c=Math.cos(n);e=this.a*Cn(n,l,c,this.en),t=this.a*r*c/Math.sqrt(1-this.es*l*l)}return i.x=t,i.y=e,i}function WO(i){var t,e,r,n;return i.x-=this.x0,r=i.x/this.a,i.y-=this.y0,t=i.y/this.a,this.sphere?(t/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(t))),this.m?t=Qi((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Qi(Math.sin(t)/this.n)),r=j(r+this.long0),t=Ji(t)):(t=rl(i.y/this.a,this.es,this.en),n=Math.abs(t),n<D?(n=Math.sin(t),e=this.long0+i.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)),r=j(e)):n-U<D&&(r=this.long0)),i.x=r,i.y=t,i}var YO=["Sinusoidal","sinu"],Q2={init:XO,forward:VO,inverse:WO,names:YO};function $O(){}function KO(i){for(var t=i.x,e=i.y,r=j(t-this.long0),n=e,s=Math.PI*Math.sin(e);;){var o=-(n+Math.sin(n)-s)/(1+Math.cos(n));if(n+=o,Math.abs(o)<U)break}n/=2,Math.PI/2-Math.abs(e)<U&&(r=0);var a=.900316316158*this.a*r*Math.cos(n)+this.x0,l=1.4142135623731*this.a*Math.sin(n)+this.y0;return i.x=a,i.y=l,i}function HO(i){var t,e;i.x-=this.x0,i.y-=this.y0,e=i.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var r=j(this.long0+i.x/(.900316316158*this.a*Math.cos(t)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var n=Math.asin(e);return i.x=r,i.y=n,i}var ZO=["Mollweide","moll"],tb={init:$O,forward:KO,inverse:HO,names:ZO};function JO(){Math.abs(this.lat1+this.lat2)<U||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=os(this.es),this.e1=as(this.es),this.e2=ls(this.es),this.e3=cs(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=_i(this.e,this.sinphi,this.cosphi),this.ml1=Ze(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<U?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=_i(this.e,this.sinphi,this.cosphi),this.ml2=Ze(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ze(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function QO(i){var t=i.x,e=i.y,r;if(this.sphere)r=this.a*(this.g-e);else{var n=Ze(this.e0,this.e1,this.e2,this.e3,e);r=this.a*(this.g-n)}var s=this.ns*j(t-this.long0),o=this.x0+r*Math.sin(s),a=this.y0+this.rh-r*Math.cos(s);return i.x=o,i.y=a,i}function tF(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var t,e,r,n;this.ns>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),t=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),t=-1);var s=0;if(e!==0&&(s=Math.atan2(t*i.x,t*i.y)),this.sphere)return n=j(this.long0+s/this.ns),r=Ji(this.g-e/this.a),i.x=n,i.y=r,i;var o=this.g-e/this.a;return r=jo(o,this.e0,this.e1,this.e2,this.e3),n=j(this.long0+s/this.ns),i.x=n,i.y=r,i}var eF=["Equidistant_Conic","eqdc"],eb={init:JO,forward:QO,inverse:tF,names:eF};function iF(){this.R=this.a}function rF(i){var t=i.x,e=i.y,r=j(t-this.long0),n,s;Math.abs(e)<=U&&(n=this.x0+this.R*r,s=this.y0);var o=Qi(2*Math.abs(e/Math.PI));(Math.abs(r)<=U||Math.abs(Math.abs(e)-D)<=U)&&(n=this.x0,e>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*o):s=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/r-r/Math.PI),l=a*a,c=Math.sin(o),h=Math.cos(o),u=h/(c+h-1),f=u*u,d=u*(2/c-1),m=d*d,p=Math.PI*this.R*(a*(u-m)+Math.sqrt(l*(u-m)*(u-m)-(m+l)*(f-m)))/(m+l);r<0&&(p=-p),n=this.x0+p;var g=l+u;return p=Math.PI*this.R*(d*g-a*Math.sqrt((m+l)*(l+1)-g*g))/(m+l),e>=0?s=this.y0+p:s=this.y0-p,i.x=n,i.y=s,i}function nF(i){var t,e,r,n,s,o,a,l,c,h,u,f,d;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,r=i.x/u,n=i.y/u,s=r*r+n*n,o=-Math.abs(n)*(1+s),a=o-2*n*n+r*r,l=-2*o+1+2*n*n+s*s,d=n*n/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,c=(o-a*a/3/l)/l,h=2*Math.sqrt(-c/3),u=3*d/c/h,Math.abs(u)>1&&(u>=0?u=1:u=-1),f=Math.acos(u)/3,i.y>=0?e=(-h*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI:e=-(-h*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI,Math.abs(r)<U?t=this.long0:t=j(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(r*r-n*n)+s*s))/2/r),i.x=t,i.y=e,i}var sF=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"],ib={init:iF,forward:rF,inverse:nF,names:sF};var nb=tC(rb());function oF(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.g=new nb.Geodesic.Geodesic(this.a,this.es/(1+Math.sqrt(1-this.es)))}function aF(i){var t=i.x,e=i.y,r=Math.sin(i.y),n=Math.cos(i.y),s=j(t-this.long0),o,a,l,c,h,u,f,d,m,p,g,y,_,x,v;return this.sphere?Math.abs(this.sin_p12-1)<=U?(i.x=this.x0+this.a*(D-e)*Math.sin(s),i.y=this.y0-this.a*(D-e)*Math.cos(s),i):Math.abs(this.sin_p12+1)<=U?(i.x=this.x0+this.a*(D+e)*Math.sin(s),i.y=this.y0+this.a*(D+e)*Math.cos(s),i):(m=this.sin_p12*r+this.cos_p12*n*Math.cos(s),f=Math.acos(m),d=f?f/Math.sin(f):1,i.x=this.x0+this.a*d*n*Math.sin(s),i.y=this.y0+this.a*d*(this.cos_p12*r-this.sin_p12*n*Math.cos(s)),i):(o=os(this.es),a=as(this.es),l=ls(this.es),c=cs(this.es),Math.abs(this.sin_p12-1)<=U?(h=this.a*Ze(o,a,l,c,D),u=this.a*Ze(o,a,l,c,e),i.x=this.x0+(h-u)*Math.sin(s),i.y=this.y0-(h-u)*Math.cos(s),i):Math.abs(this.sin_p12+1)<=U?(h=this.a*Ze(o,a,l,c,D),u=this.a*Ze(o,a,l,c,e),i.x=this.x0+(h+u)*Math.sin(s),i.y=this.y0+(h+u)*Math.cos(s),i):Math.abs(t)<U&&Math.abs(e-this.lat0)<U?(i.x=i.y=0,i):(p=this.lat0/Ht,g=this.long0/Ht,y=e/Ht,_=t/Ht,x=this.g.Inverse(p,g,y,_,this.g.AZIMUTH),v=x.azi1*Ht,i.x=x.s12*Math.sin(v),i.y=x.s12*Math.cos(v),i))}function lF(i){i.x-=this.x0,i.y-=this.y0;var t,e,r,n,s,o,a,l,c,h,u,f,d,m,p,g,y,_;return this.sphere?(t=Math.sqrt(i.x*i.x+i.y*i.y),t>2*D*this.a?void 0:(e=t/this.a,r=Math.sin(e),n=Math.cos(e),s=this.long0,Math.abs(t)<=U?o=this.lat0:(o=Qi(n*this.sin_p12+i.y*r*this.cos_p12/t),a=Math.abs(this.lat0)-D,Math.abs(a)<=U?this.lat0>=0?s=j(this.long0+Math.atan2(i.x,-i.y)):s=j(this.long0-Math.atan2(-i.x,i.y)):s=j(this.long0+Math.atan2(i.x*r,t*this.cos_p12*n-i.y*this.sin_p12*r))),i.x=s,i.y=o,i)):(l=os(this.es),c=as(this.es),h=ls(this.es),u=cs(this.es),Math.abs(this.sin_p12-1)<=U?(f=this.a*Ze(l,c,h,u,D),t=Math.sqrt(i.x*i.x+i.y*i.y),d=f-t,o=jo(d/this.a,l,c,h,u),s=j(this.long0+Math.atan2(i.x,-1*i.y)),i.x=s,i.y=o,i):Math.abs(this.sin_p12+1)<=U?(f=this.a*Ze(l,c,h,u,D),t=Math.sqrt(i.x*i.x+i.y*i.y),d=t-f,o=jo(d/this.a,l,c,h,u),s=j(this.long0+Math.atan2(i.x,i.y)),i.x=s,i.y=o,i):(m=this.lat0/Ht,p=this.long0/Ht,g=Math.atan2(i.x,i.y)/Ht,y=Math.sqrt(i.x*i.x+i.y*i.y),_=this.g.Direct(m,p,g,y,this.g.STANDARD),i.x=_.lon2*Ht,i.y=_.lat2*Ht,i))}var cF=["Azimuthal_Equidistant","aeqd"],sb={init:oF,forward:aF,inverse:lF,names:cF};function hF(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function uF(i){var t,e,r,n,s,o,a,l,c=i.x,h=i.y;return r=j(c-this.long0),t=Math.sin(h),e=Math.cos(h),n=Math.cos(r),o=this.sin_p14*t+this.cos_p14*e*n,s=1,(o>0||Math.abs(o)<=U)&&(a=this.a*s*e*Math.sin(r),l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*n)),i.x=a,i.y=l,i}function fF(i){var t,e,r,n,s,o,a;return i.x-=this.x0,i.y-=this.y0,t=Math.sqrt(i.x*i.x+i.y*i.y),e=Qi(t/this.a),r=Math.sin(e),n=Math.cos(e),o=this.long0,Math.abs(t)<=U?(a=this.lat0,i.x=o,i.y=a,i):(a=Qi(n*this.sin_p14+i.y*r*this.cos_p14/t),s=Math.abs(this.lat0)-D,Math.abs(s)<=U?(this.lat0>=0?o=j(this.long0+Math.atan2(i.x,-i.y)):o=j(this.long0-Math.atan2(-i.x,i.y)),i.x=o,i.y=a,i):(o=j(this.long0+Math.atan2(i.x*r,t*this.cos_p14*n-i.y*this.sin_p14*r)),i.x=o,i.y=a,i))}var dF=["ortho"],ob={init:hF,forward:uF,inverse:fF,names:dF};var Te={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},ee={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function mF(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=D-Yt/2?this.face=Te.TOP:this.lat0<=-(D-Yt/2)?this.face=Te.BOTTOM:Math.abs(this.long0)<=Yt?this.face=Te.FRONT:Math.abs(this.long0)<=D+Yt?this.face=this.long0>0?Te.RIGHT:Te.LEFT:this.face=Te.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function pF(i){var t={x:0,y:0},e,r,n,s,o,a,l={value:0};if(i.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):e=i.y,r=i.x,this.face===Te.TOP)s=D-e,r>=Yt&&r<=D+Yt?(l.value=ee.AREA_0,n=r-D):r>D+Yt||r<=-(D+Yt)?(l.value=ee.AREA_1,n=r>0?r-Me:r+Me):r>-(D+Yt)&&r<=-Yt?(l.value=ee.AREA_2,n=r+D):(l.value=ee.AREA_3,n=r);else if(this.face===Te.BOTTOM)s=D+e,r>=Yt&&r<=D+Yt?(l.value=ee.AREA_0,n=-r+D):r<Yt&&r>=-Yt?(l.value=ee.AREA_1,n=-r):r<-Yt&&r>=-(D+Yt)?(l.value=ee.AREA_2,n=-r-D):(l.value=ee.AREA_3,n=r>0?-r+Me:-r-Me);else{var c,h,u,f,d,m,p;this.face===Te.RIGHT?r=al(r,+D):this.face===Te.BACK?r=al(r,+Me):this.face===Te.LEFT&&(r=al(r,-D)),f=Math.sin(e),d=Math.cos(e),m=Math.sin(r),p=Math.cos(r),c=d*p,h=d*m,u=f,this.face===Te.FRONT?(s=Math.acos(c),n=Md(s,u,h,l)):this.face===Te.RIGHT?(s=Math.acos(h),n=Md(s,u,-c,l)):this.face===Te.BACK?(s=Math.acos(-c),n=Md(s,u,-h,l)):this.face===Te.LEFT?(s=Math.acos(-h),n=Md(s,u,c,l)):(s=n=0,l.value=ee.AREA_0)}return a=Math.atan(12/Me*(n+Math.acos(Math.sin(n)*Math.cos(Yt))-D)),o=Math.sqrt((1-Math.cos(s))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===ee.AREA_1?a+=D:l.value===ee.AREA_2?a+=Me:l.value===ee.AREA_3&&(a+=1.5*Me),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,i.x=t.x,i.y=t.y,i}function gF(i){var t={lam:0,phi:0},e,r,n,s,o,a,l,c,h,u={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,r=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?u.value=ee.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(u.value=ee.AREA_1,e-=D):i.x<0&&-i.x>=Math.abs(i.y)?(u.value=ee.AREA_2,e=e<0?e+Me:e-Me):(u.value=ee.AREA_3,e+=D),h=Me/12*Math.tan(e),o=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),a=Math.atan(o),n=Math.cos(e),s=Math.tan(r),l=1-n*n*s*s*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===Te.TOP)c=Math.acos(l),t.phi=D-c,u.value===ee.AREA_0?t.lam=a+D:u.value===ee.AREA_1?t.lam=a<0?a+Me:a-Me:u.value===ee.AREA_2?t.lam=a-D:t.lam=a;else if(this.face===Te.BOTTOM)c=Math.acos(l),t.phi=c-D,u.value===ee.AREA_0?t.lam=-a+D:u.value===ee.AREA_1?t.lam=-a:u.value===ee.AREA_2?t.lam=-a-D:t.lam=a<0?-a-Me:-a+Me;else{var f,d,m;f=l,h=f*f,h>=1?m=0:m=Math.sqrt(1-h)*Math.sin(a),h+=m*m,h>=1?d=0:d=Math.sqrt(1-h),u.value===ee.AREA_1?(h=d,d=-m,m=h):u.value===ee.AREA_2?(d=-d,m=-m):u.value===ee.AREA_3&&(h=d,d=m,m=-h),this.face===Te.RIGHT?(h=f,f=-d,d=h):this.face===Te.BACK?(f=-f,d=-d):this.face===Te.LEFT&&(h=f,f=d,d=-h),t.phi=Math.acos(-m)-D,t.lam=Math.atan2(d,f),this.face===Te.RIGHT?t.lam=al(t.lam,-D):this.face===Te.BACK?t.lam=al(t.lam,-Me):this.face===Te.LEFT&&(t.lam=al(t.lam,+D))}if(this.es!==0){var p,g,y;p=t.phi<0?1:0,g=Math.tan(t.phi),y=this.b/Math.sqrt(g*g+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-y*y)/(this.one_minus_f*y)),p&&(t.phi=-t.phi)}return t.lam+=this.long0,i.x=t.lam,i.y=t.phi,i}function Md(i,t,e,r){var n;return i<U?(r.value=ee.AREA_0,n=0):(n=Math.atan2(t,e),Math.abs(n)<=Yt?r.value=ee.AREA_0:n>Yt&&n<=D+Yt?(r.value=ee.AREA_1,n-=D):n>D+Yt||n<=-(D+Yt)?(r.value=ee.AREA_2,n=n>=0?n-Me:n+Me):(r.value=ee.AREA_3,n+=D)),n}function al(i,t){var e=i+t;return e<-Me?e+=Hs:e>+Me&&(e-=Hs),e}var yF=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],ab={init:mF,forward:pF,inverse:gF,names:yF};var w_=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Wc=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],lb=.8487,cb=1.3523,hb=Ki/5,_F=1/hb,ll=18,Td=function(i,t){return i[0]+t*(i[1]+t*(i[2]+t*i[3]))},xF=function(i,t){return i[1]+t*(2*i[2]+t*3*i[3])};function vF(i,t,e,r){for(var n=t;r;--r){var s=i(n);if(n-=s,Math.abs(s)<e)break}return n}function EF(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function wF(i){var t=j(i.x-this.long0),e=Math.abs(i.y),r=Math.floor(e*hb);r<0?r=0:r>=ll&&(r=ll-1),e=Ki*(e-_F*r);var n={x:Td(w_[r],e)*t,y:Td(Wc[r],e)};return i.y<0&&(n.y=-n.y),n.x=n.x*this.a*lb+this.x0,n.y=n.y*this.a*cb+this.y0,n}function SF(i){var t={x:(i.x-this.x0)/(this.a*lb),y:Math.abs(i.y-this.y0)/(this.a*cb)};if(t.y>=1)t.x/=w_[ll][0],t.y=i.y<0?-D:D;else{var e=Math.floor(t.y*ll);for(e<0?e=0:e>=ll&&(e=ll-1);;)if(Wc[e][0]>t.y)--e;else if(Wc[e+1][0]<=t.y)++e;else break;var r=Wc[e],n=5*(t.y-r[0])/(Wc[e+1][0]-r[0]);n=vF(function(s){return(Td(r,s)-t.y)/xF(r,s)},n,U,100),t.x/=Td(w_[e],n),t.y=(5*e+n)*Ht,i.y<0&&(t.y=-t.y)}return t.x=j(t.x+this.long0),t}var bF=["Robinson","robin"],ub={init:EF,forward:wF,inverse:SF,names:bF};function CF(){this.name="geocent"}function MF(i){var t=yd(i,this.es,this.a);return t}function TF(i){var t=_d(i,this.es,this.a,this.b);return t}var PF=["Geocentric","geocentric","geocent","Geocent"],fb={init:CF,forward:MF,inverse:TF,names:PF};var xi={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Yc={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function RF(){if(Object.keys(Yc).forEach(function(e){if(typeof this[e]>"u")this[e]=Yc[e].def;else{if(Yc[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Yc[e].num&&(this[e]=parseFloat(this[e]))}Yc[e].degrees&&(this[e]=this[e]*Ht)}.bind(this)),Math.abs(Math.abs(this.lat0)-D)<U?this.mode=this.lat0<0?xi.S_POLE:xi.N_POLE:Math.abs(this.lat0)<U?this.mode=xi.EQUIT:(this.mode=xi.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(i),this.sw=Math.sin(i)}function IF(i){i.x-=this.long0;var t=Math.sin(i.y),e=Math.cos(i.y),r=Math.cos(i.x),n,s;switch(this.mode){case xi.OBLIQ:s=this.sinph0*t+this.cosph0*e*r;break;case xi.EQUIT:s=e*r;break;case xi.S_POLE:s=-t;break;case xi.N_POLE:s=t;break}switch(s=this.pn1/(this.p-s),n=s*e*Math.sin(i.x),this.mode){case xi.OBLIQ:s*=this.cosph0*t-this.sinph0*e*r;break;case xi.EQUIT:s*=t;break;case xi.N_POLE:s*=-(e*r);break;case xi.S_POLE:s*=e*r;break}var o,a;return o=s*this.cg+n*this.sg,a=1/(o*this.sw*this.h1+this.cw),n=(n*this.cg-s*this.sg)*this.cw*a,s=o*a,i.x=n*this.a,i.y=s*this.a,i}function AF(i){i.x/=this.a,i.y/=this.a;var t={x:i.x,y:i.y},e,r,n;n=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*n,r=this.pn1*i.y*this.cw*n,i.x=e*this.cg+r*this.sg,i.y=r*this.cg-e*this.sg;var s=Xe(i.x,i.y);if(Math.abs(s)<U)t.x=0,t.y=i.y;else{var o,a;switch(a=1-s*s*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/s+s/this.pn1),o=Math.sqrt(1-a*a),this.mode){case xi.OBLIQ:t.y=Math.asin(o*this.sinph0+i.y*a*this.cosph0/s),i.y=(o-this.sinph0*Math.sin(t.y))*s,i.x*=a*this.cosph0;break;case xi.EQUIT:t.y=Math.asin(i.y*a/s),i.y=o*s,i.x*=a;break;case xi.N_POLE:t.y=Math.asin(o),i.y=-i.y;break;case xi.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(i.x,i.y)}return i.x=t.x+this.long0,i.y=t.y,i}var LF=["Tilted_Perspective","tpers"],db={init:RF,forward:IF,inverse:AF,names:LF};function OF(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,t=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function FF(i){var t=i.x,e=i.y,r,n,s,o;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var a=this.radius_p/Xe(this.radius_p*Math.cos(e),Math.sin(e));if(n=a*Math.cos(t)*Math.cos(e),s=a*Math.sin(t)*Math.cos(e),o=a*Math.sin(e),(this.radius_g-n)*n-s*s-o*o*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;r=this.radius_g-n,this.flip_axis?(i.x=this.radius_g_1*Math.atan(s/Xe(o,r)),i.y=this.radius_g_1*Math.atan(o/r)):(i.x=this.radius_g_1*Math.atan(s/r),i.y=this.radius_g_1*Math.atan(o/Xe(s,r)))}else this.shape==="sphere"&&(r=Math.cos(e),n=Math.cos(t)*r,s=Math.sin(t)*r,o=Math.sin(e),r=this.radius_g-n,this.flip_axis?(i.x=this.radius_g_1*Math.atan(s/Xe(o,r)),i.y=this.radius_g_1*Math.atan(o/r)):(i.x=this.radius_g_1*Math.atan(s/r),i.y=this.radius_g_1*Math.atan(o/Xe(s,r))));return i.x=i.x*this.a,i.y=i.y*this.a,i}function NF(i){var t=-1,e=0,r=0,n,s,o,a;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(r=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*Xe(1,r)):(e=Math.tan(i.x/this.radius_g_1),r=Math.tan(i.y/this.radius_g_1)*Xe(1,e));var l=r/this.radius_p;if(n=e*e+l*l+t*t,s=2*this.radius_g*t,o=s*s-4*n*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;a=(-s-Math.sqrt(o))/(2*n),t=this.radius_g+a*t,e*=a,r*=a,i.x=Math.atan2(e,t),i.y=Math.atan(r*Math.cos(i.x)/t),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(r=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+r*r)):(e=Math.tan(i.x/this.radius_g_1),r=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+e*e)),n=e*e+r*r+t*t,s=2*this.radius_g*t,o=s*s-4*n*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;a=(-s-Math.sqrt(o))/(2*n),t=this.radius_g+a*t,e*=a,r*=a,i.x=Math.atan2(e,t),i.y=Math.atan(r*Math.cos(i.x)/t)}return i.x=i.x+this.long0,i}var DF=["Geostationary Satellite View","Geostationary_Satellite","geos"],mb={init:OF,forward:FF,inverse:NF,names:DF};var $c=1.340264,Kc=-.081106,Hc=893e-6,Zc=.003796,Pd=Math.sqrt(3)/2;function GF(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function kF(i){var t=j(i.x-this.long0),e=i.y,r=Math.asin(Pd*Math.sin(e)),n=r*r,s=n*n*n;return i.x=t*Math.cos(r)/(Pd*($c+3*Kc*n+s*(7*Hc+9*Zc*n))),i.y=r*($c+Kc*n+s*(Hc+Zc*n)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function zF(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var t=1e-9,e=12,r=i.y,n,s,o,a,l,c;for(c=0;c<e&&(n=r*r,s=n*n*n,o=r*($c+Kc*n+s*(Hc+Zc*n))-i.y,a=$c+3*Kc*n+s*(7*Hc+9*Zc*n),r-=l=o/a,!(Math.abs(l)<t));++c);return n=r*r,s=n*n*n,i.x=Pd*i.x*($c+3*Kc*n+s*(7*Hc+9*Zc*n))/Math.cos(r),i.y=Math.asin(Math.sin(r)/Pd),i.x=j(i.x+this.long0),i}var jF=["eqearth","Equal Earth","Equal_Earth"],pb={init:GF,forward:kF,inverse:zF,names:jF};var Jc=1e-10;function UF(){var i;if(this.phi1=this.lat1,Math.abs(this.phi1)<Jc)throw new Error;this.es?(this.en=il(this.es),this.m1=Cn(this.phi1,this.am1=Math.sin(this.phi1),i=Math.cos(this.phi1),this.en),this.am1=i/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=qF,this.forward=BF):(Math.abs(this.phi1)+Jc>=D?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=VF,this.forward=XF)}function BF(i){var t=j(i.x-(this.long0||0)),e=i.y,r,n,s;return r=this.am1+this.m1-Cn(e,n=Math.sin(e),s=Math.cos(e),this.en),n=s*t/(r*Math.sqrt(1-this.es*n*n)),i.x=r*Math.sin(n),i.y=this.am1-r*Math.cos(n),i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function qF(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var t,e,r,n;if(e=Xe(i.x,i.y=this.am1-i.y),n=rl(this.am1+this.m1-e,this.es,this.en),(t=Math.abs(n))<D)t=Math.sin(n),r=e*Math.atan2(i.x,i.y)*Math.sqrt(1-this.es*t*t)/Math.cos(n);else if(Math.abs(t-D)<=Jc)r=0;else throw new Error;return i.x=j(r+(this.long0||0)),i.y=Ji(n),i}function XF(i){var t=j(i.x-(this.long0||0)),e=i.y,r,n;return n=this.cphi1+this.phi1-e,Math.abs(n)>Jc?(i.x=n*Math.sin(r=t*Math.cos(e)/n),i.y=this.cphi1-n*Math.cos(r)):i.x=i.y=0,i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function VF(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var t,e,r=Xe(i.x,i.y=this.cphi1-i.y);if(e=this.cphi1+this.phi1-r,Math.abs(e)>D)throw new Error;return Math.abs(Math.abs(e)-D)<=Jc?t=0:t=r*Math.atan2(i.x,i.y)/Math.cos(e),i.x=j(t+(this.long0||0)),i.y=Ji(e),i}var WF=["bonne","Bonne (Werner lat_1=90)"],gb={init:UF,names:WF};function yb(i){i.Proj.projections.add(nl),i.Proj.projections.add(sl),i.Proj.projections.add(N2),i.Proj.projections.add(D2),i.Proj.projections.add(G2),i.Proj.projections.add(k2),i.Proj.projections.add(z2),i.Proj.projections.add(j2),i.Proj.projections.add(U2),i.Proj.projections.add(B2),i.Proj.projections.add(q2),i.Proj.projections.add(X2),i.Proj.projections.add(V2),i.Proj.projections.add(Y2),i.Proj.projections.add($2),i.Proj.projections.add(H2),i.Proj.projections.add(Z2),i.Proj.projections.add(J2),i.Proj.projections.add(Q2),i.Proj.projections.add(tb),i.Proj.projections.add(eb),i.Proj.projections.add(ib),i.Proj.projections.add(sb),i.Proj.projections.add(ob),i.Proj.projections.add(ab),i.Proj.projections.add(ub),i.Proj.projections.add(fb),i.Proj.projections.add(db),i.Proj.projections.add(mb),i.Proj.projections.add(pb),i.Proj.projections.add(gb)}Hi.defaultDatum="WGS84";Hi.Proj=Js;Hi.WGS84=new Hi.Proj("WGS84");Hi.Point=M2;Hi.toPoint=vd;Hi.defs=Za;Hi.nadgrid=m_;Hi.transform=zo;Hi.mgrs=S2;Hi.version="__VERSION__";yb(Hi);var S_=Hi;function Rd(i){let t=[];for(let e of i)if(e instanceof se){let r=e.getLayers().getArray(),n=Rd(r);t=Array.prototype.concat(t,n)}else t.push(e);return t}function rnt(i,t,e,r=!1){let n=t.getContext("2d");if(!n)throw new Error("The target-canvas needs to use a 2d-context.");if(!t.width||!t.height)throw new Error("TargetCanvas: width or height have not been set.");n instanceof CanvasRenderingContext2D?n.clearRect(0,0,t.width,t.height):n.canvas;let s=i.getSize();t.width=s[0],t.height=s[1];let o=Rd(i.getLayers().getArray()),a=[];for(let l of o)if(l.getVisible()&&l.getOpacity()>0){let c=l.on("postrender",h=>{let f=h.context.canvas;n instanceof CanvasRenderingContext2D?(n.beginPath(),n.drawImage(f,0,0,f.clientWidth,f.clientHeight,0,0,t.width,t.height),n.closePath()):n.canvas});Array.isArray(c)?c.map(h=>a.push(h)):a.push(c)}r?i.on("rendercomplete",l=>{e(t)}):i.once("rendercomplete",l=>{for(let c of a)Kd(c);e(t)}),i.renderSync()}function Id(i,t,e=!1){i.setVisible(t),!e&&i instanceof se&&i.getLayers().forEach(n=>{Id(n,t)})}function Ad(i,t,e=!1){i.setOpacity(t),!e&&i instanceof se&&i.getLayers().forEach(n=>{Ad(n,t)})}function Uo(i,t,e){let r=e>0?t+e:t;i.setZIndex(r),i instanceof se&&i.getLayers().forEach(s=>{Uo(s,t,e)})}function _b(i,t,e){e.remove(i),e.insertAt(t,i)}var Je=i=>{let t=[];for(let e of i){let r;Array.isArray(e[0])?r=Je(e):r=e,t=Array.prototype.concat(t,r)}return t};var xb=(i,t)=>Math.log(i)/Math.log(t),Qc=(i,t)=>xb(i,t)%1===0,vb=(i,t)=>{let e=Math.ceil(xb(i,t));return Math.pow(2,e)};var th=7,Eb=(i,t,e)=>{let r=i.createShader(t);if(!r)throw new Error("No shader was created");if(i.shaderSource(r,e),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS))throw i.deleteShader(r),new Error(`An error occurred compiling the shader: ${i.getShaderInfoLog(r)}.    

 Shader code: ${e}`);return r},b_=(i,t,e)=>{let r=i.createProgram();if(!r)throw new Error("No program was created");let n=Eb(i,i.VERTEX_SHADER,t),s=Eb(i,i.FRAGMENT_SHADER,e);if(i.attachShader(r,n),i.attachShader(r,s),i.linkProgram(r),i.detachShader(r,n),i.detachShader(r,s),i.deleteShader(n),i.deleteShader(s),!i.getProgramParameter(r,i.LINK_STATUS))throw i.deleteProgram(r),new Error("Unable to initialize the shader program: "+i.getProgramInfoLog(r));return r};var eh=(i,t)=>{i.useProgram(t)},C_=(i,t)=>{i.clearColor(t[0],t[1],t[2],t[3]),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},M_=(i,t,e=i.TRIANGLES)=>{let r=new Float32Array(Je(t)),n=i.createBuffer();if(!n)throw new Error("No buffer was created");return i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,r,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),{buffer:n,vectorSize:t[0].length,vectorCount:t.length,type:i.FLOAT,normalize:!1,stride:0,offset:0,drawingMode:e}},wb=(i,t)=>{i.drawArrays(t.drawingMode,t.offset,t.vectorCount)},Sb=(i,t,e)=>{let r=new Float32Array(Je(e));return i.bindBuffer(i.ARRAY_BUFFER,t.buffer),i.bufferData(i.ARRAY_BUFFER,r,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),{buffer:t.buffer,vectorSize:e[0].length,vectorCount:e.length,type:i.FLOAT,normalize:!1,stride:0,offset:0,drawingMode:t.drawingMode}},T_=(i,t,e)=>{let r=i.getAttribLocation(t,e);if(r===-1)throw new Error(`Couldn't find attribute ${e} in program.`);return r},P_=(i,t,e)=>{i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.enableVertexAttribArray(t),i.vertexAttribPointer(t,e.vectorSize,e.type,e.normalize,e.stride,e.offset)},bb=(i,t,e=i.TRIANGLES)=>{let r=new Uint16Array(Je(t)),n=i.createBuffer();if(!n)throw new Error("No buffer was created");return i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n),i.bufferData(i.ELEMENT_ARRAY_BUFFER,r,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),{buffer:n,count:r.length,type:i.UNSIGNED_SHORT,offset:0,drawingMode:e}},Cb=(i,t)=>{i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.buffer)},Mb=(i,t)=>{i.drawElements(t.drawingMode,t.count,t.type,t.offset)},R_=(i,t)=>{let e=i.createTexture();if(!e)throw new Error("No texture was created");i.activeTexture(i.TEXTURE0+th),i.bindTexture(i.TEXTURE_2D,e);let r=0,n=i.RGBA,s=i.RGBA,o=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,r,n,s,o,t),i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null);let a,l;return t instanceof HTMLImageElement?(a=t.naturalWidth,l=t.naturalHeight):(a=t.width,l=t.height),{texture:e,level:r,internalformat:n,format:s,type:o,width:a,height:l,border:0}},Tb=(i,t)=>{let e=t.length,r=t[0].length,n=t[0][0].length;if(!Qc(r,2)||!Qc(e,2))throw new Error(`Texture-data-dimensions must be a power of two, but are ${r} x ${e}`);if(n!==4)throw new Error(`Expecting 4 channels, but ${n} provided`);let s=i.createTexture();if(!s)throw new Error("No texture was created");i.activeTexture(i.TEXTURE0+th),i.bindTexture(i.TEXTURE_2D,s);let o=0,a=0,l=i.RGBA,c=i.RGBA,h=i.UNSIGNED_BYTE,u=new Uint8Array(Je(t));return n!==4&&i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texImage2D(i.TEXTURE_2D,o,l,r,e,a,c,h,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.bindTexture(i.TEXTURE_2D,null),{texture:s,level:o,internalformat:l,format:c,type:h,width:r,height:e,border:a}},Pb=(i,t,e)=>{if(t<=0||e<=0)throw new Error("Width and height must be positive.");let r=i.createTexture();if(!r)throw new Error("No texture was created");return i.activeTexture(i.TEXTURE0+th),i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.bindTexture(i.TEXTURE_2D,null),{texture:r,level:0,internalformat:i.RGBA,format:i.RGBA,type:i.UNSIGNED_BYTE,width:t,height:e,border:0}},I_=(i,t,e,r)=>{if(e>i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS))throw new Error(`There are only ${i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS)} texture bind points, but you tried to bind to point nr. ${e}.`);e===th&&console.error(`You are about to bind to the dedicated texture-construction bind point (nr. ${e}).
        If after this call another texture is built, your shader will now use that new texture instead of this one!
        Consider using another bind point.`),i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(r,e)},Rb=(i,t,e)=>{if(i.activeTexture(i.TEXTURE0+th),i.bindTexture(i.TEXTURE_2D,t.texture),e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e);else{let r=e[0].length,n=e.length;if(!Qc(r,2)||!Qc(n,2))throw new Error(`Texture-data-dimensions must be a power of two, but are ${n} x ${r}`);let s=new Uint8Array(Je(e));i.texImage2D(i.TEXTURE_2D,t.level,t.internalformat,t.width,t.height,t.border,t.format,t.type,s)}return i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),e instanceof HTMLImageElement?(t.width=e.naturalWidth,t.height=e.naturalHeight):e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(t.width=e.width,t.height=e.height):(t.width=e[0].length,t.height=e.length),t},Ib=i=>{let t=i.createFramebuffer();if(!t)throw new Error("Error creating framebuffer");return t},Ab=(i,t,e)=>{i.bindFramebuffer(i.FRAMEBUFFER,t.framebuffer),e?(t.width/t.height!==e[2]/e[3]&&console.warn("Your viewport-aspect is different from the framebuffer-aspect."),i.viewport(...e)):i.viewport(0,0,t.width,t.height)},Lb=(i,t)=>{i.bindFramebuffer(i.FRAMEBUFFER,null),t?(i.canvas.width/i.canvas.height!==t[2]/t[3]&&console.warn("Your viewport-aspect is different from the canvas-aspect."),i.viewport(...t)):i.viewport(0,0,i.canvas.width,i.canvas.height)},Ob=(i,t,e)=>{if(i.bindFramebuffer(i.FRAMEBUFFER,e),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t.texture,0),i.checkFramebufferStatus(i.FRAMEBUFFER)!==i.FRAMEBUFFER_COMPLETE)throw new Error(`Error creating framebuffer: framebuffer-status: ${i.checkFramebufferStatus(i.FRAMEBUFFER)} ; error-code: ${i.getError()}`);return i.bindFramebuffer(i.FRAMEBUFFER,null),{framebuffer:e,texture:t,width:t.width,height:t.height}},ih=(i,t,e)=>{let r=i.getUniformLocation(t,e);if(r===null)throw new Error(`Couldn't find uniform ${e} in program.`);return r},Fb=(i,t,e,r)=>{switch(e){case"bool":i.uniform1i(t,r[0]);break;case"bvec2":i.uniform2i(t,r[0],r[1]);break;case"bvec3":i.uniform3i(t,r[0],r[1],r[2]);break;case"bvec4":i.uniform4i(t,r[0],r[1],r[2],r[3]);break;case"bool[]":i.uniform1iv(t,r);break;case"bvec2[]":i.uniform2iv(t,r);break;case"bvec3[]":i.uniform3iv(t,r);break;case"bvec4[]":i.uniform4iv(t,r);break;case"int":i.uniform1i(t,r[0]);break;case"ivec2":i.uniform2i(t,r[0],r[1]);break;case"ivec3":i.uniform3i(t,r[0],r[1],r[2]);break;case"ivec4":i.uniform4i(t,r[0],r[1],r[2],r[3]);break;case"int[]":i.uniform1iv(t,r);break;case"ivec2[]":i.uniform2iv(t,r);break;case"ivec3[]":i.uniform3iv(t,r);break;case"ivec4[]":i.uniform4iv(t,r);break;case"float":i.uniform1f(t,r[0]);break;case"vec2":i.uniform2f(t,r[0],r[1]);break;case"vec3":i.uniform3f(t,r[0],r[1],r[2]);break;case"vec4":i.uniform4f(t,r[0],r[1],r[2],r[3]);break;case"float[]":i.uniform1fv(t,r);break;case"vec2[]":i.uniform2fv(t,r);break;case"vec3[]":i.uniform3fv(t,r);break;case"vec4[]":i.uniform4fv(t,r);break;case"mat2":i.uniformMatrix2fv(t,!1,r);break;case"mat3":i.uniformMatrix3fv(t,!1,r);break;case"mat4":i.uniformMatrix4fv(t,!1,r);break;default:throw Error(`Type ${e} not implemented.`)}},Nb=i=>{let t=i.getContext("webgl");if(!t)throw new Error("no context");let e=t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT),r=t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE),n;if(r===t.UNSIGNED_BYTE)n=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else if(r===t.UNSIGNED_SHORT_5_6_5||r===t.UNSIGNED_SHORT_4_4_4_4||r===t.UNSIGNED_SHORT_5_5_5_1)n=new Uint16Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else if(r===t.FLOAT)n=new Float32Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else throw new Error(`Did not understand pixel data type ${r} for format ${e}`);return t.readPixels(0,0,i.width,i.height,e,r,n),n};var YF=function(i){let t=0;for(let e of i)t+=e.charCodeAt(0);return`${t}`},hs=class{constructor(t,e,r){this.vertexShaderSource=e,this.fragmentShaderSource=r,this.program=b_(t,e,r),this.id=YF(e+r)}},Ne=class{constructor(t,e,r,n,s){this.location=ih(t,e.program,r),this.type=n,this.value=s,this.variableName=r}},Qs=class{constructor(t,e,r,n,s){this.location=ih(t,e.program,r),n instanceof HTMLImageElement||n instanceof HTMLCanvasElement?this.texture=R_(t,n):this.texture=n,this.bindPoint=s,this.variableName=r}},Ld=class{constructor(t,e,r,n,s){this.location=ih(t,e.program,r),this.texture=Tb(t,n),this.bindPoint=s,this.variableName=r}},pr=class{constructor(t,e,r,n,s="triangles"){let o;switch(s){case"triangles":o=t.TRIANGLES;break;case"lines":o=t.LINES;break;case"points":o=t.POINTS;break;default:throw new Error(`Invalid drawing mode ${s}`)}this.location=T_(t,e.program,r),this.value=M_(t,n,o),this.variableName=r,this.drawingMode=o}},Od=class{constructor(t,e,r="triangles"){let n;switch(r){case"triangles":n=t.TRIANGLES;break;case"lines":n=t.LINES;break;case"points":n=t.POINTS;break;default:throw new Error(`Invalid drawing mode ${r}`)}this.index=bb(t,e,n)}};function A_(i,t){for(let e of i)if(t(e))return e;return null}function $F(i){let t=/^\s*attribute (int|float|vec2|vec3|vec4|mat2|mat3|mat4) (\w*);/gm,e=/^\s*uniform (int|float|vec2|vec3|vec4|mat2|mat3|mat4) (\w*)(\[\d\])*;/gm,r=/^\s*uniform sampler2D (\w*);/gm,n=/^\s*precision (\w*) float;/gm,s=i.fragmentShaderSource+`


`+i.vertexShaderSource,o=[],a;for(;(a=t.exec(s))!==null;)o.push(a[2]);let l=[],c;for(;(c=e.exec(s))!==null;)l.push(c[2]);let h=[],u;for(;(u=r.exec(s))!==null;)h.push(u[1]);let f=[],d;for(;(d=n.exec(s))!==null;)f.push(d[1]);return[o,l,h,f]}var us=class{constructor(t,e,r,n,s){this.program=t,this.attributes=e,this.uniforms=r,this.textures=n,this.index=s;let[o,a,l,c]=$F(t);for(let u of o){let f=e.filter(d=>d.variableName===u);if(f.length!==1)throw new Error(`Provided ${f.length} values for shader's attribute ${u}.`)}for(let u of a){let f=r.filter(d=>d.variableName===u);if(f.length!==1)throw new Error(`Provided ${f.length} values for shader's uniform ${u}.`)}for(let u of l){let f=n.filter(d=>d.variableName===u);if(f.length!==1)throw new Error(`Provided ${f.length} values for shader's texture ${u}.`)}c.length===1&&console.warn(`You have only provided one precision qualifier.
            This can cause issues when you want to use a uniform in both the vertex- and the fragment-shader.`);let h=this.attributes.map(u=>u.value.vectorCount);if(Math.min(...h)!==Math.max(...h))throw new Error("Your attributes are not of the same length!")}bind(t){eh(t,this.program.program);for(let e of this.attributes)P_(t,e.location,e.value);for(let e of this.uniforms)Fb(t,e.location,e.type,e.value);for(let e of this.textures)I_(t,e.texture.texture,e.bindPoint,e.location);this.index&&Cb(t,this.index.index)}render(t,e,r,n){if(r?Ab(t,r,n):Lb(t,n),e&&C_(t,e),this.index)Mb(t,this.index.index);else{let s=this.attributes[0];wb(t,s.value)}}updateAttributeData(t,e,r){let n=A_(this.attributes,s=>s.variableName===e);if(!n)throw new Error(`No such attribute ${e} to be updated.`);Sb(t,n.value,r)}updateUniformData(t,e,r){let n=A_(this.uniforms,s=>s.variableName===e);if(!n)throw new Error(`No such uniform ${e} to be updated.`);n.value=r}updateTextureData(t,e,r){let n=A_(this.textures,o=>o.variableName===e);if(!n)throw new Error(`No such texture ${e} to be updated.`);let s=Rb(t,n.texture,r);n.texture=s}},cl=class{constructor(t,e,r){let n=Ib(t),s=Pb(t,e,r),o=Ob(t,s,n);this.fbo=o}};function KF(i,t){let e=1e3/i,r=e,n,s,o,a=()=>{n=window.performance.now(),t(r),s=window.performance.now(),r=s-n,o=Math.max(e-r,0),setTimeout(()=>{requestAnimationFrame(a)},o)};a()}var fs=(i,t)=>({vertices:[[-i/2,t/2,0],[-i/2,-t/2,0],[i/2,-t/2,0],[-i/2,t/2,0],[i/2,-t/2,0],[i/2,t/2,0]],texturePositions:[[0,1],[0,0],[1,0],[0,1],[1,0],[1,1]]}),Db=(i,t)=>({vertices:[[-i/2,t/2,0],[-i/2,-t/2,0],[i/2,-t/2,0],[i/2,t/2,0]],texturePositions:[[0,1],[0,0],[1,0],[1,1]],vertexIndices:[[0,1,2],[0,2,3]]});var Gb=(i,t=256,e=256,r="red")=>{let n=document.createElement("canvas").getContext("2d");if(!n)throw new Error("no context");return n.canvas.width=t,n.canvas.height=e,n.font=`bold ${e*5/6|0}px sans-serif`,n.textAlign="center",n.textBaseline="middle",n.fillStyle=r,n.fillText(i,t/2,e/2),n.canvas};var kb=class extends wa{constructor(t){super(t)}createRenderer(){return this.renderer=new L_(this),this.renderer}updateSunAngle(t){this.renderer&&this.renderer.updateSunAngle(t)}},L_=class extends Pu{constructor(t){super(t),this.state="loading";let e=document.createElement("canvas");e.width=1200,e.height=800,e.style.position="absolute";let r=e.getContext("webgl"),n=t.getSource(),s=n.getProjection(),o=n.getImageExtent(),a=this.bboxOntoRectangle(2,2,o),l=Gb("test",2048,2048,"red"),c=new hs(r,`
            attribute vec3 a_position;
            attribute vec2 a_texturePosition;
            uniform mat3 u_world2pix;
            uniform mat3 u_pix2canv;
            varying vec2 v_texturePosition;
            void main() {
                vec3 pixelPosition = u_world2pix * vec3(a_position.x, a_position.y, 1.);
                vec3 canvasPosition = u_pix2canv * pixelPosition;
                gl_Position = vec4(canvasPosition.x, canvasPosition.y, 0., 1.);
                v_texturePosition = a_texturePosition;
            }
        `,`
            precision mediump float;
            uniform sampler2D u_srtm;
            uniform float u_imageSize;
            uniform vec3 u_sun;
            varying vec2 v_texturePosition;
            void main() {
                float delta = 4. / u_imageSize;
                float top = texture2D(u_srtm, vec2(v_texturePosition.x,         1. - v_texturePosition.y + delta)).r;
                float bot = texture2D(u_srtm, vec2(v_texturePosition.x,         1. - v_texturePosition.y - delta)).r;
                float lft = texture2D(u_srtm, vec2(v_texturePosition.x + delta, 1. - v_texturePosition.y        )).r;
                float rgt = texture2D(u_srtm, vec2(v_texturePosition.x - delta, 1. - v_texturePosition.y        )).r;

                vec3 surfaceNormal = vec3(
                    lft - rgt,
                    bot - top,
                    2. * delta
                );
                surfaceNormal = normalize(surfaceNormal);
                vec3 sunNormal = normalize(u_sun);
                float alignment = abs(dot(sunNormal, surfaceNormal));

                gl_FragColor = vec4(0., 0., 0., 0.5 * alignment);
            }
        `);eh(r,c.program);let h=new us(c,[new pr(r,c,"a_position",a.vertices),new pr(r,c,"a_texturePosition",a.texturePositions)],[new Ne(r,c,"u_imageSize","float",[2048]),new Ne(r,c,"u_sun","vec3",[0,0,1]),new Ne(r,c,"u_world2pix","mat3",Je([[1,0,0],[0,1,0],[0,0,1]])),new Ne(r,c,"u_pix2canv","mat3",Je([[1/(e.width/2),0,0],[0,-1/(e.height/2),0],[-1,1,1]]))],[new Qs(r,c,"u_srtm",l,0)]);h.bind(r),this.shader=h,this.canvas=e,this.gl=r,this.projection=s;let u=n.getImage(o,.02197265625,2.440000295639038,s);u.load(),u.addEventListener("change",f=>{let d=u.getImage();this.shader.updateTextureData(this.gl,"u_srtm",d),this.shader.bind(this.gl),this.state="ready",t.changed();let m=t.get("map");requestAnimationFrame(()=>{m.render()})})}prepareFrame(t){if(this.state==="ready"){let e=t.coordinateToPixelTransform,r=[[e[0],e[1],0],[e[2],e[3],0],[e[4],e[5],1]];this.shader.updateUniformData(this.gl,"u_world2pix",Je(r)),this.shader.bind(this.gl),t.viewState.projection!==this.projection&&this.reprojectImage(t.viewState.projection)}return!0}renderFrame(t,e){return this.state==="ready"&&(this.shader.render(this.gl),this.transformCanvas(t)),this.canvas}renderDeclutter(t){}updateSunAngle(t){this.shader.updateUniformData(this.gl,"u_sun",[t[0],t[1],1]),this.shader.bind(this.gl),this.shader.render(this.gl)}bboxOntoRectangle(t,e,r){let n=fs(t,e);for(let s of n.vertices){let o=s[0],a=s[1];s[0]=o===t/2?r[2]:r[0],s[1]=a===e/2?r[3]:r[1]}return n}reprojectImage(t){let e=super.getLayer().getSource(),r=e.getProjection(),n=e.getImageExtent(),s=nr(n,r,t),o=this.bboxOntoRectangle(2,2,s);this.shader.updateAttributeData(this.gl,"a_position",o.vertices),this.shader.bind(this.gl)}transformCanvas(t){let e=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,n=t.size,s=Math.round(n[0]*r),o=Math.round(n[1]*r),a=e.opacity;this.canvas.width=s,this.canvas.height=o,this.canvas.style.opacity=`${a}`;let l=[[1/(this.canvas.width/2),0,0],[0,-1/(this.canvas.height/2),0],[-1,1,1]];this.shader.updateUniformData(this.gl,"u_pix2canv",Je(l))}};var O_=class extends Wr{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5}getImageInternal(t,e,r,n){e=this.findNearestResolution(e);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==e&&s.getPixelRatio()==r&&Ce(s.getExtent(),t))return s;t=t.slice(),Th(t,this.ratio_);let o=it(t)/e,a=Ft(t)/e,l=[o*r,a*r],c=this.canvasFunction_.call(this,t,e,r,l,n);return c&&(s=new Df(t,e,r,c)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}},HF=O_;function zb(i){let t=i.load||Ls,e=i.imageExtent,r=i.crossOrigin??null;return()=>{let n=new Image;return n.crossOrigin=r,t(n,i.url).then(s=>{let o=it(e)/s.width,a=Ft(e)/s.height;return{image:s,extent:e,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}var F_=class extends Wr{constructor(t){let e=t.crossOrigin!==void 0?t.crossOrigin:null,r=t.imageLoadFunction!==void 0?t.imageLoadFunction:Hf;super({attributions:t.attributions,interpolate:t.interpolate,projection:Z(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new Os(this.imageExtent_,void 0,1,zb({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(n,s)=>(this.image.setImage(n),r(this.image,s),Ls(n))})),this.image.addEventListener($.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,r,n){return kt(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}},ZF=F_;var JF='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',N_=class extends td{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[JF];let r=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",n=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:r,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}},D_=N_;var jb=class extends dn{constructor(t){super(t),this.options=t}createRenderer(){return new G_(this,this.options.renderSettings)}updateParas(t,e,r){let n={colorRamp:this.options.renderSettings.colorRamp,maxEdgeLength:this.options.renderSettings.maxEdgeLength,storeInterpolatedPixelData:this.options.renderSettings.storeInterpolatedPixelData,valueProperty:this.options.renderSettings.valueProperty,power:t,showLabels:r,smooth:e};super.getRenderer().updateSettings(n),this.options.renderSettings=n}},G_=class extends nc{constructor(t,e){super(t),this.settings=e,this.container=document.createElement("div"),this.container.classList.add("ol-layer"),this.container.style.setProperty("position","absolute"),this.container.style.setProperty("width","100%"),this.container.style.setProperty("height","100%"),this.webGlCanvas=document.createElement("canvas"),this.webGlCanvas.style.setProperty("position","absolute"),this.webGlCanvas.style.setProperty("left","0px"),this.webGlCanvas.style.setProperty("top","0px"),this.webGlCanvas.style.setProperty("width","100%"),this.webGlCanvas.style.setProperty("height","100%"),this.webGlCanvas.width=1e3,this.webGlCanvas.height=1e3,this.gl=this.webGlCanvas.getContext("webgl"),this.container.appendChild(this.webGlCanvas),this.pointRenderer=new nc(t);let r=t.getSource();this.projection=r.getProjection();let{coords:n,values:s,bboxDelta:o,maxVal:a}=this.parseData(r,this.settings.valueProperty,this.settings.maxEdgeLength),{observationsBbox:l,maxEdgeLengthBbox:c}=this.parseDataBbox(o,n,s,a,this.settings.maxEdgeLength);this.bbox=o;let h=[[1,0,0],[0,1,0],[0,0,1]];this.interpolationShader=t5(this.gl,l,a,this.settings.power,c),this.valueFb=new cl(this.gl,this.webGlCanvas.width,this.webGlCanvas.height),this.colorizationShader=e5(this.gl,this.settings.colorRamp,a,this.settings.smooth,this.valueFb),this.colorFb=new cl(this.gl,this.webGlCanvas.width,this.webGlCanvas.height),this.arrangementShader=i5(this.gl,h,h,o,this.colorFb),this.runInterpolationShader(this.valueFb.fbo),this.runColorizationShader(this.colorFb.fbo)}prepareFrame(t){let e=t.layerStatesArray[t.layerIndex];if(this.webGlCanvas.style.opacity=`${e.opacity}`,t.viewState.projection!==this.projection){this.projection=t.viewState.projection;let n=super.getLayer().getSource(),{coords:s,values:o,bboxDelta:a,maxVal:l}=this.parseData(n,this.settings.valueProperty,this.settings.maxEdgeLength),{observationsBbox:c,maxEdgeLengthBbox:h}=this.parseDataBbox(a,s,o,l,this.settings.maxEdgeLength);this.updateInterpolationShader(this.settings.power,c,h),this.runInterpolationShader(this.valueFb.fbo),this.runColorizationShader(this.colorFb.fbo),this.bbox=a}let r=t.coordinateToPixelTransform;return this.updateArrangementShader(r,t.size[0],t.size[1],this.bbox),this.pointRenderer.prepareFrame(t),!0}renderFrame(t,e){if(this.runArrangementShader(),this.settings.showLabels){let r=this.pointRenderer.renderFrame(t,this.container);Dl(this.container,[this.webGlCanvas,r])}else Dl(this.container,[this.webGlCanvas]);return this.container}renderDeclutter(t){}updateSettings(t){let e=this.settings;this.settings=t,t.power!==e.power?(this.updateInterpolationShader(t.power),this.runInterpolationShader(this.valueFb.fbo),this.updateColorizationShader(t.smooth),this.runColorizationShader(this.colorFb.fbo)):t.smooth!==e.smooth&&(this.updateColorizationShader(t.smooth),this.runColorizationShader(this.colorFb.fbo)),super.getLayer().changed()}updateArrangementShader(t,e,r,n){let s=[[t[0],t[1],0],[t[2],t[3],0],[t[4],t[5],1]],o=[[1/(e/2),0,0],[0,-1/(r/2),0],[-1,1,1]];this.arrangementShader.updateUniformData(this.gl,"u_world2pix",Je(s)),this.arrangementShader.updateUniformData(this.gl,"u_pix2clip",Je(o)),this.arrangementShader.updateUniformData(this.gl,"u_bbox",n)}runArrangementShader(t){this.arrangementShader.bind(this.gl),this.arrangementShader.render(this.gl,[0,0,0,0],t)}updateInterpolationShader(t,e,r){this.interpolationShader.updateUniformData(this.gl,"u_power",[t]),e&&this.interpolationShader.updateTextureData(this.gl,"u_dataTexture",[e]),r&&this.interpolationShader.updateUniformData(this.gl,"u_maxDistance",[r])}runInterpolationShader(t){this.interpolationShader.bind(this.gl),this.interpolationShader.render(this.gl,[0,0,0,0],t),this.settings.storeInterpolatedPixelData&&(this.interpolatedValues=Nb(this.webGlCanvas))}updateColorizationShader(t){this.colorizationShader.updateUniformData(this.gl,"u_smooth",[t?1:0])}runColorizationShader(t){this.colorizationShader.bind(this.gl),this.colorizationShader.render(this.gl,[0,0,0,0],t)}parseData(t,e,r){let n=t.getFeatures();t instanceof Qn?n=t.getSource().getFeatures():n=t.getFeatures();let s=n.map(m=>m.getGeometry().getCoordinates()),o=n.map(m=>parseFloat(m.getProperties()[e])),a=r5(s),l=a[2]-a[0],c=a[3]-a[1],h,u;l>c?(u=l-c,h=0):(u=0,h=c-l);let f=[a[0]-r,a[1]-r,a[2]+h+r,a[3]+u+r],d=o.reduce((m,p)=>p>m?p:m,0);return{coords:s,values:o,bboxDelta:f,maxVal:d}}parseDataBbox(t,e,r,n,s){let o=n5(e,r).map(f=>{let d=QF([f[0],f[1]],t);return[255*(d[0]+1)/2,255*(d[1]+1)/2,255*f[2]/n,255]}),a=o.length,l=vb(a,2);for(let f=0;f<l-a;f++)o.push([0,0,0,0]);let c=t[2]-t[0],h=t[3]-t[1],u=s/Math.max(c,h);return{observationsBbox:o,maxEdgeLengthBbox:u}}},QF=(i,t)=>{let e=(i[0]-t[0])/(t[2]-t[0]),r=(i[1]-t[1])/(t[3]-t[1]),n=2*e-1,s=2*r-1;return[n,s]},t5=(i,t,e,r,n)=>{let o=new hs(i,`
            precision mediump float;
            attribute vec3 a_position;
            attribute vec2 a_texturePosition;
            varying vec2 v_position;
            varying vec2 v_texturePosition;

            void main() {
                v_position = a_position.xy;
                v_texturePosition = a_texturePosition;
                gl_Position = vec4(a_position.xy, 0.0, 1.0);
            }
        `,`
            precision mediump float;
            uniform float u_power;
            uniform sampler2D u_dataTexture;
            uniform int u_nrDataPoints;
            uniform float u_maxValue;
            uniform float u_maxDistance;
            varying vec2 v_position;
            varying vec2 v_texturePosition;

            void main() {

                float valSum = 0.0;
                float wSum = 0.0;
                float minD = 10000.0;
                for (int i = 0; i < 10000; i++) {
                    if (i > u_nrDataPoints) {
                        break;
                    }
                    vec4 dataPoint = texture2D(u_dataTexture, vec2(float(i) / float(u_nrDataPoints), 0.5));
                    if (dataPoint.w > 0.0) {  // texture is padded to next power of two with transparent 0-values.
                        vec2 coords = dataPoint.xy * 2.0 - 1.0;  // transforming coords from [0, 1] to [-1, 1]
                        float value = dataPoint.z * u_maxValue;  // transforming value from [0, 1] to [0, maxValue]

                        float d = distance(v_position, coords);
                        float w = 1.0 / pow(d, u_power);
                        valSum += value * w;
                        wSum += w;
                        if (d < minD) {
                            minD = d;
                        }
                    }
                }
                float interpolatedValue = valSum / wSum;
                float alpha = 1.0;
                if (minD > u_maxDistance) {
                    alpha = 0.0;
                }
                vec4 color = vec4(interpolatedValue / u_maxValue, 0.0, 0.0, alpha);

                gl_FragColor = color;
            }
        `),a=Db(2,2);return new us(o,[new pr(i,o,"a_position",a.vertices),new pr(i,o,"a_texturePosition",a.texturePositions)],[new Ne(i,o,"u_power","float",[r]),new Ne(i,o,"u_nrDataPoints","int",[t.length]),new Ne(i,o,"u_maxValue","float",[e]),new Ne(i,o,"u_maxDistance","float",[n])],[new Ld(i,o,"u_dataTexture",[t],0)],new Od(i,a.vertexIndices))},e5=(i,t,e,r,n)=>{let o=new hs(i,`
            precision mediump float;
            attribute vec2 a_position;
            attribute vec2 a_textureCoord;
            varying vec2 v_textureCoord;

            void main() {
                v_textureCoord = a_textureCoord;
                gl_Position = vec4(a_position.xy, 0.0, 1.0);
            }
        `,`
            precision mediump float;
            uniform float u_colorRampValues[15];
            uniform vec3 u_colorRampColors[15];
            uniform int u_nrColorRampValues;
            uniform float u_maxValue;
            uniform bool u_smooth;
            uniform sampler2D u_valueTexture;
            varying vec2 v_textureCoord;

            vec3 valueToSmoothColor(in float value) {
                if (value < u_colorRampValues[0]) {
                    return u_colorRampColors[0];
                }
                for (int i = 1; i < 15; i++) {
                    if (i > u_nrColorRampValues) {
                        break;
                    }
                    if (value < u_colorRampValues[i]) {
                        float alpha = (value - u_colorRampValues[i-1]) / (u_colorRampValues[i] - u_colorRampValues[i-1]);
                        vec3 color = alpha * (u_colorRampColors[i] - u_colorRampColors[i-1]) + u_colorRampColors[i-1];
                        return color;
                    }
                    if (i == u_nrColorRampValues) {
                        return u_colorRampColors[i];
                    }
                }
            }

            vec3 valueToStepColor(in float value) {
                for (int i = 0; i < 15; i++) {
                    if (i > u_nrColorRampValues) {
                        break;
                    }
                    if (value < u_colorRampValues[i]) {
                        return u_colorRampColors[i];
                    }
                    if (i == u_nrColorRampValues) {
                        return u_colorRampColors[i];
                    }
                }
            }

            void main() {
                vec4 pixelData = texture2D(u_valueTexture, v_textureCoord);
                float val = pixelData.r * u_maxValue;
                float alpha = pixelData.w;
                vec3 rgb = vec3(0.0, 0.0, 0.0);
                if (alpha > 0.01) {
                    if (u_smooth) {
                        rgb = valueToSmoothColor(val);
                    } else {
                        rgb = valueToStepColor(val);
                    }
                }
                gl_FragColor = vec4(rgb.x / 255.0, rgb.y / 255.0, rgb.z / 255.0, alpha);
            }
        `);return new us(o,[new pr(i,o,"a_position",fs(2,2).vertices),new pr(i,o,"a_textureCoord",fs(2,2).texturePositions)],[new Ne(i,o,"u_colorRampValues","float[]",t.map(l=>l.val)),new Ne(i,o,"u_colorRampColors","vec3[]",Je(t.map(l=>l.rgb))),new Ne(i,o,"u_nrColorRampValues","int",[t.length]),new Ne(i,o,"u_maxValue","float",[e]),new Ne(i,o,"u_smooth","bool",[r?1:0])],[new Qs(i,o,"u_valueTexture",n.fbo.texture,0)])},i5=(i,t,e,r,n)=>{let s=new hs(i,`
            precision mediump float;
            attribute vec3 a_pos;
            attribute vec2 a_posTexture;
            uniform mat3 u_world2pix;
            uniform mat3 u_pix2clip;
            uniform vec4 u_bbox;
            varying vec2 v_posTexture;

            vec2 clipBbx2worldCoords(vec2 clipCoords, vec4 bbox) {
                float xPerct = ( clipCoords.x + 1.0 ) / 2.0;
                float yPerct = ( clipCoords.y + 1.0 ) / 2.0;
                float xWorld = xPerct * (bbox.z - bbox.x) + bbox.x;
                float yWorld = yPerct * (bbox.w - bbox.y) + bbox.y;
                return vec2(xWorld, yWorld);
            }

            void main() {
                v_posTexture = a_posTexture;
                vec2 worldPos = clipBbx2worldCoords(a_pos.xy, u_bbox);
                vec3 clipPos = u_pix2clip * u_world2pix * vec3(worldPos.xy, 1.0);
                gl_Position = vec4(clipPos.xy, 0.0, 1.0);
            }
        `,`
            precision mediump float;
            uniform sampler2D u_texture;
            varying vec2 v_posTexture;

            void main() {
                gl_FragColor = texture2D(u_texture, v_posTexture);
            }
        `);return new us(s,[new pr(i,s,"a_pos",fs(2,2).vertices),new pr(i,s,"a_posTexture",fs(2,2).texturePositions)],[new Ne(i,s,"u_world2pix","mat3",Je(t)),new Ne(i,s,"u_pix2clip","mat3",Je(e)),new Ne(i,s,"u_bbox","vec4",r)],[new Qs(i,s,"u_texture",n.fbo.texture,0)])},r5=i=>{let t=i.map(a=>a[0]),e=i.map(a=>a[1]),r=Math.min(...t),n=Math.max(...t),s=Math.min(...e),o=Math.max(...e);return[r,s,n,o]},n5=(i,t)=>{let e=[];for(let r=0;r<i.length;r++)e.push(i[r].concat(t[r]));return e};var Fd="type",Pi="filtertype",Pe="id",k_="groupID",z_="groupName",j_="title",o5="EPSG:3857",gr="EPSG:4326",yr="popup",Ub=(()=>{class i{constructor(e,r){this.app=e,this.envInjector=r,this.hitTolerance=0,this.hitLayerCurr=null,this.hitLayerPrev=null,this.projectionChange=new jd,this.dynamicPopupComponents=new Map,this.popupEvents=new jd,this.filterLayerNoPopup=n=>{let s=n.get(yr),o=!0;return s||(o=!1),s&&this.isPopupObj(s)&&s.filterLayer===!0&&(o=!1),o},this.map=new Ds({controls:[]}),this.view=new ai,this.EPSG=o5}createMap(e){let n={lat:0,lon:0},s=new se({layers:[]});s.set(Pi,"baselayers"),s.set(j_,"Base maps"),s.set(Pe,"ID_filtertype_baselayers");let o=new se({layers:[]});o.set(Pi,"layers"),o.set(j_,"Layers"),o.set(Pe,"ID_filtertype_layers");let a=new se({layers:[]});a.set(Pi,"overlays"),a.set(j_,"Overlays"),a.set(Pe,"ID_filtertype_overlays"),this.viewOptions={center:di([n.lon,n.lat],gr,this.EPSG),zoom:0,projection:Z(this.EPSG)},this.view.constrainRotation&&(this.viewOptions.constrainRotation=this.view.constrainRotation),this.view.enableRotation&&(this.viewOptions.enableRotation=this.view.enableRotation),this.view.extent&&(this.viewOptions.extent=this.view.extent),this.view.constrainOnlyCenter&&(this.viewOptions.constrainOnlyCenter=this.view.constrainOnlyCenter),this.view.smoothExtentConstraint&&(this.viewOptions.smoothExtentConstraint=this.view.smoothExtentConstraint),this.view.getMaxResolution()&&(this.viewOptions.maxResolution=this.view.getMaxResolution()),this.view.getMinResolution()&&(this.viewOptions.minResolution=this.view.getMinResolution()),this.view.getMaxZoom()&&(this.viewOptions.maxZoom=this.view.getMaxZoom()),this.view.getMinZoom()&&(this.viewOptions.minZoom=this.view.getMinZoom()),this.view.multiWorld&&(this.viewOptions.multiWorld=this.view.multiWorld),this.view.constrainResolution&&(this.viewOptions.constrainResolution=this.view.constrainResolution),this.view.smoothResolutionConstraint&&(this.viewOptions.smoothResolutionConstraint=this.view.smoothResolutionConstraint),this.view.getResolution()&&(this.viewOptions.resolution=this.view.getResolution()),this.view.getResolutions()&&(this.viewOptions.resolutions=this.view.getResolutions()),this.view.rotation&&(this.viewOptions.rotation=this.view.rotation),this.view.zoomFactor&&(this.viewOptions.zoomFactor=this.view.zoomFactor);let l=new ai(this.viewOptions);return this.map.getLayerGroup().getLayers().clear(),[s,o,a].map(c=>this.map.addLayer(c)),this.map.setView(l),this.view=this.map.getView(),this.setProjection(this.EPSG),e&&this.map.setTarget(e),{map:this.map,view:this.view}}setHitTolerance(e){this.hitTolerance=e}getHitTolerance(){return this.hitTolerance}addBboxSelection(e,r,n,s){Object.assign({className:"ol-drag-select",condition:e},s);let a=new kl(s);return r&&a.on("boxstart",l=>{r(l)}),n&&a.on("boxend",l=>{let c=a.getGeometry().getExtent();n(c,l)}),this.map.addInteraction(a),a}getLayers(e){let r=e.toLowerCase(),n;return this.map.getLayers().getArray().forEach(s=>{s.get(Pi)===r&&(n=s.getLayers().getArray())}),n}getLayersFromGroup(e,r,n=!1){let s=e.getLayers().getArray(),o=s;if(n){let a=[].concat(s);s.forEach(l=>{l instanceof se&&(a=a.concat(this.getLayersFromGroup(l,r,!0)))}),o=a}return r?o.filter(a=>a.get(Pi)&&a.get(Pi).toLowerCase()===r.toLowerCase()):o}getLayerByKey(e,r){let n=this.getLayersFromGroup(this.map.getLayerGroup(),r),s=Rd(n),o=[];if(s.forEach(a=>{a.get(e.key)&&a.get(e.key)===e.value&&o.indexOf(a)===-1&&o.push(a)}),!o.length){let a=this.getLayersFromGroup(this.map.getLayerGroup(),r,!0);a.length&&a.forEach(l=>{l.get(e.key)&&l.get(e.key)===e.value&&o.indexOf(l)===-1&&o.push(l)})}return o.length===1?o[0]:null}setRecursiveKey(e,r,n=Pi){e.set(n,r),e instanceof se&&e.getLayers().forEach(s=>{this.setRecursiveKey(s,r,n)})}addLayer(e,r){let n=r.toLowerCase(),s;return this.map.getLayers().getArray().forEach(o=>{o.get(Pi)===n&&(this.isLayerInGroup(e,o)||(s=o.getLayers().getArray(),this.setRecursiveKey(e,n,Pi),s.push(e),o.setLayers(new pe(s))))}),s}isLayerInGroup(e,r){return!!r.getLayers().getArray().filter(o=>o.get(Pe)===e.get(Pe)).length}getLayerGroups(e){let r=[];return this.map.getLayers().forEach(n=>{n instanceof se&&(e?n.get(Pi)&&n.get(Pi).toLowerCase()===e.toLowerCase()&&r.push(n):r.push(n))}),r}addLayers(e,r){let n=r.toLocaleLowerCase(),s;return this.getLayerGroups(n).forEach(a=>{a.getLayers().getLength()>0?(s=a.getLayers().getArray(),e.map(c=>{this.isLayerInGroup(c,a)||s.push(c)})):s=e,s.forEach(c=>{c instanceof se&&this.setRecursiveKey(c,n,Pi)}),a.setLayers(new pe(s))}),s}setLayers(e,r){let n=r.toLocaleLowerCase(),s=this.getLayerGroups(n);return e.forEach(o=>{o instanceof se&&this.setRecursiveKey(o,r.toLocaleLowerCase(),Pi)}),s.forEach(o=>{this.cleanUpEventListeners(o,e),o.setLayers(new pe(e))}),e}cleanUpEventListeners(e,r){let n=e.getLayers().getArray().filter(s=>!r.map(o=>o.get(Pe)).includes(s.get(Pe)));this.removeListenersFromOldLayers(n),n.forEach(s=>e.getLayers().remove(s))}addEventsToLayer(e,r,n){e.events&&(e.events.layer&&e.events.layer.forEach(s=>{r.getListeners(s.event)||r.on(s.event,s.listener)}),e.events.source&&e.events.source.forEach(s=>{n.getListeners(s.event)||n.on(s.event,s.listener)}))}removeListenersFromOldLayers(e){let r=n=>{if(typeof n.getSource=="function"){let s=n.getSource();s&&(s instanceof Wa&&s.dispose(),s.hasListener()&&s.disposeInternal())}n.hasListener()&&n.disposeInternal()};e.forEach(n=>{n instanceof se?n.getLayers().forEach(s=>{r(s)}):n instanceof ua&&r(n)})}getLayerGroupForLayer(e){let r=this.getLayersFromGroup(this.map.getLayerGroup(),null,!0);r.push(this.map.getLayerGroup());let n=null;return r.forEach(s=>{if(s instanceof se){let a=this.getLayersFromGroup(s).find(l=>l===e);a&&(n={group:s,layer:a})}}),n}removeLayerByKey(e,r){let n=r.toLocaleLowerCase(),s=this.getLayerByKey(e,n);if(s){let o=this.getLayerGroupForLayer(s);if(o.group){let a=this.getLayersFromGroup(o.group).filter(l=>l!==s);o.group.setLayers(new pe(a))}}}updateLayerByKey(e,r,n){let s=n.toLocaleLowerCase();this.map.getLayers().forEach(o=>{if(o.get(Pi)===s){let a=o.getLayers();a.forEach((l,c)=>{if(l.get(e.key)&&l.get(e.key)===e.value){let h=r.getProperties(),u=r.getExtent(),f=r.getMaxZoom(),d=r.getMinZoom(),m=r.getOpacity(),p=r.getVisible(),g=r.getZIndex();if(l instanceof ye&&r instanceof ye){let y=r.getSource();l.setSource(y)}h&&l.setProperties(h),u&&l.setExtent(u),f&&l.setMaxZoom(f),d&&l.setMinZoom(d),m&&l.setOpacity(m),p&&l.setVisible(p),g&&Uo(l,g),l.changed(),a.setAt(c,l)}}),o.setLayers(a)}})}removeAllLayers(e){let r=e.toLowerCase(),n;this.map.getLayers().getArray().forEach(s=>{s.get(Pi)===r&&(n=s.getLayers(),n.clear())})}setUkisLayers(e,r,n){let s=r.toLowerCase(),o=[];if(e.length<1&&s!=="baselayers"?this.removeAllLayers(s):e.forEach((a,l)=>{let c=this.create_layers(a);c&&(Uo(c,l,n),o.push(c))}),o.length>0)return this.setLayers(o,s),{type:s,layers:o}}setUkisLayer(e,r){r||(r=e.filtertype);let n=r.toLowerCase(),o=this.getLayers(n).find(l=>l.get(Pe)===e.id),a=this.create_layers(e);o?(this.removeLayerByKey({key:Pe,value:o.get(Pe)},r),this.addLayer(a,r)):this.addLayer(a,r)}updateUkisLayer(e,r){r||(r=e.filtertype);let n=r.toLowerCase(),o=this.getLayers(n).find(l=>l.get(Pe)===e.id),a=this.create_layers(e);a&&this.updateLayerByKey({key:Pe,value:o.get(Pe)},a,r)}create_layers(e){let r;switch(e.type){case u1:r=this.create_xyz_layer(e);break;case uh:r=this.create_wms_layer(e);break;case fh:r=this.create_wmts_layer(e);break;case hh:r=this.create_tms_layer(e);break;case dh:r=this.create_geojson_layer(e);break;case f1:r=this.create_kml_layer(e);break;case mh:r=this.create_wfs_layer(e);break;case d1:r=this.create_custom_layer(e);break;case m1:r=this.create_stacked_layer(e);break}return r}createOlLayerOptions(e,r,n){n&&(e.attribution&&n.setAttributions([e.attribution]),e.continuousWorld&&(n.wrapX_=e.continuousWorld),e.popup&&!e.crossOrigin&&e.crossOrigin!==null&&this.sourceSetCross(n),(e.crossOrigin||e.crossOrigin===null)&&this.sourceSetCross(n));let s={opacity:e.opacity||1,visible:e.visible,zIndex:1,id:e.id,name:e.name,filtertype:e.filtertype,type:r,legendImg:e.legendImg};return n&&(s.source=n),e.popup&&(s.popup=e.popup,s.className=e.id),e.maxResolution&&(s.maxResolution=e.maxResolution),e.minResolution&&(s.minResolution=e.minResolution),e.maxZoom&&(s.maxZoom=e.maxZoom),e.minZoom&&(s.minZoom=e.minZoom),e.bbox&&(s.extent=nr(e.bbox.slice(0,4),gr,this.getProjection().getCode())),s}create_xyz_layer(e){let r={wrapX:!1};e.crossOrigin&&(r.crossOrigin=e.crossOrigin);let n=new td(r),s=this.createOlLayerOptions(e,"xyz",n),o={preload:0,useInterimTilesOnError:!0},a=new ks(Object.assign(s,o));return this.setSubdomains(e,a),this.setCrossOrigin(e,a),this.addEventsToLayer(e,a,n),a}create_tms_layer(e){let r=null;if(e instanceof Vd)return r=this.create_xyz_layer(e),r.set("type","tms"),r;if(e instanceof fl){let n=new oc({format:new Kf,tileGrid:mn({minZoom:e.minZoom||void 0,maxZoom:e.maxZoom||void 0}),url:e.url,wrapX:!1}),s=this.createOlLayerOptions(e,"tms",n),o={declutter:!0,renderMode:"hybrid"};r=new Pa(Object.assign(s,o)),this.setCrossOrigin(e,r),this.addEventsToLayer(e,r,n);let a=e?.options?.style,l=e?.options?.styleSource;return a&&l&&(Qf(r,a),Ya(r,a,l).then(c=>{this.setSubdomains(e,r)})),r}}create_wms_layer(e){let r;return e.params?.TILED==="true"||e.params?.TILED===void 0||e.params?.TILED===null?r=this.create_tiled_wms_layer(e):e.params?.TILED==="false"&&(r=this.create_image_wms_layer(e)),r}create_tiled_wms_layer(e){let r={params:Object.assign({},this.keysToUppercase(e.params)),wrapX:!1};e.tileSize&&(r.tileGrid=this.getTileGrid("default",null,e.tileSize),delete r.params.tileSize),e.crossOrigin&&(r.crossOrigin=e.crossOrigin);let n=new Ny(r),s={preload:0,useInterimTilesOnError:!0},o=this.createOlLayerOptions(e,"wms",n),a=new ks(Object.assign(o,s));return this.setSubdomains(e,a),this.addEventsToLayer(e,a,n),a}create_image_wms_layer(e){let r={params:Object.assign({},this.keysToUppercase(e.params)),url:e.url},n=new Gy(r),s=this.createOlLayerOptions(e,"wms",n),o={},a=new wa(Object.assign(s,o));return this.addEventsToLayer(e,a,n),a}create_wmts_layer(e){if(e instanceof g1){let r=this.getTileGrid("wmts"),n=this.EPSG;if(e.params.matrixSetOptions){if(n=e.params.matrixSetOptions.matrixSet,"resolutions"in e.params.matrixSetOptions){let h=e.params.matrixSetOptions.resolutions;r=this.getTileGrid("wmts",null,e.tileSize,null,h)}else if("resolutionLevels"in e.params.matrixSetOptions||"tileMatrixPrefix"in e.params.matrixSetOptions){let h=e.params.matrixSetOptions.resolutionLevels,u=e.params.matrixSetOptions.tileMatrixPrefix;r=this.getTileGrid("wmts",h,e.tileSize,u,null)}if("matrixIds"in e.params.matrixSetOptions){let h=e.params.matrixSetOptions.matrixIds;r=this.getTileGrid("wmts",null,e.tileSize,null,null,h)}}let s={url:e.url,tileGrid:r,matrixSet:n,wrapX:!1,layer:e.params.layer,style:e.params.style};s=Object.assign({},s,e.params),e.crossOrigin&&(s.crossOrigin=e.crossOrigin);let o=new Zw(s),a=this.createOlLayerOptions(e,"wmts",o),l={},c=new ks(Object.assign(a,l));return this.setSubdomains(e,c),this.setCrossOrigin(e,c),this.addEventsToLayer(e,c,o),c}else{let r=e;console.error(`layer with id: ${r.id} and type ${r.type} is no instanceof WmtsLayer!`)}}create_wfs_layer(e){let r=null;e.url.indexOf("http://")===0||e.url.indexOf("https://")===0?r=new URL(e.url):r=new URL(e.url,window.location.origin),r.searchParams.set("srsname",this.EPSG);let n=new ni({format:new Jn,url:r.toString()}),s=this.createOlLayerOptions(e,"wfs",n),o={};e.options&&Object.assign(o,e.options);let a=new dn(Object.assign(s,o));return e.cluster&&this.setCluster(e,a,n,{}),this.setSubdomains(e,a),this.setCrossOrigin(e,a),this.addEventsToLayer(e,a,n),a}create_geojson_layer(e){let r;e.data?r=new ni({features:this.geoJsonToFeatures(e.data),format:new Jn,wrapX:!1}):e.url&&(r=new ni({url:e.url,format:new Jn({dataProjection:gr,featureProjection:this.EPSG}),wrapX:!1}));let n=this.createOlLayerOptions(e,"geojson",r),s={};e.options&&Object.assign(s,e.options);let o=new dn(Object.assign(n,s));return e.cluster&&this.setCluster(e,o,r,{}),this.setCrossOrigin(e,o),this.addEventsToLayer(e,o,r),o}create_kml_layer(e){let r;e.data?r=new ni({features:new hd({extractStyles:!0}).readFeatures(e.data,{dataProjection:gr,featureProjection:this.EPSG}),format:new hd,wrapX:!1}):e.url&&(r=new ni({url:e.url,format:new hd({extractStyles:!0,crossOrigin:e.crossOrigin&&e.crossOrigin===null?e.crossOrigin:"anonymous"}),wrapX:!1}));let n=this.createOlLayerOptions(e,"kml",r),s={};e.options&&Object.assign(s,e.options);let o=new dn(Object.assign(n,s));return e.cluster&&this.setCluster(e,o,r,{}),this.setCrossOrigin(e,o),this.addEventsToLayer(e,o,n.source),o}setCrossOrigin(e,r){if(r instanceof ye){let n=r.getSource();e.popup&&!e.crossOrigin&&e.crossOrigin!==null&&this.sourceSetCross(n),(e.crossOrigin||e.crossOrigin===null)&&this.sourceSetCross(n)}}setCluster(e,r,n,s){if(e.cluster){let o={};typeof e.cluster=="object"&&Object.assign(o,e.cluster),o.source=n;let a=new Qn(o);r.setSource(a),r.setStyle(l=>{let c=l.get("features").length,h=s[c];return h||(h=new ce({image:new zn({radius:10,stroke:new Be({color:"#fff"}),fill:new Le({color:"#3399CC"})}),text:new cr({text:c.toString(),fill:new Le({color:"#fff"})})}),s[c]=h),h})}}setSubdomains(e,r){if(e instanceof fl||e instanceof Vd){let n=r.getSource();if(e.subdomains){if(e.type==="wfs"&&n instanceof ni)e.url=e.url.replace("{s}",`${e.subdomains[0]}-${e.subdomains[e.subdomains.length-1]}`),n.setUrl(e.url);else if(!(n instanceof ni)){let s=e.subdomains.map(o=>e.url.replace("{s}",`${o}`));n.setUrls(s)}}else n.setUrl(e.url)}}sourceSetCross(e){(e instanceof Wr||e instanceof vn||e instanceof Ia)&&(e.crossOrigin="anonymous",e.crossOrigin_="anonymous")}create_custom_layer(e){if(e.custom_layer){let r=e.custom_layer;if(r instanceof ye){let s=r.getSource();e.attribution&&s.setAttributions([e.attribution]),e.continuousWorld?s.wrapX_=e.continuousWorld:s.wrapX_=!1,this.setCrossOrigin(e,r),this.addEventsToLayer(e,r,s),s instanceof Wa&&r.on("change:source",o=>{o.oldValue.dispose()})}else r instanceof se?r.getLayers().forEach(s=>{s.set(k_,e.id),s.set(z_,e.name);let o=`${e.id}_${H(s)}`;if(s.get(Pe)||s.set(Pe,o),s instanceof ye&&(this.setCrossOrigin(e,s),this.addEventsToLayer(e,s,s.getSource())),e.popup&&!s.get(yr)&&(s.set(yr,e.popup),s.getClassName()==="ol-layer"&&(s.className_=o)),e.bbox){let a=nr(e.bbox.slice(0,4),gr,this.getProjection().getCode());s.setExtent(a)}}):console.error(`The custom_layer of ${e.id} in not a openlayers Layer`);e.maxResolution&&r.setMaxResolution(e.maxResolution),e.minResolution&&r.setMinResolution(e.minResolution),e.maxZoom&&r.setMaxZoom(e.maxZoom),e.minZoom&&r.setMinZoom(e.minZoom);let n={type:"custom",name:e.name,id:e.id,visible:e.visible,legendImg:e.legendImg,opacity:e.opacity||1,zIndex:1};if(e.popup&&!(r instanceof se)&&(n.popup=e.popup,r.className_=e.id),e.bbox){let s=nr(e.bbox.slice(0,4),gr,this.getProjection().getCode());r.setExtent(s)}return r.setProperties(n),r}else console.log("attribute custom_layer not set on layer type custom!",e)}create_stacked_layer(e){if(e instanceof p1){let r=e.layers.map(a=>(a.visible=e.visible,a.opacity=e.opacity,e.popup&&(a.popup=e.popup),e.events&&(a.events=e.events),this.create_layers(a))),n=this.createOlLayerOptions(e,"custom");r.forEach(a=>{a.set(k_,e.id),a.set(z_,e.name)});let s={layers:r};return new se(Object.assign(n,s))}else console.log("layer is not of type StackedLayer!",e)}resolutionsFromExtent(e,r,n){let s=r,o=Ft(e),a=it(e),l=Math.max(a/n,o/n),c=s+1,h=new Array(c);for(let u=0;u<c;++u)h[u]=l/Math.pow(2,u);return h}matrixIdsFromResolutions(e,r){return Array.from(Array(e).keys()).map(n=>r?`${r}:${n}`:n)}getTileGrid(e="default",r,n,s,o,a){let l=r||42,c=n||256,h=s||"",u=this.getProjection().getExtent(),f=this.resolutionsFromExtent(u,l,c),d=this.matrixIdsFromResolutions(f.length,h),m={extent:u,origin:Ue(u),resolutions:o||f,tileSize:[c,c]};if(e==="wmts")return m.matrixIds=a||d,new Jv(m);if(e==="default")return new Gr(m)}isPopupObj(e){return e&&typeof e=="object"&&!Array.isArray(e)}isPopupObjMove(e){return this.isPopupObj(e)&&e.event==="move"}isPopupObjClick(e){return this.isPopupObj(e)&&e.event==="click"}isPopupObjArray(e){return Array.isArray(e)&&e.length&&this.isPopupObj(e[0])}isPopupStringArray(e){return Array.isArray(e)&&e.length&&typeof e[0]=="string"}eventIsBrowserEvent(e,r){if(e==="move"&&r.type==="pointermove")return!0;if(e==="click"&&r.type==="click")return!0}layersOnMapEvent(e){let r=!1,n=this.map.getAllLayers(),s=n.length,o=new Map,a=null;for(;s--;){let l=n[s],c=l.getVisible(),h=l.getOpacity(),u=l.get(k_);if(u){let d=this.getLayerByKey({key:Pe,value:u});c=d.getVisible(),h=d.getOpacity()}let f=l.get(yr);if(this.checkForPopupAsObservable(l,c,h,f,o),c&&h!==0&&this.filterLayerExtent(l,e.pixel)&&!f)break;if(this.filterLayerNoPopup(l)&&l.getData&&l.getData(e.pixel)&&this.checkIsRaster(l)){let d=l.getData(e.pixel),m;if((d instanceof Uint8ClampedArray||d instanceof Uint8Array||d instanceof Float32Array)&&(m=d[3]),m||d instanceof DataView){a={layer:l,color:d};break}}else if(this.filterLayerNoPopup(l)&&this.filterLayerExtent(l,e.pixel)&&this.checkIsVector(l)){let d=this.map.getFeaturesAtPixel(e.pixel,{layerFilter:m=>l.get(Pe)===m.get(Pe)});if(d.length){a={layer:l,feature:d[0]};break}}}if(a){let l=a.layer.get(yr);this.hitLayerCurr=a.layer.get(Pe),this.hitLayerPrev||(this.hitLayerPrev=this.hitLayerCurr),(a.color||a.feature)&&(r=!0),this.hitLayerPrev&&this.hitLayerPrev!==this.hitLayerCurr&&(r=!1,this.hitLayerPrev=this.hitLayerCurr),this.checkTopLayerEvent(e,l)&&this.layerOnEvent(e,a.layer,a.color,a.feature)}r?this.map.getTargetElement().style.cursor="pointer":(this.publishNullPropertiesAsObservable(o,e),this.removeAllPopups(l=>l.get("addEvent")==="pointermove"),this.map.getTargetElement().style.cursor="")}checkForPopupAsObservable(e,r,n,s,o){r&&n!==0&&s&&(this.isPopupObj(s)&&s.asObservable?o.set(e.get(Pe),e):this.isPopupObjArray(s)&&s.forEach(a=>{a.asObservable&&o.set(e.get(Pe),e)}))}publishNullPropertiesAsObservable(e,r){e.size&&e.forEach(n=>{let s=n.get(yr),o=[];this.isPopupObj(s)&&s.asObservable?o.push(s):this.isPopupObjArray(s)&&s.forEach(a=>{a.asObservable&&o.push(a)}),o.forEach(a=>{this.eventIsBrowserEvent(a.event||"click",r)&&this.popupEvents.next({popupObj:a,popupParams:{layerId:n.get(Pe),layerName:n.get("name"),mapEvent:r,layer:n,properties:null}})})})}checkTopLayerEvent(e,r){let n=null,s=(o,a)=>{a.event?this.eventIsBrowserEvent(a.event,o)&&this.isPopupObjClick(a)?n="click":this.eventIsBrowserEvent(a.event,o)&&this.isPopupObjMove(a)&&(n="move"):o.type==="click"&&(n="click")};return typeof r=="boolean"?r===!0&&e.type==="click"&&(n="click"):this.isPopupStringArray(r)?e.type==="click"&&(n="click"):this.isPopupObjArray(r)?r.map(o=>{s(e,o)}):s(e,r),n}checkIsRaster(e){return e instanceof Tu||e instanceof Mu}checkIsVector(e){return e instanceof Ns&&!this.checkIsRaster(e)}layerOnEvent(e,r,n,s){this.checkIsRaster(r)?this.rasterOnEvent(e,r,n):this.checkIsVector(r)&&this.vectorOnEvent(e,r,s)}filterLayerExtent(e,r){let n=!0,s=e.getExtent();if(s){let o=this.map.getCoordinateFromPixel(r);ke(s,o)||(n=!1)}return n}vectorOnEvent(e,r,n){if(r&&n){let s=r.get(yr),o={},l=n.getProperties().features;if(l&&l.length===1)o=l[0].getProperties();else if(l&&l.length>1)if(e.type==="click"){let c=this.getFeaturesExtent(l);return this.setExtent(c),!1}else return!0;else o=n.getProperties();this.prepareAddPopup(r,e,s,n,o)}}rasterOnEvent(e,r,n){let s=r.get(yr);s&&this.prepareAddPopup(r,e,s,null,null,n)}prepareAddPopup(e,r,n,s,o,a){let l=e.getProperties(),c={layerId:l.id,layerName:l.name||l[z_]||null,mapEvent:r,layer:e,properties:o?Object.assign({},o):{}};c.properties?.geometry&&delete c.properties.geometry,s&&(c.feature=s),a&&(c.color=a);let h=d=>{d&&d.filterkeys&&(c.properties=Object.keys(c.properties).filter(m=>d.filterkeys.includes(m)).reduce((m,p)=>(m[p]=c.properties[p],m),{}))};if(this.isPopupStringArray(n))c.properties=Object.keys(c.properties).filter(d=>n.includes(d)).reduce((d,m)=>(d[m]=c.properties[m],d),{});else if(this.isPopupObjArray(n)){let d=n.find(m=>this.eventIsBrowserEvent(m.event,r));h(d)}else this.isPopupObj(n)&&h(n);let u=d=>{if(d.properties){let m=Object.keys(d.properties);Array.isArray(m)&&(c.properties=Object.keys(c.properties).reduce((p,g)=>{let y=d.properties[g];return y?p[y]=c.properties[g]:p[g]=c.properties[g],p},{}))}};this.isPopupObjArray(n)?n.forEach(d=>{this.eventIsBrowserEvent(d.event,r)&&u(d)}):this.isPopupObj(n)&&u(n);let f=d=>{"asyncPopup"in d?d.asyncPopup(c,m=>{d.asObservable?this.publishPopupEvent(d,c,m):this.addPopup(c,d,m,d.event,d.single)}):d.asObservable?this.publishPopupEvent(d,c):this.addPopup(c,d,null,d.event,d.single)};typeof n=="boolean"||this.isPopupStringArray(n)?this.addPopup(c):this.isPopupObjArray(n)?n.forEach(d=>{this.eventIsBrowserEvent(d.event,r)&&f(d)}):n&&f(n)}publishPopupEvent(e,r,n){n&&(r.properties=Object.assign(r.properties,n));let s={popupObj:e,popupParams:r};this.popupEvents.next(s)}addPopup(e,r,n,s,o){let a=e.layer.get(yr),l=e.layer.get(Pe),c="popup_move_ID",h="move_ID_L_F",u=this.getPopups().find(m=>m.getId()===c),f=e.mapEvent,d=null;if(s==="move"&&(e.color?d=`${l}:${e.color.toString()}`:e.feature?d=`${l}:${H(e.feature)}`:e.layer&&(d=`${l}:${H(e.layer)}`)),s==="move"&&f.type==="pointermove"&&u){let m,p=e.feature;if(p&&p.getGeometry()?.getType()==="Point"?m=p.getGeometry().getCoordinates():m=f.coordinate,d!==u.get(h)){let g=this.createPopupContainer(u,e,r,n,s);u.setElement(g)}u.setPosition(m),u.getElement().parentElement.style.zIndex="1"}else if(f.type==="pointermove"&&!s)u&&this.removeAllPopups(m=>m.get("addEvent")==="pointermove");else if(f.type==="pointermove"&&s==="click")u&&this.removeAllPopups(m=>m.get("addEvent")==="pointermove");else{let m=null;s==="move"?m=c:e.feature?m=`${l}:${H(e.feature)}`:e.layer?m=`${l}:${H(e.layer)}`:m=`${l}:popup_${new Date().getTime()}`;let p={id:m,autoPan:{animation:{duration:250}},positioning:"bottom-center",stopEvent:!0,insertFirst:!1},g=p;if(this.isPopupObjArray(a)){let b=a.find(S=>this.eventIsBrowserEvent(S.event,f));b.options&&(g=Object.assign(p,b.options))}else this.isPopupObj(a)&&a.options&&(g=Object.assign(p,a.options));let y=new Cu(g);d&&y.set(h,d),o&&this.removeAllPopups(b=>{let T=b.getId().toString().split(":")[0];if(T){if(l===T)return l===T}else return!0});let _=this.getPopups().find(b=>b.getId()===y.getId()&&y.getId()!==c);_&&(this.map.removeOverlay(_),this.destroyDynamicPopupComponent(_.getId().toString()));let x=this.createPopupContainer(y,e,r,n,s);x&&(y.getId()===c?y.set("addEvent","pointermove"):y.set("addEvent",f.type),y.set(Fd,yr),y.setElement(x));let v,E=e.feature;E&&E.getGeometry()?.getType()==="Point"?v=E.getGeometry().getCoordinates():v=f.coordinate,x?y.setPosition(v):this.map.removeOverlay(y),u&&s==="move"||this.map.addOverlay(y)}}createPopupContainer(e,r,n,s,o){let a=document.createElement("div");a.className="ol-popup-content";let l="",c=!0;if(n?.popupFunction){let h=n.popupFunction(r);typeof h=="string"?l=h:h===!1?c=!1:l=this.createPopupHtml(h)}else s?typeof s=="string"?l=s:l=this.createPopupHtml(s):s===!1?c=!1:Object.keys(r.properties).length?l=this.createPopupHtml(r.properties):c=!1;if(a.innerHTML=l,n?.dynamicPopup){let h=e.getId().toString();this.destroyDynamicPopupComponent(h),this.createDynamicPopupComponent(h,a,r,n)}if(c){let h=document.createElement("div");if(h.className="ol-popup",h.id=e.getId().toString(),h.style.display="block",!o||o!=="move"){let u=document.createElement("a");u.className="ol-popup-closer",h.appendChild(u);let f=()=>{u.removeEventListener("click",f,!1),this.map.removeOverlay(e),this.destroyDynamicPopupComponent(e.getId().toString())};u.addEventListener("click",f,!1)}return h.appendChild(a),h}else return}removeAllPopups(e){let r=this.getPopups();e&&(r=this.getPopups().filter(e)),r.forEach(n=>{n.get(Fd)===yr&&(this.map.removeOverlay(n),this.destroyDynamicPopupComponent(n.getId().toString()))})}hideAllPopups(e,r){let n=this.getPopups();r&&(n=this.getPopups().filter(r)),n.forEach(s=>{if(s.get(Fd)===yr){let o=s.getElement();e?o.classList.add("hidden"):o.classList.remove("hidden")}})}createPopupHtml(e){let r="<table>";for(let n in e)e.hasOwnProperty(n)&&(r+='<tr><td style="vertical-align: top; padding-right: 7px;"><b>'+n+": </b></td><td>"+e[n]+"</td></tr>");return r=r+"</table>",r}getPopups(){let e=[];return this.map.getOverlays().getArray().slice(0).forEach(r=>{r.get(Fd)===yr&&e.push(r)}),e}destroyDynamicPopupComponent(e){this.dynamicPopupComponents.has(e)&&(this.dynamicPopupComponents.get(e).destroy(),this.dynamicPopupComponents.delete(e))}createDynamicPopupComponent(e,r,n,s){let o=l1(s.dynamicPopup.component,{environmentInjector:this.envInjector,hostElement:r});if(s.dynamicPopup.getAttributes){let a=s.dynamicPopup.getAttributes(n);for(let l in a)a[l]!=="undefined"&&(o.instance[l]=a[l])}this.app.attachView(o.hostView),this.dynamicPopupComponents.set(e,o)}setExtent(e,r,n){let s=r?Z(gr):Z(this.EPSG),o=nr(e.slice(0,4),s,this.getProjection().getCode()),a={size:this.map.getSize()};return n&&Object.assign(a,n),this.map.getView().fit(o,n),o}setCenter(e,r){let n=r?Z(gr):Z(this.EPSG),s=di(e,n,this.getProjection().getCode());return this.map.getView().setCenter(s),s}getCenter(e){let r=e?Z(gr):Z(this.EPSG),n=Z(this.getProjection().getCode());return di(this.map.getView().getCenter(),n,r)}getFeaturesExtent(e,r){let n=e[0].getGeometry().getExtent().slice(0);if(e.forEach(s=>{Yo(n,s.getGeometry().getExtent())}),r){let s=Z(gr);return nr(n,this.getProjection().getCode(),s)}else return n}getCurrentExtent(e){let r=e?Z(gr):Z(this.EPSG),n=this.map.getView().calculateExtent();return nr(n,this.getProjection().getCode(),r)}setRotation(e){let r=this.map.getView();e=e*(Math.PI/180),r.setRotation(e)}getRotation(){return this.map.getView().getRotation()*(180/Math.PI)}setZoom(e){this.map.getView().setZoom(e)}getZoom(){return this.map.getView().getZoom()}zoomInOut(e,r){let n=this.map.getView();if(!n)return;let s=r?.zoomStep||1,o=e==="+"?s:-1*s,a=n.getZoom();if(a!==void 0){let l=n.getConstrainedZoom(a+o);n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:l,duration:r?.duration||250,easing:r?.easing||Gi},c=>{r.callback&&r.callback(c)})}}geoJsonToFeature(e){let r=new Jn({dataProjection:gr,featureProjection:this.EPSG});return r.readFeature,r.readFeature(e)}geoJsonToFeatures(e){return new Jn({dataProjection:gr,featureProjection:this.EPSG}).readFeatures(e)}getProjection(){return this.map.getView().getProjection()}reprojectFeatures(e,r,n){e.getFeatures().forEach(s=>{s.getGeometry().transform(r,n)})}setProjection(e){if(e){let r={};if(this.viewOptions&&(r=this.viewOptions,r.minResolution=void 0,r.maxResolution=void 0,r.resolution=void 0,r.resolutions=void 0),e instanceof ki){r.projection=e;let o=di(this.map.getView().getCenter(),this.map.getView().getProjection(),e);r.center=o,r.zoom=this.map.getView().getZoom()}else typeof e=="string"&&(r.projection=e,r.center=this.map.getView().getCenter(),r.zoom=this.map.getView().getZoom());let n=new ai(r),s=this.EPSG;this.EPSG=n.getProjection().getCode(),this.map.setView(n),this.view=this.map.getView(),this.map.getLayers().getArray().forEach(o=>{o.getLayers().getArray().forEach(a=>{if(a instanceof ye){let l=a.getSource();for(;l.source;)l=l.source;l instanceof ni&&this.reprojectFeatures(l,s,this.EPSG)}})}),this.projectionChange.next(this.getProjection())}}registerProjection(e){S_.defs(e.code,e.proj4js),PS(S_)}getOlProjection(e){return new ki({code:e.code,extent:e.extent?e.extent:void 0,worldExtent:e.worldExtent?e.worldExtent:void 0,global:e.global?e.global:!1,units:e.units?e.units:void 0})}keysToUppercase(e){return Object.keys(e).forEach(r=>{let n=r.toUpperCase();n!==r&&(e[n]=e[r],delete e[r])}),e}static{this.\u0275fac=function(r){return new(r||i)(Ud(i1),Ud(Z_))}}static{this.\u0275prov=H_({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var U_="units",l5=[1,2,5],rh=25.4/.28,B_=class extends qi{constructor(t){t=t||{};let e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;let r=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=r+"-inner",this.element.className=r+" "+Bi,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(U_,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(U_)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(U_,t)}setDpi(t){this.dpi_=t}updateElement_(){let t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let e=t.center,r=t.projection,n=this.getUnits(),s=n=="degrees"?"degrees":"m",o=ao(r,t.resolution,e,s),a=this.minWidth_*(this.dpi_||rh)/rh,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||rh)/rh:void 0,c=a*o,h="";if(n=="degrees"){let x=rr.degrees;c*=x,c<x/60?(h="\u2033",o*=3600):c<x?(h="\u2032",o*=60):h="\xB0"}else if(n=="imperial")c<.9144?(h="in",o/=.0254):c<1609.344?(h="ft",o/=.3048):(h="mi",o/=1609.344);else if(n=="nautical")o/=1852,h="NM";else if(n=="metric")c<1e-6?(h="nm",o*=1e9):c<.001?(h="\u03BCm",o*=1e6):c<1?(h="mm",o*=1e3):c<1e3?h="m":(h="km",o/=1e3);else if(n=="us")c<.9144?(h="in",o*=39.37):c<1609.344?(h="ft",o/=.30480061):(h="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),f,d,m,p=0,g,y;for(;;){m=Math.floor(u/3);let x=Math.pow(10,m);if(f=l5[(u%3+3)%3]*x,d=Math.round(f/o),isNaN(d)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&d>=l){f=p,d=g,m=y;break}else if(d>=a)break;p=f,g=d,y=m,++u}let _=this.scaleBar_?this.createScaleBar(d,f,h):f.toFixed(m<0?-m:0)+" "+h;this.renderedHTML_!=_&&(this.innerElement_.innerHTML=_,this.renderedHTML_=_),this.renderedWidth_!=d&&(this.innerElement_.style.width=d+"px",this.renderedWidth_=d),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,r){let n=this.getScaleForResolution(),s=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),o=this.scaleBarSteps_,a=t/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){let u=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,t,!1,e,r):"")+"</div>")}return l.push(this.createStepText(o,t,!0,e,r)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+s+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,e,r,n,s){let a=(t===0?0:Math.round(n/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+s),l=t===0?-3:e/this.scaleBarSteps_*-1,c=t===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${t===0?"left":"center"};min-width: ${c}px;left: ${r?e+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){let t=ao(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||rh,r=1e3/25.4;return t*r*e}render(t){let e=t.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}},Bb=B_;var q_="projection",qb="coordinateFormat",X_=class extends qi{constructor(t){t=t||{};let e=document.createElement("div");e.className=t.className!==void 0?t.className:"ol-mouse-position",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un,this.addChangeListener(q_,this.handleProjectionChanged_),t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat),t.projection&&this.setProjection(t.projection),this.renderOnMouseOut_=t.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?t.placeholder:"&#160;",this.renderedHTML_=e.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=t.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(qb)}getProjection(){return this.get(q_)}handleMouseMove(t){let e=this.getMap();this.updateHTML_(e.getEventPixel(t))}handleMouseOut(t){this.updateHTML_(null)}setMap(t){if(super.setMap(t),t){let e=t.getViewport();this.listenerKeys.push(dt(e,ys.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(dt(e,ys.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(t){this.set(qb,t)}setProjection(t){this.set(q_,Z(t))}updateHTML_(t){let e=this.placeholder_;if(t&&this.mapProjection_){if(!this.transform_){let s=this.getProjection();s?this.transform_=zi(this.mapProjection_,s):this.transform_=tx}let n=this.getMap().getCoordinateFromPixelInternal(t);if(n){let s=sr();if(s&&(this.transform_=zi(this.mapProjection_,s)),this.transform_(n,n),this.wrapX_){let a=s||this.getProjection()||this.mapProjection_;vs(n,a)}let o=this.getCoordinateFormat();o?e=o(n):e=n.toString()}}(!this.renderedHTML_||e!==this.renderedHTML_)&&(this.element.innerHTML=e,this.renderedHTML_=e)}render(t){let e=t.frameState;e?this.mapProjection_!=e.viewState.projection&&(this.mapProjection_=e.viewState.projection,this.transform_=null):this.mapProjection_=null}},Xb=X_;var Vb=["fullscreenchange","webkitfullscreenchange"],Wb={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},V_=class extends qi{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];let e=t.label!==void 0?t.label:"\u2922";this.labelNode_=typeof e=="string"?document.createTextNode(e):e;let r=t.labelActive!==void 0?t.labelActive:"\xD7";this.labelActiveNode_=typeof r=="string"?document.createTextNode(r):r;let n=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=n,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener($.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Bi} ${rn}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){let t=this.getMap();if(!t)return;let e=t.getOwnerDocument();if(Yb(e))if($b(e))h5(e);else{let r;this.source_?r=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:r=t.getTargetElement(),this.keys_?c5(r):Kb(r)}}handleFullScreenChange_(){let t=this.getMap();if(!t)return;let e=this.isInFullscreen_;this.isInFullscreen_=$b(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Fn(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Wb.ENTERFULLSCREEN)):(Fn(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Wb.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,e){e?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){let e=this.getMap();e&&e.removeChangeListener(Ee.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(Ee.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){let t=this.documentListeners_;for(let r=0,n=t.length;r<n;++r)Tt(t[r]);t.length=0;let e=this.getMap();if(e){let r=e.getOwnerDocument();Yb(r)?this.element.classList.remove(Wm):this.element.classList.add(Wm);for(let n=0,s=Vb.length;n<s;++n)t.push(dt(r,Vb[n],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}};function Yb(i){let t=i.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&i.fullscreenEnabled)}function $b(i){return!!(i.webkitIsFullScreen||i.fullscreenElement)}function Kb(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function c5(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():Kb(i)}function h5(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}var Hb=V_;var Nd=.75,nh=.1,W_=class extends qi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=t.rotateWithView!==void 0?t.rotateWithView:!1,this.viewExtent_=void 0;let e=t.className!==void 0?t.className:"ol-overviewmap",r=t.tipLabel!==void 0?t.tipLabel:"Overview map",n=t.collapseLabel!==void 0?t.collapseLabel:"\u2039";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;let s=t.label!==void 0?t.label:"\u203A";typeof s=="string"?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;let o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=r,a.appendChild(o),a.addEventListener($.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=t.view;let l=new Ds({view:t.view,controls:new pe,interactions:new pe});this.ovmap_=l,t.layers&&t.layers.forEach(function(y){l.addLayer(y)});let c=document.createElement("div");c.className="ol-overviewmap-box",c.style.boxSizing="border-box",this.boxOverlay_=new Cu({position:[0,0],positioning:"center-center",element:c}),this.ovmap_.addOverlay(this.boxOverlay_);let h=e+" "+Bi+" "+rn+(this.collapsed_&&this.collapsible_?" "+oa:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=h,u.appendChild(this.ovmapDiv_),u.appendChild(a);let f=this.boxOverlay_,d=this.boxOverlay_.getElement(),m=y=>({clientX:y.clientX,clientY:y.clientY}),p=function(y){let _=m(y),x=l.getEventCoordinate(_);f.setPosition(x)},g=y=>{let _=l.getEventCoordinateInternal(y),x=this.getMap();x.getView().setCenterInternal(_);let v=x.getOwnerDocument();v.removeEventListener("pointermove",p),v.removeEventListener("pointerup",g)};this.ovmapDiv_.addEventListener("pointerdown",y=>{let _=this.getMap().getOwnerDocument();y.target===d&&_.addEventListener("pointermove",p),_.addEventListener("pointerup",g)})}setMap(t){let e=this.getMap();if(t!==e){if(e){let r=e.getView();r&&this.unbindView_(r),this.ovmap_.setTarget(null)}if(super.setMap(t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(dt(t,er.PROPERTYCHANGE,this.handleMapPropertyChange_,this));let r=t.getView();r&&this.bindView_(r),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(t){if(t.key===Ee.VIEW){let e=t.oldValue;e&&this.unbindView_(e);let r=this.getMap().getView();this.bindView_(r)}else!this.ovmap_.isRendered()&&(t.key===Ee.TARGET||t.key===Ee.SIZE)&&this.ovmap_.updateSize()}bindView_(t){if(!this.view_){let e=new ai({projection:t.getProjection()});this.ovmap_.setView(e)}t.addChangeListener(Ei.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),t.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(t){t.removeChangeListener(Ei.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){let t=this.getMap(),e=this.ovmap_;if(!t.isRendered()||!e.isRendered())return;let r=t.getSize(),s=t.getView().calculateExtentInternal(r);if(this.viewExtent_&&ze(s,this.viewExtent_))return;this.viewExtent_=s;let o=e.getSize(),l=e.getView().calculateExtentInternal(o),c=e.getPixelFromCoordinateInternal(Ue(s)),h=e.getPixelFromCoordinateInternal(xs(s)),u=Math.abs(c[0]-h[0]),f=Math.abs(c[1]-h[1]),d=o[0],m=o[1];u<d*nh||f<m*nh||u>d*Nd||f>m*Nd?this.resetExtent_():Ce(l,s)||this.recenter_()}resetExtent_(){if(Nd===0||nh===0)return;let t=this.getMap(),e=this.ovmap_,r=t.getSize(),s=t.getView().calculateExtentInternal(r),o=e.getView(),a=Math.log(Nd/nh)/Math.LN2,l=1/(Math.pow(2,a/2)*nh);Th(s,l),o.fitInternal(Fl(s))}recenter_(){let t=this.getMap(),e=this.ovmap_,r=t.getView();e.getView().setCenterInternal(r.getCenterInternal())}updateBox_(){let t=this.getMap(),e=this.ovmap_;if(!t.isRendered()||!e.isRendered())return;let r=t.getSize(),n=t.getView(),s=e.getView(),o=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),c=n.getCenter(),h=n.getResolution(),u=s.getResolution(),f=r[0]*h/u,d=r[1]*h/u;if(a.setPosition(c),l){l.style.width=f+"px",l.style.height=d+"px";let m="rotate("+o+"rad)";l.style.transform=m}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=ps(this.ovmap_,Li.POSTRENDER,t=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(t){t.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(oa),this.collapsed_?Fn(this.collapseLabel_,this.label_):Fn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;let t=this.ovmap_;if(!this.collapsed_){if(t.isRendered()){this.viewExtent_=void 0,t.render();return}t.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())}setCollapsed(t){!this.collapsible_||this.collapsed_===t||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(t){this.rotateWithView_!==t&&(this.rotateWithView_=t,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(t){this.validateExtent_(),this.updateBox_()}},Zb=W_;var u5=["mapDiv"];function f5(i,t){i&1&&(qd(0,"div",2),a1(1,"+"),Xd())}c1.addIcons(h1);var Jb="id",gat=(()=>{class i{constructor(e,r){this.mapSvc=e,this.ngZone=r,this.subs=[],this.mapSize=[0,0],this.initialMapStateSet=!1,this.removePopupsOnMouseLeave=n=>{this.mapSvc.removeAllPopups(s=>s.get("addEvent")==="pointermove")}}ngOnInit(){this.subscribeToMapState(),this.initMap(),this.subscribeToLayers()}ngAfterViewInit(){this.map.setTarget(this.mapDivView.nativeElement),this.subscribeToMapEvents(),this.map.getTargetElement().addEventListener("mouseleave",this.removePopupsOnMouseLeave)}ngAfterViewChecked(){this.updateMapSize()}ngOnDestroy(){this.subs.forEach(r=>r.unsubscribe());let e=this.mapStateSvc.getMapState().value;e.options.notifier="user",this.mapStateSvc.setMapState(e),this.map&&(this.map.un("moveend",this.mapOnMoveend),this.map.un("click",this.mapOnClickMove),this.map.un("dblclick",this.mapOnDclick),this.map.getTargetElement().removeEventListener("mouseleave",this.removePopupsOnMouseLeave),this.map.getInteractions().forEach(r=>{this.map.removeInteraction(r)}))}getMapDiv(){return this.mapDivView&&this.mapDivView.nativeElement?{width:this.mapDivView.nativeElement.offsetWidth,height:this.mapDivView.nativeElement.offsetHeight}:null}updateMapSize(){let e=this.getMapDiv();if(e)if(e.width===this.mapSize[0]&&e.height===this.mapSize[1]){if(!this.initialMapStateSet){let r=this.mapStateSvc.getMapState().getValue();this.setMapState(r),this.initialMapStateSet=!0}}else this.ngZone.runOutsideAngular(()=>{this.map.updateSize(),this.mapSize=this.map.getSize()})}addUpdateLayers(e,r,n){let s=this.mapSvc.getLayerGroups(r)[0].getLayers(),o=n.reduce((a,l)=>a+this.mapSvc.getLayers(l).length,0);e.length!==this.mapSvc.getLayers(r).length?this.mapSvc.setUkisLayers(e,r,o):this.updateLayers(e,r,o,s)}updateLayers(e,r,n,s){for(let o of e){let a=this.mapSvc.getLayerByKey({key:Jb,value:o.id},r);if(a){a.getVisible()!==o.visible&&(Id(a,o.visible,o instanceof eo),this.mapSvc.hideAllPopups(!o.visible,h=>{let f=h.getId().toString().split(":")[0];if(f){if(f===o.id)return f===o.id}else return!0})),a.getOpacity()!==o.opacity&&Ad(a,o.opacity,o instanceof eo),this.updateLayerSource(o,a);let l=e.indexOf(o),c=n>0?l+n:l;a.getZIndex()!==c&&(_b(a,l,s),Uo(a,l,n)),this.updateLayerParamsWith(a,o)}}}updateLayerSource(e,r){if(e instanceof eo&&r instanceof ye){let n=e.custom_layer.getSource(),s=r.getSource();n&&H(s)!==H(n)&&(r.setSource(n),s instanceof Wa&&s.dispose())}else if(e instanceof eo&&e.custom_layer instanceof se&&r instanceof se){let n=e.custom_layer.getLayers().getArray();r.getLayers().getArray().forEach((o,a)=>{let l=n[a];if(o instanceof ye&&l instanceof ye){let c=o.getSource(),h=l.getSource();h&&H(c)!==H(h)&&o.setSource(h)}})}}updateLayerParamsWith(e,r){switch(r.type){case uh:this.updateWmsLayerParamsWith(e,r);break;case fh:this.updateWmtsLayerParamsWith(e,r);break;case dh:this.updateGeojsonLayerParamsWith(e,r);break;case mh:this.updateWfsLayerParamsWith(e,r);break;case hh:this.updateTmsLayerParamsWith(e,r);default:break}}updateTmsLayerParamsWith(e,r){if(r instanceof fl){let n=r.options.style,s=r.options.styleSource;Ya(e,n,s)}}updateWfsLayerParamsWith(e,r){r.options&&r.options.style!==e.getStyle()&&e.setStyle(r.options.style),e.getSource().getUrl()!==r.url&&e.getSource().setUrl(r.url)}updateGeojsonLayerParamsWith(e,r){let n=e.getSource();if(n){if(r.data){let s=this.mapSvc.geoJsonToFeatures(r.data);if(n instanceof Qn){let o=n.getSource();o.clear(),o.addFeatures(s)}else n.clear(),n.addFeatures(s)}else r.url&&(n instanceof Qn?n.getSource().setUrl(r.url):n.setUrl(r.url));typeof r?.cluster=="object"&&"distance"in r.cluster&&n instanceof Qn&&n.setDistance(r.cluster.distance)}r?.options?.style&&e.setStyle(r.options.style)}updateWmsLayerParamsWith(e,r){if(e instanceof ye){let s=e.getSource().getParams(),o=r.params;this.shallowEqual(s,o)||e.getSource().updateParams(o)}}updateWmtsLayerParamsWith(e,r){if(e instanceof ye){let n=e.getSource(),s=n.getStyle(),o=n.getFormat(),a=n.getVersion(),l=n.getMatrixSet(),c=r.params.style,h=r.params.format,u=r.params.version,f=r.params.matrixSetOptions.matrixSet;if(c!==void 0&&s!==c||h!==void 0&&o!==h||u!==void 0&&a!==u||f!==void 0&&l!==f){let d=r.filtertype.toLowerCase();this.mapSvc.updateUkisLayer(r,d)}}}shallowEqual(e,r){let n=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(r);if(n.length!==s.length)return!1;for(let o of n)if(e[o]!==r[o])return!1;return!0}addUpdateBaseLayers(e){let r=this.mapSvc.getLayerGroups("baselayers")[0].getLayers();if(e.length!==this.mapSvc.getLayers("baselayers").length){let n=e.filter(s=>s.visible===!0);n.length===0?e[0].visible=!0:n.length>1&&(e.forEach(s=>s.visible=!1),e[0].visible=!0),this.mapSvc.setUkisLayers(e,"baselayers")}else for(let n of e){let s=this.mapSvc.getLayerByKey({key:Jb,value:n.id},"baselayers");if(s){let o=e.indexOf(n);s.getVisible()!==n.visible&&Id(s,n.visible,n instanceof eo),s.getZIndex()!==o&&(r.remove(s),r.insertAt(o,s),Uo(s,o)),s.getOpacity()!==n.opacity&&Ad(s,n.opacity,n instanceof eo),this.updateLayerSource(n,s),this.updateLayerParamsWith(s,n)}}}subscribeToLayers(){if(this.layersSvc){let e=this.layersSvc.getBaseLayers().subscribe(s=>this.addUpdateBaseLayers(s));this.subs.push(e);let r=this.layersSvc.getLayers().subscribe(s=>this.addUpdateLayers(s,"layers",["baselayers"]));this.subs.push(r);let n=this.layersSvc.getOverlays().subscribe(s=>this.addUpdateLayers(s,"overlays",["baselayers","layers"]));this.subs.push(n)}}setMapState(e){let r=this.mapStateSvc.getLastAction().getValue();e.options.notifier==="user"&&(r==="setExtent"?this.mapSvc.setExtent(e.extent,!0):r==="setState"?(this.mapSvc.setZoom(e.zoom),this.mapSvc.setCenter([e.center.lon,e.center.lat],!0),this.mapSvc.setRotation(e.rotation)):r==="setRotation"&&this.mapSvc.setRotation(e.rotation))}subscribeToMapState(){if(this.mapStateSvc){let e=this.mapStateSvc.getMapState().pipe(K_(1)).subscribe(r=>this.setMapState(r));this.subs.push(e)}}subscribeToMapEvents(){this.mapOnMoveend=e=>{let r=this.mapStateSvc.getMapState().getValue(),n=this.mapSvc.getZoom(),s=this.mapSvc.getCenter(!0),o=this.mapSvc.getCurrentExtent(!0),a=this.mapSvc.getRotation(),l={lat:parseFloat(s[1]),lon:parseFloat(s[0])},c=new y1(n,l,{notifier:"map"},o,r.time,r.viewAngle,a);this.mapStateSvc.setMapState(c)},this.map.on("moveend",this.mapOnMoveend),this.mapOnClickMove=e=>{this.mapSvc.layersOnMapEvent(e)},this.map.on(["click","pointermove"],this.mapOnClickMove),this.mapOnDclick=e=>{this.mapSvc.removeAllPopups()},this.map.on("dblclick",this.mapOnDclick)}initMap(){let e=this.mapSvc.createMap();this.map=e.map;let r=this.map.getInteractions();ou().forEach(s=>{r.getArray().find(a=>a.constructor.name===s.constructor.name)||this.map.addInteraction(s)}),this.setControls(),this.layersSvc||console.log("there is no layersSvc as defined!"),this.mapStateSvc||console.log("there is no mapStateSvc as defined!")}setControls(){let e=[],r=[];if(this.map&&(this.map.getControls().getArray().forEach(s=>r.push(s)),this.map.getControls().clear()),this.controls&&this.map){if(this.controls.attribution!==!1){let n={collapsible:!0,collapsed:!1};typeof this.controls.attribution=="object"&&(n=Object.assign(n,this.controls.attribution));let s=new Jh(n);e.push(s)}if(this.controls.scaleLine){let n={};typeof this.controls.scaleLine=="object"&&(n=Object.assign(n,this.controls.scaleLine));let s=new Bb(n);e.push(s)}if(this.controls.zoom!==!1){let n={};typeof this.controls.zoom=="object"&&(n=Object.assign(n,this.controls.zoom));let s=new tu(n);e.push(s)}if(this.controls.mousePosition){let n={coordinateFormat:o=>N1(o,2),projection:"EPSG:4326"};typeof this.controls.mousePosition=="object"&&(n=Object.assign(n,this.controls.mousePosition));let s=new Xb(n);e.push(s)}if(this.controls.fullScreen){let n={};typeof this.controls.fullScreen=="object"&&(n=Object.assign(n,this.controls.fullScreen));let s=new Hb(n);e.push(s)}if(this.controls.overviewMap){let n=document.createElement("spawn");n.innerHTML='<cds-icon shape="world"></cds-icon>';let s={layers:[new ks({source:new D_})],label:n};typeof this.controls.overviewMap=="object"&&(s=Object.assign(s,this.controls.overviewMap));let o=new Zb(s);e.push(o)}if(this.controls.rotate){let n={};typeof this.controls.rotate=="object"&&(n=Object.assign(n,this.controls.rotate));let s=new Qh(n);e.push(s)}e.length&&(r.filter(s=>!e.includes(s)).forEach(s=>e.push(s)),this.map.getControls().extend(e))}}static{this.\u0275fac=function(r){return new(r||i)(Bd(Ub),Bd(J_))}}static{this.\u0275cmp=t1({type:i,selectors:[["ukis-map-ol"]],viewQuery:function(r,n){if(r&1&&n1(u5,5),r&2){let s;s1(s=o1())&&(n.mapDivView=s.first)}},inputs:{layersSvc:"layersSvc",mapStateSvc:[0,"mapState","mapStateSvc"],controls:"controls"},decls:3,vars:1,consts:[["mapDiv",""],["ref","map",1,"map"],[1,"crosshair"]],template:function(r,n){r&1&&(qd(0,"div",1,0),e1(2,f5,2,0,"div",2),Xd()),r&2&&(Q_(2),r1(n.controls&&n.controls.crosshair?2:-1))},styles:[`@charset "UTF-8";:root{--ukis-crosshair-color: #ff0004;--ukis-popup-bg-color: rgb(238, 238, 238);--ukis-drop-shadow: drop-shadow(0 1px 4px rgba(0, 0, 0, .2));--ukis-ol-bbox-bg-color: rgba(255, 255, 255, .4);--ukis-ol-bbox-border-color: rgba(87, 87, 87, .4);--ukis-ol-overviewmap-left: .5em;--ukis-ol-overviewmap-bottom: 3em;--ukis-ol-control-bg-color: rgba(87, 87, 87, .6);--ukis-ol-control-border-color: rgba(87, 87, 87, .4)}.map{width:100%;height:100%;position:relative}.ol-popup{position:absolute;background-color:var(--ukis-popup-bg-color);-webkit-filter:var(--ukis-drop-shadow);filter:var(--ukis-drop-shadow);padding:15px;border-radius:2px;bottom:12px;left:-50px;min-width:280px;display:none;z-index:1000000}.ol-popup .ol-popup-closer{text-decoration:none;position:absolute;top:0;right:8px;cursor:pointer}.ol-popup .ol-popup-closer:after{content:"\\2716"}.ol-popup:after,.ol-popup:before{top:100%;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none}.ol-popup:after{border-top-color:var(--ukis-popup-bg-color);border-width:10px;left:48px;margin-left:-10px}.ol-popup:before{border-width:11px;left:48px;margin-left:-11px}.ol-popup.hidden{visibility:hidden}.crosshair{top:50%;left:50%;font-size:large;color:var(--ukis-crosshair-color);z-index:1;position:absolute;cursor:default}.ol-control{padding:1px;--ol-subtle-background-color: #fff6}.ol-control button{--ol-subtle-foreground-color: #fff;--ol-foreground-color: #fff;cursor:pointer;background-color:var(--ukis-ol-control-bg-color)}.ol-control button:focus{background-color:var(--ukis-ol-control-bg-color)}.ol-control button:hover{background-color:var(--ukis-ol-control-border-color)}.ol-scale-line{background:#fff6;line-height:1.375em;padding:1px}.ol-scale-line .ol-scale-line-inner{background:var(--ukis-ol-control-bg-color);border-color:var(--ukis-ol-control-bg-color);--ol-foreground-color: #fff}.ol-attribution:not(.ol-collapsed){padding:0 2px}.ol-attribution ul{font-size:.5rem}.ol-box{background-color:var(--ukis-ol-bbox-bg-color);border-color:var(--ukis-ol-bbox-border-color)!important}.ol-box.ol-drag-select{border-color:var(--clr-color-action-600, var(--fallback-color-no-clr))!important}.ol-overviewmap{left:var(--ukis-ol-overviewmap-left)!important;bottom:var(--ukis-ol-overviewmap-bottom)!important}
`],encapsulation:2})}}return i})();export{$ as a,Hr as b,ui as c,Jr as d,dt as e,Tt as f,nt as g,H as h,H5 as i,Et as j,ie as k,ht as l,ii as m,gl as n,ge as o,ze as p,Ft as q,it as r,Di as s,Th as t,xl as u,ki as v,Z as w,zi as x,wi as y,di as z,sr as A,Ss as B,ix as C,we as D,ia as E,sx as F,ne as G,ox as H,$e as I,jh as J,ji as K,oi as L,$h as M,or as N,Xt as O,qi as P,Jt as Q,se as R,Ke as S,ma as T,ar as U,me as V,mi as W,Vt as X,bi as Y,lr as Z,As as _,Yl as $,$l as aa,Rp as ba,Ap as ca,ri as da,N as ea,Lp as fa,Op as ga,on as ha,K as ia,zn as ja,Le as ka,Be as la,ce as ma,cr as na,Ns as oa,bu as pa,Tv as qa,Pu as ra,wa as sa,ks as ta,nc as ua,dn as va,Pa as wa,oc as xa,yn as ya,$i as za,$s as Aa,Kn as Ba,To as Ca,yi as Da,cW as Ea,vw as Fa,Ew as Ga,ur as Ha,ni as Ia,WR as Ja,Df as Ka,Zn as La,Dw as Ma,Jn as Na,Kf as Oa,Ac as Pa,Wa as Qa,Ny as Ra,Gy as Sa,Qn as Ta,En as Ua,wn as Va,ts as Wa,QH as Xa,Q as Ya,at as Za,ae as _a,cA as $a,be as ab,hA as bb,aZ as cb,uA as db,li as eb,hd as fb,PS as gb,S_ as hb,rnt as ib,KF as jb,kb,HF as lb,ZF as mb,D_ as nb,jb as ob,Ub as pb,gat as qb};
