import{a as Rh}from"./chunk-GH7CIMZO.js";import{a as Af,c as Ef,g as Tf,h as Cf}from"./chunk-P62NUZ5D.js";import{a as Ch,b as Dh,c as Ih,d as kh,e as Mh,f as Ph,g as zh,h as Lh,i as Bh,k as xf,l as ss,m as la,n as wl,o as Sl,p as bf,q as wf,r as ja,s as Gc,t as Sf,u as Zc,v as Df,w as If}from"./chunk-RM6VSO6X.js";import{$a as cf,E as xa,Fc as ff,G as as,Ga as of,Gc as mf,Hc as gf,I as $c,Ic as yf,J as Eh,Kc as _f,Oa as lf,P as ba,S as tf,X as gr,Y as na,Ya as Th,Z as sa,a as Jd,b as Yd,ba as ns,dc as pf,ec as df,ha as rf,hd as vf,ia as af,j as Uc,ja as nf,l as jc,la as oa,p as Qd,q as Ah,sa as sf,sb as uf,xb as hf,y as ef}from"./chunk-G5LJQFAD.js";import{a as Wd,b as Xd,d as Kd,e as Dn,f as Vc}from"./chunk-FJYW2LMB.js";var Hc=Dn((Fh,Oh)=>{(function(_,b){typeof Fh=="object"&&typeof Oh<"u"?Oh.exports=b():typeof define=="function"&&define.amd?define(b):(_=typeof globalThis<"u"?globalThis:_||self,_.maplibregl=b())})(Fh,function(){"use strict";var _={},b={};function E(w,c,Q){if(b[w]=Q,w==="index"){var ee="var sharedModule = {}; ("+b.shared+")(sharedModule); ("+b.worker+")(sharedModule);",de={};return b.shared(de),b.index(_,de),typeof window<"u"&&_.setWorkerUrl(window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"}))),_}}E("shared",["exports"],function(w){"use strict";function c(i,t,r,n){return new(r||(r=Promise))(function(l,p){function d(x){try{g(n.next(x))}catch(S){p(S)}}function f(x){try{g(n.throw(x))}catch(S){p(S)}}function g(x){var S;x.done?l(x.value):(S=x.value,S instanceof r?S:new r(function(T){T(S)})).then(d,f)}g((n=n.apply(i,t||[])).next())})}function Q(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var ee=de;function de(i,t){this.x=i,this.y=t}de.prototype={clone:function(){return new de(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,t){var r=Math.cos(i),n=Math.sin(i),l=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},de.convert=function(i){return i instanceof de?i:Array.isArray(i)?new de(i[0],i[1]):i};var ne=Q(ee),$=Re;function Re(i,t,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=n}Re.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,n=0;n<8;n++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=l/p}var d=0,f=1;for(r=i,n=0;n<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));n++)i>l?d=r:f=r,r=.5*(f-d)+d;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Xe=Q($);let ot,St;function xt(){return ot==null&&(ot=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ot}function Tt(){if(St==null&&(St=!1,xt())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let n=0;n<5*5;n++){let l=4*n;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(n%5,Math.floor(n/5),1,1)}let r=t.getImageData(0,0,5,5).data;for(let n=0;n<5*5*4;n++)if(n%4!=3&&r[n]!==n){St=!0;break}}}return St||!1}function yt(i,t,r,n){let l=new Xe(i,t,r,n);return p=>l.solve(p)}let yr=yt(.25,.1,.25,1);function dt(i,t,r){return Math.min(r,Math.max(t,i))}function Ht(i,t,r){let n=r-t,l=((i-t)%n+n)%n+t;return l===t?r:l}function bi(i,...t){for(let r of t)for(let n in r)i[n]=r[n];return i}let Ue=1;function je(i,t,r){let n={};for(let l in i)n[l]=t.call(this,i[l],l,i);return n}function ht(i,t,r){let n={};for(let l in i)t.call(this,i[l],l,i)&&(n[l]=i[l]);return n}function Ve(i){return Array.isArray(i)?i.map(Ve):typeof i=="object"&&i?je(i,Ve):i}let Qt={};function et(i){Qt[i]||(typeof console<"u"&&console.warn(i),Qt[i]=!0)}function Nt(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function pi(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let yi=null;function oi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}let kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Lt(i,t,r,n,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let p=new VideoFrame(i,{timestamp:0});try{let d=p?.format;if(!d||!d.startsWith("BGR")&&!d.startsWith("RGB"))throw new Error(`Unrecognized format ${d}`);let f=d.startsWith("BGR"),g=new Uint8ClampedArray(n*l*4);if(yield p.copyTo(g,function(x,S,T,I,P){let B=4*Math.max(-S,0),R=(Math.max(0,T)-T)*I*4+B,V=4*I,Z=Math.max(0,S),oe=Math.max(0,T);return{rect:{x:Z,y:oe,width:Math.min(x.width,S+I)-Z,height:Math.min(x.height,T+P)-oe},layout:[{offset:R,stride:V}]}}(i,t,r,n,l)),f)for(let x=0;x<g.length;x+=4){let S=g[x];g[x]=g[x+2],g[x+2]=S}return g}finally{p.close()}})}let wi,li,ft="AbortError";function Dt(){return new Error(ft)}let pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Mt(i){return pt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}let Ut="global-dispatcher";class lt extends Error{constructor(t,r,n,l){super(`AJAXError: ${r} (${t}): ${n}`),this.status=t,this.statusText=r,this.url=n,this.body=l}}let ci=()=>pi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ge=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){let n=Mt(i.url);if(n)return n(i,t);if(pi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Ut},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ci())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(n,l){return c(this,void 0,void 0,function*(){let p=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:ci(),signal:l.signal});n.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");let d=yield fetch(p);if(!d.ok){let x=yield d.blob();throw new lt(d.status,d.statusText,n.url,x)}let f;f=n.type==="arrayBuffer"||n.type==="image"?d.arrayBuffer():n.type==="json"?d.json():d.text();let g=yield f;if(l.signal.aborted)throw Dt();return{data:g,cacheControl:d.headers.get("Cache-Control"),expires:d.headers.get("Expires")}})}(i,t);if(pi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Ut},t)}var r;return function(n,l){return new Promise((p,d)=>{var f;let g=new XMLHttpRequest;g.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(g.responseType="arraybuffer");for(let x in n.headers)g.setRequestHeader(x,n.headers[x]);n.type==="json"&&(g.responseType="text",!((f=n.headers)===null||f===void 0)&&f.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=n.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if(!l.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let x=g.response;if(n.type==="json")try{x=JSON.parse(g.response)}catch(S){return void d(S)}p({data:x,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{let x=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});d(new lt(g.status,g.statusText,n.url,x))}},l.signal.addEventListener("abort",()=>{g.abort(),d(Dt())}),g.send(n.body)})}(i,t)};function nt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;let t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function qt(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function tt(i,t,r){if(r&&r[i]){let n=r[i].indexOf(t);n!==-1&&r[i].splice(n,1)}}class di{constructor(t,r={}){bi(this,r),this.type=t}}class _i extends di{constructor(t,r={}){super("error",bi({error:t},r))}}class jt{on(t,r){return this._listeners=this._listeners||{},qt(t,r,this._listeners),this}off(t,r){return tt(t,r,this._listeners),tt(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},qt(t,r,this._oneTimeListeners),this):new Promise(n=>this.once(t,n))}fire(t,r){typeof t=="string"&&(t=new di(t,r||{}));let n=t.type;if(this.listens(n)){t.target=this;let l=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let f of l)f.call(this,t);let p=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let f of p)tt(n,f,this._oneTimeListeners),f.call(this,t);let d=this._eventedParent;d&&(bi(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(t))}else t instanceof _i&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Hi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mr(i,t){let r={};for(let n in i)n!=="ref"&&(r[n]=i[n]);return Hi.forEach(n=>{n in t&&(r[n]=t[n])}),r}function ct(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!ct(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(let r in i)if(!ct(i[r],t[r]))return!1;return!0}return i===t}function Bt(i,t){i.push(t)}function _r(i,t,r){Bt(r,{command:"addSource",args:[i,t[i]]})}function Pr(i,t,r){Bt(t,{command:"removeSource",args:[i]}),r[i]=!0}function Wi(i,t,r,n){Pr(i,r,n),_r(i,t,r)}function Qr(i,t,r){let n;for(n in i[r])if(Object.prototype.hasOwnProperty.call(i[r],n)&&n!=="data"&&!ct(i[r][n],t[r][n]))return!1;for(n in t[r])if(Object.prototype.hasOwnProperty.call(t[r],n)&&n!=="data"&&!ct(i[r][n],t[r][n]))return!1;return!0}function Vi(i,t,r,n,l,p){i=i||{},t=t||{};for(let d in i)Object.prototype.hasOwnProperty.call(i,d)&&(ct(i[d],t[d])||r.push({command:p,args:[n,d,t[d],l]}));for(let d in t)Object.prototype.hasOwnProperty.call(t,d)&&!Object.prototype.hasOwnProperty.call(i,d)&&(ct(i[d],t[d])||r.push({command:p,args:[n,d,t[d],l]}))}function ua(i){return i.id}function Ea(i,t){return i[t.id]=t,i}class ve{constructor(t,r,n,l){this.message=(t?`${t}: `:"")+n,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function sr(i,...t){for(let r of t)for(let n in r)i[n]=r[n];return i}class Si extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class or{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[n,l]of r)this.bindings[n]=l}concat(t){return new or(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let zr={kind:"null"},xe={kind:"number"},rt={kind:"string"},We={kind:"boolean"},Di={kind:"color"},Xi={kind:"object"},Ke={kind:"value"},Ki={kind:"collator"},vr={kind:"formatted"},ha={kind:"padding"},Zr={kind:"resolvedImage"},G={kind:"variableAnchorOffsetCollection"};function M(i,t){return{kind:"array",itemType:i,N:t}}function k(i){if(i.kind==="array"){let t=k(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}let O=[zr,xe,rt,We,Di,vr,Xi,M(Ke),ha,Zr,G];function U(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!U(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let r of O)if(!U(r,t))return null}}return`Expected ${k(i)} but found ${k(t)} instead.`}function Y(i,t){return t.some(r=>r.kind===i.kind)}function ie(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function se(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}let X=.96422,pe=.82521,ge=4/29,ue=6/29,be=3*ue*ue,qe=ue*ue*ue,$e=Math.PI/180,bt=180/Math.PI;function it(i){return(i%=360)<0&&(i+=360),i}function wt([i,t,r,n]){let l,p,d=fi((.2225045*(i=mt(i))+.7168786*(t=mt(t))+.0606169*(r=mt(r)))/1);i===t&&t===r?l=p=d:(l=fi((.4360747*i+.3850649*t+.1430804*r)/X),p=fi((.0139322*i+.0971045*t+.7141733*r)/pe));let f=116*d-16;return[f<0?0:f,500*(l-d),200*(d-p),n]}function mt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function fi(i){return i>qe?Math.pow(i,1/3):i/be+ge}function ii([i,t,r,n]){let l=(i+16)/116,p=isNaN(t)?l:l+t/500,d=isNaN(r)?l:l-r/200;return l=1*Pt(l),p=X*Pt(p),d=pe*Pt(d),[st(3.1338561*p-1.6168667*l-.4906146*d),st(-.9787684*p+1.9161415*l+.033454*d),st(.0719453*p-.2289914*l+1.4052427*d),n]}function st(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Pt(i){return i>ue?i*i*i:be*(i-ge)}function ei(i){return parseInt(i.padEnd(2,i),16)/255}function Ai(i,t){return Ii(t?i/100:i,0,1)}function Ii(i,t,r){return Math.min(Math.max(t,i),r)}function Ui(i){return!i.some(Number.isNaN)}let Ha={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class zt{constructor(t,r,n,l=1,p=!0){this.r=t,this.g=r,this.b=n,this.a=l,p||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,n,l]))}static parse(t){if(t instanceof zt)return t;if(typeof t!="string")return;let r=function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];let l=Ha[n];if(l){let[d,f,g]=l;return[d/255,f/255,g/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){let d=n.length<6?1:2,f=1;return[ei(n.slice(f,f+=d)),ei(n.slice(f,f+=d)),ei(n.slice(f,f+=d)),ei(n.slice(f,f+d)||"ff")]}if(n.startsWith("rgb")){let d=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){let[f,g,x,S,T,I,P,B,R,V,Z,oe]=d,J=[S||" ",P||" ",V].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){let ae=[x,I,R].join(""),he=ae==="%%%"?100:ae===""?255:0;if(he){let ye=[Ii(+g/he,0,1),Ii(+T/he,0,1),Ii(+B/he,0,1),Z?Ai(+Z,oe):1];if(Ui(ye))return ye}}return}}let p=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){let[d,f,g,x,S,T,I,P,B]=p,R=[g||" ",S||" ",I].join("");if(R==="  "||R==="  /"||R===",,"||R===",,,"){let V=[+f,Ii(+x,0,100),Ii(+T,0,100),P?Ai(+P,B):1];if(Ui(V))return function([Z,oe,J,ae]){function he(ye){let Ie=(ye+Z/30)%12,Ze=oe*Math.min(J,1-J);return J-Ze*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return Z=it(Z),oe/=100,J/=100,[he(0),he(8),he(4),ae]}(V)}}}(t);return r?new zt(...r,!1):void 0}get rgb(){let{r:t,g:r,b:n,a:l}=this,p=l||1/0;return this.overwriteGetter("rgb",[t/p,r/p,n/p,l])}get hcl(){return this.overwriteGetter("hcl",function(t){let[r,n,l,p]=wt(t),d=Math.sqrt(n*n+l*l);return[Math.round(1e4*d)?it(Math.atan2(l,n)*bt):NaN,d,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wt(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){let[t,r,n,l]=this.rgb;return`rgba(${[t,r,n].map(p=>Math.round(255*p)).join(",")},${l})`}}zt.black=new zt(0,0,0,1),zt.white=new zt(1,1,1,1),zt.transparent=new zt(0,0,0,0),zt.red=new zt(1,0,0,1);class fo{constructor(t,r,n){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mo{constructor(t,r,n,l,p){this.text=t,this.image=r,this.scale=n,this.fontStack=l,this.textColor=p}}class lr{constructor(t){this.sections=t}static fromString(t){return new lr([new mo(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof lr?t:lr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class cr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof cr)return t;if(typeof t=="number")return new cr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new cr(t)}}toString(){return JSON.stringify(this.values)}}let cu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class xr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){let n=t[r],l=t[r+1];if(typeof n!="string"||!cu.has(n)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new xr(t)}}toString(){return JSON.stringify(this.values)}}class ur{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ur({name:t,available:!1}):null}}function Wa(i,t,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,t,r,n]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ta(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof zt||i instanceof fo||i instanceof lr||i instanceof cr||i instanceof xr||i instanceof ur)return!0;if(Array.isArray(i)){for(let t of i)if(!Ta(t))return!1;return!0}if(typeof i=="object"){for(let t in i)if(!Ta(i[t]))return!1;return!0}return!1}function mi(i){if(i===null)return zr;if(typeof i=="string")return rt;if(typeof i=="boolean")return We;if(typeof i=="number")return xe;if(i instanceof zt)return Di;if(i instanceof fo)return Ki;if(i instanceof lr)return vr;if(i instanceof cr)return ha;if(i instanceof xr)return G;if(i instanceof ur)return Zr;if(Array.isArray(i)){let t=i.length,r;for(let n of i){let l=mi(n);if(r){if(r===l)continue;r=Ke;break}r=l}return M(r||Ke,t)}return Xi}function Pn(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof zt||i instanceof lr||i instanceof cr||i instanceof xr||i instanceof ur?i.toString():JSON.stringify(i)}class Lr{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ta(t[1]))return r.error("invalid value");let n=t[1],l=mi(n),p=r.expectedType;return l.kind!=="array"||l.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(l=p),new Lr(l,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ui{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let ls={string:rt,number:xe,boolean:We,object:Xi};class Br{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let n,l=1,p=t[0];if(p==="array"){let f,g;if(t.length>2){let x=t[1];if(typeof x!="string"||!(x in ls)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=ls[x],l++}else f=Ke;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=t[2],l++}n=M(f,g)}else{if(!ls[p])throw new Error(`Types doesn't contain name = ${p}`);n=ls[p]}let d=[];for(;l<t.length;l++){let f=r.parse(t[l],l,Ke);if(!f)return null;d.push(f)}return new Br(n,d)}evaluate(t){for(let r=0;r<this.args.length;r++){let n=this.args[r].evaluate(t);if(!U(this.type,mi(n)))return n;if(r===this.args.length-1)throw new ui(`Expected value to be of type ${k(this.type)}, but found ${k(mi(n))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let go={"to-boolean":We,"to-color":Di,"to-number":xe,"to-string":rt};class Rr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let n=t[0];if(!go[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&t.length!==2)return r.error("Expected one argument.");let l=go[n],p=[];for(let d=1;d<t.length;d++){let f=r.parse(t[d],d,Ke);if(!f)return null;p.push(f)}return new Rr(l,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,n;for(let l of this.args){if(r=l.evaluate(t),n=null,r instanceof zt)return r;if(typeof r=="string"){let p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Wa(r[0],r[1],r[2],r[3]),!n))return new zt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ui(n||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let n of this.args){r=n.evaluate(t);let l=cr.parse(r);if(l)return l}throw new ui(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let n of this.args){r=n.evaluate(t);let l=xr.parse(r);if(l)return l}throw new ui(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let n of this.args){if(r=n.evaluate(t),r===null)return 0;let l=Number(r);if(!isNaN(l))return l}throw new ui(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return lr.fromString(Pn(this.args[0].evaluate(t)));case"resolvedImage":return ur.fromString(Pn(this.args[0].evaluate(t)));default:return Pn(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let uu=["Unknown","Point","LineString","Polygon"];class cs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=zt.parse(t)),r}}class Ca{constructor(t,r,n=[],l,p=new or,d=[]){this.registry=t,this.path=n,this.key=n.map(f=>`[${f}]`).join(""),this.scope=p,this.errors=d,this.expectedType=l,this._isConstant=r}parse(t,r,n,l,p={}){return r?this.concat(r,n,l)._parse(t,p):this._parse(t,p)}_parse(t,r){function n(l,p,d){return d==="assert"?new Br(p,[l]):d==="coerce"?new Rr(p,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let p=this.registry[l];if(p){let d=p.parse(t,this);if(!d)return null;if(this.expectedType){let f=this.expectedType,g=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(f.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array")if(f.kind!=="variableAnchorOffsetCollection"||g.kind!=="value"&&g.kind!=="array"){if(this.checkSubtype(f,g))return null}else d=n(d,f,r.typeAnnotation||"coerce");else d=n(d,f,r.typeAnnotation||"coerce");else d=n(d,f,r.typeAnnotation||"coerce");else d=n(d,f,r.typeAnnotation||"assert")}if(!(d instanceof Lr)&&d.type.kind!=="resolvedImage"&&this._isConstant(d)){let f=new cs;try{d=new Lr(d.type,d.evaluate(f))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,n){let l=typeof t=="number"?this.path.concat(t):this.path,p=n?this.scope.concat(n):this.scope;return new Ca(this.registry,this._isConstant,l,r||null,p,this.errors)}error(t,...r){let n=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Si(n,t))}checkSubtype(t,r){let n=U(t,r);return n&&this.error(n),n}}class pa{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let n=[];for(let p=1;p<t.length-1;p+=2){let d=t[p];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,p);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);let f=r.parse(t[p+1],p+1);if(!f)return null;n.push([d,f])}let l=r.parse(t[t.length-1],t.length-1,r.expectedType,n);return l?new pa(n,l):null}outputDefined(){return this.result.outputDefined()}}class Ct{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let n=t[1];return r.scope.has(n)?new Ct(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class yo{constructor(t,r,n){this.type=t,this.index=r,this.input=n}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let n=r.parse(t[1],1,xe),l=r.parse(t[2],2,M(r.expectedType||Ke));return n&&l?new yo(l.type.itemType,n,l):null}evaluate(t){let r=this.index.evaluate(t),n=this.input.evaluate(t);if(r<0)throw new ui(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new ui(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new ui(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class _o{constructor(t,r){this.type=We,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let n=r.parse(t[1],1,Ke),l=r.parse(t[2],2,Ke);return n&&l?Y(n.type,[We,rt,xe,zr,Ke])?new _o(n,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${k(n.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!ie(r,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${k(mi(r))} instead.`);if(!ie(n,["string","array"]))throw new ui(`Expected second argument to be of type array or string, but found ${k(mi(n))} instead.`);return n.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Xa{constructor(t,r,n){this.type=xe,this.needle=t,this.haystack=r,this.fromIndex=n}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let n=r.parse(t[1],1,Ke),l=r.parse(t[2],2,Ke);if(!n||!l)return null;if(!Y(n.type,[We,rt,xe,zr,Ke]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${k(n.type)} instead`);if(t.length===4){let p=r.parse(t[3],3,xe);return p?new Xa(n,l,p):null}return new Xa(n,l)}evaluate(t){let r=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!ie(r,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${k(mi(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),ie(n,["string"])){let p=n.indexOf(r,l);return p===-1?-1:[...n.slice(0,p)].length}if(ie(n,["array"]))return n.indexOf(r,l);throw new ui(`Expected second argument to be of type array or string, but found ${k(mi(n))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class vo{constructor(t,r,n,l,p,d){this.inputType=t,this.type=r,this.input=n,this.cases=l,this.outputs=p,this.otherwise=d}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let n,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);let p={},d=[];for(let x=2;x<t.length-1;x+=2){let S=t[x],T=t[x+1];Array.isArray(S)||(S=[S]);let I=r.concat(x);if(S.length===0)return I.error("Expected at least one branch label.");for(let B of S){if(typeof B!="number"&&typeof B!="string")return I.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return I.error("Numeric branch labels must be integer values.");if(n){if(I.checkSubtype(n,mi(B)))return null}else n=mi(B);if(p[String(B)]!==void 0)return I.error("Branch labels must be unique.");p[String(B)]=d.length}let P=r.parse(T,x,l);if(!P)return null;l=l||P.type,d.push(P)}let f=r.parse(t[1],1,Ke);if(!f)return null;let g=r.parse(t[t.length-1],t.length-1,l);return g?f.type.kind!=="value"&&r.concat(1).checkSubtype(n,f.type)?null:new vo(n,l,f,p,d,g):null}evaluate(t){let r=this.input.evaluate(t);return(mi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class us{constructor(t,r,n){this.type=t,this.branches=r,this.otherwise=n}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);let l=[];for(let d=1;d<t.length-1;d+=2){let f=r.parse(t[d],d,We);if(!f)return null;let g=r.parse(t[d+1],d+1,n);if(!g)return null;l.push([f,g]),n=n||g.type}let p=r.parse(t[t.length-1],t.length-1,n);if(!p)return null;if(!n)throw new Error("Can't infer output type");return new us(n,l,p)}evaluate(t){for(let[r,n]of this.branches)if(r.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,n]of this.branches)t(r),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class zn{constructor(t,r,n,l){this.type=t,this.input=r,this.beginIndex=n,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let n=r.parse(t[1],1,Ke),l=r.parse(t[2],2,xe);if(!n||!l)return null;if(!Y(n.type,[M(Ke),rt,Ke]))return r.error(`Expected first argument to be of type array or string, but found ${k(n.type)} instead`);if(t.length===4){let p=r.parse(t[3],3,xe);return p?new zn(n.type,n,l,p):null}return new zn(n.type,n,l)}evaluate(t){let r=this.input.evaluate(t),n=this.beginIndex.evaluate(t),l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),ie(r,["string"]))return[...r].slice(n,l).join("");if(ie(r,["array"]))return r.slice(n,l);throw new ui(`Expected first argument to be of type array or string, but found ${k(mi(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function hs(i,t){let r=i.length-1,n,l,p=0,d=r,f=0;for(;p<=d;)if(f=Math.floor((p+d)/2),n=i[f],l=i[f+1],n<=t){if(f===r||t<l)return f;p=f+1}else{if(!(n>t))throw new ui("Input is not a number.");d=f-1}return 0}class Ka{constructor(t,r,n){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[l,p]of n)this.labels.push(l),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let n=r.parse(t[1],1,xe);if(!n)return null;let l=[],p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let d=1;d<t.length;d+=2){let f=d===1?-1/0:t[d],g=t[d+1],x=d,S=d+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let T=r.parse(g,S,p);if(!T)return null;p=p||T.type,l.push([f,T])}return new Ka(p,n,l)}evaluate(t){let r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return n[0].evaluate(t);let p=r.length;return l>=r[p-1]?n[p-1].evaluate(t):n[hs(r,l)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Nl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var hu=ql;function ql(i,t,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=n}ql.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,n=0;n<8;n++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=l/p}var d=0,f=1;for(r=i,n=0;n<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));n++)i>l?d=r:f=r,r=.5*(f-d)+d;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var pu=Nl(hu);function Da(i,t,r){return i+r*(t-i)}function Ln(i,t,r){return i.map((n,l)=>Da(n,t[l],r))}let Ji={number:Da,color:function(i,t,r,n="rgb"){switch(n){case"rgb":{let[l,p,d,f]=Ln(i.rgb,t.rgb,r);return new zt(l,p,d,f,!1)}case"hcl":{let[l,p,d,f]=i.hcl,[g,x,S,T]=t.hcl,I,P;if(isNaN(l)||isNaN(g))isNaN(l)?isNaN(g)?I=NaN:(I=g,d!==1&&d!==0||(P=x)):(I=l,S!==1&&S!==0||(P=p));else{let oe=g-l;g>l&&oe>180?oe-=360:g<l&&l-g>180&&(oe+=360),I=l+r*oe}let[B,R,V,Z]=function([oe,J,ae,he]){return oe=isNaN(oe)?0:oe*$e,ii([ae,Math.cos(oe)*J,Math.sin(oe)*J,he])}([I,P??Da(p,x,r),Da(d,S,r),Da(f,T,r)]);return new zt(B,R,V,Z,!1)}case"lab":{let[l,p,d,f]=ii(Ln(i.lab,t.lab,r));return new zt(l,p,d,f,!1)}}},array:Ln,padding:function(i,t,r){return new cr(Ln(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){let n=i.values,l=t.values;if(n.length!==l.length)throw new ui(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);let p=[];for(let d=0;d<n.length;d+=2){if(n[d]!==l[d])throw new ui(`Cannot interpolate values containing mismatched anchors. from[${d}]: ${n[d]}, to[${d}]: ${l[d]}`);p.push(n[d]);let[f,g]=n[d+1],[x,S]=l[d+1];p.push([Da(f,x,r),Da(g,S,r)])}return new xr(p)}};class Yi{constructor(t,r,n,l,p){this.type=t,this.operator=r,this.interpolation=n,this.input=l,this.labels=[],this.outputs=[];for(let[d,f]of p)this.labels.push(d),this.outputs.push(f)}static interpolationFactor(t,r,n,l){let p=0;if(t.name==="exponential")p=ps(r,t.base,n,l);else if(t.name==="linear")p=ps(r,1,n,l);else if(t.name==="cubic-bezier"){let d=t.controlPoints;p=new pu(d[0],d[1],d[2],d[3]).solve(ps(r,1,n,l))}return p}static parse(t,r){let[n,l,p,...d]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let x=l[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let x=l.slice(1);if(x.length!==4||x.some(S=>typeof S!="number"||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,xe),!p)return null;let f=[],g=null;n==="interpolate-hcl"||n==="interpolate-lab"?g=Di:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let x=0;x<d.length;x+=2){let S=d[x],T=d[x+1],I=x+3,P=x+4;if(typeof S!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);let B=r.parse(T,P,g);if(!B)return null;g=g||B.type,f.push([S,B])}return se(g,xe)||se(g,Di)||se(g,ha)||se(g,G)||se(g,M(xe))?new Yi(g,n,l,p,f):r.error(`Type ${k(g)} is not interpolatable.`)}evaluate(t){let r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return n[0].evaluate(t);let p=r.length;if(l>=r[p-1])return n[p-1].evaluate(t);let d=hs(r,l),f=Yi.interpolationFactor(this.interpolation,l,r[d],r[d+1]),g=n[d].evaluate(t),x=n[d+1].evaluate(t);switch(this.operator){case"interpolate":return Ji[this.type.kind](g,x,f);case"interpolate-hcl":return Ji.color(g,x,f,"hcl");case"interpolate-lab":return Ji.color(g,x,f,"lab")}}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ps(i,t,r,n){let l=n-r,p=i-r;return l===0?0:t===1?p/l:(Math.pow(t,p)-1)/(Math.pow(t,l)-1)}class ds{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let n=null,l=r.expectedType;l&&l.kind!=="value"&&(n=l);let p=[];for(let f of t.slice(1)){let g=r.parse(f,1+p.length,n,void 0,{typeAnnotation:"omit"});if(!g)return null;n=n||g.type,p.push(g)}if(!n)throw new Error("No output type");let d=l&&p.some(f=>U(l,f.type));return new ds(d?Ke:n,p)}evaluate(t){let r,n=null,l=0;for(let p of this.args)if(l++,n=p.evaluate(t),n&&n instanceof ur&&!n.available&&(r||(r=n.name),n=null,l===this.args.length&&(n=r)),n!==null)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function fs(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Vl(i,t,r,n){return n.compare(t,r)===0}function Ja(i,t,r){let n=i!=="=="&&i!=="!=";return class kf{constructor(p,d,f){this.type=We,this.lhs=p,this.rhs=d,this.collator=f,this.hasUntypedArgument=p.type.kind==="value"||d.type.kind==="value"}static parse(p,d){if(p.length!==3&&p.length!==4)return d.error("Expected two or three arguments.");let f=p[0],g=d.parse(p[1],1,Ke);if(!g)return null;if(!fs(f,g.type))return d.concat(1).error(`"${f}" comparisons are not supported for type '${k(g.type)}'.`);let x=d.parse(p[2],2,Ke);if(!x)return null;if(!fs(f,x.type))return d.concat(2).error(`"${f}" comparisons are not supported for type '${k(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${k(g.type)}' and '${k(x.type)}'.`);n&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new Br(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new Br(g.type,[x])));let S=null;if(p.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(S=d.parse(p[3],3,Ki),!S)return null}return new kf(g,x,S)}evaluate(p){let d=this.lhs.evaluate(p),f=this.rhs.evaluate(p);if(n&&this.hasUntypedArgument){let g=mi(d),x=mi(f);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new ui(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let g=mi(d),x=mi(f);if(g.kind!=="string"||x.kind!=="string")return t(p,d,f)}return this.collator?r(p,d,f,this.collator.evaluate(p)):t(p,d,f)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}let du=Ja("==",function(i,t,r){return t===r},Vl),Ul=Ja("!=",function(i,t,r){return t!==r},function(i,t,r,n){return!Vl(0,t,r,n)}),jl=Ja("<",function(i,t,r){return t<r},function(i,t,r,n){return n.compare(t,r)<0}),fu=Ja(">",function(i,t,r){return t>r},function(i,t,r,n){return n.compare(t,r)>0}),mu=Ja("<=",function(i,t,r){return t<=r},function(i,t,r,n){return n.compare(t,r)<=0}),$l=Ja(">=",function(i,t,r){return t>=r},function(i,t,r,n){return n.compare(t,r)>=0});class Bn{constructor(t,r,n){this.type=Ki,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let n=t[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");let l=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,We);if(!l)return null;let p=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,We);if(!p)return null;let d=null;return n.locale&&(d=r.parse(n.locale,1,rt),!d)?null:new Bn(l,p,d)}evaluate(t){return new fo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class xo{constructor(t,r,n,l,p){this.type=rt,this.number=t,this.locale=r,this.currency=n,this.minFractionDigits=l,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let n=r.parse(t[1],1,xe);if(!n)return null;let l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let p=null;if(l.locale&&(p=r.parse(l.locale,1,rt),!p))return null;let d=null;if(l.currency&&(d=r.parse(l.currency,1,rt),!d))return null;let f=null;if(l["min-fraction-digits"]&&(f=r.parse(l["min-fraction-digits"],1,xe),!f))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,xe),!g)?null:new xo(n,p,d,f,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ms{constructor(t){this.type=vr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let n=t[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");let l=[],p=!1;for(let d=1;d<=t.length-1;++d){let f=t[d];if(p&&typeof f=="object"&&!Array.isArray(f)){p=!1;let g=null;if(f["font-scale"]&&(g=r.parse(f["font-scale"],1,xe),!g))return null;let x=null;if(f["text-font"]&&(x=r.parse(f["text-font"],1,M(rt)),!x))return null;let S=null;if(f["text-color"]&&(S=r.parse(f["text-color"],1,Di),!S))return null;let T=l[l.length-1];T.scale=g,T.font=x,T.textColor=S}else{let g=r.parse(t[d],1,Ke);if(!g)return null;let x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,l.push({content:g,scale:null,font:null,textColor:null})}}return new ms(l)}evaluate(t){return new lr(this.sections.map(r=>{let n=r.content.evaluate(t);return mi(n)===Zr?new mo("",n,null,null,null):new mo(Pn(n),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class bo{constructor(t){this.type=Zr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let n=r.parse(t[1],1,rt);return n?new bo(n):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),n=ur.fromString(r);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(r)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class wo{constructor(t){this.type=xe,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let n=r.parse(t[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${k(n.type)} instead.`):new wo(n):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ui(`Expected value to be of type string or array, but found ${k(mi(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Hr=8192;function gu(i,t){let r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*Hr),Math.round(n*l*Hr)]}function So(i,t){let r=Math.pow(2,t.z);return[(l=(i[0]/Hr+t.x)/r,360*l-180),(n=(i[1]/Hr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,l}function Ia(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function da(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function It(i,t,r){let n=i[0]-t[0],l=i[1]-t[1],p=i[0]-r[0],d=i[1]-r[1];return n*d-p*l==0&&n*p<=0&&l*d<=0}function gs(i,t,r,n){return(l=[n[0]-r[0],n[1]-r[1]])[0]*(p=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*p[0]!=0&&!(!Zl(i,t,r,n)||!Zl(r,n,i,t));var l,p}function yu(i,t,r){for(let n of r)for(let l=0;l<n.length-1;++l)if(gs(i,t,n[l],n[l+1]))return!0;return!1}function Ya(i,t,r=!1){let n=!1;for(let f of t)for(let g=0;g<f.length-1;g++){if(It(i,f[g],f[g+1]))return r;(p=f[g])[1]>(l=i)[1]!=(d=f[g+1])[1]>l[1]&&l[0]<(d[0]-p[0])*(l[1]-p[1])/(d[1]-p[1])+p[0]&&(n=!n)}var l,p,d;return n}function _u(i,t){for(let r of t)if(Ya(i,r))return!0;return!1}function Gl(i,t){for(let r of i)if(!Ya(r,t))return!1;for(let r=0;r<i.length-1;++r)if(yu(i[r],i[r+1],t))return!1;return!0}function vu(i,t){for(let r of t)if(Gl(i,r))return!0;return!1}function Zl(i,t,r,n){let l=n[0]-r[0],p=n[1]-r[1],d=(i[0]-r[0])*p-l*(i[1]-r[1]),f=(t[0]-r[0])*p-l*(t[1]-r[1]);return d>0&&f<0||d<0&&f>0}function Ao(i,t,r){let n=[];for(let l=0;l<i.length;l++){let p=[];for(let d=0;d<i[l].length;d++){let f=gu(i[l][d],r);Ia(t,f),p.push(f)}n.push(p)}return n}function Hl(i,t,r){let n=[];for(let l=0;l<i.length;l++){let p=Ao(i[l],t,r);n.push(p)}return n}function Wl(i,t,r,n){if(i[0]<r[0]||i[0]>r[2]){let l=.5*n,p=i[0]-r[0]>l?-n:r[0]-i[0]>l?n:0;p===0&&(p=i[0]-r[2]>l?-n:r[2]-i[0]>l?n:0),i[0]+=p}Ia(t,i)}function Xl(i,t,r,n){let l=Math.pow(2,n.z)*Hr,p=[n.x*Hr,n.y*Hr],d=[];for(let f of i)for(let g of f){let x=[g.x+p[0],g.y+p[1]];Wl(x,t,r,l),d.push(x)}return d}function Kl(i,t,r,n){let l=Math.pow(2,n.z)*Hr,p=[n.x*Hr,n.y*Hr],d=[];for(let g of i){let x=[];for(let S of g){let T=[S.x+p[0],S.y+p[1]];Ia(t,T),x.push(T)}d.push(x)}if(t[2]-t[0]<=l/2){(f=t)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(let g of d)for(let x of g)Wl(x,t,r,l)}var f;return d}class ka{constructor(t,r){this.type=We,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ta(t[1])){let n=t[1];if(n.type==="FeatureCollection"){let l=[];for(let p of n.features){let{type:d,coordinates:f}=p.geometry;d==="Polygon"&&l.push(f),d==="MultiPolygon"&&l.push(...f)}if(l.length)return new ka(n,{type:"MultiPolygon",coordinates:l})}else if(n.type==="Feature"){let l=n.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new ka(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new ka(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,n){let l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(n.type==="Polygon"){let f=Ao(n.coordinates,p,d),g=Xl(r.geometry(),l,p,d);if(!da(l,p))return!1;for(let x of g)if(!Ya(x,f))return!1}if(n.type==="MultiPolygon"){let f=Hl(n.coordinates,p,d),g=Xl(r.geometry(),l,p,d);if(!da(l,p))return!1;for(let x of g)if(!_u(x,f))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,n){let l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(n.type==="Polygon"){let f=Ao(n.coordinates,p,d),g=Kl(r.geometry(),l,p,d);if(!da(l,p))return!1;for(let x of g)if(!Gl(x,f))return!1}if(n.type==="MultiPolygon"){let f=Hl(n.coordinates,p,d),g=Kl(r.geometry(),l,p,d);if(!da(l,p))return!1;for(let x of g)if(!vu(x,f))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Jl=class{constructor(i=[],t=(r,n)=>r<n?-1:r>n?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:t,compare:r}=this,n=t[i];for(;i>0;){let l=i-1>>1,p=t[l];if(r(n,p)>=0)break;t[i]=p,i=l}t[i]=n}_down(i){let{data:t,compare:r}=this,n=this.length>>1,l=t[i];for(;i<n;){let p=1+(i<<1),d=p+1;if(d<this.length&&r(t[d],t[p])<0&&(p=d),r(t[p],l)>=0)break;t[i]=t[p],i=p}t[i]=l}};function xu(i,t,r,n,l){Yl(i,t,r,n||i.length-1,l||bu)}function Yl(i,t,r,n,l){for(;n>r;){if(n-r>600){var p=n-r+1,d=t-r+1,f=Math.log(p),g=.5*Math.exp(2*f/3),x=.5*Math.sqrt(f*g*(p-g)/p)*(d-p/2<0?-1:1);Yl(i,t,Math.max(r,Math.floor(t-d*g/p+x)),Math.min(n,Math.floor(t+(p-d)*g/p+x)),l)}var S=i[t],T=r,I=n;for(Rn(i,r,t),l(i[n],S)>0&&Rn(i,r,n);T<I;){for(Rn(i,T,I),T++,I--;l(i[T],S)<0;)T++;for(;l(i[I],S)>0;)I--}l(i[r],S)===0?Rn(i,r,I):Rn(i,++I,n),I<=t&&(r=I+1),t<=I&&(n=I-1)}}function Rn(i,t,r){var n=i[t];i[t]=i[r],i[r]=n}function bu(i,t){return i<t?-1:i>t?1:0}function ys(i,t){if(i.length<=1)return[i];let r=[],n,l;for(let p of i){let d=Su(p);d!==0&&(p.area=Math.abs(d),l===void 0&&(l=d<0),l===d<0?(n&&r.push(n),n=[p]):n.push(p))}if(n&&r.push(n),t>1)for(let p=0;p<r.length;p++)r[p].length<=t||(xu(r[p],t,1,r[p].length-1,wu),r[p]=r[p].slice(0,t));return r}function wu(i,t){return t.area-i.area}function Su(i){let t=0;for(let r,n,l=0,p=i.length,d=p-1;l<p;d=l++)r=i[l],n=i[d],t+=(n.x-r.x)*(r.y+n.y);return t}let Ql=1/298.257223563,ec=Ql*(2-Ql),tc=Math.PI/180;class Eo{constructor(t){let r=6378.137*tc*1e3,n=Math.cos(t*tc),l=1/(1-ec*(1-n*n)),p=Math.sqrt(l);this.kx=r*p*n,this.ky=r*p*l*(1-ec)}distance(t,r){let n=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(n*n+l*l)}pointOnLine(t,r){let n,l,p,d,f=1/0;for(let g=0;g<t.length-1;g++){let x=t[g][0],S=t[g][1],T=this.wrap(t[g+1][0]-x)*this.kx,I=(t[g+1][1]-S)*this.ky,P=0;T===0&&I===0||(P=(this.wrap(r[0]-x)*this.kx*T+(r[1]-S)*this.ky*I)/(T*T+I*I),P>1?(x=t[g+1][0],S=t[g+1][1]):P>0&&(x+=T/this.kx*P,S+=I/this.ky*P)),T=this.wrap(r[0]-x)*this.kx,I=(r[1]-S)*this.ky;let B=T*T+I*I;B<f&&(f=B,n=x,l=S,p=g,d=P)}return{point:[n,l],index:p,t:Math.max(0,Math.min(1,d))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function ic(i,t){return t[0]-i[0]}function _s(i){return i[1]-i[0]+1}function ea(i,t){return i[1]>=i[0]&&i[1]<t}function To(i,t){if(i[0]>i[1])return[null,null];let r=_s(i);if(t){if(r===2)return[i,null];let l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];let n=Math.floor(r/2)-1;return[[i[0],i[0]+n],[i[0]+n+1,i[1]]]}function Co(i,t){if(!ea(t,i.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let n=t[0];n<=t[1];++n)Ia(r,i[n]);return r}function Do(i){let t=[1/0,1/0,-1/0,-1/0];for(let r of i)for(let n of r)Ia(t,n);return t}function vs(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Io(i,t,r){if(!vs(i)||!vs(t))return NaN;let n=0,l=0;return i[2]<t[0]&&(n=t[0]-i[2]),i[0]>t[2]&&(n=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[n,l])}function Ma(i,t,r){let n=r.pointOnLine(t,i);return r.distance(i,n.point)}function ko(i,t,r,n,l){let p=Math.min(Ma(i,[r,n],l),Ma(t,[r,n],l)),d=Math.min(Ma(r,[i,t],l),Ma(n,[i,t],l));return Math.min(p,d)}function Au(i,t,r,n,l){if(!ea(t,i.length)||!ea(n,r.length))return 1/0;let p=1/0;for(let d=t[0];d<t[1];++d){let f=i[d],g=i[d+1];for(let x=n[0];x<n[1];++x){let S=r[x],T=r[x+1];if(gs(f,g,S,T))return 0;p=Math.min(p,ko(f,g,S,T,l))}}return p}function ai(i,t,r,n,l){if(!ea(t,i.length)||!ea(n,r.length))return NaN;let p=1/0;for(let d=t[0];d<=t[1];++d)for(let f=n[0];f<=n[1];++f)if(p=Math.min(p,l.distance(i[d],r[f])),p===0)return p;return p}function Eu(i,t,r){if(Ya(i,t,!0))return 0;let n=1/0;for(let l of t){let p=l[0],d=l[l.length-1];if(p!==d&&(n=Math.min(n,Ma(i,[d,p],r)),n===0))return n;let f=r.pointOnLine(l,i);if(n=Math.min(n,r.distance(i,f.point)),n===0)return n}return n}function ut(i,t,r,n){if(!ea(t,i.length))return NaN;for(let p=t[0];p<=t[1];++p)if(Ya(i[p],r,!0))return 0;let l=1/0;for(let p=t[0];p<t[1];++p){let d=i[p],f=i[p+1];for(let g of r)for(let x=0,S=g.length,T=S-1;x<S;T=x++){let I=g[T],P=g[x];if(gs(d,f,I,P))return 0;l=Math.min(l,ko(d,f,I,P,n))}}return l}function xs(i,t){for(let r of i)for(let n of r)if(Ya(n,t,!0))return!0;return!1}function $t(i,t,r,n=1/0){let l=Do(i),p=Do(t);if(n!==1/0&&Io(l,p,r)>=n)return n;if(da(l,p)){if(xs(i,t))return 0}else if(xs(t,i))return 0;let d=1/0;for(let f of i)for(let g=0,x=f.length,S=x-1;g<x;S=g++){let T=f[S],I=f[g];for(let P of t)for(let B=0,R=P.length,V=R-1;B<R;V=B++){let Z=P[V],oe=P[B];if(gs(T,I,Z,oe))return 0;d=Math.min(d,ko(T,I,Z,oe,r))}}return d}function Rt(i,t,r,n,l,p){if(!p)return;let d=Io(Co(n,p),l,r);d<t&&i.push([d,p,[0,0]])}function Pa(i,t,r,n,l,p,d){if(!p||!d)return;let f=Io(Co(n,p),Co(l,d),r);f<t&&i.push([f,p,d])}function Fn(i,t,r,n,l=1/0){let p=Math.min(n.distance(i[0],r[0][0]),l);if(p===0)return p;let d=new Jl([[0,[0,i.length-1],[0,0]]],ic),f=Do(r);for(;d.length>0;){let g=d.pop();if(g[0]>=p)continue;let x=g[1],S=t?50:100;if(_s(x)<=S){if(!ea(x,i.length))return NaN;if(t){let T=ut(i,x,r,n);if(isNaN(T)||T===0)return T;p=Math.min(p,T)}else for(let T=x[0];T<=x[1];++T){let I=Eu(i[T],r,n);if(p=Math.min(p,I),p===0)return 0}}else{let T=To(x,t);Rt(d,p,n,i,f,T[0]),Rt(d,p,n,i,f,T[1])}}return p}function On(i,t,r,n,l,p=1/0){let d=Math.min(p,l.distance(i[0],r[0]));if(d===0)return d;let f=new Jl([[0,[0,i.length-1],[0,r.length-1]]],ic);for(;f.length>0;){let g=f.pop();if(g[0]>=d)continue;let x=g[1],S=g[2],T=t?50:100,I=n?50:100;if(_s(x)<=T&&_s(S)<=I){if(!ea(x,i.length)&&ea(S,r.length))return NaN;let P;if(t&&n)P=Au(i,x,r,S,l),d=Math.min(d,P);else if(t&&!n){let B=i.slice(x[0],x[1]+1);for(let R=S[0];R<=S[1];++R)if(P=Ma(r[R],B,l),d=Math.min(d,P),d===0)return d}else if(!t&&n){let B=r.slice(S[0],S[1]+1);for(let R=x[0];R<=x[1];++R)if(P=Ma(i[R],B,l),d=Math.min(d,P),d===0)return d}else P=ai(i,x,r,S,l),d=Math.min(d,P)}else{let P=To(x,t),B=To(S,n);Pa(f,d,l,i,r,P[0],B[0]),Pa(f,d,l,i,r,P[0],B[1]),Pa(f,d,l,i,r,P[1],B[0]),Pa(f,d,l,i,r,P[1],B[1])}}return d}function Mo(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class za{constructor(t,r){this.type=xe,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ta(t[1])){let n=t[1];if(n.type==="FeatureCollection")return new za(n,n.features.map(l=>Mo(l.geometry)).flat());if(n.type==="Feature")return new za(n,Mo(n.geometry));if("type"in n&&"coordinates"in n)return new za(n,Mo(n))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,n){let l=r.geometry(),p=l.flat().map(g=>So([g.x,g.y],r.canonical));if(l.length===0)return NaN;let d=new Eo(p[0][1]),f=1/0;for(let g of n){switch(g.type){case"Point":f=Math.min(f,On(p,!1,[g.coordinates],!1,d,f));break;case"LineString":f=Math.min(f,On(p,!1,g.coordinates,!0,d,f));break;case"Polygon":f=Math.min(f,Fn(p,!1,g.coordinates,d,f))}if(f===0)return f}return f}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,n){let l=r.geometry(),p=l.flat().map(g=>So([g.x,g.y],r.canonical));if(l.length===0)return NaN;let d=new Eo(p[0][1]),f=1/0;for(let g of n){switch(g.type){case"Point":f=Math.min(f,On(p,!0,[g.coordinates],!1,d,f));break;case"LineString":f=Math.min(f,On(p,!0,g.coordinates,!0,d,f));break;case"Polygon":f=Math.min(f,Fn(p,!0,g.coordinates,d,f))}if(f===0)return f}return f}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,n){let l=r.geometry();if(l.length===0||l[0].length===0)return NaN;let p=ys(l,0).map(g=>g.map(x=>x.map(S=>So([S.x,S.y],r.canonical)))),d=new Eo(p[0][0][0][1]),f=1/0;for(let g of n)for(let x of p){switch(g.type){case"Point":f=Math.min(f,Fn([g.coordinates],!1,x,d,f));break;case"LineString":f=Math.min(f,Fn(g.coordinates,!0,x,d,f));break;case"Polygon":f=Math.min(f,$t(x,g.coordinates,d,f))}if(f===0)return f}return f}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let Qa={"==":du,"!=":Ul,">":fu,"<":jl,">=":$l,"<=":mu,array:Br,at:yo,boolean:Br,case:us,coalesce:ds,collator:Bn,format:ms,image:bo,in:_o,"index-of":Xa,interpolate:Yi,"interpolate-hcl":Yi,"interpolate-lab":Yi,length:wo,let:pa,literal:Lr,match:vo,number:Br,"number-format":xo,object:Br,slice:zn,step:Ka,string:Br,"to-boolean":Rr,"to-color":Rr,"to-number":Rr,"to-string":Rr,var:Ct,within:ka,distance:za};class br{constructor(t,r,n,l){this.name=t,this.type=r,this._evaluate=n,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){let n=t[0],l=br.definitions[n];if(!l)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let p=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=d.filter(([x])=>!Array.isArray(x)||x.length===t.length-1),g=null;for(let[x,S]of f){g=new Ca(r.registry,Nn,r.path,null,r.scope);let T=[],I=!1;for(let P=1;P<t.length;P++){let B=t[P],R=Array.isArray(x)?x[P-1]:x.type,V=g.parse(B,1+T.length,R);if(!V){I=!0;break}T.push(V)}if(!I)if(Array.isArray(x)&&x.length!==T.length)g.error(`Expected ${x.length} arguments, but found ${T.length} instead.`);else{for(let P=0;P<T.length;P++){let B=Array.isArray(x)?x[P]:x.type,R=T[P];g.concat(P+1).checkSubtype(B,R.type)}if(g.errors.length===0)return new br(n,p,S,T)}}if(f.length===1)r.errors.push(...g.errors);else{let x=(f.length?f:d).map(([T])=>{return I=T,Array.isArray(I)?`(${I.map(k).join(", ")})`:`(${k(I.type)}...)`;var I}).join(" | "),S=[];for(let T=1;T<t.length;T++){let I=r.parse(t[T],1+S.length);if(!I)return null;S.push(k(I.type))}r.error(`Expected arguments of type ${x}, but found (${S.join(", ")}) instead.`)}return null}static register(t,r){br.definitions=r;for(let n in r)t[n]=br}}function Po(i,[t,r,n,l]){t=t.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);let p=l?l.evaluate(i):1,d=Wa(t,r,n,p);if(d)throw new ui(d);return new zt(t/255,r/255,n/255,p,!1)}function zo(i,t){return i in t}function Lo(i,t){let r=t[i];return r===void 0?null:r}function La(i){return{type:i}}function Nn(i){if(i instanceof Ct)return Nn(i.boundExpression);if(i instanceof br&&i.name==="error"||i instanceof Bn||i instanceof ka||i instanceof za)return!1;let t=i instanceof Rr||i instanceof Br,r=!0;return i.eachChild(n=>{r=t?r&&Nn(n):r&&n instanceof Lr}),!!r&&qn(i)&&Vn(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function qn(i){if(i instanceof br&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ka||i instanceof za)return!1;let t=!0;return i.eachChild(r=>{t&&!qn(r)&&(t=!1)}),t}function en(i){if(i instanceof br&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!en(r)&&(t=!1)}),t}function Vn(i,t){if(i instanceof br&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!Vn(n,t)&&(r=!1)}),r}function bs(i){return{result:"success",value:i}}function tn(i){return{result:"error",value:i}}function rn(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function rc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Bo(i){return!!i.expression&&i.expression.interpolated}function At(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ws(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Tu(i){return i}function ac(i,t){let r=t.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),p=i.type||(Bo(t)?"exponential":"interval");if(r||t.type==="padding"){let S=r?zt.parse:cr.parse;(i=sr({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],S(T[1])])),i.default=S(i.default?i.default:t.default)}if(i.colorSpace&&(d=i.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var d;let f,g,x;if(p==="exponential")f=sc;else if(p==="interval")f=Ss;else if(p==="categorical"){f=nc,g=Object.create(null);for(let S of i.stops)g[S[0]]=S[1];x=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);f=oc}if(n){let S={},T=[];for(let B=0;B<i.stops.length;B++){let R=i.stops[B],V=R[0].zoom;S[V]===void 0&&(S[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},T.push(V)),S[V].stops.push([R[0].value,R[1]])}let I=[];for(let B of T)I.push([S[B].zoom,ac(S[B],t)]);let P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Yi.interpolationFactor.bind(void 0,P),zoomStops:I.map(B=>B[0]),evaluate:({zoom:B},R)=>sc({stops:I,base:i.base},t,B).evaluate(B,R)}}if(l){let S=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Yi.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(i,t,T,g,x)}}return{kind:"source",evaluate(S,T){let I=T&&T.properties?T.properties[i.property]:void 0;return I===void 0?an(i.default,t.default):f(i,t,I,g,x)}}}function an(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function nc(i,t,r,n,l){return an(typeof r===l?n[r]:void 0,i.default,t.default)}function Ss(i,t,r){if(At(r)!=="number")return an(i.default,t.default);let n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];let l=hs(i.stops.map(p=>p[0]),r);return i.stops[l][1]}function sc(i,t,r){let n=i.base!==void 0?i.base:1;if(At(r)!=="number")return an(i.default,t.default);let l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];let p=hs(i.stops.map(S=>S[0]),r),d=function(S,T,I,P){let B=P-I,R=S-I;return B===0?0:T===1?R/B:(Math.pow(T,R)-1)/(Math.pow(T,B)-1)}(r,n,i.stops[p][0],i.stops[p+1][0]),f=i.stops[p][1],g=i.stops[p+1][1],x=Ji[t.type]||Tu;return typeof f.evaluate=="function"?{evaluate(...S){let T=f.evaluate.apply(void 0,S),I=g.evaluate.apply(void 0,S);if(T!==void 0&&I!==void 0)return x(T,I,d,i.colorSpace)}}:x(f,g,d,i.colorSpace)}function oc(i,t,r){switch(t.type){case"color":r=zt.parse(r);break;case"formatted":r=lr.fromString(r.toString());break;case"resolvedImage":r=ur.fromString(r.toString());break;case"padding":r=cr.parse(r);break;default:At(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return an(r,i.default,t.default)}br.register(Qa,{error:[{kind:"error"},[rt],(i,[t])=>{throw new ui(t.evaluate(i))}],typeof:[rt,[Ke],(i,[t])=>k(mi(t.evaluate(i)))],"to-rgba":[M(xe,4),[Di],(i,[t])=>{let[r,n,l,p]=t.evaluate(i).rgb;return[255*r,255*n,255*l,p]}],rgb:[Di,[xe,xe,xe],Po],rgba:[Di,[xe,xe,xe,xe],Po],has:{type:We,overloads:[[[rt],(i,[t])=>zo(t.evaluate(i),i.properties())],[[rt,Xi],(i,[t,r])=>zo(t.evaluate(i),r.evaluate(i))]]},get:{type:Ke,overloads:[[[rt],(i,[t])=>Lo(t.evaluate(i),i.properties())],[[rt,Xi],(i,[t,r])=>Lo(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Ke,[rt],(i,[t])=>Lo(t.evaluate(i),i.featureState||{})],properties:[Xi,[],i=>i.properties()],"geometry-type":[rt,[],i=>i.geometryType()],id:[Ke,[],i=>i.id()],zoom:[xe,[],i=>i.globals.zoom],"heatmap-density":[xe,[],i=>i.globals.heatmapDensity||0],"line-progress":[xe,[],i=>i.globals.lineProgress||0],accumulated:[Ke,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[xe,La(xe),(i,t)=>{let r=0;for(let n of t)r+=n.evaluate(i);return r}],"*":[xe,La(xe),(i,t)=>{let r=1;for(let n of t)r*=n.evaluate(i);return r}],"-":{type:xe,overloads:[[[xe,xe],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[xe],(i,[t])=>-t.evaluate(i)]]},"/":[xe,[xe,xe],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[xe,[xe,xe],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[xe,[],()=>Math.LN2],pi:[xe,[],()=>Math.PI],e:[xe,[],()=>Math.E],"^":[xe,[xe,xe],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[xe,[xe],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[xe,[xe],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[xe,[xe],(i,[t])=>Math.log(t.evaluate(i))],log2:[xe,[xe],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[xe,[xe],(i,[t])=>Math.sin(t.evaluate(i))],cos:[xe,[xe],(i,[t])=>Math.cos(t.evaluate(i))],tan:[xe,[xe],(i,[t])=>Math.tan(t.evaluate(i))],asin:[xe,[xe],(i,[t])=>Math.asin(t.evaluate(i))],acos:[xe,[xe],(i,[t])=>Math.acos(t.evaluate(i))],atan:[xe,[xe],(i,[t])=>Math.atan(t.evaluate(i))],min:[xe,La(xe),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[xe,La(xe),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[xe,[xe],(i,[t])=>Math.abs(t.evaluate(i))],round:[xe,[xe],(i,[t])=>{let r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[xe,[xe],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[xe,[xe],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[We,[rt,Ke],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[We,[Ke],(i,[t])=>i.id()===t.value],"filter-type-==":[We,[rt],(i,[t])=>i.geometryType()===t.value],"filter-<":[We,[rt,Ke],(i,[t,r])=>{let n=i.properties()[t.value],l=r.value;return typeof n==typeof l&&n<l}],"filter-id-<":[We,[Ke],(i,[t])=>{let r=i.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[We,[rt,Ke],(i,[t,r])=>{let n=i.properties()[t.value],l=r.value;return typeof n==typeof l&&n>l}],"filter-id->":[We,[Ke],(i,[t])=>{let r=i.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[We,[rt,Ke],(i,[t,r])=>{let n=i.properties()[t.value],l=r.value;return typeof n==typeof l&&n<=l}],"filter-id-<=":[We,[Ke],(i,[t])=>{let r=i.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[We,[rt,Ke],(i,[t,r])=>{let n=i.properties()[t.value],l=r.value;return typeof n==typeof l&&n>=l}],"filter-id->=":[We,[Ke],(i,[t])=>{let r=i.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[We,[Ke],(i,[t])=>t.value in i.properties()],"filter-has-id":[We,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[We,[M(rt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[We,[M(Ke)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[We,[rt,M(Ke)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[We,[rt,M(Ke)],(i,[t,r])=>function(n,l,p,d){for(;p<=d;){let f=p+d>>1;if(l[f]===n)return!0;l[f]>n?d=f-1:p=f+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:We,overloads:[[[We,We],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[La(We),(i,t)=>{for(let r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:We,overloads:[[[We,We],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[La(We),(i,t)=>{for(let r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[We,[We],(i,[t])=>!t.evaluate(i)],"is-supported-script":[We,[rt],(i,[t])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[rt,[rt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[rt,[rt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[rt,La(Ke),(i,t)=>t.map(r=>Pn(r.evaluate(i))).join("")],"resolved-locale":[rt,[Ki],(i,[t])=>t.evaluate(i).resolvedLocale()]});class As{constructor(t,r){var n;this.expression=t,this._warningHistory={},this._evaluator=new cs,this._defaultValue=r?(n=r).type==="color"&&ws(n.default)?new zt(0,0,0,0):n.type==="color"?zt.parse(n.default)||null:n.type==="padding"?cr.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?xr.parse(n.default)||null:n.default===void 0?null:n.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,n,l,p,d){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(t,r,n,l,p,d){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=d||null;try{let f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new ui(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function Es(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Qa}function nn(i,t){let r=new Ca(Qa,Nn,[],t?function(l){let p={color:Di,string:rt,number:xe,enum:rt,boolean:We,formatted:vr,padding:ha,resolvedImage:Zr,variableAnchorOffsetCollection:G};return l.type==="array"?M(p[l.value]||Ke,l.length):p[l.type]}(t):void 0),n=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?bs(new As(n,t)):tn(r.errors)}class sn{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!en(r.expression)}evaluateWithoutErrorHandling(t,r,n,l,p,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,n,l,p,d)}evaluate(t,r,n,l,p,d){return this._styleExpression.evaluate(t,r,n,l,p,d)}}class on{constructor(t,r,n,l){this.kind=t,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!en(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,n,l,p,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,n,l,p,d)}evaluate(t,r,n,l,p,d){return this._styleExpression.evaluate(t,r,n,l,p,d)}interpolationFactor(t,r,n){return this.interpolationType?Yi.interpolationFactor(this.interpolationType,t,r,n):0}}function Ro(i,t){let r=nn(i,t);if(r.result==="error")return r;let n=r.value.expression,l=qn(n);if(!l&&!rn(t))return tn([new Si("","data expressions not supported")]);let p=Vn(n,["zoom"]);if(!p&&!rc(t))return tn([new Si("","zoom expressions not supported")]);let d=Un(n);return d||p?d instanceof Si?tn([d]):d instanceof Yi&&!Bo(t)?tn([new Si("",'"interpolate" expressions cannot be used with this property')]):bs(d?new on(l?"camera":"composite",r.value,d.labels,d instanceof Yi?d.interpolation:void 0):new sn(l?"constant":"source",r.value)):tn([new Si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ln{constructor(t,r){this._parameters=t,this._specification=r,sr(this,ac(this._parameters,this._specification))}static deserialize(t){return new ln(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Un(i){let t=null;if(i instanceof pa)t=Un(i.result);else if(i instanceof ds){for(let r of i.args)if(t=Un(r),t)break}else(i instanceof Ka||i instanceof Yi)&&i.input instanceof br&&i.input.name==="zoom"&&(t=i);return t instanceof Si||i.eachChild(r=>{let n=Un(r);n instanceof Si?t=n:!t&&n?t=new Si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new Si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ts(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!Ts(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let Cs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fo(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ts(i)||(i=Ds(i));let t=nn(i,Cs);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,n,l)=>t.value.evaluate(r,n,{},l),needGeometry:lc(i)}}function Cu(i,t){return i<t?-1:i>t?1:0}function lc(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(lc(i[t]))return!0;return!1}function Ds(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?Oo(i[1],i[2],"=="):t==="!="?Pi(Oo(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Oo(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Ds))):t==="all"?["all"].concat(i.slice(1).map(Ds)):t==="none"?["all"].concat(i.slice(1).map(Ds).map(Pi)):t==="in"?jn(i[1],i.slice(2)):t==="!in"?Pi(jn(i[1],i.slice(2))):t==="has"?$n(i[1]):t!=="!has"||Pi($n(i[1]));var r}function Oo(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function jn(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Cu)]]:["filter-in-small",i,["literal",t]]}}function $n(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Pi(i){return["!",i]}function Ba(i){let t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(let p of i)l+=`${Ba(p)},`;return`${l}]`}let r=Object.keys(i).sort(),n="{";for(let l=0;l<r.length;l++)n+=`${JSON.stringify(r[l])}:${Ba(i[r[l]])},`;return`${n}}`}function cc(i){let t="";for(let r of Hi)t+=`/${Ba(i[r])}`;return t}function uc(i){let t=i.value;return t?[new ve(i.key,t,"constants have been deprecated as of v8")]:[]}function ni(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Fr(i){if(Array.isArray(i))return i.map(Fr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let r in i)t[r]=Fr(i[r]);return t}return ni(i)}function hr(i){let t=i.key,r=i.value,n=i.valueSpec||{},l=i.objectElementValidators||{},p=i.style,d=i.styleSpec,f=i.validateSpec,g=[],x=At(r);if(x!=="object")return[new ve(t,r,`object expected, ${x} found`)];for(let S in r){let T=S.split(".")[0],I=n[T]||n["*"],P;if(l[T])P=l[T];else if(n[T])P=f;else if(l["*"])P=l["*"];else{if(!n["*"]){g.push(new ve(t,r[S],`unknown property "${S}"`));continue}P=f}g=g.concat(P({key:(t&&`${t}.`)+S,value:r[S],valueSpec:I,style:p,styleSpec:d,object:r,objectKey:S,validateSpec:f},r))}for(let S in n)l[S]||n[S].required&&n[S].default===void 0&&r[S]===void 0&&g.push(new ve(t,r,`missing required property "${S}"`));return g}function Gn(i){let t=i.value,r=i.valueSpec,n=i.style,l=i.styleSpec,p=i.key,d=i.arrayElementValidator||i.validateSpec;if(At(t)!=="array")return[new ve(p,t,`array expected, ${At(t)} found`)];if(r.length&&t.length!==r.length)return[new ve(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ve(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let f={type:r.value,values:r.values};l.$version<7&&(f.function=r.function),At(r.value)==="object"&&(f=r.value);let g=[];for(let x=0;x<t.length;x++)g=g.concat(d({array:t,arrayIndex:x,value:t[x],valueSpec:f,validateSpec:i.validateSpec,style:n,styleSpec:l,key:`${p}[${x}]`}));return g}function No(i){let t=i.key,r=i.value,n=i.valueSpec,l=At(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new ve(t,r,`number expected, ${l} found`)]:"minimum"in n&&r<n.minimum?[new ve(t,r,`${r} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&r>n.maximum?[new ve(t,r,`${r} is greater than the maximum value ${n.maximum}`)]:[]}function Is(i){let t=i.valueSpec,r=ni(i.value.type),n,l,p,d={},f=r!=="categorical"&&i.value.property===void 0,g=!f,x=At(i.value.stops)==="array"&&At(i.value.stops[0])==="array"&&At(i.value.stops[0][0])==="object",S=hr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(r==="identity")return[new ve(P.key,P.value,'identity function may not have a "stops" property')];let B=[],R=P.value;return B=B.concat(Gn({key:P.key,value:R,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:T})),At(R)==="array"&&R.length===0&&B.push(new ve(P.key,R,"array must have at least one stop")),B},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return r==="identity"&&f&&S.push(new ve(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||S.push(new ve(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Bo(i.valueSpec)&&S.push(new ve(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!rn(i.valueSpec)?S.push(new ve(i.key,i.value,"property functions not supported")):f&&!rc(i.valueSpec)&&S.push(new ve(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||S.push(new ve(i.key,i.value,'"property" property is required')),S;function T(P){let B=[],R=P.value,V=P.key;if(At(R)!=="array")return[new ve(V,R,`array expected, ${At(R)} found`)];if(R.length!==2)return[new ve(V,R,`array length 2 expected, length ${R.length} found`)];if(x){if(At(R[0])!=="object")return[new ve(V,R,`object expected, ${At(R[0])} found`)];if(R[0].zoom===void 0)return[new ve(V,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new ve(V,R,"object stop key must have value")];if(p&&p>ni(R[0].zoom))return[new ve(V,R[0].zoom,"stop zoom values must appear in ascending order")];ni(R[0].zoom)!==p&&(p=ni(R[0].zoom),l=void 0,d={}),B=B.concat(hr({key:`${V}[0]`,value:R[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:No,value:I}}))}else B=B.concat(I({key:`${V}[0]`,value:R[0],valueSpec:{},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},R));return Es(Fr(R[1]))?B.concat([new ve(`${V}[1]`,R[1],"expressions are not allowed in function stops.")]):B.concat(P.validateSpec({key:`${V}[1]`,value:R[1],valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function I(P,B){let R=At(P.value),V=ni(P.value),Z=P.value!==null?P.value:B;if(n){if(R!==n)return[new ve(P.key,Z,`${R} stop domain type must match previous stop domain type ${n}`)]}else n=R;if(R!=="number"&&R!=="string"&&R!=="boolean")return[new ve(P.key,Z,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&r!=="categorical"){let oe=`number expected, ${R} found`;return rn(t)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ve(P.key,Z,oe)]}return r!=="categorical"||R!=="number"||isFinite(V)&&Math.floor(V)===V?r!=="categorical"&&R==="number"&&l!==void 0&&V<l?[new ve(P.key,Z,"stop domain values must appear in ascending order")]:(l=V,r==="categorical"&&V in d?[new ve(P.key,Z,"stop domain values must be unique")]:(d[V]=!0,[])):[new ve(P.key,Z,`integer expected, found ${V}`)]}}function cn(i){let t=(i.expressionContext==="property"?Ro:nn)(Fr(i.value),i.valueSpec);if(t.result==="error")return t.value.map(n=>new ve(`${i.key}${n.key}`,i.value,n.message));let r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ve(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!en(r))return[new ve(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!en(r))return[new ve(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Vn(r,["zoom","feature-state"]))return[new ve(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!qn(r))return[new ve(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ta(i){let t=i.key,r=i.value,n=i.valueSpec,l=[];return Array.isArray(n.values)?n.values.indexOf(ni(r))===-1&&l.push(new ve(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(ni(r))===-1&&l.push(new ve(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function qo(i){return Ts(Fr(i.value))?cn(sr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ks(i)}function ks(i){let t=i.value,r=i.key;if(At(t)!=="array")return[new ve(r,t,`array expected, ${At(t)} found`)];let n=i.styleSpec,l,p=[];if(t.length<1)return[new ve(r,t,"filter array must have at least 1 element")];switch(p=p.concat(ta({key:`${r}[0]`,value:t[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),ni(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ni(t[1])==="$type"&&p.push(new ve(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new ve(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=At(t[1]),l!=="string"&&p.push(new ve(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let d=2;d<t.length;d++)l=At(t[d]),ni(t[1])==="$type"?p=p.concat(ta({key:`${r}[${d}]`,value:t[d],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&p.push(new ve(`${r}[${d}]`,t[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<t.length;d++)p=p.concat(ks({key:`${r}[${d}]`,value:t[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=At(t[1]),t.length!==2?p.push(new ve(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&p.push(new ve(`${r}[1]`,t[1],`string expected, ${l} found`))}return p}function Vo(i,t){let r=i.key,n=i.validateSpec,l=i.style,p=i.styleSpec,d=i.value,f=i.objectKey,g=p[`${t}_${i.layerType}`];if(!g)return[];let x=f.match(/^(.*)-transition$/);if(t==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return n({key:r,value:d,valueSpec:p.transition,style:l,styleSpec:p});let S=i.valueSpec||g[f];if(!S)return[new ve(r,d,`unknown property "${f}"`)];let T;if(At(d)==="string"&&rn(S)&&!S.tokens&&(T=/^{([^}]+)}$/.exec(d)))return[new ve(r,d,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];let I=[];return i.layerType==="symbol"&&(f==="text-field"&&l&&!l.glyphs&&I.push(new ve(r,d,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&ws(Fr(d))&&ni(d.type)==="identity"&&I.push(new ve(r,d,'"text-font" does not support identity functions'))),I.concat(n({key:i.key,value:d,valueSpec:S,style:l,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:f}))}function Ms(i){return Vo(i,"paint")}function Uo(i){return Vo(i,"layout")}function jo(i){let t=[],r=i.value,n=i.key,l=i.style,p=i.styleSpec;r.type||r.ref||t.push(new ve(n,r,'either "type" or "ref" is required'));let d=ni(r.type),f=ni(r.ref);if(r.id){let g=ni(r.id);for(let x=0;x<i.arrayIndex;x++){let S=l.layers[x];ni(S.id)===g&&t.push(new ve(n,r.id,`duplicate layer id "${r.id}", previously used at line ${S.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&t.push(new ve(n,r[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{ni(x.id)===f&&(g=x)}),g?g.ref?t.push(new ve(n,r.ref,"ref cannot reference another ref layer")):d=ni(g.type):t.push(new ve(n,r.ref,`ref layer "${f}" not found`))}else if(d!=="background")if(r.source){let g=l.sources&&l.sources[r.source],x=g&&ni(g.type);g?x==="vector"&&d==="raster"?t.push(new ve(n,r.source,`layer "${r.id}" requires a raster source`)):x!=="raster-dem"&&d==="hillshade"?t.push(new ve(n,r.source,`layer "${r.id}" requires a raster-dem source`)):x==="raster"&&d!=="raster"?t.push(new ve(n,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&d!=="hillshade"?t.push(new ve(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&g.lineMetrics||t.push(new ve(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ve(n,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ve(n,r.source,`source "${r.source}" not found`))}else t.push(new ve(n,r,'missing required property "source"'));return t=t.concat(hr({key:n,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${n}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:qo,layout:g=>hr({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":x=>Uo(sr({layerType:d},x))}}),paint:g=>hr({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":x=>Ms(sr({layerType:d},x))}})}})),t}function Ra(i){let t=i.value,r=i.key,n=At(t);return n!=="string"?[new ve(r,t,`string expected, ${n} found`)]:[]}let Ps={promoteId:function({key:i,value:t}){if(At(t)==="string")return Ra({key:i,value:t});{let r=[];for(let n in t)r.push(...Ra({key:`${i}.${n}`,value:t[n]}));return r}}};function Zn(i){let t=i.value,r=i.key,n=i.styleSpec,l=i.style,p=i.validateSpec;if(!t.type)return[new ve(r,t,'"type" is required')];let d=ni(t.type),f;switch(d){case"vector":case"raster":return f=hr({key:r,value:t,valueSpec:n[`source_${d.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:Ps,validateSpec:p}),f;case"raster-dem":return f=function(g){var x;let S=(x=g.sourceName)!==null&&x!==void 0?x:"",T=g.value,I=g.styleSpec,P=I.source_raster_dem,B=g.style,R=[],V=At(T);if(T===void 0)return R;if(V!=="object")return R.push(new ve("source_raster_dem",T,`object expected, ${V} found`)),R;let Z=ni(T.encoding)==="custom",oe=["redFactor","greenFactor","blueFactor","baseShift"],J=g.value.encoding?`"${g.value.encoding}"`:"Default";for(let ae in T)!Z&&oe.includes(ae)?R.push(new ve(ae,T[ae],`In "${S}": "${ae}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):P[ae]?R=R.concat(g.validateSpec({key:ae,value:T[ae],valueSpec:P[ae],validateSpec:g.validateSpec,style:B,styleSpec:I})):R.push(new ve(ae,T[ae],`unknown property "${ae}"`));return R}({sourceName:r,value:t,style:i.style,styleSpec:n,validateSpec:p}),f;case"geojson":if(f=hr({key:r,value:t,valueSpec:n.source_geojson,style:l,styleSpec:n,validateSpec:p,objectElementValidators:Ps}),t.cluster)for(let g in t.clusterProperties){let[x,S]=t.clusterProperties[g],T=typeof x=="string"?[x,["accumulated"],["get",g]]:x;f.push(...cn({key:`${r}.${g}.map`,value:S,validateSpec:p,expressionContext:"cluster-map"})),f.push(...cn({key:`${r}.${g}.reduce`,value:T,validateSpec:p,expressionContext:"cluster-reduce"}))}return f;case"video":return hr({key:r,value:t,valueSpec:n.source_video,style:l,validateSpec:p,styleSpec:n});case"image":return hr({key:r,value:t,valueSpec:n.source_image,style:l,validateSpec:p,styleSpec:n});case"canvas":return[new ve(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ta({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:p,styleSpec:n})}}function $o(i){let t=i.value,r=i.styleSpec,n=r.light,l=i.style,p=[],d=At(t);if(t===void 0)return p;if(d!=="object")return p=p.concat([new ve("light",t,`object expected, ${d} found`)]),p;for(let f in t){let g=f.match(/^(.*)-transition$/);p=p.concat(g&&n[g[1]]&&n[g[1]].transition?i.validateSpec({key:f,value:t[f],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):n[f]?i.validateSpec({key:f,value:t[f],valueSpec:n[f],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ve(f,t[f],`unknown property "${f}"`)])}return p}function Go(i){let t=i.value,r=i.styleSpec,n=r.sky,l=i.style,p=At(t);if(t===void 0)return[];if(p!=="object")return[new ve("sky",t,`object expected, ${p} found`)];let d=[];for(let f in t)d=d.concat(n[f]?i.validateSpec({key:f,value:t[f],valueSpec:n[f],style:l,styleSpec:r}):[new ve(f,t[f],`unknown property "${f}"`)]);return d}function Zo(i){let t=i.value,r=i.styleSpec,n=r.terrain,l=i.style,p=[],d=At(t);if(t===void 0)return p;if(d!=="object")return p=p.concat([new ve("terrain",t,`object expected, ${d} found`)]),p;for(let f in t)p=p.concat(n[f]?i.validateSpec({key:f,value:t[f],valueSpec:n[f],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ve(f,t[f],`unknown property "${f}"`)]);return p}function Ho(i){let t=[],r=i.value,n=i.key;if(Array.isArray(r)){let l=[],p=[];for(let d in r)r[d].id&&l.includes(r[d].id)&&t.push(new ve(n,r,`all the sprites' ids must be unique, but ${r[d].id} is duplicated`)),l.push(r[d].id),r[d].url&&p.includes(r[d].url)&&t.push(new ve(n,r,`all the sprites' URLs must be unique, but ${r[d].url} is duplicated`)),p.push(r[d].url),t=t.concat(hr({key:`${n}[${d}]`,value:r[d],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ra({key:n,value:r})}let zs={"*":()=>[],array:Gn,boolean:function(i){let t=i.value,r=i.key,n=At(t);return n!=="boolean"?[new ve(r,t,`boolean expected, ${n} found`)]:[]},number:No,color:function(i){let t=i.key,r=i.value,n=At(r);return n!=="string"?[new ve(t,r,`color expected, ${n} found`)]:zt.parse(String(r))?[]:[new ve(t,r,`color expected, "${r}" found`)]},constants:uc,enum:ta,filter:qo,function:Is,layer:jo,object:hr,source:Zn,light:$o,sky:Go,terrain:Zo,projection:function(i){let t=i.value,r=i.styleSpec,n=r.projection,l=i.style,p=At(t);if(t===void 0)return[];if(p!=="object")return[new ve("projection",t,`object expected, ${p} found`)];let d=[];for(let f in t)d=d.concat(n[f]?i.validateSpec({key:f,value:t[f],valueSpec:n[f],style:l,styleSpec:r}):[new ve(f,t[f],`unknown property "${f}"`)]);return d},string:Ra,formatted:function(i){return Ra(i).length===0?[]:cn(i)},resolvedImage:function(i){return Ra(i).length===0?[]:cn(i)},padding:function(i){let t=i.key,r=i.value;if(At(r)==="array"){if(r.length<1||r.length>4)return[new ve(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let n={type:"number"},l=[];for(let p=0;p<r.length;p++)l=l.concat(i.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:i.validateSpec,valueSpec:n}));return l}return No({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){let t=i.key,r=i.value,n=At(r),l=i.styleSpec;if(n!=="array"||r.length<1||r.length%2!=0)return[new ve(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let d=0;d<r.length;d+=2)p=p.concat(ta({key:`${t}[${d}]`,value:r[d],valueSpec:l.layout_symbol["text-anchor"]})),p=p.concat(Gn({key:`${t}[${d+1}]`,value:r[d+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return p},sprite:Ho};function un(i){let t=i.value,r=i.valueSpec,n=i.styleSpec;return i.validateSpec=un,r.expression&&ws(ni(t))?Is(i):r.expression&&Es(Fr(t))?cn(i):r.type&&zs[r.type]?zs[r.type](i):hr(sr({},i,{valueSpec:r.type?n[r.type]:r}))}function hc(i){let t=i.value,r=i.key,n=Ra(i);return n.length||(t.indexOf("{fontstack}")===-1&&n.push(new ve(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&n.push(new ve(r,t,'"glyphs" url must include a "{range}" token'))),n}function wr(i,t=ce){let r=[];return r=r.concat(un({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:un,objectElementValidators:{glyphs:hc,"*":()=>[]}})),i.constants&&(r=r.concat(uc({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:un}))),Wo(r)}function Wr(i){return function(t){return i(Xd(Wd({},t),{validateSpec:un}))}}function Wo(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function Or(i){return function(...t){return Wo(i.apply(this,t))}}wr.source=Or(Wr(Zn)),wr.sprite=Or(Wr(Ho)),wr.glyphs=Or(Wr(hc)),wr.light=Or(Wr($o)),wr.sky=Or(Wr(Go)),wr.terrain=Or(Wr(Zo)),wr.layer=Or(Wr(jo)),wr.filter=Or(Wr(qo)),wr.paintProperty=Or(Wr(Ms)),wr.layoutProperty=Or(Wr(Uo));let Fa=wr,Du=Fa.light,Iu=Fa.sky,pc=Fa.paintProperty,dc=Fa.layoutProperty;function Xo(i,t){let r=!1;if(t&&t.length)for(let n of t)i.fire(new _i(new Error(n.message))),r=!0;return r}class hn{constructor(t,r,n){let l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let d=new Int32Array(this.arrayBuffer);t=d[0],this.d=(r=d[1])+2*(n=d[2]);for(let g=0;g<this.d*this.d;g++){let x=d[3+g],S=d[3+g+1];l.push(x===S?null:d.subarray(x,S))}let f=d[3+l.length+1];this.keys=d.subarray(d[3+l.length],f),this.bboxes=d.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*n;for(let d=0;d<this.d*this.d;d++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=n,this.scale=r/t,this.uid=0;let p=n/r*t;this.min=-p,this.max=t+p}insert(t,r,n,l,p){this._forEachCell(r,n,l,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,n,l,p,d){this.cells[p].push(d)}query(t,r,n,l,p){let d=this.min,f=this.max;if(t<=d&&r<=d&&f<=n&&f<=l&&!p)return Array.prototype.slice.call(this.keys);{let g=[];return this._forEachCell(t,r,n,l,this._queryCell,g,{},p),g}}_queryCell(t,r,n,l,p,d,f,g){let x=this.cells[p];if(x!==null){let S=this.keys,T=this.bboxes;for(let I=0;I<x.length;I++){let P=x[I];if(f[P]===void 0){let B=4*P;(g?g(T[B+0],T[B+1],T[B+2],T[B+3]):t<=T[B+2]&&r<=T[B+3]&&n>=T[B+0]&&l>=T[B+1])?(f[P]=!0,d.push(S[P])):f[P]=!1}}}}_forEachCell(t,r,n,l,p,d,f,g){let x=this._convertToCellCoord(t),S=this._convertToCellCoord(r),T=this._convertToCellCoord(n),I=this._convertToCellCoord(l);for(let P=x;P<=T;P++)for(let B=S;B<=I;B++){let R=this.d*B+P;if((!g||g(this._convertFromCellCoord(P),this._convertFromCellCoord(B),this._convertFromCellCoord(P+1),this._convertFromCellCoord(B+1)))&&p.call(this,t,r,n,l,R,d,f,g))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,r=3+this.cells.length+1+1,n=0;for(let d=0;d<this.cells.length;d++)n+=this.cells[d].length;let l=new Int32Array(r+n+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let p=r;for(let d=0;d<t.length;d++){let f=t[d];l[3+d]=p,l.set(f,p),p+=f.length}return l[3+t.length]=p,l.set(this.keys,p),p+=this.keys.length,l[3+t.length+1]=p,l.set(this.bboxes,p),p+=this.bboxes.length,l.buffer}static serialize(t,r){let n=t.toArrayBuffer();return r&&r.push(n),{buffer:n}}static deserialize(t){return new hn(t.buffer)}}let Sr={};function Pe(i,t,r={}){if(Sr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Sr[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Pe("Object",Object),Pe("TransferableGridIndex",hn),Pe("Color",zt),Pe("Error",Error),Pe("AJAXError",lt),Pe("ResolvedImage",ur),Pe("StylePropertyFunction",ln),Pe("StyleExpression",As,{omit:["_evaluator"]}),Pe("ZoomDependentExpression",on),Pe("ZoomConstantExpression",sn),Pe("CompoundExpression",br,{omit:["_evaluate"]});for(let i in Qa)Qa[i]._classRegistryKey||Pe(`Expression_${i}`,Qa[i]);function Ls(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ko(i){return i.$name||i.constructor._classRegistryKey}function fc(i){return!function(t){if(t===null||typeof t!="object")return!1;let r=Ko(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Ls(i)||oi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function pn(i,t){if(fc(i))return(Ls(i)||oi(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){let p=[];for(let d of i)p.push(pn(d,t));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);let r=Ko(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Sr[r])throw new Error(`${r} is not registered.`);let{klass:n}=Sr[r],l=n.serialize?n.serialize(i,t):{};if(n.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let p in i){if(!i.hasOwnProperty(p)||Sr[r].omit.indexOf(p)>=0)continue;let d=i[p];l[p]=Sr[r].shallow.indexOf(p)>=0?d:pn(d,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function dn(i){if(fc(i))return i;if(Array.isArray(i))return i.map(dn);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);let t=Ko(i)||"Object";if(!Sr[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:r}=Sr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);let n=Object.create(r.prototype);for(let l of Object.keys(i)){if(l==="$name")continue;let p=i[l];n[l]=Sr[t].shallow.indexOf(l)>=0?p:dn(p)}return n}class Jo{constructor(){this.first=!0}update(t,r){let n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}let _t={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Yo(i){for(let t of i)if(el(t.charCodeAt(0)))return!0;return!1}function ku(i){for(let t of i)if(!fn(t.charCodeAt(0)))return!1;return!0}function Qo(i){let t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}let Mu=Qo(["Arab","Dupl","Mong","Ougr","Syrc"]);function fn(i){return!Mu.test(String.fromCodePoint(i))}let mc=Qo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function el(i){return!(i!==746&&i!==747&&(i<4352||!(_t["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||_t["CJK Compatibility"](i)||_t["CJK Strokes"](i)||!(!_t["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||_t["Enclosed CJK Letters and Months"](i)||_t["Ideographic Description Characters"](i)||_t.Kanbun(i)||_t.Katakana(i)&&i!==12540||!(!_t["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!_t["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||_t["Vertical Forms"](i)||_t["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||mc.test(String.fromCodePoint(i)))))}function gc(i){return!(el(i)||function(t){return!!(_t["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||_t["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||_t["Letterlike Symbols"](t)||_t["Number Forms"](t)||_t["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||_t["Control Pictures"](t)&&t!==9251||_t["Optical Character Recognition"](t)||_t["Enclosed Alphanumerics"](t)||_t["Geometric Shapes"](t)||_t["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||_t["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||_t["CJK Symbols and Punctuation"](t)||_t.Katakana(t)||_t["Private Use Area"](t)||_t["CJK Compatibility Forms"](t)||_t["Small Form Variants"](t)||_t["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}let Pu=Qo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function tl(i){return Pu.test(String.fromCodePoint(i))}function zu(i,t){return!(!t&&tl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||_t.Khmer(i))}function Lu(i){for(let t of i)if(tl(t.charCodeAt(0)))return!0;return!1}let pr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Wt{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Jo,this.transition={})}isSupportedScript(t){return function(r,n){for(let l of r)if(!zu(l.charCodeAt(0),n))return!1;return!0}(t,pr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class mn{constructor(t,r){this.property=t,this.value=r,this.expression=function(n,l){if(ws(n))return new ln(n,l);if(Es(n)){let p=Ro(n,l);if(p.result==="error")throw new Error(p.value.map(d=>`${d.key}: ${d.message}`).join(", "));return p.value}{let p=n;return l.type==="color"&&typeof n=="string"?p=zt.parse(n):l.type!=="padding"||typeof n!="number"&&!Array.isArray(n)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(n)&&(p=xr.parse(n)):p=cr.parse(n),{kind:"constant",evaluate:()=>p}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,n){return this.property.possiblyEvaluate(this,t,r,n)}}class Bs{constructor(t){this.property=t,this.value=new mn(t,void 0)}transitioned(t,r){return new yc(this.property,this.value,r,bi({},t.transition,this.transition),t.now)}untransitioned(){return new yc(this.property,this.value,null,{},0)}}class Rs{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ve(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bs(this._values[t].property)),this._values[t].value=new mn(this._values[t].property,r===null?void 0:Ve(r))}getTransition(t){return Ve(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bs(this._values[t].property)),this._values[t].transition=Ve(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let n=this.getValue(r);n!==void 0&&(t[r]=n);let l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){let n=new Hn(this._properties);for(let l of Object.keys(this._values))n._values[l]=this._values[l].transitioned(t,r._values[l]);return n}untransitioned(){let t=new Hn(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class yc{constructor(t,r,n,l,p){this.property=t,this.value=r,this.begin=p+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=n)}possiblyEvaluate(t,r,n){let l=t.now||0,p=this.value.possiblyEvaluate(t,r,n),d=this.prior;if(d){if(l>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(l<this.begin)return d.possiblyEvaluate(t,r,n);{let f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(t,r,n),p,function(g){if(g<=0)return 0;if(g>=1)return 1;let x=g*g,S=x*g;return 4*(g<.5?S:3*(g-x)+S-.75)}(f))}}return p}}class Hn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,n){let l=new Xn(this._properties);for(let p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(t,r,n);return l}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Wn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Ve(this._values[t].value)}setValue(t,r){this._values[t]=new mn(this._values[t].property,r===null?void 0:Ve(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let n=this.getValue(r);n!==void 0&&(t[r]=n)}return t}possiblyEvaluate(t,r,n){let l=new Xn(this._properties);for(let p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(t,r,n);return l}}class Xr{constructor(t,r,n){this.property=t,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,n,l){return this.property.evaluate(this.value,this.parameters,t,r,n,l)}}class Xn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Le{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,n){let l=Ji[this.specification.type];return l?l(t,r,n):t}}class He{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,n,l){return new Xr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},n,l)}:t.expression,r)}interpolate(t,r,n){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Xr(this,{kind:"constant",value:void 0},t.parameters);let l=Ji[this.specification.type];if(l){let p=l(t.value.value,r.value.value,n);return new Xr(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,r,n,l,p,d){return t.kind==="constant"?t.value:t.evaluate(r,n,l,p,d)}}class Fs extends He{possiblyEvaluate(t,r,n,l){if(t.value===void 0)return new Xr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let p=t.expression.evaluate(r,null,{},n,l),d=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,f=this._calculate(d,d,d,r);return new Xr(this,{kind:"constant",value:f},r)}if(t.expression.kind==="camera"){let p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Xr(this,{kind:"constant",value:p},r)}return new Xr(this,t.expression,r)}evaluate(t,r,n,l,p,d){if(t.kind==="source"){let f=t.evaluate(r,n,l,p,d);return this._calculate(f,f,f,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},n,l),t.evaluate({zoom:Math.floor(r.zoom)},n,l),t.evaluate({zoom:Math.floor(r.zoom)+1},n,l),r):t.value}_calculate(t,r,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:n,to:r}}interpolate(t){return t}}class Os{constructor(t){this.specification=t}possiblyEvaluate(t,r,n,l){if(t.value!==void 0){if(t.expression.kind==="constant"){let p=t.expression.evaluate(r,null,{},n,l);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new Wt(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Wt(Math.floor(r.zoom),r)),t.expression.evaluate(new Wt(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:n,to:r}}interpolate(t){return t}}class il{constructor(t){this.specification=t}possiblyEvaluate(t,r,n,l){return!!t.expression.evaluate(r,null,{},n,l)}interpolate(){return!1}}class h{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let n=t[r];n.specification.overridable&&this.overridableProperties.push(r);let l=this.defaultPropertyValues[r]=new mn(n,void 0),p=this.defaultTransitionablePropertyValues[r]=new Bs(n);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Pe("DataDrivenProperty",He),Pe("DataConstantProperty",Le),Pe("CrossFadedDataDrivenProperty",Fs),Pe("CrossFadedProperty",Os),Pe("ColorRampProperty",il);let e="-transition";class a extends jt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Wn(r.layout)),r.paint)){this._transitionablePaint=new Rs(r.paint);for(let n in t.paint)this.setPaintProperty(n,t.paint[n],{validate:!1});for(let n in t.layout)this.setLayoutProperty(n,t.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xn(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,n={}){r!=null&&this._validate(dc,`layers.${this.id}.layout.${t}`,t,r,n)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,n={}){if(r!=null&&this._validate(pc,`layers.${this.id}.paint.${t}`,t,r,n))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{let l=this._transitionablePaint._values[t],p=l.property.specification["property-type"]==="cross-faded-data-driven",d=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let g=this._transitionablePaint._values[t].value;return g.isDataDriven()||d||p||this._handleOverridablePaintPropertyUpdate(t,f,g)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ht(t,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(t,r,n,l,p={}){return(!p||p.validate!==!1)&&Xo(this,t.call(Fa,{key:r,layerType:this.type,objectKey:n,value:l,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof Xr&&rn(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let s={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class o{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class u{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function m(i,t=1){let r=0,n=0;return{members:i.map(l=>{let p=s[l.type].BYTES_PER_ELEMENT,d=r=y(r,Math.max(t,p)),f=l.components||1;return n=Math.max(n,p),r+=p*f,{name:l.name,type:l.type,components:f,offset:d}}),size:y(r,Math.max(n,t)),alignment:t}}function y(i,t){return Math.ceil(i/t)*t}class v extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let n=this.length;return this.resize(n+1),this.emplace(n,t,r)}emplace(t,r,n){let l=2*t;return this.int16[l+0]=r,this.int16[l+1]=n,t}}v.prototype.bytesPerElement=4,Pe("StructArrayLayout2i4",v);class A extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,n)}emplace(t,r,n,l){let p=3*t;return this.int16[p+0]=r,this.int16[p+1]=n,this.int16[p+2]=l,t}}A.prototype.bytesPerElement=6,Pe("StructArrayLayout3i6",A);class C extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,l){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,n,l)}emplace(t,r,n,l,p){let d=4*t;return this.int16[d+0]=r,this.int16[d+1]=n,this.int16[d+2]=l,this.int16[d+3]=p,t}}C.prototype.bytesPerElement=8,Pe("StructArrayLayout4i8",C);class D extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d){let f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,l,p,d)}emplace(t,r,n,l,p,d,f){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=n,this.int16[g+2]=l,this.int16[g+3]=p,this.int16[g+4]=d,this.int16[g+5]=f,t}}D.prototype.bytesPerElement=12,Pe("StructArrayLayout2i4i12",D);class L extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d){let f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,l,p,d)}emplace(t,r,n,l,p,d,f){let g=4*t,x=8*t;return this.int16[g+0]=r,this.int16[g+1]=n,this.uint8[x+4]=l,this.uint8[x+5]=p,this.uint8[x+6]=d,this.uint8[x+7]=f,t}}L.prototype.bytesPerElement=8,Pe("StructArrayLayout2i4ub8",L);class F extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let n=this.length;return this.resize(n+1),this.emplace(n,t,r)}emplace(t,r,n){let l=2*t;return this.float32[l+0]=r,this.float32[l+1]=n,t}}F.prototype.bytesPerElement=8,Pe("StructArrayLayout2f8",F);class N extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d,f,g,x,S){let T=this.length;return this.resize(T+1),this.emplace(T,t,r,n,l,p,d,f,g,x,S)}emplace(t,r,n,l,p,d,f,g,x,S,T){let I=10*t;return this.uint16[I+0]=r,this.uint16[I+1]=n,this.uint16[I+2]=l,this.uint16[I+3]=p,this.uint16[I+4]=d,this.uint16[I+5]=f,this.uint16[I+6]=g,this.uint16[I+7]=x,this.uint16[I+8]=S,this.uint16[I+9]=T,t}}N.prototype.bytesPerElement=20,Pe("StructArrayLayout10ui20",N);class j extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d,f,g,x,S,T,I){let P=this.length;return this.resize(P+1),this.emplace(P,t,r,n,l,p,d,f,g,x,S,T,I)}emplace(t,r,n,l,p,d,f,g,x,S,T,I,P){let B=12*t;return this.int16[B+0]=r,this.int16[B+1]=n,this.int16[B+2]=l,this.int16[B+3]=p,this.uint16[B+4]=d,this.uint16[B+5]=f,this.uint16[B+6]=g,this.uint16[B+7]=x,this.int16[B+8]=S,this.int16[B+9]=T,this.int16[B+10]=I,this.int16[B+11]=P,t}}j.prototype.bytesPerElement=24,Pe("StructArrayLayout4i4ui4i24",j);class H extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,n)}emplace(t,r,n,l){let p=3*t;return this.float32[p+0]=r,this.float32[p+1]=n,this.float32[p+2]=l,t}}H.prototype.bytesPerElement=12,Pe("StructArrayLayout3f12",H);class W extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}W.prototype.bytesPerElement=4,Pe("StructArrayLayout1ul4",W);class K extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d,f,g,x){let S=this.length;return this.resize(S+1),this.emplace(S,t,r,n,l,p,d,f,g,x)}emplace(t,r,n,l,p,d,f,g,x,S){let T=10*t,I=5*t;return this.int16[T+0]=r,this.int16[T+1]=n,this.int16[T+2]=l,this.int16[T+3]=p,this.int16[T+4]=d,this.int16[T+5]=f,this.uint32[I+3]=g,this.uint16[T+8]=x,this.uint16[T+9]=S,t}}K.prototype.bytesPerElement=20,Pe("StructArrayLayout6i1ul2ui20",K);class q extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d){let f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,l,p,d)}emplace(t,r,n,l,p,d,f){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=n,this.int16[g+2]=l,this.int16[g+3]=p,this.int16[g+4]=d,this.int16[g+5]=f,t}}q.prototype.bytesPerElement=12,Pe("StructArrayLayout2i2i2i12",q);class te extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p){let d=this.length;return this.resize(d+1),this.emplace(d,t,r,n,l,p)}emplace(t,r,n,l,p,d){let f=4*t,g=8*t;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=l,this.int16[g+6]=p,this.int16[g+7]=d,t}}te.prototype.bytesPerElement=16,Pe("StructArrayLayout2f1f2i16",te);class re extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d){let f=this.length;return this.resize(f+1),this.emplace(f,t,r,n,l,p,d)}emplace(t,r,n,l,p,d,f){let g=16*t,x=4*t,S=8*t;return this.uint8[g+0]=r,this.uint8[g+1]=n,this.float32[x+1]=l,this.float32[x+2]=p,this.int16[S+6]=d,this.int16[S+7]=f,t}}re.prototype.bytesPerElement=16,Pe("StructArrayLayout2ub2f2i16",re);class le extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,n)}emplace(t,r,n,l){let p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=n,this.uint16[p+2]=l,t}}le.prototype.bytesPerElement=6,Pe("StructArrayLayout3ui6",le);class me extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d,f,g,x,S,T,I,P,B,R,V,Z){let oe=this.length;return this.resize(oe+1),this.emplace(oe,t,r,n,l,p,d,f,g,x,S,T,I,P,B,R,V,Z)}emplace(t,r,n,l,p,d,f,g,x,S,T,I,P,B,R,V,Z,oe){let J=24*t,ae=12*t,he=48*t;return this.int16[J+0]=r,this.int16[J+1]=n,this.uint16[J+2]=l,this.uint16[J+3]=p,this.uint32[ae+2]=d,this.uint32[ae+3]=f,this.uint32[ae+4]=g,this.uint16[J+10]=x,this.uint16[J+11]=S,this.uint16[J+12]=T,this.float32[ae+7]=I,this.float32[ae+8]=P,this.uint8[he+36]=B,this.uint8[he+37]=R,this.uint8[he+38]=V,this.uint32[ae+10]=Z,this.int16[J+22]=oe,t}}me.prototype.bytesPerElement=48,Pe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",me);class _e extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,l,p,d,f,g,x,S,T,I,P,B,R,V,Z,oe,J,ae,he,ye,Ie,Ze,Ce,Ee,Oe,ze){let Me=this.length;return this.resize(Me+1),this.emplace(Me,t,r,n,l,p,d,f,g,x,S,T,I,P,B,R,V,Z,oe,J,ae,he,ye,Ie,Ze,Ce,Ee,Oe,ze)}emplace(t,r,n,l,p,d,f,g,x,S,T,I,P,B,R,V,Z,oe,J,ae,he,ye,Ie,Ze,Ce,Ee,Oe,ze,Me){let fe=32*t,Ne=16*t;return this.int16[fe+0]=r,this.int16[fe+1]=n,this.int16[fe+2]=l,this.int16[fe+3]=p,this.int16[fe+4]=d,this.int16[fe+5]=f,this.int16[fe+6]=g,this.int16[fe+7]=x,this.uint16[fe+8]=S,this.uint16[fe+9]=T,this.uint16[fe+10]=I,this.uint16[fe+11]=P,this.uint16[fe+12]=B,this.uint16[fe+13]=R,this.uint16[fe+14]=V,this.uint16[fe+15]=Z,this.uint16[fe+16]=oe,this.uint16[fe+17]=J,this.uint16[fe+18]=ae,this.uint16[fe+19]=he,this.uint16[fe+20]=ye,this.uint16[fe+21]=Ie,this.uint16[fe+22]=Ze,this.uint32[Ne+12]=Ce,this.float32[Ne+13]=Ee,this.float32[Ne+14]=Oe,this.uint16[fe+30]=ze,this.uint16[fe+31]=Me,t}}_e.prototype.bytesPerElement=64,Pe("StructArrayLayout8i15ui1ul2f2ui64",_e);class Te extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Te.prototype.bytesPerElement=4,Pe("StructArrayLayout1f4",Te);class ke extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,n)}emplace(t,r,n,l){let p=3*t;return this.uint16[6*t+0]=r,this.float32[p+1]=n,this.float32[p+2]=l,t}}ke.prototype.bytesPerElement=12,Pe("StructArrayLayout1ui2f12",ke);class Se extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,n){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,n)}emplace(t,r,n,l){let p=4*t;return this.uint32[2*t+0]=r,this.uint16[p+2]=n,this.uint16[p+3]=l,t}}Se.prototype.bytesPerElement=8,Pe("StructArrayLayout1ul2ui8",Se);class we extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let n=this.length;return this.resize(n+1),this.emplace(n,t,r)}emplace(t,r,n){let l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=n,t}}we.prototype.bytesPerElement=4,Pe("StructArrayLayout2ui4",we);class Be extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Be.prototype.bytesPerElement=2,Pe("StructArrayLayout1ui2",Be);class Qe extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,n,l){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,n,l)}emplace(t,r,n,l,p){let d=4*t;return this.float32[d+0]=r,this.float32[d+1]=n,this.float32[d+2]=l,this.float32[d+3]=p,t}}Qe.prototype.bytesPerElement=16,Pe("StructArrayLayout4f16",Qe);class Ae extends o{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ne(this.anchorPointX,this.anchorPointY)}}Ae.prototype.size=20;class De extends K{get(t){return new Ae(this,t)}}Pe("CollisionBoxArray",De);class Je extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Je.prototype.size=48;class Xt extends me{get(t){return new Je(this,t)}}Pe("PlacedSymbolArray",Xt);class at extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}at.prototype.size=64;class gt extends _e{get(t){return new at(this,t)}}Pe("SymbolInstanceArray",gt);class Kt extends Te{getoffsetX(t){return this.float32[1*t+0]}}Pe("GlyphOffsetArray",Kt);class zi extends A{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Pe("SymbolLineVertexArray",zi);class Nr extends o{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Nr.prototype.size=12;class Jt extends ke{get(t){return new Nr(this,t)}}Pe("TextAnchorOffsetArray",Jt);class Qi extends o{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Qi.prototype.size=8;class ji extends Se{get(t){return new Qi(this,t)}}Pe("FeatureIndexArray",ji);class Li extends v{}class $i extends v{}class Kr extends v{}class gn extends D{}class Ns extends L{}class yn extends F{}class Ar extends N{}class qs extends j{}class rl extends H{}class Er extends W{}class Tr extends q{}class fa extends re{}class qr extends le{}class ki extends we{}let Bi=m([{name:"a_pos",components:2,type:"Int16"}],4),{members:dr}=Bi;class vt{constructor(t=[]){this.segments=t}prepareSegment(t,r,n,l){let p=this.segments[this.segments.length-1];return t>vt.MAX_VERTEX_ARRAY_LENGTH&&et(`Max vertices per segment is ${vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>vt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==l)&&(p={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},l!==void 0&&(p.sortKey=l),this.segments.push(p)),p}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,n,l){return new vt([{vertexOffset:t,primitiveOffset:r,vertexLength:n,primitiveLength:l,vaos:{},sortKey:0}])}}function Oa(i,t){return 256*(i=dt(Math.floor(i),0,255))+dt(Math.floor(t),0,255)}vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pe("SegmentVector",vt);let _n=m([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var vn={exports:{}},_c={exports:{}};_c.exports=function(i,t){var r,n,l,p,d,f,g,x;for(n=i.length-(r=3&i.length),l=t,d=3432918353,f=461845907,x=0;x<n;)g=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,l=27492+(65535&(p=5*(65535&(l=(l^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:l^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(x)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var Bu=_c.exports,vc={exports:{}};vc.exports=function(i,t){for(var r,n=i.length,l=t^n,p=0;n>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++p;switch(n){case 3:l^=(255&i.charCodeAt(p+2))<<16;case 2:l^=(255&i.charCodeAt(p+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(p)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var ma=Bu,xc=vc.exports;vn.exports=ma,vn.exports.murmur3=ma,vn.exports.murmur2=xc;var Vs=Q(vn.exports);class Kn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,n,l){this.ids.push(Us(t)),this.positions.push(r,n,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=Us(t),n=0,l=this.ids.length-1;for(;n<l;){let d=n+l>>1;this.ids[d]>=r?l=d:n=d+1}let p=[];for(;this.ids[n]===r;)p.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return p}static serialize(t,r){let n=new Float64Array(t.ids),l=new Uint32Array(t.positions);return js(n,l,0,n.length-1),r&&r.push(n.buffer,l.buffer),{ids:n,positions:l}}static deserialize(t){let r=new Kn;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Us(i){let t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Vs(String(i))}function js(i,t,r,n){for(;r<n;){let l=i[r+n>>1],p=r-1,d=n+1;for(;;){do p++;while(i[p]<l);do d--;while(i[d]>l);if(p>=d)break;xn(i,p,d),xn(t,3*p,3*d),xn(t,3*p+1,3*d+1),xn(t,3*p+2,3*d+2)}d-r<n-d?(js(i,t,r,d),r=d+1):(js(i,t,d+1,n),n=d)}}function xn(i,t,r){let n=i[t];i[t]=i[r],i[r]=n}Pe("FeaturePositionMap",Kn);class Jn{constructor(t,r){this.gl=t.gl,this.location=r}}class bc extends Jn{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class hp extends Jn{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class pp extends Jn{constructor(t,r){super(t,r),this.current=zt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Zm=new Float32Array(16);function Ru(i){return[Oa(255*i.r,255*i.g),Oa(255*i.b,255*i.a)]}class al{constructor(t,r,n){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=n}setUniform(t,r,n){t.set(n.constantOr(this.value))}getBinding(t,r,n){return this.type==="color"?new pp(t,r):new bc(t,r)}}class $s{constructor(t,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,n,l){let p=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,n){return n.substr(0,9)==="u_pattern"?new hp(t,r):new bc(t,r)}}class Na{constructor(t,r,n,l){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,n,l,p){let d=this.paintVertexArray.length,f=this.expression.evaluate(new Wt(0),r,{},l,[],p);this.paintVertexArray.resize(t),this._setPaintValue(d,t,f)}updatePaintArray(t,r,n,l){let p=this.expression.evaluate({zoom:0},n,l);this._setPaintValue(t,r,p)}_setPaintValue(t,r,n){if(this.type==="color"){let l=Ru(n);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ia{constructor(t,r,n,l,p,d){this.expression=t,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=n,this.useIntegerZoom=l,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,n,l,p){let d=this.expression.evaluate(new Wt(this.zoom),r,{},l,[],p),f=this.expression.evaluate(new Wt(this.zoom+1),r,{},l,[],p),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,d,f)}updatePaintArray(t,r,n,l){let p=this.expression.evaluate({zoom:this.zoom},n,l),d=this.expression.evaluate({zoom:this.zoom+1},n,l);this._setPaintValue(t,r,p,d)}_setPaintValue(t,r,n,l){if(this.type==="color"){let p=Ru(n),d=Ru(l);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,p[0],p[1],d[0],d[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,n,l);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=dt(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,n){return new bc(t,r)}}class bn{constructor(t,r,n,l,p,d){this.expression=t,this.type=r,this.useIntegerZoom=n,this.zoom=l,this.layerId=d,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,r,n){let l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(t,r,n,l,p){this._setPaintValues(t,r,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(t,r,n,l){if(!l||!n)return;let{min:p,mid:d,max:f}=n,g=l[p],x=l[d],S=l[f];if(g&&x&&S)for(let T=t;T<r;T++)this.zoomInPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,_n.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,_n.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class dp{constructor(t,r,n){this.binders={},this._buffers=[];let l=[];for(let p in t.paint._values){if(!n(p))continue;let d=t.paint.get(p);if(!(d instanceof Xr&&rn(d.property.specification)))continue;let f=Hm(p,t.type),g=d.value,x=d.property.specification.type,S=d.property.useIntegerZoom,T=d.property.specification["property-type"],I=T==="cross-faded"||T==="cross-faded-data-driven";if(g.kind==="constant")this.binders[p]=I?new $s(g.value,f):new al(g.value,f,x),l.push(`/u_${p}`);else if(g.kind==="source"||I){let P=fp(p,x,"source");this.binders[p]=I?new bn(g,x,S,r,P,t.id):new Na(g,f,x,P),l.push(`/a_${p}`)}else{let P=fp(p,x,"composite");this.binders[p]=new ia(g,f,x,S,r,P),l.push(`/z_${p}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof Na||r instanceof ia?r.maxValue:0}populatePaintArrays(t,r,n,l,p){for(let d in this.binders){let f=this.binders[d];(f instanceof Na||f instanceof ia||f instanceof bn)&&f.populatePaintArray(t,r,n,l,p)}}setConstantPatternPositions(t,r){for(let n in this.binders){let l=this.binders[n];l instanceof $s&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,n,l,p){let d=!1;for(let f in t){let g=r.getPositions(f);for(let x of g){let S=n.feature(x.index);for(let T in this.binders){let I=this.binders[T];if((I instanceof Na||I instanceof ia||I instanceof bn)&&I.expression.isStateDependent===!0){let P=l.paint.get(T);I.expression=P.value,I.updatePaintArray(x.start,x.end,S,t[f],p),d=!0}}}}return d}defines(){let t=[];for(let r in this.binders){let n=this.binders[r];(n instanceof al||n instanceof $s)&&t.push(...n.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof Na||n instanceof ia)for(let l=0;l<n.paintVertexAttributes.length;l++)t.push(n.paintVertexAttributes[l].name);else if(n instanceof bn)for(let l=0;l<_n.members.length;l++)t.push(_n.members[l].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof al||n instanceof $s||n instanceof ia)for(let l of n.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let n=[];for(let l in this.binders){let p=this.binders[l];if(p instanceof al||p instanceof $s||p instanceof ia){for(let d of p.uniformNames)if(r[d]){let f=p.getBinding(t,r[d],d);n.push({name:d,property:l,binding:f})}}}return n}setUniforms(t,r,n,l){for(let{name:p,property:d,binding:f}of r)this.binders[d].setUniform(f,l,n.get(d),p)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let n=this.binders[r];if(t&&n instanceof bn){let l=t.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(n instanceof Na||n instanceof ia)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(let r in this.binders){let n=this.binders[r];(n instanceof Na||n instanceof ia||n instanceof bn)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof Na||r instanceof ia||r instanceof bn)&&r.destroy()}}}class Yn{constructor(t,r,n=()=>!0){this.programConfigurations={};for(let l of t)this.programConfigurations[l.id]=new dp(l,r,n);this.needsUpload=!1,this._featureMap=new Kn,this._bufferOffset=0}populatePaintArrays(t,r,n,l,p,d){for(let f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(t,r,l,p,d);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,n,l){for(let p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,r,p,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Hm(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function fp(i,t,r){let n={color:{source:F,composite:Qe},number:{source:Te,composite:F}},l=function(p){return{"line-pattern":{source:Ar,composite:Ar},"fill-pattern":{source:Ar,composite:Ar},"fill-extrusion-pattern":{source:Ar,composite:Ar}}[p]}(i);return l&&l[r]||n[t][r]}Pe("ConstantBinder",al),Pe("CrossFadedConstantBinder",$s),Pe("SourceExpressionBinder",Na),Pe("CrossFadedCompositeBinder",bn),Pe("CompositeExpressionBinder",ia),Pe("ProgramConfiguration",dp,{omit:["_buffers"]}),Pe("ProgramConfigurationSet",Yn);let gi=8192,Fu=Math.pow(2,14)-1,mp=-Fu-1;function Qn(i){let t=gi/i.extent,r=i.loadGeometry();for(let n=0;n<r.length;n++){let l=r[n];for(let p=0;p<l.length;p++){let d=l[p],f=Math.round(d.x*t),g=Math.round(d.y*t);d.x=dt(f,mp,Fu),d.y=dt(g,mp,Fu),(f<d.x||f>d.x+1||g<d.y||g>d.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function es(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Qn(i):[]}}function wc(i,t,r,n,l){i.emplaceBack(2*t+(n+1)/2,2*r+(l+1)/2)}class Ou{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new $i,this.indexArray=new qr,this.segments=new vt,this.programConfigurations=new Yn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){let l=this.layers[0],p=[],d=null,f=!1;l.type==="circle"&&(d=l.layout.get("circle-sort-key"),f=!d.isConstant());for(let{feature:g,id:x,index:S,sourceLayerIndex:T}of t){let I=this.layers[0]._featureFilter.needGeometry,P=es(g,I);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),P,n))continue;let B=f?d.evaluate(P,{},n):void 0,R={id:x,properties:g.properties,type:g.type,sourceLayerIndex:T,index:S,geometry:I?P.geometry:Qn(g),patterns:{},sortKey:B};p.push(R)}f&&p.sort((g,x)=>g.sortKey-x.sortKey);for(let g of p){let{geometry:x,index:S,sourceLayerIndex:T}=g,I=t[S].feature;this.addFeature(g,x,S,n),r.featureIndex.insert(I,x,S,T,this.index)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,n,l){for(let p of r)for(let d of p){let f=d.x,g=d.y;if(f<0||f>=gi||g<0||g>=gi)continue;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),S=x.vertexLength;wc(this.layoutVertexArray,f,g,-1,-1),wc(this.layoutVertexArray,f,g,1,-1),wc(this.layoutVertexArray,f,g,1,1),wc(this.layoutVertexArray,f,g,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},l)}}function gp(i,t){for(let r=0;r<i.length;r++)if(Gs(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Gs(i,t[r]))return!0;return!!Nu(i,t)}function Wm(i,t,r){return!!Gs(i,t)||!!qu(t,i,r)}function yp(i,t){if(i.length===1)return vp(t,i[0]);for(let r=0;r<t.length;r++){let n=t[r];for(let l=0;l<n.length;l++)if(Gs(i,n[l]))return!0}for(let r=0;r<i.length;r++)if(vp(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Nu(i,t[r]))return!0;return!1}function Xm(i,t,r){if(i.length>1){if(Nu(i,t))return!0;for(let n=0;n<t.length;n++)if(qu(t[n],i,r))return!0}for(let n=0;n<i.length;n++)if(qu(i[n],t,r))return!0;return!1}function Nu(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){let n=i[r],l=i[r+1];for(let p=0;p<t.length-1;p++)if(Km(n,l,t[p],t[p+1]))return!0}return!1}function Km(i,t,r,n){return Nt(i,r,n)!==Nt(t,r,n)&&Nt(i,t,r)!==Nt(i,t,n)}function qu(i,t,r){let n=r*r;if(t.length===1)return i.distSqr(t[0])<n;for(let l=1;l<t.length;l++)if(_p(i,t[l-1],t[l])<n)return!0;return!1}function _p(i,t,r){let n=t.distSqr(r);if(n===0)return i.distSqr(t);let l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/n;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function vp(i,t){let r,n,l,p=!1;for(let d=0;d<i.length;d++){r=i[d];for(let f=0,g=r.length-1;f<r.length;g=f++)n=r[f],l=r[g],n.y>t.y!=l.y>t.y&&t.x<(l.x-n.x)*(t.y-n.y)/(l.y-n.y)+n.x&&(p=!p)}return p}function Gs(i,t){let r=!1;for(let n=0,l=i.length-1;n<i.length;l=n++){let p=i[n],d=i[l];p.y>t.y!=d.y>t.y&&t.x<(d.x-p.x)*(t.y-p.y)/(d.y-p.y)+p.x&&(r=!r)}return r}function Jm(i,t,r){let n=r[0],l=r[2];if(i.x<n.x&&t.x<n.x||i.x>l.x&&t.x>l.x||i.y<n.y&&t.y<n.y||i.y>l.y&&t.y>l.y)return!1;let p=Nt(i,t,r[0]);return p!==Nt(i,t,r[1])||p!==Nt(i,t,r[2])||p!==Nt(i,t,r[3])}function nl(i,t,r){let n=t.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Sc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ac(i,t,r,n,l){if(!t[0]&&!t[1])return i;let p=ne.convert(t)._mult(l);r==="viewport"&&p._rotate(-n);let d=[];for(let f=0;f<i.length;f++)d.push(i[f].sub(p));return d}let xp,bp;Pe("CircleBucket",Ou,{omit:["layers"]});var Ym={get paint(){return bp=bp||new h({"circle-radius":new He(ce.paint_circle["circle-radius"]),"circle-color":new He(ce.paint_circle["circle-color"]),"circle-blur":new He(ce.paint_circle["circle-blur"]),"circle-opacity":new He(ce.paint_circle["circle-opacity"]),"circle-translate":new Le(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Le(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Le(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Le(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new He(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new He(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new He(ce.paint_circle["circle-stroke-opacity"])})},get layout(){return xp=xp||new h({"circle-sort-key":new He(ce.layout_circle["circle-sort-key"])})}},er=1e-6,Zs=typeof Float32Array<"u"?Float32Array:Array;function Vu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function wp(i,t,r){var n=t[0],l=t[1],p=t[2],d=t[3],f=t[4],g=t[5],x=t[6],S=t[7],T=t[8],I=t[9],P=t[10],B=t[11],R=t[12],V=t[13],Z=t[14],oe=t[15],J=r[0],ae=r[1],he=r[2],ye=r[3];return i[0]=J*n+ae*f+he*T+ye*R,i[1]=J*l+ae*g+he*I+ye*V,i[2]=J*p+ae*x+he*P+ye*Z,i[3]=J*d+ae*S+he*B+ye*oe,i[4]=(J=r[4])*n+(ae=r[5])*f+(he=r[6])*T+(ye=r[7])*R,i[5]=J*l+ae*g+he*I+ye*V,i[6]=J*p+ae*x+he*P+ye*Z,i[7]=J*d+ae*S+he*B+ye*oe,i[8]=(J=r[8])*n+(ae=r[9])*f+(he=r[10])*T+(ye=r[11])*R,i[9]=J*l+ae*g+he*I+ye*V,i[10]=J*p+ae*x+he*P+ye*Z,i[11]=J*d+ae*S+he*B+ye*oe,i[12]=(J=r[12])*n+(ae=r[13])*f+(he=r[14])*T+(ye=r[15])*R,i[13]=J*l+ae*g+he*I+ye*V,i[14]=J*p+ae*x+he*P+ye*Z,i[15]=J*d+ae*S+he*B+ye*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var sl,Qm=wp;function Ec(i,t,r){var n=t[0],l=t[1],p=t[2],d=t[3];return i[0]=r[0]*n+r[4]*l+r[8]*p+r[12]*d,i[1]=r[1]*n+r[5]*l+r[9]*p+r[13]*d,i[2]=r[2]*n+r[6]*l+r[10]*p+r[14]*d,i[3]=r[3]*n+r[7]*l+r[11]*p+r[15]*d,i}sl=new Zs(4),Zs!=Float32Array&&(sl[0]=0,sl[1]=0,sl[2]=0,sl[3]=0);class e0 extends a{constructor(t){super(t,Ym)}createBucket(t){return new Ou(t)}queryRadius(t){let r=t;return nl("circle-radius",this,r)+nl("circle-stroke-width",this,r)+Sc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,n,l,p,d,f,g){let x=Ac(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,f),S=this.paint.get("circle-radius").evaluate(r,n)+this.paint.get("circle-stroke-width").evaluate(r,n),T=this.paint.get("circle-pitch-alignment")==="map",I=T?x:function(B,R){return B.map(V=>Sp(V,R))}(x,g),P=T?S*f:S;for(let B of l)for(let R of B){let V=T?R:Sp(R,g),Z=P,oe=Ec([],[R.x,R.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Z*=oe[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Z*=d.cameraToCenterDistance/oe[3]),Wm(I,V,Z))return!0}return!1}}function Sp(i,t){let r=Ec([],[i.x,i.y,0,1],t);return new ne(r[0]/r[3],r[1]/r[3])}class Ap extends Ou{}let Ep;Pe("HeatmapBucket",Ap,{omit:["layers"]});var t0={get paint(){return Ep=Ep||new h({"heatmap-radius":new He(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new He(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Le(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new il(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Le(ce.paint_heatmap["heatmap-opacity"])})}};function Uu(i,{width:t,height:r},n,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*n)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*n}`)}else l=new Uint8Array(t*r*n);return i.width=t,i.height=r,i.data=l,i}function Tp(i,{width:t,height:r},n){if(t===i.width&&r===i.height)return;let l=Uu({},{width:t,height:r},n);ju(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},n),i.width=t,i.height=r,i.data=l.data}function ju(i,t,r,n,l,p){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||n.x>t.width-l.width||n.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let d=i.data,f=t.data;if(d===f)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){let x=((r.y+g)*i.width+r.x)*p,S=((n.y+g)*t.width+n.x)*p;for(let T=0;T<l.width*p;T++)f[S+T]=d[x+T]}return t}class ol{constructor(t,r){Uu(this,t,1,r)}resize(t){Tp(this,t,1)}clone(){return new ol({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,n,l,p){ju(t,r,n,l,p,1)}}class Vr{constructor(t,r){Uu(this,t,4,r)}resize(t){Tp(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Vr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,n,l,p){ju(t,r,n,l,p,4)}}function Cp(i){let t={},r=i.resolution||256,n=i.clips?i.clips.length:1,l=i.image||new Vr({width:r,height:n});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let p=(d,f,g)=>{t[i.evaluationKey]=g;let x=i.expression.evaluate(t);l.data[d+f+0]=Math.floor(255*x.r/x.a),l.data[d+f+1]=Math.floor(255*x.g/x.a),l.data[d+f+2]=Math.floor(255*x.b/x.a),l.data[d+f+3]=Math.floor(255*x.a)};if(i.clips)for(let d=0,f=0;d<n;++d,f+=4*r)for(let g=0,x=0;g<r;g++,x+=4){let S=g/(r-1),{start:T,end:I}=i.clips[d];p(f,x,T*(1-S)+I*S)}else for(let d=0,f=0;d<r;d++,f+=4)p(0,f,d/(r-1));return l}Pe("AlphaImage",ol),Pe("RGBAImage",Vr);let $u="big-fb";class i0 extends a{createBucket(t){return new Ap(t)}constructor(t){super(t,t0),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has($u)&&this.heatmapFbos.delete($u)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Dp;var r0={get paint(){return Dp=Dp||new h({"hillshade-illumination-direction":new Le(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Le(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Le(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Le(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Le(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Le(ce.paint_hillshade["hillshade-accent-color"])})}};class a0 extends a{constructor(t){super(t,r0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let n0=m([{name:"a_pos",components:2,type:"Int16"}],4),{members:s0}=n0;function Ip(i,t,r=2){let n=t&&t.length,l=n?t[0]*r:i.length,p=kp(i,0,l,r,!0),d=[];if(!p||p.next===p.prev)return d;let f,g,x;if(n&&(p=function(S,T,I,P){let B=[];for(let R=0,V=T.length;R<V;R++){let Z=kp(S,T[R]*P,R<V-1?T[R+1]*P:S.length,P,!1);Z===Z.next&&(Z.steiner=!0),B.push(f0(Z))}B.sort(h0);for(let R=0;R<B.length;R++)I=p0(B[R],I);return I}(i,t,p,r)),i.length>80*r){f=1/0,g=1/0;let S=-1/0,T=-1/0;for(let I=r;I<l;I+=r){let P=i[I],B=i[I+1];P<f&&(f=P),B<g&&(g=B),P>S&&(S=P),B>T&&(T=B)}x=Math.max(S-f,T-g),x=x!==0?32767/x:0}return ll(p,d,r,f,g,x,0),d}function kp(i,t,r,n,l){let p;if(l===function(d,f,g,x){let S=0;for(let T=f,I=g-x;T<g;T+=x)S+=(d[I]-d[T])*(d[T+1]+d[I+1]),I=T;return S}(i,t,r,n)>0)for(let d=t;d<r;d+=n)p=zp(d/n|0,i[d],i[d+1],p);else for(let d=r-n;d>=t;d-=n)p=zp(d/n|0,i[d],i[d+1],p);return p&&Tc(p,p.next)&&(ul(p),p=p.next),p}function ts(i,t){if(!i)return i;t||(t=i);let r,n=i;do if(r=!1,n.steiner||!Tc(n,n.next)&&hi(n.prev,n,n.next)!==0)n=n.next;else{if(ul(n),n=t=n.prev,n===n.next)break;r=!0}while(r||n!==t);return t}function ll(i,t,r,n,l,p,d){if(!i)return;!d&&p&&function(g,x,S,T){let I=g;do I.z===0&&(I.z=Gu(I.x,I.y,x,S,T)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==g);I.prevZ.nextZ=null,I.prevZ=null,function(P){let B,R=1;do{let V,Z=P;P=null;let oe=null;for(B=0;Z;){B++;let J=Z,ae=0;for(let ye=0;ye<R&&(ae++,J=J.nextZ,J);ye++);let he=R;for(;ae>0||he>0&&J;)ae!==0&&(he===0||!J||Z.z<=J.z)?(V=Z,Z=Z.nextZ,ae--):(V=J,J=J.nextZ,he--),oe?oe.nextZ=V:P=V,V.prevZ=oe,oe=V;Z=J}oe.nextZ=null,R*=2}while(B>1)}(I)}(i,n,l,p);let f=i;for(;i.prev!==i.next;){let g=i.prev,x=i.next;if(p?l0(i,n,l,p):o0(i))t.push(g.i,i.i,x.i),ul(i),i=x.next,f=x.next;else if((i=x)===f){d?d===1?ll(i=c0(ts(i),t),t,r,n,l,p,2):d===2&&u0(i,t,r,n,l,p):ll(ts(i),t,r,n,l,p,1);break}}}function o0(i){let t=i.prev,r=i,n=i.next;if(hi(t,r,n)>=0)return!1;let l=t.x,p=r.x,d=n.x,f=t.y,g=r.y,x=n.y,S=l<p?l<d?l:d:p<d?p:d,T=f<g?f<x?f:x:g<x?g:x,I=l>p?l>d?l:d:p>d?p:d,P=f>g?f>x?f:x:g>x?g:x,B=n.next;for(;B!==t;){if(B.x>=S&&B.x<=I&&B.y>=T&&B.y<=P&&Hs(l,f,p,g,d,x,B.x,B.y)&&hi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function l0(i,t,r,n){let l=i.prev,p=i,d=i.next;if(hi(l,p,d)>=0)return!1;let f=l.x,g=p.x,x=d.x,S=l.y,T=p.y,I=d.y,P=f<g?f<x?f:x:g<x?g:x,B=S<T?S<I?S:I:T<I?T:I,R=f>g?f>x?f:x:g>x?g:x,V=S>T?S>I?S:I:T>I?T:I,Z=Gu(P,B,t,r,n),oe=Gu(R,V,t,r,n),J=i.prevZ,ae=i.nextZ;for(;J&&J.z>=Z&&ae&&ae.z<=oe;){if(J.x>=P&&J.x<=R&&J.y>=B&&J.y<=V&&J!==l&&J!==d&&Hs(f,S,g,T,x,I,J.x,J.y)&&hi(J.prev,J,J.next)>=0||(J=J.prevZ,ae.x>=P&&ae.x<=R&&ae.y>=B&&ae.y<=V&&ae!==l&&ae!==d&&Hs(f,S,g,T,x,I,ae.x,ae.y)&&hi(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;J&&J.z>=Z;){if(J.x>=P&&J.x<=R&&J.y>=B&&J.y<=V&&J!==l&&J!==d&&Hs(f,S,g,T,x,I,J.x,J.y)&&hi(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ae&&ae.z<=oe;){if(ae.x>=P&&ae.x<=R&&ae.y>=B&&ae.y<=V&&ae!==l&&ae!==d&&Hs(f,S,g,T,x,I,ae.x,ae.y)&&hi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function c0(i,t){let r=i;do{let n=r.prev,l=r.next.next;!Tc(n,l)&&Mp(n,r,r.next,l)&&cl(n,l)&&cl(l,n)&&(t.push(n.i,r.i,l.i),ul(r),ul(r.next),r=i=l),r=r.next}while(r!==i);return ts(r)}function u0(i,t,r,n,l,p){let d=i;do{let f=d.next.next;for(;f!==d.prev;){if(d.i!==f.i&&m0(d,f)){let g=Pp(d,f);return d=ts(d,d.next),g=ts(g,g.next),ll(d,t,r,n,l,p,0),void ll(g,t,r,n,l,p,0)}f=f.next}d=d.next}while(d!==i)}function h0(i,t){return i.x-t.x}function p0(i,t){let r=function(l,p){let d=p,f=l.x,g=l.y,x,S=-1/0;do{if(g<=d.y&&g>=d.next.y&&d.next.y!==d.y){let R=d.x+(g-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(R<=f&&R>S&&(S=R,x=d.x<d.next.x?d:d.next,R===f))return x}d=d.next}while(d!==p);if(!x)return null;let T=x,I=x.x,P=x.y,B=1/0;d=x;do{if(f>=d.x&&d.x>=I&&f!==d.x&&Hs(g<P?f:S,g,I,P,g<P?S:f,g,d.x,d.y)){let R=Math.abs(g-d.y)/(f-d.x);cl(d,l)&&(R<B||R===B&&(d.x>x.x||d.x===x.x&&d0(x,d)))&&(x=d,B=R)}d=d.next}while(d!==T);return x}(i,t);if(!r)return t;let n=Pp(r,i);return ts(n,n.next),ts(r,r.next)}function d0(i,t){return hi(i.prev,i,t.prev)<0&&hi(t.next,i,i.next)<0}function Gu(i,t,r,n,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f0(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Hs(i,t,r,n,l,p,d,f){return(l-d)*(t-f)>=(i-d)*(p-f)&&(i-d)*(n-f)>=(r-d)*(t-f)&&(r-d)*(p-f)>=(l-d)*(n-f)}function m0(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,n){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==n.i&&l.next.i!==n.i&&Mp(l,l.next,r,n))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(cl(i,t)&&cl(t,i)&&function(r,n){let l=r,p=!1,d=(r.x+n.x)/2,f=(r.y+n.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&d<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(p=!p),l=l.next;while(l!==r);return p}(i,t)&&(hi(i.prev,i,t.prev)||hi(i,t.prev,t))||Tc(i,t)&&hi(i.prev,i,i.next)>0&&hi(t.prev,t,t.next)>0)}function hi(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Tc(i,t){return i.x===t.x&&i.y===t.y}function Mp(i,t,r,n){let l=Dc(hi(i,t,r)),p=Dc(hi(i,t,n)),d=Dc(hi(r,n,i)),f=Dc(hi(r,n,t));return l!==p&&d!==f||!(l!==0||!Cc(i,r,t))||!(p!==0||!Cc(i,n,t))||!(d!==0||!Cc(r,i,n))||!(f!==0||!Cc(r,t,n))}function Cc(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Dc(i){return i>0?1:i<0?-1:0}function cl(i,t){return hi(i.prev,i,i.next)<0?hi(i,t,i.next)>=0&&hi(i,i.prev,t)>=0:hi(i,t,i.prev)<0||hi(i,i.next,t)<0}function Pp(i,t){let r=Zu(i.i,i.x,i.y),n=Zu(t.i,t.x,t.y),l=i.next,p=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,n.next=r,r.prev=n,p.next=n,n.prev=p,n}function zp(i,t,r,n){let l=Zu(i,t,r);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function ul(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Zu(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hu(i,t,r){let n=r.patternDependencies,l=!1;for(let p of t){let d=p.paint.get(`${i}-pattern`);d.isConstant()||(l=!0);let f=d.constantOr(null);f&&(l=!0,n[f.to]=!0,n[f.from]=!0)}return l}function Wu(i,t,r,n,l){let p=l.patternDependencies;for(let d of t){let f=d.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let g=f.evaluate({zoom:n-1},r,{},l.availableImages),x=f.evaluate({zoom:n},r,{},l.availableImages),S=f.evaluate({zoom:n+1},r,{},l.availableImages);g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,S=S&&S.name?S.name:S,p[g]=!0,p[x]=!0,p[S]=!0,r.patterns[d.id]={min:g,mid:x,max:S}}}return r}class Xu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kr,this.indexArray=new qr,this.indexArray2=new ki,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new vt,this.segments2=new vt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){this.hasPattern=Hu("fill",this.layers,r);let l=this.layers[0].layout.get("fill-sort-key"),p=!l.isConstant(),d=[];for(let{feature:f,id:g,index:x,sourceLayerIndex:S}of t){let T=this.layers[0]._featureFilter.needGeometry,I=es(f,T);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),I,n))continue;let P=p?l.evaluate(I,{},n,r.availableImages):void 0,B={id:g,properties:f.properties,type:f.type,sourceLayerIndex:S,index:x,geometry:T?I.geometry:Qn(f),patterns:{},sortKey:P};d.push(B)}p&&d.sort((f,g)=>f.sortKey-g.sortKey);for(let f of d){let{geometry:g,index:x,sourceLayerIndex:S}=f;if(this.hasPattern){let T=Wu("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,g,x,n,{});r.featureIndex.insert(t[x].feature,g,x,S,this.index)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}addFeatures(t,r,n){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,s0),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,n,l,p){for(let d of ys(r,500)){let f=0;for(let P of d)f+=P.length;let g=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),x=g.vertexLength,S=[],T=[];for(let P of d){if(P.length===0)continue;P!==d[0]&&T.push(S.length/2);let B=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),R=B.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(R+P.length-1,R),S.push(P[0].x),S.push(P[0].y);for(let V=1;V<P.length;V++)this.layoutVertexArray.emplaceBack(P[V].x,P[V].y),this.indexArray2.emplaceBack(R+V-1,R+V),S.push(P[V].x),S.push(P[V].y);B.vertexLength+=P.length,B.primitiveLength+=P.length}let I=Ip(S,T);for(let P=0;P<I.length;P+=3)this.indexArray.emplaceBack(x+I[P],x+I[P+1],x+I[P+2]);g.vertexLength+=f,g.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,p,l)}}let Lp,Bp;Pe("FillBucket",Xu,{omit:["layers","patternFeatures"]});var g0={get paint(){return Bp=Bp||new h({"fill-antialias":new Le(ce.paint_fill["fill-antialias"]),"fill-opacity":new He(ce.paint_fill["fill-opacity"]),"fill-color":new He(ce.paint_fill["fill-color"]),"fill-outline-color":new He(ce.paint_fill["fill-outline-color"]),"fill-translate":new Le(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Le(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fs(ce.paint_fill["fill-pattern"])})},get layout(){return Lp=Lp||new h({"fill-sort-key":new He(ce.layout_fill["fill-sort-key"])})}};class y0 extends a{constructor(t){super(t,g0)}recalculate(t,r){super.recalculate(t,r);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Xu(t)}queryRadius(){return Sc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,n,l,p,d,f){return yp(Ac(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,f),l)}isTileClipped(){return!0}}let _0=m([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),v0=m([{name:"a_centroid",components:2,type:"Int16"}],4),{members:x0}=_0;var wn={},b0=ee,Rp=Ws;function Ws(i,t,r,n,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=l,i.readFields(w0,this,t)}function w0(i,t,r){i==1?t.id=r.readVarint():i==2?function(n,l){for(var p=n.readVarint()+n.pos;n.pos<p;){var d=l._keys[n.readVarint()],f=l._values[n.readVarint()];l.properties[d]=f}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function S0(i){for(var t,r,n=0,l=0,p=i.length,d=p-1;l<p;d=l++)n+=((r=i[d]).x-(t=i[l]).x)*(t.y+r.y);return n}Ws.types=["Unknown","Point","LineString","Polygon"],Ws.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,n=1,l=0,p=0,d=0,f=[];i.pos<r;){if(l<=0){var g=i.readVarint();n=7&g,l=g>>3}if(l--,n===1||n===2)p+=i.readSVarint(),d+=i.readSVarint(),n===1&&(t&&f.push(t),t=[]),t.push(new b0(p,d));else{if(n!==7)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&f.push(t),f},Ws.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,n=0,l=0,p=0,d=1/0,f=-1/0,g=1/0,x=-1/0;i.pos<t;){if(n<=0){var S=i.readVarint();r=7&S,n=S>>3}if(n--,r===1||r===2)(l+=i.readSVarint())<d&&(d=l),l>f&&(f=l),(p+=i.readSVarint())<g&&(g=p),p>x&&(x=p);else if(r!==7)throw new Error("unknown command "+r)}return[d,g,f,x]},Ws.prototype.toGeoJSON=function(i,t,r){var n,l,p=this.extent*Math.pow(2,r),d=this.extent*i,f=this.extent*t,g=this.loadGeometry(),x=Ws.types[this.type];function S(P){for(var B=0;B<P.length;B++){var R=P[B];P[B]=[360*(R.x+d)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+f)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(n=0;n<g.length;n++)T[n]=g[n][0];S(g=T);break;case 2:for(n=0;n<g.length;n++)S(g[n]);break;case 3:for(g=function(P){var B=P.length;if(B<=1)return[P];for(var R,V,Z=[],oe=0;oe<B;oe++){var J=S0(P[oe]);J!==0&&(V===void 0&&(V=J<0),V===J<0?(R&&Z.push(R),R=[P[oe]]):R.push(P[oe]))}return R&&Z.push(R),Z}(g),n=0;n<g.length;n++)for(l=0;l<g[n].length;l++)S(g[n][l])}g.length===1?g=g[0]:x="Multi"+x;var I={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(I.id=this.id),I};var A0=Rp,Fp=Op;function Op(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(E0,this,t),this.length=this._features.length}function E0(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(n){for(var l=null,p=n.readVarint()+n.pos;n.pos<p;){var d=n.readVarint()>>3;l=d===1?n.readString():d===2?n.readFloat():d===3?n.readDouble():d===4?n.readVarint64():d===5?n.readVarint():d===6?n.readSVarint():d===7?n.readBoolean():null}return l}(r))}Op.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new A0(this._pbf,t,this.extent,this._keys,this._values)};var T0=Fp;function C0(i,t,r){if(i===3){var n=new T0(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}wn.VectorTile=function(i,t){this.layers=i.readFields(C0,{},t)},wn.VectorTileFeature=Rp,wn.VectorTileLayer=Fp;let D0=wn.VectorTileFeature.types,Ku=Math.pow(2,13);function hl(i,t,r,n,l,p,d,f){i.emplaceBack(t,r,2*Math.floor(n*Ku)+d,l*Ku*2,p*Ku*2,Math.round(f))}class Ju{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new gn,this.centroidVertexArray=new Li,this.indexArray=new qr,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new vt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){this.features=[],this.hasPattern=Hu("fill-extrusion",this.layers,r);for(let{feature:l,id:p,index:d,sourceLayerIndex:f}of t){let g=this.layers[0]._featureFilter.needGeometry,x=es(l,g);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),x,n))continue;let S={id:p,sourceLayerIndex:f,index:d,geometry:g?x.geometry:Qn(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Wu("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,d,n,{}),r.featureIndex.insert(l,S.geometry,d,f,this.index,!0)}}addFeatures(t,r,n){for(let l of this.features){let{geometry:p}=l;this.addFeature(l,p,l.index,r,n)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,x0),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,v0.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,n,l,p){for(let d of ys(r,500)){let f={x:0,y:0,vertexCount:0},g=0;for(let B of d)g+=B.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let B of d){if(B.length===0||k0(B))continue;let R=0;for(let V=0;V<B.length;V++){let Z=B[V];if(V>=1){let oe=B[V-1];if(!I0(Z,oe)){x.vertexLength+4>vt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let J=Z.sub(oe)._perp()._unit(),ae=oe.dist(Z);R+ae>32768&&(R=0),hl(this.layoutVertexArray,Z.x,Z.y,J.x,J.y,0,0,R),hl(this.layoutVertexArray,Z.x,Z.y,J.x,J.y,0,1,R),f.x+=2*Z.x,f.y+=2*Z.y,f.vertexCount+=2,R+=ae,hl(this.layoutVertexArray,oe.x,oe.y,J.x,J.y,0,0,R),hl(this.layoutVertexArray,oe.x,oe.y,J.x,J.y,0,1,R),f.x+=2*oe.x,f.y+=2*oe.y,f.vertexCount+=2;let he=x.vertexLength;this.indexArray.emplaceBack(he,he+2,he+1),this.indexArray.emplaceBack(he+1,he+2,he+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>vt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),D0[t.type]!=="Polygon")continue;let S=[],T=[],I=x.vertexLength;for(let B of d)if(B.length!==0){B!==d[0]&&T.push(S.length/2);for(let R=0;R<B.length;R++){let V=B[R];hl(this.layoutVertexArray,V.x,V.y,0,0,1,1,0),f.x+=V.x,f.y+=V.y,f.vertexCount+=1,S.push(V.x),S.push(V.y)}}let P=Ip(S,T);for(let B=0;B<P.length;B+=3)this.indexArray.emplaceBack(I+P[B],I+P[B+2],I+P[B+1]);x.primitiveLength+=P.length/3,x.vertexLength+=g;for(let B=0;B<f.vertexCount;B++){let R=Math.floor(f.x/f.vertexCount),V=Math.floor(f.y/f.vertexCount);this.centroidVertexArray.emplaceBack(R,V)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,p,l)}}function I0(i,t){return i.x===t.x&&(i.x<0||i.x>gi)||i.y===t.y&&(i.y<0||i.y>gi)}function k0(i){return i.every(t=>t.x<0)||i.every(t=>t.x>gi)||i.every(t=>t.y<0)||i.every(t=>t.y>gi)}let Np;Pe("FillExtrusionBucket",Ju,{omit:["layers","features"]});var M0={get paint(){return Np=Np||new h({"fill-extrusion-opacity":new Le(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new He(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Le(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Le(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fs(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new He(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new He(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Le(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class P0 extends a{constructor(t){super(t,M0)}createBucket(t){return new Ju(t)}queryRadius(){return Sc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,n,l,p,d,f,g){let x=Ac(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,f),S=this.paint.get("fill-extrusion-height").evaluate(r,n),T=this.paint.get("fill-extrusion-base").evaluate(r,n),I=function(B,R,V,Z){let oe=[];for(let J of B){let ae=[J.x,J.y,0,1];Ec(ae,ae,R),oe.push(new ne(ae[0]/ae[3],ae[1]/ae[3]))}return oe}(x,g),P=function(B,R,V,Z){let oe=[],J=[],ae=Z[8]*R,he=Z[9]*R,ye=Z[10]*R,Ie=Z[11]*R,Ze=Z[8]*V,Ce=Z[9]*V,Ee=Z[10]*V,Oe=Z[11]*V;for(let ze of B){let Me=[],fe=[];for(let Ne of ze){let Fe=Ne.x,Ye=Ne.y,Vt=Z[0]*Fe+Z[4]*Ye+Z[12],Ot=Z[1]*Fe+Z[5]*Ye+Z[13],Ei=Z[2]*Fe+Z[6]*Ye+Z[14],Jr=Z[3]*Fe+Z[7]*Ye+Z[15],Fi=Ei+ye,Ti=Jr+Ie,tr=Vt+Ze,ir=Ot+Ce,rr=Ei+Ee,si=Jr+Oe,Ci=new ne((Vt+ae)/Ti,(Ot+he)/Ti);Ci.z=Fi/Ti,Me.push(Ci);let Gi=new ne(tr/si,ir/si);Gi.z=rr/si,fe.push(Gi)}oe.push(Me),J.push(fe)}return[oe,J]}(l,T,S,g);return function(B,R,V){let Z=1/0;yp(V,R)&&(Z=qp(V,R[0]));for(let oe=0;oe<R.length;oe++){let J=R[oe],ae=B[oe];for(let he=0;he<J.length-1;he++){let ye=J[he],Ie=[ye,J[he+1],ae[he+1],ae[he],ye];gp(V,Ie)&&(Z=Math.min(Z,qp(V,Ie)))}}return Z!==1/0&&Z}(P[0],P[1],I)}}function pl(i,t){return i.x*t.x+i.y*t.y}function qp(i,t){if(i.length===1){let r=0,n=t[r++],l;for(;!l||n.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){let p=t[r],d=i[0],f=l.sub(n),g=p.sub(n),x=d.sub(n),S=pl(f,f),T=pl(f,g),I=pl(g,g),P=pl(x,f),B=pl(x,g),R=S*I-T*T,V=(I*P-T*B)/R,Z=(S*B-T*P)/R,oe=n.z*(1-V-Z)+l.z*V+p.z*Z;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(let n of t)r=Math.min(r,n.z);return r}}let z0=m([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:L0}=z0,B0=m([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:R0}=B0,F0=wn.VectorTileFeature.types,O0=Math.cos(Math.PI/180*37.5),Vp=Math.pow(2,14)/.5;class Yu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ns,this.layoutVertexArray2=new yn,this.indexArray=new qr,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,n){this.hasPattern=Hu("line",this.layers,r);let l=this.layers[0].layout.get("line-sort-key"),p=!l.isConstant(),d=[];for(let{feature:f,id:g,index:x,sourceLayerIndex:S}of t){let T=this.layers[0]._featureFilter.needGeometry,I=es(f,T);if(!this.layers[0]._featureFilter.filter(new Wt(this.zoom),I,n))continue;let P=p?l.evaluate(I,{},n):void 0,B={id:g,properties:f.properties,type:f.type,sourceLayerIndex:S,index:x,geometry:T?I.geometry:Qn(f),patterns:{},sortKey:P};d.push(B)}p&&d.sort((f,g)=>f.sortKey-g.sortKey);for(let f of d){let{geometry:g,index:x,sourceLayerIndex:S}=f;if(this.hasPattern){let T=Wu("line",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,g,x,n,{});r.featureIndex.insert(t[x].feature,g,x,S,this.index)}}update(t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,n)}addFeatures(t,r,n){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,R0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,L0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,n,l,p){let d=this.layers[0].layout,f=d.get("line-join").evaluate(t,{}),g=d.get("line-cap"),x=d.get("line-miter-limit"),S=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let T of r)this.addLine(T,t,f,g,x,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,p,l)}addLine(t,r,n,l,p,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Z=0;Z<t.length-1;Z++)this.totalDistance+=t[Z].dist(t[Z+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let f=F0[r.type]==="Polygon",g=t.length;for(;g>=2&&t[g-1].equals(t[g-2]);)g--;let x=0;for(;x<g-1&&t[x].equals(t[x+1]);)x++;if(g<(f?3:2))return;n==="bevel"&&(p=1.05);let S=this.overscaling<=16?15*gi/(512*this.overscaling):0,T=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray),I,P,B,R,V;this.e1=this.e2=-1,f&&(I=t[g-2],V=t[x].sub(I)._unit()._perp());for(let Z=x;Z<g;Z++){if(B=Z===g-1?f?t[x+1]:void 0:t[Z+1],B&&t[Z].equals(B))continue;V&&(R=V),I&&(P=I),I=t[Z],V=B?B.sub(I)._unit()._perp():R,R=R||V;let oe=R.add(V);oe.x===0&&oe.y===0||oe._unit();let J=R.x*V.x+R.y*V.y,ae=oe.x*V.x+oe.y*V.y,he=ae!==0?1/ae:1/0,ye=2*Math.sqrt(2-2*ae),Ie=ae<O0&&P&&B,Ze=R.x*V.y-R.y*V.x>0;if(Ie&&Z>x){let Oe=I.dist(P);if(Oe>2*S){let ze=I.sub(I.sub(P)._mult(S/Oe)._round());this.updateDistance(P,ze),this.addCurrentVertex(ze,R,0,0,T),P=ze}}let Ce=P&&B,Ee=Ce?n:f?"butt":l;if(Ce&&Ee==="round"&&(he<d?Ee="miter":he<=2&&(Ee="fakeround")),Ee==="miter"&&he>p&&(Ee="bevel"),Ee==="bevel"&&(he>2&&(Ee="flipbevel"),he<p&&(Ee="miter")),P&&this.updateDistance(P,I),Ee==="miter")oe._mult(he),this.addCurrentVertex(I,oe,0,0,T);else if(Ee==="flipbevel"){if(he>100)oe=V.mult(-1);else{let Oe=he*R.add(V).mag()/R.sub(V).mag();oe._perp()._mult(Oe*(Ze?-1:1))}this.addCurrentVertex(I,oe,0,0,T),this.addCurrentVertex(I,oe.mult(-1),0,0,T)}else if(Ee==="bevel"||Ee==="fakeround"){let Oe=-Math.sqrt(he*he-1),ze=Ze?Oe:0,Me=Ze?0:Oe;if(P&&this.addCurrentVertex(I,R,ze,Me,T),Ee==="fakeround"){let fe=Math.round(180*ye/Math.PI/20);for(let Ne=1;Ne<fe;Ne++){let Fe=Ne/fe;if(Fe!==.5){let Vt=Fe-.5;Fe+=Fe*Vt*(Fe-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Vt*Vt+(.848013+J*(.215638*J-1.06021)))}let Ye=V.sub(R)._mult(Fe)._add(R)._unit()._mult(Ze?-1:1);this.addHalfVertex(I,Ye.x,Ye.y,!1,Ze,0,T)}}B&&this.addCurrentVertex(I,V,-ze,-Me,T)}else if(Ee==="butt")this.addCurrentVertex(I,oe,0,0,T);else if(Ee==="square"){let Oe=P?1:-1;this.addCurrentVertex(I,oe,Oe,Oe,T)}else Ee==="round"&&(P&&(this.addCurrentVertex(I,R,0,0,T),this.addCurrentVertex(I,R,1,1,T,!0)),B&&(this.addCurrentVertex(I,V,-1,-1,T,!0),this.addCurrentVertex(I,V,0,0,T)));if(Ie&&Z<g-1){let Oe=I.dist(B);if(Oe>2*S){let ze=I.add(B.sub(I)._mult(S/Oe)._round());this.updateDistance(I,ze),this.addCurrentVertex(ze,V,0,0,T),I=ze}}}}addCurrentVertex(t,r,n,l,p,d=!1){let f=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*n,r.y-r.x*n,d,!1,n,p),this.addHalfVertex(t,f,g,d,!0,-l,p),this.distance>Vp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,n,l,p,d))}addHalfVertex({x:t,y:r},n,l,p,d,f,g){let x=.5*(this.lineClips?this.scaledDistance*(Vp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(d?1:0),Math.round(63*n)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let S=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),g.primitiveLength++),d?this.e2=S:this.e1=S}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Up,jp;Pe("LineBucket",Yu,{omit:["layers","patternFeatures"]});var $p={get paint(){return jp=jp||new h({"line-opacity":new He(ce.paint_line["line-opacity"]),"line-color":new He(ce.paint_line["line-color"]),"line-translate":new Le(ce.paint_line["line-translate"]),"line-translate-anchor":new Le(ce.paint_line["line-translate-anchor"]),"line-width":new He(ce.paint_line["line-width"]),"line-gap-width":new He(ce.paint_line["line-gap-width"]),"line-offset":new He(ce.paint_line["line-offset"]),"line-blur":new He(ce.paint_line["line-blur"]),"line-dasharray":new Os(ce.paint_line["line-dasharray"]),"line-pattern":new Fs(ce.paint_line["line-pattern"]),"line-gradient":new il(ce.paint_line["line-gradient"])})},get layout(){return Up=Up||new h({"line-cap":new Le(ce.layout_line["line-cap"]),"line-join":new He(ce.layout_line["line-join"]),"line-miter-limit":new Le(ce.layout_line["line-miter-limit"]),"line-round-limit":new Le(ce.layout_line["line-round-limit"]),"line-sort-key":new He(ce.layout_line["line-sort-key"])})}};class N0 extends He{possiblyEvaluate(t,r){return r=new Wt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,n,l){return r=bi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,n,l)}}let Ic;class q0 extends a{constructor(t){super(t,$p),this.gradientVersion=0,Ic||(Ic=new N0($p.paint.properties["line-width"].specification),Ic.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!function(n){return n._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Ka,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ic.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Yu(t)}queryRadius(t){let r=t,n=Gp(nl("line-width",this,r),nl("line-gap-width",this,r)),l=nl("line-offset",this,r);return n/2+Math.abs(l)+Sc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,n,l,p,d,f){let g=Ac(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,f),x=f/2*Gp(this.paint.get("line-width").evaluate(r,n),this.paint.get("line-gap-width").evaluate(r,n)),S=this.paint.get("line-offset").evaluate(r,n);return S&&(l=function(T,I){let P=[];for(let B=0;B<T.length;B++){let R=T[B],V=[];for(let Z=0;Z<R.length;Z++){let oe=R[Z-1],J=R[Z],ae=R[Z+1],he=Z===0?new ne(0,0):J.sub(oe)._unit()._perp(),ye=Z===R.length-1?new ne(0,0):ae.sub(J)._unit()._perp(),Ie=he._add(ye)._unit(),Ze=Ie.x*ye.x+Ie.y*ye.y;Ze!==0&&Ie._mult(1/Ze),V.push(Ie._mult(I)._add(J))}P.push(V)}return P}(l,S*f)),function(T,I,P){for(let B=0;B<I.length;B++){let R=I[B];if(T.length>=3){for(let V=0;V<R.length;V++)if(Gs(T,R[V]))return!0}if(Xm(T,R,P))return!0}return!1}(g,l,x)}isTileClipped(){return!0}}function Gp(i,t){return t>0?t+2*i:i}let V0=m([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),U0=m([{name:"a_projected_pos",components:3,type:"Float32"}],4);m([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let j0=m([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);m([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Zp=m([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$0=m([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function G0(i,t,r){return i.sections.forEach(n=>{n.text=function(l,p,d){let f=p.layout.get("text-transform").evaluate(d,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),pr.applyArabicShaping&&(l=pr.applyArabicShaping(l)),l}(n.text,t,r)}),i}m([{name:"triangle",components:3,type:"Uint16"}]),m([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),m([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),m([{type:"Float32",name:"offsetX"}]),m([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),m([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let dl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var vi=24,Hp=Ft,Wp=function(i,t,r,n,l){var p,d,f=8*l-n-1,g=(1<<f)-1,x=g>>1,S=-7,T=r?l-1:0,I=r?-1:1,P=i[t+T];for(T+=I,p=P&(1<<-S)-1,P>>=-S,S+=f;S>0;p=256*p+i[t+T],T+=I,S-=8);for(d=p&(1<<-S)-1,p>>=-S,S+=n;S>0;d=256*d+i[t+T],T+=I,S-=8);if(p===0)p=1-x;else{if(p===g)return d?NaN:1/0*(P?-1:1);d+=Math.pow(2,n),p-=x}return(P?-1:1)*d*Math.pow(2,p-n)},Xp=function(i,t,r,n,l,p){var d,f,g,x=8*p-l-1,S=(1<<x)-1,T=S>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=n?0:p-1,B=n?1:-1,R=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,d=S):(d=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-d))<1&&(d--,g*=2),(t+=d+T>=1?I/g:I*Math.pow(2,1-T))*g>=2&&(d++,g/=2),d+T>=S?(f=0,d=S):d+T>=1?(f=(t*g-1)*Math.pow(2,l),d+=T):(f=t*Math.pow(2,T-1)*Math.pow(2,l),d=0));l>=8;i[r+P]=255&f,P+=B,f/=256,l-=8);for(d=d<<l|f,x+=l;x>0;i[r+P]=255&d,P+=B,d/=256,x-=8);i[r+P-B]|=128*R};function Ft(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ft.Varint=0,Ft.Fixed64=1,Ft.Bytes=2,Ft.Fixed32=5;var Qu=4294967296,Kp=1/Qu,Jp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function qa(i){return i.type===Ft.Bytes?i.readVarint()+i.pos:i.pos+1}function Xs(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Yp(i,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var l=r.pos-1;l>=i;l--)r.buf[l+n]=r.buf[l]}function Z0(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function H0(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function W0(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function X0(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function K0(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function J0(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function Y0(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function Q0(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function eg(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function kc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Ks(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function Qp(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Ft.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),l=n>>3,p=this.pos;this.type=7&n,i(l,t,this),this.pos===p&&this.skip(n)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=kc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Qp(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=kc(this.buf,this.pos)+kc(this.buf,this.pos+4)*Qu;return this.pos+=8,i},readSFixed64:function(){var i=kc(this.buf,this.pos)+Qp(this.buf,this.pos+4)*Qu;return this.pos+=8,i},readFloat:function(){var i=Wp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Wp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(l,p,d){var f,g,x=d.buf;if(f=(112&(g=x[d.pos++]))>>4,g<128||(f|=(127&(g=x[d.pos++]))<<3,g<128)||(f|=(127&(g=x[d.pos++]))<<10,g<128)||(f|=(127&(g=x[d.pos++]))<<17,g<128)||(f|=(127&(g=x[d.pos++]))<<24,g<128)||(f|=(1&(g=x[d.pos++]))<<31,g<128))return Xs(l,f,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Jp?function(r,n,l){return Jp.decode(r.subarray(n,l))}(this.buf,t,i):function(r,n,l){for(var p="",d=n;d<l;){var f,g,x,S=r[d],T=null,I=S>239?4:S>223?3:S>191?2:1;if(d+I>l)break;I===1?S<128&&(T=S):I===2?(192&(f=r[d+1]))==128&&(T=(31&S)<<6|63&f)<=127&&(T=null):I===3?(g=r[d+2],(192&(f=r[d+1]))==128&&(192&g)==128&&((T=(15&S)<<12|(63&f)<<6|63&g)<=2047||T>=55296&&T<=57343)&&(T=null)):I===4&&(g=r[d+2],x=r[d+3],(192&(f=r[d+1]))==128&&(192&g)==128&&(192&x)==128&&((T=(15&S)<<18|(63&f)<<12|(63&g)<<6|63&x)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,I=1):T>65535&&(T-=65536,p+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),p+=String.fromCharCode(T),d+=I}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Ft.Bytes)return i.push(this.readVarint(t));var r=qa(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Ft.Bytes)return i.push(this.readSVarint());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ft.Bytes)return i.push(this.readBoolean());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ft.Bytes)return i.push(this.readFloat());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ft.Bytes)return i.push(this.readDouble());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ft.Bytes)return i.push(this.readFixed32());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ft.Bytes)return i.push(this.readSFixed32());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ft.Bytes)return i.push(this.readFixed64());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ft.Bytes)return i.push(this.readSFixed64());var t=qa(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Ft.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ft.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ft.Fixed32)this.pos+=4;else{if(t!==Ft.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ks(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ks(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ks(this.buf,-1&i,this.pos),Ks(this.buf,Math.floor(i*Kp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ks(this.buf,-1&i,this.pos),Ks(this.buf,Math.floor(i*Kp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var n,l;if(t>=0?(n=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,d,f){f.buf[f.pos++]=127&p|128,p>>>=7,f.buf[f.pos++]=127&p|128,p>>>=7,f.buf[f.pos++]=127&p|128,p>>>=7,f.buf[f.pos++]=127&p|128,f.buf[f.pos]=127&(p>>>=7)}(n,0,r),function(p,d){var f=(7&p)<<4;d.buf[d.pos++]|=f|((p>>>=3)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p|((p>>>=7)?128:0),p&&(d.buf[d.pos++]=127&p)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(n,l,p){for(var d,f,g=0;g<l.length;g++){if((d=l.charCodeAt(g))>55295&&d<57344){if(!f){d>56319||g+1===l.length?(n[p++]=239,n[p++]=191,n[p++]=189):f=d;continue}if(d<56320){n[p++]=239,n[p++]=191,n[p++]=189,f=d;continue}d=f-55296<<10|d-56320|65536,f=null}else f&&(n[p++]=239,n[p++]=191,n[p++]=189,f=null);d<128?n[p++]=d:(d<2048?n[p++]=d>>6|192:(d<65536?n[p++]=d>>12|224:(n[p++]=d>>18|240,n[p++]=d>>12&63|128),n[p++]=d>>6&63|128),n[p++]=63&d|128)}return p}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Yp(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Xp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Xp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var n=this.pos-r;n>=128&&Yp(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,t,r){this.writeTag(i,Ft.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Z0,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,H0,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,K0,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,W0,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,X0,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,J0,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Y0,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Q0,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,eg,t)},writeBytesField:function(i,t){this.writeTag(i,Ft.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Ft.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Ft.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Ft.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Ft.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Ft.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Ft.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Ft.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Ft.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Ft.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var eh=Q(Hp);let th=3;function tg(i,t,r){i===1&&r.readMessage(ig,t)}function ig(i,t,r){if(i===3){let{id:n,bitmap:l,width:p,height:d,left:f,top:g,advance:x}=r.readMessage(rg,{});t.push({id:n,bitmap:new ol({width:p+2*th,height:d+2*th},l),metrics:{width:p,height:d,left:f,top:g,advance:x}})}}function rg(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}let ed=th;function td(i){let t=0,r=0;for(let d of i)t+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,f)=>f.h-d.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],l=0,p=0;for(let d of i)for(let f=n.length-1;f>=0;f--){let g=n[f];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,p=Math.max(p,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===g.w&&d.h===g.h){let x=n.pop();f<n.length&&(n[f]=x)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(n.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:l,h:p,fill:t/(l*p)||0}}let fr=1;class ih{constructor(t,{pixelRatio:r,version:n,stretchX:l,stretchY:p,content:d,textFitWidth:f,textFitHeight:g}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=p,this.content=d,this.version=n,this.textFitWidth=f,this.textFitHeight=g}get tl(){return[this.paddedRect.x+fr,this.paddedRect.y+fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-fr,this.paddedRect.y+this.paddedRect.h-fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*fr)/this.pixelRatio,(this.paddedRect.h-2*fr)/this.pixelRatio]}}class id{constructor(t,r){let n={},l={};this.haveRenderCallbacks=[];let p=[];this.addImages(t,n,p),this.addImages(r,l,p);let{w:d,h:f}=td(p),g=new Vr({width:d||1,height:f||1});for(let x in t){let S=t[x],T=n[x].paddedRect;Vr.copy(S.data,g,{x:0,y:0},{x:T.x+fr,y:T.y+fr},S.data)}for(let x in r){let S=r[x],T=l[x].paddedRect,I=T.x+fr,P=T.y+fr,B=S.data.width,R=S.data.height;Vr.copy(S.data,g,{x:0,y:0},{x:I,y:P},S.data),Vr.copy(S.data,g,{x:0,y:R-1},{x:I,y:P-1},{width:B,height:1}),Vr.copy(S.data,g,{x:0,y:0},{x:I,y:P+R},{width:B,height:1}),Vr.copy(S.data,g,{x:B-1,y:0},{x:I-1,y:P},{width:1,height:R}),Vr.copy(S.data,g,{x:0,y:0},{x:I+B,y:P},{width:1,height:R})}this.image=g,this.iconPositions=n,this.patternPositions=l}addImages(t,r,n){for(let l in t){let p=t[l],d={x:0,y:0,w:p.data.width+2*fr,h:p.data.height+2*fr};n.push(d),r[l]=new ih(d,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),r)}patchUpdatedImage(t,r,n){if(!t||!r||t.version===r.version)return;t.version=r.version;let[l,p]=t.tl;n.update(r.data,void 0,{x:l,y:p})}}var Sn;Pe("ImagePosition",ih),Pe("ImageAtlas",id),w.ah=void 0,(Sn=w.ah||(w.ah={}))[Sn.none=0]="none",Sn[Sn.horizontal=1]="horizontal",Sn[Sn.vertical=2]="vertical",Sn[Sn.horizontalOnly=3]="horizontalOnly";let fl=-17;class ml{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){let n=new ml;return n.scale=t||1,n.fontStack=r,n}static forImage(t){let r=new ml;return r.imageName=t,r}}class Js{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let n=new Js;for(let l=0;l<t.sections.length;l++){let p=t.sections[l];p.image?n.addImageSection(p):n.addTextSection(p,r)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let n=0;n<t.length;n++){let l=t.charCodeAt(n+1)||null,p=t.charCodeAt(n-1)||null;r+=l&&gc(l)&&!dl[t[n+1]]||p&&gc(p)&&!dl[t[n-1]]||!dl[t[n]]?t[n]:dl[t[n]]}return r}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&Pc[this.text.charCodeAt(n)];n++)t++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&Pc[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let n=new Js;return n.text=this.text.substring(t,r),n.sectionIndex=this.sectionIndex.slice(t,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(ml.forText(t.scale,t.fontStack||r));let n=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(n)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void et("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(ml.forImage(r)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mc(i,t,r,n,l,p,d,f,g,x,S,T,I,P,B){let R=Js.fromFeature(i,l),V;T===w.ah.vertical&&R.verticalizePunctuation();let{processBidirectionalText:Z,processStyledBidirectionalText:oe}=pr;if(Z&&R.sections.length===1){V=[];let he=Z(R.toString(),rh(R,x,p,t,n,P));for(let ye of he){let Ie=new Js;Ie.text=ye,Ie.sections=R.sections;for(let Ze=0;Ze<ye.length;Ze++)Ie.sectionIndex.push(0);V.push(Ie)}}else if(oe){V=[];let he=oe(R.text,R.sectionIndex,rh(R,x,p,t,n,P));for(let ye of he){let Ie=new Js;Ie.text=ye[0],Ie.sectionIndex=ye[1],Ie.sections=R.sections,V.push(Ie)}}else V=function(he,ye){let Ie=[],Ze=he.text,Ce=0;for(let Ee of ye)Ie.push(he.substring(Ce,Ee)),Ce=Ee;return Ce<Ze.length&&Ie.push(he.substring(Ce,Ze.length)),Ie}(R,rh(R,x,p,t,n,P));let J=[],ae={positionedLines:J,text:R.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:T,iconsInText:!1,verticalizable:!1};return function(he,ye,Ie,Ze,Ce,Ee,Oe,ze,Me,fe,Ne,Fe){let Ye=0,Vt=fl,Ot=0,Ei=0,Jr=ze==="right"?1:ze==="left"?0:.5,Fi=0;for(let si of Ce){si.trim();let Ci=si.getMaxScale(),Gi=(Ci-1)*vi,Oi={positionedGlyphs:[],lineOffset:0};he.positionedLines[Fi]=Oi;let ar=Oi.positionedGlyphs,Ni=0;if(!si.length()){Vt+=Ee,++Fi;continue}for(let mr=0;mr<si.length();mr++){let Et=si.getSection(mr),Gt=si.getSectionIndex(mr),Yt=si.getCharCode(mr),Cr=0,ri=null,to=null,ya=null,_a=vi,Yr=!(Me===w.ah.horizontal||!Ne&&!el(Yt)||Ne&&(Pc[Yt]||(Ti=Yt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Ti)))));if(Et.imageName){let $r=Ze[Et.imageName];if(!$r)continue;ya=Et.imageName,he.iconsInText=he.iconsInText||!0,to=$r.paddedRect;let Mi=$r.displaySize;Et.scale=Et.scale*vi/Fe,ri={width:Mi[0],height:Mi[1],left:fr,top:-ed,advance:Yr?Mi[1]:Mi[0]},Cr=Gi+(vi-Mi[1]*Et.scale),_a=ri.advance;let Va=Yr?Mi[0]*Et.scale-vi*Ci:Mi[1]*Et.scale-vi*Ci;Va>0&&Va>Ni&&(Ni=Va)}else{let $r=Ie[Et.fontStack],Mi=$r&&$r[Yt];if(Mi&&Mi.rect)to=Mi.rect,ri=Mi.metrics;else{let Va=ye[Et.fontStack],bl=Va&&Va[Yt];if(!bl)continue;ri=bl.metrics}Cr=(Ci-Et.scale)*vi}Yr?(he.verticalizable=!0,ar.push({glyph:Yt,imageName:ya,x:Ye,y:Vt+Cr,vertical:Yr,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:Gt,metrics:ri,rect:to}),Ye+=_a*Et.scale+fe):(ar.push({glyph:Yt,imageName:ya,x:Ye,y:Vt+Cr,vertical:Yr,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:Gt,metrics:ri,rect:to}),Ye+=ri.advance*Et.scale+fe)}ar.length!==0&&(Ot=Math.max(Ye-fe,Ot),og(ar,0,ar.length-1,Jr,Ni)),Ye=0;let jr=Ee*Ci+Ni;Oi.lineOffset=Math.max(Ni,Gi),Vt+=jr,Ei=Math.max(jr,Ei),++Fi}var Ti;let tr=Vt-fl,{horizontalAlign:ir,verticalAlign:rr}=ah(Oe);(function(si,Ci,Gi,Oi,ar,Ni,jr,mr,Et){let Gt=(Ci-Gi)*ar,Yt=0;Yt=Ni!==jr?-mr*Oi-fl:(-Oi*Et+.5)*jr;for(let Cr of si)for(let ri of Cr.positionedGlyphs)ri.x+=Gt,ri.y+=Yt})(he.positionedLines,Jr,ir,rr,Ot,Ei,Ee,tr,Ce.length),he.top+=-rr*tr,he.bottom=he.top+tr,he.left+=-ir*Ot,he.right=he.left+Ot}(ae,t,r,n,V,d,f,g,T,x,I,B),!function(he){for(let ye of he)if(ye.positionedGlyphs.length!==0)return!1;return!0}(J)&&ae}let Pc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ag={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ng={40:!0};function rd(i,t,r,n,l,p){if(t.imageName){let d=n[t.imageName];return d?d.displaySize[0]*t.scale*vi/p+l:0}{let d=r[t.fontStack],f=d&&d[i];return f?f.metrics.advance*t.scale+l:0}}function ad(i,t,r,n){let l=Math.pow(i-t,2);return n?i<t?l/2:2*l:l+Math.abs(r)*r}function sg(i,t,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),t!==41&&t!==65289||(n+=50),n}function nd(i,t,r,n,l,p){let d=null,f=ad(t,r,l,p);for(let g of n){let x=ad(t-g.x,r,l,p)+g.badness;x<=f&&(d=g,f=x)}return{index:i,x:t,priorBreak:d,badness:f}}function sd(i){return i?sd(i.priorBreak).concat(i.index):[]}function rh(i,t,r,n,l,p){if(!i)return[];let d=[],f=function(T,I,P,B,R,V){let Z=0;for(let oe=0;oe<T.length();oe++){let J=T.getSection(oe);Z+=rd(T.getCharCode(oe),J,B,R,I,V)}return Z/Math.max(1,Math.ceil(Z/P))}(i,t,r,n,l,p),g=i.text.indexOf("\u200B")>=0,x=0;for(let T=0;T<i.length();T++){let I=i.getSection(T),P=i.getCharCode(T);if(Pc[P]||(x+=rd(P,I,n,l,t,p)),T<i.length()-1){let B=!((S=P)<11904)&&(!!_t["CJK Compatibility Forms"](S)||!!_t["CJK Compatibility"](S)||!!_t["CJK Strokes"](S)||!!_t["CJK Symbols and Punctuation"](S)||!!_t["Enclosed CJK Letters and Months"](S)||!!_t["Halfwidth and Fullwidth Forms"](S)||!!_t["Ideographic Description Characters"](S)||!!_t["Vertical Forms"](S)||mc.test(String.fromCodePoint(S)));(ag[P]||B||I.imageName||T!==i.length()-2&&ng[i.getCharCode(T+1)])&&d.push(nd(T+1,x,f,d,sg(P,i.getCharCode(T+1),B&&g),!1))}}var S;return sd(nd(i.length(),x,f,d,0,!0))}function ah(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function og(i,t,r,n,l){if(!n&&!l)return;let p=i[r],d=(i[r].x+p.metrics.advance*p.scale)*n;for(let f=t;f<=r;f++)i[f].x-=d,i[f].y+=l}function lg(i,t,r){let{horizontalAlign:n,verticalAlign:l}=ah(r),p=t[0]-i.displaySize[0]*n,d=t[1]-i.displaySize[1]*l;return{image:i,top:d,bottom:d+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function od(i){var t,r;let n=i.left,l=i.top,p=i.right-n,d=i.bottom-l,f=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",g=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",x=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(g==="proportional"){if(f==="stretchOnly"&&p/d<x||f==="proportional"){let S=Math.ceil(d*x);n*=S/p,p=S}}else if(f==="proportional"&&g==="stretchOnly"&&x!==0&&p/d>x){let S=Math.ceil(p/x);l*=S/d,d=S}return{x1:n,y1:l,x2:n+p,y2:l+d}}function ld(i,t,r,n,l,p){let d=i.image,f;if(d.content){let V=d.content,Z=d.pixelRatio||1;f=[V[0]/Z,V[1]/Z,d.displaySize[0]-V[2]/Z,d.displaySize[1]-V[3]/Z]}let g=t.left*p,x=t.right*p,S,T,I,P;r==="width"||r==="both"?(P=l[0]+g-n[3],T=l[0]+x+n[1]):(P=l[0]+(g+x-d.displaySize[0])/2,T=P+d.displaySize[0]);let B=t.top*p,R=t.bottom*p;return r==="height"||r==="both"?(S=l[1]+B-n[0],I=l[1]+R+n[2]):(S=l[1]+(B+R-d.displaySize[1])/2,I=S+d.displaySize[1]),{image:d,top:S,right:T,bottom:I,left:P,collisionPadding:f}}let gl=255,ga=128,An=gl*ga;function cd(i,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Wt(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:n,interpolationType:l}=r,p=0;for(;p<n.length&&n[p]<=i;)p++;p=Math.max(0,p-1);let d=p;for(;d<n.length&&n[d]<i+1;)d++;d=Math.min(n.length-1,d);let f=n[p],g=n[d];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:g,minSize:r.evaluate(new Wt(f)),maxSize:r.evaluate(new Wt(g)),interpolationType:l}}}function nh(i,t,r){let n="never",l=i.get(t);return l?n=l:i.get(r)&&(n="always"),n}let cg=wn.VectorTileFeature.types,ug=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zc(i,t,r,n,l,p,d,f,g,x,S,T,I){let P=f?Math.min(An,Math.round(f[0])):0,B=f?Math.min(An,Math.round(f[1])):0;i.emplaceBack(t,r,Math.round(32*n),Math.round(32*l),p,d,(P<<1)+(g?1:0),B,16*x,16*S,256*T,256*I)}function sh(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function hg(i){for(let t of i.sections)if(Lu(t.text))return!0;return!1}class oh{constructor(t){this.layoutVertexArray=new qs,this.indexArray=new qr,this.programConfigurations=t,this.segments=new vt,this.dynamicLayoutVertexArray=new rl,this.opacityVertexArray=new Er,this.hasVisibleVertices=!1,this.placedSymbolArray=new Xt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,n,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,V0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,U0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ug,!0),this.opacityVertexBuffer.itemSize=1),(n||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pe("SymbolBuffers",oh);class lh{constructor(t,r,n){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new n,this.segments=new vt,this.collisionVertexArray=new fa}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,j0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pe("CollisionBuffers",lh);class Ys{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(d=>d.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vu([]),this.placementViewportMatrix=Vu([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cd(this.zoom,r["text-size"]),this.iconSizeData=cd(this.zoom,r["icon-size"]);let n=this.layers[0].layout,l=n.get("symbol-sort-key"),p=n.get("symbol-z-order");this.canOverlap=nh(n,"text-overlap","text-allow-overlap")!=="never"||nh(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map(d=>w.ah[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=t.sourceID}createArrays(){this.text=new oh(new Yn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new oh(new Yn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Kt,this.lineVertexArray=new zi,this.symbolInstances=new gt,this.textAnchorOffsets=new Jt}calculateGlyphDependencies(t,r,n,l,p){for(let d=0;d<t.length;d++)if(r[t.charCodeAt(d)]=!0,(n||l)&&p){let f=dl[t.charAt(d)];f&&(r[f.charCodeAt(0)]=!0)}}populate(t,r,n){let l=this.layers[0],p=l.layout,d=p.get("text-font"),f=p.get("text-field"),g=p.get("icon-image"),x=(f.value.kind!=="constant"||f.value.value instanceof lr&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),S=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,T=p.get("symbol-sort-key");if(this.features=[],!x&&!S)return;let I=r.iconDependencies,P=r.glyphDependencies,B=r.availableImages,R=new Wt(this.zoom);for(let{feature:V,id:Z,index:oe,sourceLayerIndex:J}of t){let ae=l._featureFilter.needGeometry,he=es(V,ae);if(!l._featureFilter.filter(R,he,n))continue;let ye,Ie;if(ae||(he.geometry=Qn(V)),x){let Ce=l.getValueAndResolveTokens("text-field",he,n,B),Ee=lr.factory(Ce),Oe=this.hasRTLText=this.hasRTLText||hg(Ee);(!Oe||pr.getRTLTextPluginStatus()==="unavailable"||Oe&&pr.isParsed())&&(ye=G0(Ee,l,he))}if(S){let Ce=l.getValueAndResolveTokens("icon-image",he,n,B);Ie=Ce instanceof ur?Ce:ur.fromString(Ce)}if(!ye&&!Ie)continue;let Ze=this.sortFeaturesByKey?T.evaluate(he,{},n):void 0;if(this.features.push({id:Z,text:ye,icon:Ie,index:oe,sourceLayerIndex:J,geometry:he.geometry,properties:V.properties,type:cg[V.type],sortKey:Ze}),Ie&&(I[Ie.name]=!0),ye){let Ce=d.evaluate(he,{},n).join(","),Ee=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(let Oe of ye.sections)if(Oe.image)I[Oe.image.name]=!0;else{let ze=Yo(ye.toString()),Me=Oe.fontStack||Ce,fe=P[Me]=P[Me]||{};this.calculateGlyphDependencies(Oe.text,fe,Ee,this.allowVerticalPlacement,ze)}}}p.get("symbol-placement")==="line"&&(this.features=function(V){let Z={},oe={},J=[],ae=0;function he(Ce){J.push(V[Ce]),ae++}function ye(Ce,Ee,Oe){let ze=oe[Ce];return delete oe[Ce],oe[Ee]=ze,J[ze].geometry[0].pop(),J[ze].geometry[0]=J[ze].geometry[0].concat(Oe[0]),ze}function Ie(Ce,Ee,Oe){let ze=Z[Ee];return delete Z[Ee],Z[Ce]=ze,J[ze].geometry[0].shift(),J[ze].geometry[0]=Oe[0].concat(J[ze].geometry[0]),ze}function Ze(Ce,Ee,Oe){let ze=Oe?Ee[0][Ee[0].length-1]:Ee[0][0];return`${Ce}:${ze.x}:${ze.y}`}for(let Ce=0;Ce<V.length;Ce++){let Ee=V[Ce],Oe=Ee.geometry,ze=Ee.text?Ee.text.toString():null;if(!ze){he(Ce);continue}let Me=Ze(ze,Oe),fe=Ze(ze,Oe,!0);if(Me in oe&&fe in Z&&oe[Me]!==Z[fe]){let Ne=Ie(Me,fe,Oe),Fe=ye(Me,fe,J[Ne].geometry);delete Z[Me],delete oe[fe],oe[Ze(ze,J[Fe].geometry,!0)]=Fe,J[Ne].geometry=null}else Me in oe?ye(Me,fe,Oe):fe in Z?Ie(Me,fe,Oe):(he(Ce),Z[Me]=ae-1,oe[fe]=ae-1)}return J.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,Z)=>V.sortKey-Z.sortKey)}update(t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let n=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),p=t.dist(r[t.segment]),d={};for(let f=t.segment+1;f<r.length;f++)d[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:l},f<r.length-1&&(l+=r[f+1].dist(r[f]));for(let f=t.segment||0;f>=0;f--)d[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:p},f>0&&(p+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){let g=d[f];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,r,n,l,p,d,f,g,x,S,T,I){let P=t.indexArray,B=t.layoutVertexArray,R=t.segments.prepareSegment(4*r.length,B,P,this.canOverlap?d.sortKey:void 0),V=this.glyphOffsetArray.length,Z=R.vertexLength,oe=this.allowVerticalPlacement&&f===w.ah.vertical?Math.PI/2:0,J=d.text&&d.text.sections;for(let ae=0;ae<r.length;ae++){let{tl:he,tr:ye,bl:Ie,br:Ze,tex:Ce,pixelOffsetTL:Ee,pixelOffsetBR:Oe,minFontScaleX:ze,minFontScaleY:Me,glyphOffset:fe,isSDF:Ne,sectionIndex:Fe}=r[ae],Ye=R.vertexLength,Vt=fe[1];zc(B,g.x,g.y,he.x,Vt+he.y,Ce.x,Ce.y,n,Ne,Ee.x,Ee.y,ze,Me),zc(B,g.x,g.y,ye.x,Vt+ye.y,Ce.x+Ce.w,Ce.y,n,Ne,Oe.x,Ee.y,ze,Me),zc(B,g.x,g.y,Ie.x,Vt+Ie.y,Ce.x,Ce.y+Ce.h,n,Ne,Ee.x,Oe.y,ze,Me),zc(B,g.x,g.y,Ze.x,Vt+Ze.y,Ce.x+Ce.w,Ce.y+Ce.h,n,Ne,Oe.x,Oe.y,ze,Me),sh(t.dynamicLayoutVertexArray,g,oe),P.emplaceBack(Ye,Ye+1,Ye+2),P.emplaceBack(Ye+1,Ye+2,Ye+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(fe[0]),ae!==r.length-1&&Fe===r[ae+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,d,d.index,{},I,J&&J[Fe])}t.placedSymbolArray.emplaceBack(g.x,g.y,V,this.glyphOffsetArray.length-V,Z,x,S,g.segment,n?n[0]:0,n?n[1]:0,l[0],l[1],f,0,!1,0,T)}_addCollisionDebugVertex(t,r,n,l,p,d){return r.emplaceBack(0,0),t.emplaceBack(n.x,n.y,l,p,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(t,r,n,l,p,d,f){let g=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),x=g.vertexLength,S=p.layoutVertexArray,T=p.collisionVertexArray,I=f.anchorX,P=f.anchorY;this._addCollisionDebugVertex(S,T,d,I,P,new ne(t,r)),this._addCollisionDebugVertex(S,T,d,I,P,new ne(n,r)),this._addCollisionDebugVertex(S,T,d,I,P,new ne(n,l)),this._addCollisionDebugVertex(S,T,d,I,P,new ne(t,l)),g.vertexLength+=4;let B=p.indexArray;B.emplaceBack(x,x+1),B.emplaceBack(x+1,x+2),B.emplaceBack(x+2,x+3),B.emplaceBack(x+3,x),g.primitiveLength+=4}addDebugCollisionBoxes(t,r,n,l){for(let p=t;p<r;p++){let d=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,l?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lh(Tr,Zp.members,ki),this.iconCollisionBox=new lh(Tr,Zp.members,ki);for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,n,l,p,d,f,g,x){let S={};for(let T=r;T<n;T++){let I=t.get(T);S.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},S.textFeatureIndex=I.featureIndex;break}for(let T=l;T<p;T++){let I=t.get(T);S.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},S.verticalTextFeatureIndex=I.featureIndex;break}for(let T=d;T<f;T++){let I=t.get(T);S.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},S.iconFeatureIndex=I.featureIndex;break}for(let T=g;T<x;T++){let I=t.get(T);S.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},S.verticalIconFeatureIndex=I.featureIndex;break}return S}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let n=t.placedSymbolArray.get(r),l=n.vertexStartIndex+4*n.numGlyphs;for(let p=n.vertexStartIndex;p<l;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),n=Math.cos(t),l=[],p=[],d=[];for(let f=0;f<this.symbolInstances.length;++f){d.push(f);let g=this.symbolInstances.get(f);l.push(0|Math.round(r*g.anchorX+n*g.anchorY)),p.push(g.featureIndex)}return d.sort((f,g)=>l[f]-l[g]||p[g]-p[f]),d}addToSortKeyRanges(t,r){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((l,p,d)=>{l>=0&&d.indexOf(l)===p&&this.addIndicesForPlacedSymbol(this.text,l)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ud,hd;Pe("SymbolBucket",Ys,{omit:["layers","collisionBoxArray","features","compareText"]}),Ys.MAX_GLYPHS=65535,Ys.addDynamicAttributes=sh;var ch={get paint(){return hd=hd||new h({"icon-opacity":new He(ce.paint_symbol["icon-opacity"]),"icon-color":new He(ce.paint_symbol["icon-color"]),"icon-halo-color":new He(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new He(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new He(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Le(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Le(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new He(ce.paint_symbol["text-opacity"]),"text-color":new He(ce.paint_symbol["text-color"],{runtimeType:Di,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new He(ce.paint_symbol["text-halo-color"]),"text-halo-width":new He(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new He(ce.paint_symbol["text-halo-blur"]),"text-translate":new Le(ce.paint_symbol["text-translate"]),"text-translate-anchor":new Le(ce.paint_symbol["text-translate-anchor"])})},get layout(){return ud=ud||new h({"symbol-placement":new Le(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Le(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Le(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new He(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Le(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Le(ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Le(ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Le(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Le(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Le(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new He(ce.layout_symbol["icon-size"]),"icon-text-fit":new Le(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Le(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new He(ce.layout_symbol["icon-image"]),"icon-rotate":new He(ce.layout_symbol["icon-rotate"]),"icon-padding":new He(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Le(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new He(ce.layout_symbol["icon-offset"]),"icon-anchor":new He(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Le(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Le(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Le(ce.layout_symbol["text-rotation-alignment"]),"text-field":new He(ce.layout_symbol["text-field"]),"text-font":new He(ce.layout_symbol["text-font"]),"text-size":new He(ce.layout_symbol["text-size"]),"text-max-width":new He(ce.layout_symbol["text-max-width"]),"text-line-height":new Le(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new He(ce.layout_symbol["text-letter-spacing"]),"text-justify":new He(ce.layout_symbol["text-justify"]),"text-radial-offset":new He(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Le(ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new He(ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new He(ce.layout_symbol["text-anchor"]),"text-max-angle":new Le(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Le(ce.layout_symbol["text-writing-mode"]),"text-rotate":new He(ce.layout_symbol["text-rotate"]),"text-padding":new Le(ce.layout_symbol["text-padding"]),"text-keep-upright":new Le(ce.layout_symbol["text-keep-upright"]),"text-transform":new He(ce.layout_symbol["text-transform"]),"text-offset":new He(ce.layout_symbol["text-offset"]),"text-allow-overlap":new Le(ce.layout_symbol["text-allow-overlap"]),"text-overlap":new Le(ce.layout_symbol["text-overlap"]),"text-ignore-placement":new Le(ce.layout_symbol["text-ignore-placement"]),"text-optional":new Le(ce.layout_symbol["text-optional"])})}};class pd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:zr,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pe("FormatSectionOverride",pd,{omit:["defaultValue"]});class Lc extends a{constructor(t){super(t,ch)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let n=this.layout.get("text-writing-mode");if(n){let l=[];for(let p of n)l.indexOf(p)<0&&l.push(p);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,n,l){let p=this.layout.get(t).evaluate(r,{},n,l),d=this._unevaluatedLayout._values[t];return d.isDataDriven()||Es(d.value)||!p?p:function(f,g){return g.replace(/{([^{}]+)}/g,(x,S)=>f&&S in f?String(f[S]):"")}(r.properties,p)}createBucket(t){return new Ys(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of ch.paint.overridableProperties){if(!Lc.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),n=new pd(r),l=new As(n,r.property.specification),p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new sn("source",l):new on("composite",l,r.value.zoomStops),this.paint._values[t]=new Xr(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Lc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let n=t.get("text-field"),l=ch.paint.properties[r],p=!1,d=f=>{for(let g of f)if(l.overrides&&l.overrides.hasOverride(g))return void(p=!0)};if(n.value.kind==="constant"&&n.value.value instanceof lr)d(n.value.value.sections);else if(n.value.kind==="source"){let f=x=>{p||(x instanceof Lr&&mi(x.value)===vr?d(x.value.sections):x instanceof ms?d(x.sections):x.eachChild(f))},g=n.value;g._styleExpression&&f(g._styleExpression.expression)}return p}}let dd;var pg={get paint(){return dd=dd||new h({"background-color":new Le(ce.paint_background["background-color"]),"background-pattern":new Os(ce.paint_background["background-pattern"]),"background-opacity":new Le(ce.paint_background["background-opacity"])})}};class dg extends a{constructor(t){super(t,pg)}}let fd;var fg={get paint(){return fd=fd||new h({"raster-opacity":new Le(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Le(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Le(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Le(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Le(ce.paint_raster["raster-saturation"]),"raster-contrast":new Le(ce.paint_raster["raster-contrast"]),"raster-resampling":new Le(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Le(ce.paint_raster["raster-fade-duration"])})}};class mg extends a{constructor(t){super(t,fg)}}class gg extends a{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let uh=63710088e-1;class En{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new En(Ht(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,n=this.lat*r,l=t.lat*r,p=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return uh*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof En)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new En(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new En(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let md=2*Math.PI*uh;function gd(i){return md*Math.cos(i*Math.PI/180)}function yd(i){return(180+i)/360}function _d(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function vd(i,t){return i/gd(t)}function hh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class yl{constructor(t,r,n=0){this.x=+t,this.y=+r,this.z=+n}static fromLngLat(t,r=0){let n=En.convert(t);return new yl(yd(n.lng),_d(n.lat),vd(r,n.lat))}toLngLat(){return new En(360*this.x-180,hh(this.y))}toAltitude(){return this.z*gd(hh(this.y))}meterInMercatorCoordinateUnits(){return 1/md*(t=hh(this.y),1/Math.cos(t*Math.PI/180));var t}}function xd(i,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class ph{constructor(t,r,n){if(!function(l,p,d){return!(l<0||l>25||d<0||d>=Math.pow(2,l)||p<0||p>=Math.pow(2,l))}(t,r,n))throw new Error(`x=${r}, y=${n}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=n,this.key=_l(0,t,t,r,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,n){let l=(d=this.y,f=this.z,g=xd(256*(p=this.x),256*(d=Math.pow(2,f)-d-1),f),x=xd(256*(p+1),256*(d+1),f),g[0]+","+g[1]+","+x[0]+","+x[1]);var p,d,f,g,x;let S=function(T,I,P){let B,R="";for(let V=T;V>0;V--)B=1<<V-1,R+=(I&B?1:0)+(P&B?2:0);return R}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,S).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){let r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){let r=Math.pow(2,this.z);return new ne((t.x*r-this.x)*gi,(t.y*r-this.y)*gi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bd{constructor(t,r){this.wrap=t,this.canonical=r,this.key=_l(t,r.z,r.z,r.x,r.y)}}class Ur{constructor(t,r,n,l,p){if(t<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${n}`);this.overscaledZ=t,this.wrap=r,this.canonical=new ph(n,+l,+p),this.key=_l(r,t,n,l,p)}clone(){return new Ur(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-t;return t>this.canonical.z?new Ur(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ur(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-t;return t>this.canonical.z?_l(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):_l(this.wrap*+r,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,n=2*this.canonical.x,l=2*this.canonical.y;return[new Ur(r,this.wrap,r,n,l),new Ur(r,this.wrap,r,n+1,l),new Ur(r,this.wrap,r,n,l+1),new Ur(r,this.wrap,r,n+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ur(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new yl(t.x-this.wrap,t.y))}}function _l(i,t,r,n,l){(i*=2)<0&&(i=-1*i-1);let p=1<<r;return(p*p*i+p*l+n).toString(36)+r.toString(36)+t.toString(36)}Pe("CanonicalTileID",ph),Pe("OverscaledTileID",Ur,{omit:["posMatrix"]});class wd{constructor(t,r,n,l=1,p=1,d=1,f=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void et(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=p,this.blueFactor=d,this.baseShift=f;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let x=0;x<g;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(g,x)]=this.data[this._idx(g-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,g)]=this.data[this._idx(x,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<g;x++)for(let S=0;S<g;S++){let T=this.get(x,S);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(t,r){let n=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(n[l],n[l+1],n[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,n){return t*this.redFactor+r*this.greenFactor+n*this.blueFactor-this.baseShift}getPixels(){return new Vr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,p=r*this.dim+this.dim,d=n*this.dim,f=n*this.dim+this.dim;switch(r){case-1:l=p-1;break;case 1:p=l+1}switch(n){case-1:d=f-1;break;case 1:f=d+1}let g=-r*this.dim,x=-n*this.dim;for(let S=d;S<f;S++)for(let T=l;T<p;T++)this.data[this._idx(T,S)]=t.data[this._idx(T+g,S+x)]}}Pe("DEMData",wd);class Sd{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let n=t[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Ad{constructor(t,r,n,l,p){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=n,t._y=l,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Ed{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new hn(gi,16,0),this.grid3D=new hn(gi,16,0),this.featureIndexArray=new ji,this.promoteId=r}insert(t,r,n,l,p,d){let f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,l,p);let g=d?this.grid3D:this.grid;for(let x=0;x<r.length;x++){let S=r[x],T=[1/0,1/0,-1/0,-1/0];for(let I=0;I<S.length;I++){let P=S[I];T[0]=Math.min(T[0],P.x),T[1]=Math.min(T[1],P.y),T[2]=Math.max(T[2],P.x),T[3]=Math.max(T[3],P.y)}T[0]<gi&&T[1]<gi&&T[2]>=0&&T[3]>=0&&g.insert(f,T[0],T[1],T[2],T[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wn.VectorTile(new eh(this.rawTileData)).layers,this.sourceLayerCoder=new Sd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,n,l){this.loadVTLayers();let p=t.params||{},d=gi/t.tileSize/t.scale,f=Fo(p.filter),g=t.queryGeometry,x=t.queryPadding*d,S=Cd(g),T=this.grid.query(S.minX-x,S.minY-x,S.maxX+x,S.maxY+x),I=Cd(t.cameraQueryGeometry),P=this.grid3D.query(I.minX-x,I.minY-x,I.maxX+x,I.maxY+x,(V,Z,oe,J)=>function(ae,he,ye,Ie,Ze){for(let Ee of ae)if(he<=Ee.x&&ye<=Ee.y&&Ie>=Ee.x&&Ze>=Ee.y)return!0;let Ce=[new ne(he,ye),new ne(he,Ze),new ne(Ie,Ze),new ne(Ie,ye)];if(ae.length>2){for(let Ee of Ce)if(Gs(ae,Ee))return!0}for(let Ee=0;Ee<ae.length-1;Ee++)if(Jm(ae[Ee],ae[Ee+1],Ce))return!0;return!1}(t.cameraQueryGeometry,V-x,Z-x,oe+x,J+x));for(let V of P)T.push(V);T.sort(_g);let B={},R;for(let V=0;V<T.length;V++){let Z=T[V];if(Z===R)continue;R=Z;let oe=this.featureIndexArray.get(Z),J=null;this.loadMatchingFeature(B,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,f,p.layers,p.availableImages,r,n,l,(ae,he,ye)=>(J||(J=Qn(ae)),he.queryIntersectsFeature(g,ae,ye,J,this.z,t.transform,d,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,r,n,l,p,d,f,g,x,S,T){let I=this.bucketLayerIDs[r];if(d&&!function(V,Z){for(let oe=0;oe<V.length;oe++)if(Z.indexOf(V[oe])>=0)return!0;return!1}(d,I))return;let P=this.sourceLayerCoder.decode(n),B=this.vtLayers[P].feature(l);if(p.needGeometry){let V=es(B,!0);if(!p.filter(new Wt(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!p.filter(new Wt(this.tileID.overscaledZ),B))return;let R=this.getId(B,P);for(let V=0;V<I.length;V++){let Z=I[V];if(d&&d.indexOf(Z)<0)continue;let oe=g[Z];if(!oe)continue;let J={};R&&S&&(J=S.getState(oe.sourceLayer||"_geojsonTileLayer",R));let ae=bi({},x[Z]);ae.paint=Td(ae.paint,oe.paint,B,J,f),ae.layout=Td(ae.layout,oe.layout,B,J,f);let he=!T||T(B,oe,J);if(!he)continue;let ye=new Ad(B,this.z,this.x,this.y,R);ye.layer=ae;let Ie=t[Z];Ie===void 0&&(Ie=t[Z]=[]),Ie.push({featureIndex:l,feature:ye,intersectionZ:he})}}lookupSymbolFeatures(t,r,n,l,p,d,f,g){let x={};this.loadVTLayers();let S=Fo(p);for(let T of t)this.loadMatchingFeature(x,n,l,T,S,d,f,g,r);return x}hasLayer(t){for(let r of this.bucketLayerIDs)for(let n of r)if(t===n)return!0;return!1}getId(t,r){let n=t.id;return this.promoteId&&(n=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function Td(i,t,r,n,l){return je(i,(p,d)=>{let f=t instanceof Xn?t.get(d):null;return f&&f.evaluate?f.evaluate(r,n,l):f})}function Cd(i){let t=1/0,r=1/0,n=-1/0,l=-1/0;for(let p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),n=Math.max(n,p.x),l=Math.max(l,p.y);return{minX:t,minY:r,maxX:n,maxY:l}}function _g(i,t){return t-i}function Dd(i,t,r,n,l){let p=[];for(let d=0;d<i.length;d++){let f=i[d],g;for(let x=0;x<f.length-1;x++){let S=f[x],T=f[x+1];S.x<t&&T.x<t||(S.x<t?S=new ne(t,S.y+(t-S.x)/(T.x-S.x)*(T.y-S.y))._round():T.x<t&&(T=new ne(t,S.y+(t-S.x)/(T.x-S.x)*(T.y-S.y))._round()),S.y<r&&T.y<r||(S.y<r?S=new ne(S.x+(r-S.y)/(T.y-S.y)*(T.x-S.x),r)._round():T.y<r&&(T=new ne(S.x+(r-S.y)/(T.y-S.y)*(T.x-S.x),r)._round()),S.x>=n&&T.x>=n||(S.x>=n?S=new ne(n,S.y+(n-S.x)/(T.x-S.x)*(T.y-S.y))._round():T.x>=n&&(T=new ne(n,S.y+(n-S.x)/(T.x-S.x)*(T.y-S.y))._round()),S.y>=l&&T.y>=l||(S.y>=l?S=new ne(S.x+(l-S.y)/(T.y-S.y)*(T.x-S.x),l)._round():T.y>=l&&(T=new ne(S.x+(l-S.y)/(T.y-S.y)*(T.x-S.x),l)._round()),g&&S.equals(g[g.length-1])||(g=[S],p.push(g)),g.push(T)))))}}return p}Pe("FeatureIndex",Ed,{omit:["rawTileData","sourceLayerCoder"]});class Tn extends ne{constructor(t,r,n,l){super(t,r),this.angle=n,l!==void 0&&(this.segment=l)}clone(){return new Tn(this.x,this.y,this.angle,this.segment)}}function Id(i,t,r,n,l){if(t.segment===void 0||r===0)return!0;let p=t,d=t.segment+1,f=0;for(;f>-r/2;){if(d--,d<0)return!1;f-=i[d].dist(p),p=i[d]}f+=i[d].dist(i[d+1]),d++;let g=[],x=0;for(;f<r/2;){let S=i[d],T=i[d+1];if(!T)return!1;let I=i[d-1].angleTo(S)-S.angleTo(T);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:I}),x+=I;f-g[0].distance>n;)x-=g.shift().angleDelta;if(x>l)return!1;d++,f+=S.dist(T)}return!0}function kd(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Md(i,t,r){return i?.6*t*r:0}function Pd(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function vg(i,t,r,n,l,p){let d=Md(r,l,p),f=Pd(r,n)*p,g=0,x=kd(i)/2;for(let S=0;S<i.length-1;S++){let T=i[S],I=i[S+1],P=T.dist(I);if(g+P>x){let B=(x-g)/P,R=Ji.number(T.x,I.x,B),V=Ji.number(T.y,I.y,B),Z=new Tn(R,V,I.angleTo(T),S);return Z._round(),!d||Id(i,Z,f,d,t)?Z:void 0}g+=P}}function xg(i,t,r,n,l,p,d,f,g){let x=Md(n,p,d),S=Pd(n,l),T=S*d,I=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return t-T<t/4&&(t=T+t/4),zd(i,I?t/2*f%t:(S/2+2*p)*d*f%t,t,x,r,T,I,!1,g)}function zd(i,t,r,n,l,p,d,f,g){let x=p/2,S=kd(i),T=0,I=t-r,P=[];for(let B=0;B<i.length-1;B++){let R=i[B],V=i[B+1],Z=R.dist(V),oe=V.angleTo(R);for(;I+r<T+Z;){I+=r;let J=(I-T)/Z,ae=Ji.number(R.x,V.x,J),he=Ji.number(R.y,V.y,J);if(ae>=0&&ae<g&&he>=0&&he<g&&I-x>=0&&I+x<=S){let ye=new Tn(ae,he,oe,B);ye._round(),n&&!Id(i,ye,p,n,l)||P.push(ye)}}T+=Z}return f||P.length||d||(P=zd(i,T/2,r,n,l,p,d,!0,g)),P}Pe("Anchor",Tn);let Qs=fr;function Ld(i,t,r,n){let l=[],p=i.image,d=p.pixelRatio,f=p.paddedRect.w-2*Qs,g=p.paddedRect.h-2*Qs,x={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom},S=p.stretchX||[[0,f]],T=p.stretchY||[[0,g]],I=(fe,Ne)=>fe+Ne[1]-Ne[0],P=S.reduce(I,0),B=T.reduce(I,0),R=f-P,V=g-B,Z=0,oe=P,J=0,ae=B,he=0,ye=R,Ie=0,Ze=V;if(p.content&&n){let fe=p.content,Ne=fe[2]-fe[0],Fe=fe[3]-fe[1];(p.textFitWidth||p.textFitHeight)&&(x=od(i)),Z=Bc(S,0,fe[0]),J=Bc(T,0,fe[1]),oe=Bc(S,fe[0],fe[2]),ae=Bc(T,fe[1],fe[3]),he=fe[0]-Z,Ie=fe[1]-J,ye=Ne-oe,Ze=Fe-ae}let Ce=x.x1,Ee=x.y1,Oe=x.x2-Ce,ze=x.y2-Ee,Me=(fe,Ne,Fe,Ye)=>{let Vt=Rc(fe.stretch-Z,oe,Oe,Ce),Ot=Fc(fe.fixed-he,ye,fe.stretch,P),Ei=Rc(Ne.stretch-J,ae,ze,Ee),Jr=Fc(Ne.fixed-Ie,Ze,Ne.stretch,B),Fi=Rc(Fe.stretch-Z,oe,Oe,Ce),Ti=Fc(Fe.fixed-he,ye,Fe.stretch,P),tr=Rc(Ye.stretch-J,ae,ze,Ee),ir=Fc(Ye.fixed-Ie,Ze,Ye.stretch,B),rr=new ne(Vt,Ei),si=new ne(Fi,Ei),Ci=new ne(Fi,tr),Gi=new ne(Vt,tr),Oi=new ne(Ot/d,Jr/d),ar=new ne(Ti/d,ir/d),Ni=t*Math.PI/180;if(Ni){let Et=Math.sin(Ni),Gt=Math.cos(Ni),Yt=[Gt,-Et,Et,Gt];rr._matMult(Yt),si._matMult(Yt),Gi._matMult(Yt),Ci._matMult(Yt)}let jr=fe.stretch+fe.fixed,mr=Ne.stretch+Ne.fixed;return{tl:rr,tr:si,bl:Gi,br:Ci,tex:{x:p.paddedRect.x+Qs+jr,y:p.paddedRect.y+Qs+mr,w:Fe.stretch+Fe.fixed-jr,h:Ye.stretch+Ye.fixed-mr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oi,pixelOffsetBR:ar,minFontScaleX:ye/d/Oe,minFontScaleY:Ze/d/ze,isSDF:r}};if(n&&(p.stretchX||p.stretchY)){let fe=Bd(S,R,P),Ne=Bd(T,V,B);for(let Fe=0;Fe<fe.length-1;Fe++){let Ye=fe[Fe],Vt=fe[Fe+1];for(let Ot=0;Ot<Ne.length-1;Ot++)l.push(Me(Ye,Ne[Ot],Vt,Ne[Ot+1]))}}else l.push(Me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:g+1}));return l}function Bc(i,t,r){let n=0;for(let l of i)n+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return n}function Bd(i,t,r){let n=[{fixed:-Qs,stretch:0}];for(let[l,p]of i){let d=n[n.length-1];n.push({fixed:l-d.stretch,stretch:d.stretch}),n.push({fixed:l-d.stretch,stretch:d.stretch+(p-l)})}return n.push({fixed:t+Qs,stretch:r}),n}function Rc(i,t,r,n){return i/t*r+n}function Fc(i,t,r,n){return i-t*r/n}class Oc{constructor(t,r,n,l,p,d,f,g,x,S){var T;if(this.boxStartIndex=t.length,x){let I=d.top,P=d.bottom,B=d.collisionPadding;B&&(I-=B[1],P+=B[3]);let R=P-I;R>0&&(R=Math.max(10,R),this.circleDiameter=R)}else{let I=!((T=d.image)===null||T===void 0)&&T.content&&(d.image.textFitWidth||d.image.textFitHeight)?od(d):{x1:d.left,y1:d.top,x2:d.right,y2:d.bottom};I.y1=I.y1*f-g[0],I.y2=I.y2*f+g[2],I.x1=I.x1*f-g[3],I.x2=I.x2*f+g[1];let P=d.collisionPadding;if(P&&(I.x1-=P[0]*f,I.y1-=P[1]*f,I.x2+=P[2]*f,I.y2+=P[3]*f),S){let B=new ne(I.x1,I.y1),R=new ne(I.x2,I.y1),V=new ne(I.x1,I.y2),Z=new ne(I.x2,I.y2),oe=S*Math.PI/180;B._rotate(oe),R._rotate(oe),V._rotate(oe),Z._rotate(oe),I.x1=Math.min(B.x,R.x,V.x,Z.x),I.x2=Math.max(B.x,R.x,V.x,Z.x),I.y1=Math.min(B.y,R.y,V.y,Z.y),I.y2=Math.max(B.y,R.y,V.y,Z.y)}t.emplaceBack(r.x,r.y,I.x1,I.y1,I.x2,I.y2,n,l,p)}this.boxEndIndex=t.length}}class bg{constructor(t=[],r=(n,l)=>n<l?-1:n>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:n}=this,l=r[t];for(;t>0;){let p=t-1>>1,d=r[p];if(n(l,d)>=0)break;r[t]=d,t=p}r[t]=l}_down(t){let{data:r,compare:n}=this,l=this.length>>1,p=r[t];for(;t<l;){let d=1+(t<<1),f=d+1;if(f<this.length&&n(r[f],r[d])<0&&(d=f),n(r[d],p)>=0)break;r[t]=r[d],t=d}r[t]=p}}function wg(i,t=1,r=!1){let n=1/0,l=1/0,p=-1/0,d=-1/0,f=i[0];for(let P=0;P<f.length;P++){let B=f[P];(!P||B.x<n)&&(n=B.x),(!P||B.y<l)&&(l=B.y),(!P||B.x>p)&&(p=B.x),(!P||B.y>d)&&(d=B.y)}let g=Math.min(p-n,d-l),x=g/2,S=new bg([],Sg);if(g===0)return new ne(n,l);for(let P=n;P<p;P+=g)for(let B=l;B<d;B+=g)S.push(new eo(P+x,B+x,x,i));let T=function(P){let B=0,R=0,V=0,Z=P[0];for(let oe=0,J=Z.length,ae=J-1;oe<J;ae=oe++){let he=Z[oe],ye=Z[ae],Ie=he.x*ye.y-ye.x*he.y;R+=(he.x+ye.x)*Ie,V+=(he.y+ye.y)*Ie,B+=3*Ie}return new eo(R/B,V/B,0,P)}(i),I=S.length;for(;S.length;){let P=S.pop();(P.d>T.d||!T.d)&&(T=P,r&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),P.max-T.d<=t||(x=P.h/2,S.push(new eo(P.p.x-x,P.p.y-x,x,i)),S.push(new eo(P.p.x+x,P.p.y-x,x,i)),S.push(new eo(P.p.x-x,P.p.y+x,x,i)),S.push(new eo(P.p.x+x,P.p.y+x,x,i)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${T.d}`)),T.p}function Sg(i,t){return t.max-i.max}function eo(i,t,r,n){this.p=new ne(i,t),this.h=r,this.d=function(l,p){let d=!1,f=1/0;for(let g=0;g<p.length;g++){let x=p[g];for(let S=0,T=x.length,I=T-1;S<T;I=S++){let P=x[S],B=x[I];P.y>l.y!=B.y>l.y&&l.x<(B.x-P.x)*(l.y-P.y)/(B.y-P.y)+P.x&&(d=!d),f=Math.min(f,_p(l,P,B))}}return(d?1:-1)*Math.sqrt(f)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var Ri;w.aq=void 0,(Ri=w.aq||(w.aq={}))[Ri.center=1]="center",Ri[Ri.left=2]="left",Ri[Ri.right=3]="right",Ri[Ri.top=4]="top",Ri[Ri.bottom=5]="bottom",Ri[Ri["top-left"]=6]="top-left",Ri[Ri["top-right"]=7]="top-right",Ri[Ri["bottom-left"]=8]="bottom-left",Ri[Ri["bottom-right"]=9]="bottom-right";let Cn=7,dh=Number.POSITIVE_INFINITY;function Rd(i,t){return t[1]!==dh?function(r,n,l){let p=0,d=0;switch(n=Math.abs(n),l=Math.abs(l),r){case"top-right":case"top-left":case"top":d=l-Cn;break;case"bottom-right":case"bottom-left":case"bottom":d=-l+Cn}switch(r){case"top-right":case"bottom-right":case"right":p=-n;break;case"top-left":case"bottom-left":case"left":p=n}return[p,d]}(i,t[0],t[1]):function(r,n){let l=0,p=0;n<0&&(n=0);let d=n/Math.SQRT2;switch(r){case"top-right":case"top-left":p=d-Cn;break;case"bottom-right":case"bottom-left":p=-d+Cn;break;case"bottom":p=-n+Cn;break;case"top":p=n-Cn}switch(r){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=n;break;case"right":l=-n}return[l,p]}(i,t[0])}function Fd(i,t,r){var n;let l=i.layout,p=(n=l.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(t,{},r);if(p){let f=p.values,g=[];for(let x=0;x<f.length;x+=2){let S=g[x]=f[x],T=f[x+1].map(I=>I*vi);S.startsWith("top")?T[1]-=Cn:S.startsWith("bottom")&&(T[1]+=Cn),g[x+1]=T}return new xr(g)}let d=l.get("text-variable-anchor");if(d){let f;f=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*vi,dh]:l.get("text-offset").evaluate(t,{},r).map(x=>x*vi);let g=[];for(let x of d)g.push(x,Rd(x,f));return new xr(g)}return null}function fh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ag(i,t,r,n,l,p,d,f,g,x,S){let T=p.textMaxSize.evaluate(t,{});T===void 0&&(T=d);let I=i.layers[0].layout,P=I.get("icon-offset").evaluate(t,{},S),B=Nd(r.horizontal),R=d/24,V=i.tilePixelRatio*R,Z=i.tilePixelRatio*T/24,oe=i.tilePixelRatio*f,J=i.tilePixelRatio*I.get("symbol-spacing"),ae=I.get("text-padding")*i.tilePixelRatio,he=function(fe,Ne,Fe,Ye=1){let Vt=fe.get("icon-padding").evaluate(Ne,{},Fe),Ot=Vt&&Vt.values;return[Ot[0]*Ye,Ot[1]*Ye,Ot[2]*Ye,Ot[3]*Ye]}(I,t,S,i.tilePixelRatio),ye=I.get("text-max-angle")/180*Math.PI,Ie=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",Ze=I.get("icon-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",Ce=I.get("symbol-placement"),Ee=J/2,Oe=I.get("icon-text-fit"),ze;n&&Oe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ze=ld(n,r.vertical,Oe,I.get("icon-text-fit-padding"),P,R)),B&&(n=ld(n,B,Oe,I.get("icon-text-fit-padding"),P,R)));let Me=(fe,Ne)=>{Ne.x<0||Ne.x>=gi||Ne.y<0||Ne.y>=gi||function(Fe,Ye,Vt,Ot,Ei,Jr,Fi,Ti,tr,ir,rr,si,Ci,Gi,Oi,ar,Ni,jr,mr,Et,Gt,Yt,Cr,ri,to){let ya=Fe.addToLineVertexArray(Ye,Vt),_a,Yr,$r,Mi,Va=0,bl=0,jd=0,$d=0,wh=-1,Sh=-1,Ua={},Gd=Vs("");if(Fe.allowVerticalPlacement&&Ot.vertical){let Zi=Ti.layout.get("text-rotate").evaluate(Gt,{},ri)+90;$r=new Oc(tr,Ye,ir,rr,si,Ot.vertical,Ci,Gi,Oi,Zi),Fi&&(Mi=new Oc(tr,Ye,ir,rr,si,Fi,Ni,jr,Oi,Zi))}if(Ei){let Zi=Ti.layout.get("icon-rotate").evaluate(Gt,{}),Gr=Ti.layout.get("icon-text-fit")!=="none",is=Ld(Ei,Zi,Cr,Gr),aa=Fi?Ld(Fi,Zi,Cr,Gr):void 0;Yr=new Oc(tr,Ye,ir,rr,si,Ei,Ni,jr,!1,Zi),Va=4*is.length;let rs=Fe.iconSizeData,va=null;rs.kind==="source"?(va=[ga*Ti.layout.get("icon-size").evaluate(Gt,{})],va[0]>An&&et(`${Fe.layerIds[0]}: Value for "icon-size" is >= ${gl}. Reduce your "icon-size".`)):rs.kind==="composite"&&(va=[ga*Yt.compositeIconSizes[0].evaluate(Gt,{},ri),ga*Yt.compositeIconSizes[1].evaluate(Gt,{},ri)],(va[0]>An||va[1]>An)&&et(`${Fe.layerIds[0]}: Value for "icon-size" is >= ${gl}. Reduce your "icon-size".`)),Fe.addSymbols(Fe.icon,is,va,Et,mr,Gt,w.ah.none,Ye,ya.lineStartIndex,ya.lineLength,-1,ri),wh=Fe.icon.placedSymbolArray.length-1,aa&&(bl=4*aa.length,Fe.addSymbols(Fe.icon,aa,va,Et,mr,Gt,w.ah.vertical,Ye,ya.lineStartIndex,ya.lineLength,-1,ri),Sh=Fe.icon.placedSymbolArray.length-1)}let Zd=Object.keys(Ot.horizontal);for(let Zi of Zd){let Gr=Ot.horizontal[Zi];if(!_a){Gd=Vs(Gr.text);let aa=Ti.layout.get("text-rotate").evaluate(Gt,{},ri);_a=new Oc(tr,Ye,ir,rr,si,Gr,Ci,Gi,Oi,aa)}let is=Gr.positionedLines.length===1;if(jd+=Od(Fe,Ye,Gr,Jr,Ti,Oi,Gt,ar,ya,Ot.vertical?w.ah.horizontal:w.ah.horizontalOnly,is?Zd:[Zi],Ua,wh,Yt,ri),is)break}Ot.vertical&&($d+=Od(Fe,Ye,Ot.vertical,Jr,Ti,Oi,Gt,ar,ya,w.ah.vertical,["vertical"],Ua,Sh,Yt,ri));let Cg=_a?_a.boxStartIndex:Fe.collisionBoxArray.length,Dg=_a?_a.boxEndIndex:Fe.collisionBoxArray.length,Ig=$r?$r.boxStartIndex:Fe.collisionBoxArray.length,kg=$r?$r.boxEndIndex:Fe.collisionBoxArray.length,Mg=Yr?Yr.boxStartIndex:Fe.collisionBoxArray.length,Pg=Yr?Yr.boxEndIndex:Fe.collisionBoxArray.length,zg=Mi?Mi.boxStartIndex:Fe.collisionBoxArray.length,Lg=Mi?Mi.boxEndIndex:Fe.collisionBoxArray.length,ra=-1,qc=(Zi,Gr)=>Zi&&Zi.circleDiameter?Math.max(Zi.circleDiameter,Gr):Gr;ra=qc(_a,ra),ra=qc($r,ra),ra=qc(Yr,ra),ra=qc(Mi,ra);let Hd=ra>-1?1:0;Hd&&(ra*=to/vi),Fe.glyphOffsetArray.length>=Ys.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gt.sortKey!==void 0&&Fe.addToSortKeyRanges(Fe.symbolInstances.length,Gt.sortKey);let Bg=Fd(Ti,Gt,ri),[Rg,Fg]=function(Zi,Gr){let is=Zi.length,aa=Gr?.values;if(aa?.length>0)for(let rs=0;rs<aa.length;rs+=2){let va=aa[rs+1];Zi.emplaceBack(w.aq[aa[rs]],va[0],va[1])}return[is,Zi.length]}(Fe.textAnchorOffsets,Bg);Fe.symbolInstances.emplaceBack(Ye.x,Ye.y,Ua.right>=0?Ua.right:-1,Ua.center>=0?Ua.center:-1,Ua.left>=0?Ua.left:-1,Ua.vertical||-1,wh,Sh,Gd,Cg,Dg,Ig,kg,Mg,Pg,zg,Lg,ir,jd,$d,Va,bl,Hd,0,Ci,ra,Rg,Fg)}(i,Ne,fe,r,n,l,ze,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,V,[ae,ae,ae,ae],Ie,g,oe,he,Ze,P,t,p,x,S,d)};if(Ce==="line")for(let fe of Dd(t.geometry,0,0,gi,gi)){let Ne=xg(fe,J,ye,r.vertical||B,n,24,Z,i.overscaling,gi);for(let Fe of Ne)B&&Eg(i,B.text,Ee,Fe)||Me(fe,Fe)}else if(Ce==="line-center"){for(let fe of t.geometry)if(fe.length>1){let Ne=vg(fe,ye,r.vertical||B,n,24,Z);Ne&&Me(fe,Ne)}}else if(t.type==="Polygon")for(let fe of ys(t.geometry,0)){let Ne=wg(fe,16);Me(fe[0],new Tn(Ne.x,Ne.y,0))}else if(t.type==="LineString")for(let fe of t.geometry)Me(fe,new Tn(fe[0].x,fe[0].y,0));else if(t.type==="Point")for(let fe of t.geometry)for(let Ne of fe)Me([Ne],new Tn(Ne.x,Ne.y,0))}function Od(i,t,r,n,l,p,d,f,g,x,S,T,I,P,B){let R=function(oe,J,ae,he,ye,Ie,Ze,Ce){let Ee=he.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,Oe=[];for(let ze of J.positionedLines)for(let Me of ze.positionedGlyphs){if(!Me.rect)continue;let fe=Me.rect||{},Ne=ed+1,Fe=!0,Ye=1,Vt=0,Ot=(ye||Ce)&&Me.vertical,Ei=Me.metrics.advance*Me.scale/2;if(Ce&&J.verticalizable&&(Vt=ze.lineOffset/2-(Me.imageName?-(vi-Me.metrics.width*Me.scale)/2:(Me.scale-1)*vi)),Me.imageName){let Et=Ze[Me.imageName];Fe=Et.sdf,Ye=Et.pixelRatio,Ne=fr/Ye}let Jr=ye?[Me.x+Ei,Me.y]:[0,0],Fi=ye?[0,0]:[Me.x+Ei+ae[0],Me.y+ae[1]-Vt],Ti=[0,0];Ot&&(Ti=Fi,Fi=[0,0]);let tr=Me.metrics.isDoubleResolution?2:1,ir=(Me.metrics.left-Ne)*Me.scale-Ei+Fi[0],rr=(-Me.metrics.top-Ne)*Me.scale+Fi[1],si=ir+fe.w/tr*Me.scale/Ye,Ci=rr+fe.h/tr*Me.scale/Ye,Gi=new ne(ir,rr),Oi=new ne(si,rr),ar=new ne(ir,Ci),Ni=new ne(si,Ci);if(Ot){let Et=new ne(-Ei,Ei-fl),Gt=-Math.PI/2,Yt=vi/2-Ei,Cr=new ne(5-fl-Yt,-(Me.imageName?Yt:0)),ri=new ne(...Ti);Gi._rotateAround(Gt,Et)._add(Cr)._add(ri),Oi._rotateAround(Gt,Et)._add(Cr)._add(ri),ar._rotateAround(Gt,Et)._add(Cr)._add(ri),Ni._rotateAround(Gt,Et)._add(Cr)._add(ri)}if(Ee){let Et=Math.sin(Ee),Gt=Math.cos(Ee),Yt=[Gt,-Et,Et,Gt];Gi._matMult(Yt),Oi._matMult(Yt),ar._matMult(Yt),Ni._matMult(Yt)}let jr=new ne(0,0),mr=new ne(0,0);Oe.push({tl:Gi,tr:Oi,bl:ar,br:Ni,tex:fe,writingMode:J.writingMode,glyphOffset:Jr,sectionIndex:Me.sectionIndex,isSDF:Fe,pixelOffsetTL:jr,pixelOffsetBR:mr,minFontScaleX:0,minFontScaleY:0})}return Oe}(0,r,f,l,p,d,n,i.allowVerticalPlacement),V=i.textSizeData,Z=null;V.kind==="source"?(Z=[ga*l.layout.get("text-size").evaluate(d,{})],Z[0]>An&&et(`${i.layerIds[0]}: Value for "text-size" is >= ${gl}. Reduce your "text-size".`)):V.kind==="composite"&&(Z=[ga*P.compositeTextSizes[0].evaluate(d,{},B),ga*P.compositeTextSizes[1].evaluate(d,{},B)],(Z[0]>An||Z[1]>An)&&et(`${i.layerIds[0]}: Value for "text-size" is >= ${gl}. Reduce your "text-size".`)),i.addSymbols(i.text,R,Z,f,p,d,x,t,g.lineStartIndex,g.lineLength,I,B);for(let oe of S)T[oe]=i.text.placedSymbolArray.length-1;return 4*R.length}function Nd(i){for(let t in i)return i[t];return null}function Eg(i,t,r,n){let l=i.compareText;if(t in l){let p=l[t];for(let d=p.length-1;d>=0;d--)if(n.dist(p[d])<r)return!0}else l[t]=[];return l[t].push(n),!1}let qd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mh{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,n]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=n>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let p=qd[15&n];if(!p)throw new Error("Unrecognized array type.");let[d]=new Uint16Array(t,2,1),[f]=new Uint32Array(t,4,1);return new mh(f,d,p,t)}constructor(t,r=64,n=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let p=qd.indexOf(this.ArrayType),d=2*t*this.ArrayType.BYTES_PER_ELEMENT,f=t*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-f%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${n}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+f+g,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+d+f+g),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+f+g,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=r,n}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:d,nodeSize:f}=this,g=[0,p.length-1,0],x=[];for(;g.length;){let S=g.pop()||0,T=g.pop()||0,I=g.pop()||0;if(T-I<=f){for(let V=I;V<=T;V++){let Z=d[2*V],oe=d[2*V+1];Z>=t&&Z<=n&&oe>=r&&oe<=l&&x.push(p[V])}continue}let P=I+T>>1,B=d[2*P],R=d[2*P+1];B>=t&&B<=n&&R>=r&&R<=l&&x.push(p[P]),(S===0?t<=B:r<=R)&&(g.push(I),g.push(P-1),g.push(1-S)),(S===0?n>=B:l>=R)&&(g.push(P+1),g.push(T),g.push(1-S))}return x}within(t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:p,nodeSize:d}=this,f=[0,l.length-1,0],g=[],x=n*n;for(;f.length;){let S=f.pop()||0,T=f.pop()||0,I=f.pop()||0;if(T-I<=d){for(let V=I;V<=T;V++)Ud(p[2*V],p[2*V+1],t,r)<=x&&g.push(l[V]);continue}let P=I+T>>1,B=p[2*P],R=p[2*P+1];Ud(B,R,t,r)<=x&&g.push(l[P]),(S===0?t-n<=B:r-n<=R)&&(f.push(I),f.push(P-1),f.push(1-S)),(S===0?t+n>=B:r+n>=R)&&(f.push(P+1),f.push(T),f.push(1-S))}return g}}function gh(i,t,r,n,l,p){if(l-n<=r)return;let d=n+l>>1;Vd(i,t,d,n,l,p),gh(i,t,r,n,d-1,1-p),gh(i,t,r,d+1,l,1-p)}function Vd(i,t,r,n,l,p){for(;l>n;){if(l-n>600){let x=l-n+1,S=r-n+1,T=Math.log(x),I=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*I*(x-I)/x)*(S-x/2<0?-1:1);Vd(i,t,r,Math.max(n,Math.floor(r-S*I/x+P)),Math.min(l,Math.floor(r+(x-S)*I/x+P)),p)}let d=t[2*r+p],f=n,g=l;for(vl(i,t,n,r),t[2*l+p]>d&&vl(i,t,n,l);f<g;){for(vl(i,t,f,g),f++,g--;t[2*f+p]<d;)f++;for(;t[2*g+p]>d;)g--}t[2*n+p]===d?vl(i,t,n,g):(g++,vl(i,t,g,l)),g<=r&&(n=g+1),r<=g&&(l=g-1)}}function vl(i,t,r,n){yh(i,r,n),yh(t,2*r,2*n),yh(t,2*r+1,2*n+1)}function yh(i,t,r){let n=i[t];i[t]=i[r],i[r]=n}function Ud(i,t,r,n){let l=i-r,p=t-n;return l*l+p*p}var _h;w.bg=void 0,(_h=w.bg||(w.bg={})).create="create",_h.load="load",_h.fullLoad="fullLoad";let Nc=null,xl=[],vh=1e3/60,xh="loadTime",bh="fullLoadTime",Tg={mark(i){performance.mark(i)},frame(i){let t=i;Nc!=null&&xl.push(t-Nc),Nc=t},clearMetrics(){Nc=null,xl=[],performance.clearMeasures(xh),performance.clearMeasures(bh);for(let i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(xh,w.bg.create,w.bg.load),performance.measure(bh,w.bg.create,w.bg.fullLoad);let i=performance.getEntriesByName(xh)[0].duration,t=performance.getEntriesByName(bh)[0].duration,r=xl.length,n=1/(xl.reduce((p,d)=>p+d,0)/r/1e3),l=xl.filter(p=>p>vh).reduce((p,d)=>p+(d-vh)/vh,0);return{loadTime:i,fullLoadTime:t,fps:n,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};w.$=class extends C{},w.A=Zs,w.B=Iu,w.C=function(i){if(yi==null){let t=i.navigator?i.navigator.userAgent:null;yi=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return yi},w.D=Le,w.E=jt,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yg(()=>this.process()),this.subscription=function(r,n,l,p){return r.addEventListener(n,l,!1),{unsubscribe:()=>{r.removeEventListener(n,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=pi(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,n)=>{let l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:n},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];let f={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(f)},{once:!0});let p=[],d=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:pn(i.data,p)});this.target.postMessage(d,{transfer:p})})}receive(i){let t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];let n=this.abortControllers[r];return delete this.abortControllers[r],void(n&&n.abort())}if(pi(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;let i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){let l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(dn(t.error)):l.resolve(dn(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=dn(t.data),n=new AbortController;this.abortControllers[i]=n;try{let l=yield this.messageHandlers[t.type](t.sourceMapId,r,n);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){let n=[];delete this.abortControllers[i];let l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?pn(t):null,data:pn(r,n)};this.target.postMessage(l,{transfer:n})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=Ut,w.H=function(){var i=new Zs(16);return Zs!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=ih,w.J=function(i,t,r){var n,l,p,d,f,g,x,S,T,I,P,B,R=r[0],V=r[1],Z=r[2];return t===i?(i[12]=t[0]*R+t[4]*V+t[8]*Z+t[12],i[13]=t[1]*R+t[5]*V+t[9]*Z+t[13],i[14]=t[2]*R+t[6]*V+t[10]*Z+t[14],i[15]=t[3]*R+t[7]*V+t[11]*Z+t[15]):(l=t[1],p=t[2],d=t[3],f=t[4],g=t[5],x=t[6],S=t[7],T=t[8],I=t[9],P=t[10],B=t[11],i[0]=n=t[0],i[1]=l,i[2]=p,i[3]=d,i[4]=f,i[5]=g,i[6]=x,i[7]=S,i[8]=T,i[9]=I,i[10]=P,i[11]=B,i[12]=n*R+f*V+T*Z+t[12],i[13]=l*R+g*V+I*Z+t[13],i[14]=p*R+x*V+P*Z+t[14],i[15]=d*R+S*V+B*Z+t[15]),i},w.K=function(i,t,r){var n=r[0],l=r[1],p=r[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=wp,w.M=function(i,t){let r={};for(let n=0;n<t.length;n++){let l=t[n];l in i&&(r[l]=i[l])}return r},w.N=En,w.O=yd,w.P=ne,w.Q=_d,w.R=Vr,w.S=Ur,w.T=Rs,w.U=xt,w.V=Tt,w.W=Lt,w.X=gi,w.Y=m,w.Z=yl,w._=c,w.a=pt,w.a$=function(i,t){var r=i[0],n=i[1],l=i[2],p=i[3],d=i[4],f=i[5],g=i[6],x=i[7],S=i[8],T=i[9],I=i[10],P=i[11],B=i[12],R=i[13],V=i[14],Z=i[15],oe=t[0],J=t[1],ae=t[2],he=t[3],ye=t[4],Ie=t[5],Ze=t[6],Ce=t[7],Ee=t[8],Oe=t[9],ze=t[10],Me=t[11],fe=t[12],Ne=t[13],Fe=t[14],Ye=t[15];return Math.abs(r-oe)<=er*Math.max(1,Math.abs(r),Math.abs(oe))&&Math.abs(n-J)<=er*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(l-ae)<=er*Math.max(1,Math.abs(l),Math.abs(ae))&&Math.abs(p-he)<=er*Math.max(1,Math.abs(p),Math.abs(he))&&Math.abs(d-ye)<=er*Math.max(1,Math.abs(d),Math.abs(ye))&&Math.abs(f-Ie)<=er*Math.max(1,Math.abs(f),Math.abs(Ie))&&Math.abs(g-Ze)<=er*Math.max(1,Math.abs(g),Math.abs(Ze))&&Math.abs(x-Ce)<=er*Math.max(1,Math.abs(x),Math.abs(Ce))&&Math.abs(S-Ee)<=er*Math.max(1,Math.abs(S),Math.abs(Ee))&&Math.abs(T-Oe)<=er*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(I-ze)<=er*Math.max(1,Math.abs(I),Math.abs(ze))&&Math.abs(P-Me)<=er*Math.max(1,Math.abs(P),Math.abs(Me))&&Math.abs(B-fe)<=er*Math.max(1,Math.abs(B),Math.abs(fe))&&Math.abs(R-Ne)<=er*Math.max(1,Math.abs(R),Math.abs(Ne))&&Math.abs(V-Fe)<=er*Math.max(1,Math.abs(V),Math.abs(Fe))&&Math.abs(Z-Ye)<=er*Math.max(1,Math.abs(Z),Math.abs(Ye))},w.a0=vt,w.a1=ph,w.a2=ve,w.a3=i=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(let n of i){let l=window.document.createElement("source");nt(n)||(t.crossOrigin="Anonymous"),l.src=n,t.appendChild(l)}})},w.a4=function(){return Ue++},w.a5=De,w.a6=Ys,w.a7=Fo,w.a8=es,w.a9=Ad,w.aA=function(i){if(i.type==="custom")return new gg(i);switch(i.type){case"background":return new dg(i);case"circle":return new e0(i);case"fill":return new y0(i);case"fill-extrusion":return new P0(i);case"heatmap":return new i0(i);case"hillshade":return new a0(i);case"line":return new q0(i);case"raster":return new mg(i);case"symbol":return new Lc(i)}},w.aB=Ve,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!ct(i.version,t.version))return[{command:"setStyle",args:[t]}];ct(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),ct(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),ct(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),ct(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),ct(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),ct(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),ct(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),ct(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),ct(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),ct(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),ct(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});let n={},l=[];(function(d,f,g,x){let S;for(S in f=f||{},d=d||{})Object.prototype.hasOwnProperty.call(d,S)&&(Object.prototype.hasOwnProperty.call(f,S)||Pr(S,g,x));for(S in f)Object.prototype.hasOwnProperty.call(f,S)&&(Object.prototype.hasOwnProperty.call(d,S)?ct(d[S],f[S])||(d[S].type==="geojson"&&f[S].type==="geojson"&&Qr(d,f,S)?Bt(g,{command:"setGeoJSONSourceData",args:[S,f[S].data]}):Wi(S,f,g,x)):_r(S,f,g))})(i.sources,t.sources,l,n);let p=[];i.layers&&i.layers.forEach(d=>{"source"in d&&n[d.source]?r.push({command:"removeLayer",args:[d.id]}):p.push(d)}),r=r.concat(l),function(d,f,g){f=f||[];let x=(d=d||[]).map(ua),S=f.map(ua),T=d.reduce(Ea,{}),I=f.reduce(Ea,{}),P=x.slice(),B=Object.create(null),R,V,Z,oe,J;for(let ae=0,he=0;ae<x.length;ae++)R=x[ae],Object.prototype.hasOwnProperty.call(I,R)?he++:(Bt(g,{command:"removeLayer",args:[R]}),P.splice(P.indexOf(R,he),1));for(let ae=0,he=0;ae<S.length;ae++)R=S[S.length-1-ae],P[P.length-1-ae]!==R&&(Object.prototype.hasOwnProperty.call(T,R)?(Bt(g,{command:"removeLayer",args:[R]}),P.splice(P.lastIndexOf(R,P.length-he),1)):he++,oe=P[P.length-ae],Bt(g,{command:"addLayer",args:[I[R],oe]}),P.splice(P.length-ae,0,R),B[R]=!0);for(let ae=0;ae<S.length;ae++)if(R=S[ae],V=T[R],Z=I[R],!B[R]&&!ct(V,Z))if(ct(V.source,Z.source)&&ct(V["source-layer"],Z["source-layer"])&&ct(V.type,Z.type)){for(J in Vi(V.layout,Z.layout,g,R,null,"setLayoutProperty"),Vi(V.paint,Z.paint,g,R,null,"setPaintProperty"),ct(V.filter,Z.filter)||Bt(g,{command:"setFilter",args:[R,Z.filter]}),ct(V.minzoom,Z.minzoom)&&ct(V.maxzoom,Z.maxzoom)||Bt(g,{command:"setLayerZoomRange",args:[R,Z.minzoom,Z.maxzoom]}),V)Object.prototype.hasOwnProperty.call(V,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Vi(V[J],Z[J],g,R,J.slice(6),"setPaintProperty"):ct(V[J],Z[J])||Bt(g,{command:"setLayerProperty",args:[R,J,Z[J]]}));for(J in Z)Object.prototype.hasOwnProperty.call(Z,J)&&!Object.prototype.hasOwnProperty.call(V,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Vi(V[J],Z[J],g,R,J.slice(6),"setPaintProperty"):ct(V[J],Z[J])||Bt(g,{command:"setLayerProperty",args:[R,J,Z[J]]}))}else Bt(g,{command:"removeLayer",args:[R]}),oe=P[P.lastIndexOf(R)+1],Bt(g,{command:"addLayer",args:[Z,oe]})}(p,t.layers,r)}catch(n){console.warn("Unable to compute style diff:",n),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(i){let t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!i(t[n],r[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let n in t)if(!i(t[n],r[n]))return!1;return!0}return t===r},w.aF=je,w.aG=ht,w.aH=class extends Jn{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=bc,w.aJ=class extends Jn{constructor(i,t){super(i,t),this.current=Zm}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=hp,w.aL=pp,w.aM=zt,w.aN=class extends Jn{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends Jn{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,r,n,l,p,d){var f=1/(t-r),g=1/(n-l),x=1/(p-d);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(t+r)*f,i[13]=(l+n)*g,i[14]=(d+p)*x,i[15]=1,i},w.aQ=Qm,w.aR=class extends te{},w.aS=$0,w.aT=class extends le{},w.aU=$u,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=Cp,w.aX=Li,w.aY=qr,w.aZ=class extends Be{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){let t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,l,p)=>{let d=l||p;return t[n]=!d||d.toLowerCase(),""}),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(i,t){let r=[];for(let n in i)n in t||r.push(n);return r},w.ac=dt,w.ad=function(i,t,r){var n=Math.sin(r),l=Math.cos(r),p=t[0],d=t[1],f=t[2],g=t[3],x=t[4],S=t[5],T=t[6],I=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*l+x*n,i[1]=d*l+S*n,i[2]=f*l+T*n,i[3]=g*l+I*n,i[4]=x*l-p*n,i[5]=S*l-d*n,i[6]=T*l-f*n,i[7]=I*l-g*n,i},w.ae=function(i){var t=new Zs(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=Ec,w.ag=function(i,t){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:l,minZoom:p,maxZoom:d}=i,f=l?dt(Yi.interpolationFactor(l,t,p,d),0,1):0;i.kind==="camera"?n=Ji.number(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:n}},w.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:l}){return i.kind==="source"?n/ga:i.kind==="composite"?Ji.number(n/ga,l/ga,r):t},w.aj=sh,w.ak=function(i,t,r,n){let l=t.y-i.y,p=t.x-i.x,d=n.y-r.y,f=n.x-r.x,g=d*p-f*l;if(g===0)return null;let x=(f*(i.y-r.y)-d*(i.x-r.x))/g;return new ne(i.x+x*p,i.y+x*l)},w.al=Dd,w.am=gp,w.an=Vu,w.ao=function(i){let t=1/0,r=1/0,n=-1/0,l=-1/0;for(let p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),n=Math.max(n,p.x),l=Math.max(l,p.y);return[t,r,n,l]},w.ap=vi,w.ar=nh,w.as=function(i,t){var r=t[0],n=t[1],l=t[2],p=t[3],d=t[4],f=t[5],g=t[6],x=t[7],S=t[8],T=t[9],I=t[10],P=t[11],B=t[12],R=t[13],V=t[14],Z=t[15],oe=r*f-n*d,J=r*g-l*d,ae=r*x-p*d,he=n*g-l*f,ye=n*x-p*f,Ie=l*x-p*g,Ze=S*R-T*B,Ce=S*V-I*B,Ee=S*Z-P*B,Oe=T*V-I*R,ze=T*Z-P*R,Me=I*Z-P*V,fe=oe*Me-J*ze+ae*Oe+he*Ee-ye*Ce+Ie*Ze;return fe?(i[0]=(f*Me-g*ze+x*Oe)*(fe=1/fe),i[1]=(l*ze-n*Me-p*Oe)*fe,i[2]=(R*Ie-V*ye+Z*he)*fe,i[3]=(I*ye-T*Ie-P*he)*fe,i[4]=(g*Ee-d*Me-x*Ce)*fe,i[5]=(r*Me-l*Ee+p*Ce)*fe,i[6]=(V*ae-B*Ie-Z*J)*fe,i[7]=(S*Ie-I*ae+P*J)*fe,i[8]=(d*ze-f*Ee+x*Ze)*fe,i[9]=(n*Ee-r*ze-p*Ze)*fe,i[10]=(B*ye-R*ae+Z*oe)*fe,i[11]=(T*ae-S*ye-P*oe)*fe,i[12]=(f*Ce-d*Oe-g*Ze)*fe,i[13]=(r*Oe-n*Ce+l*Ze)*fe,i[14]=(R*J-B*he-V*oe)*fe,i[15]=(S*he-T*J+I*oe)*fe,i):null},w.at=fh,w.au=ah,w.av=mh,w.aw=function(){let i={},t=ce.$version;for(let r in ce.$root){let n=ce.$root[r];if(n.required){let l=null;l=r==="version"?t:n.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},w.ax=Jo,w.ay=ci,w.az=function(i){i=i.slice();let t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Mr(i[r],t[i[r].ref]));return i},w.b=oi,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=Ht,w.b4=bd,w.b5=vd,w.b6=function(i,t,r,n,l){var p,d=1/Math.tan(t/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+n)*(p=1/(n-l)),i[14]=2*l*n*p):(i[10]=-1,i[14]=-2*n),i},w.b7=function(i,t,r){var n=Math.sin(r),l=Math.cos(r),p=t[4],d=t[5],f=t[6],g=t[7],x=t[8],S=t[9],T=t[10],I=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*l+x*n,i[5]=d*l+S*n,i[6]=f*l+T*n,i[7]=g*l+I*n,i[8]=x*l-p*n,i[9]=S*l-d*n,i[10]=T*l-f*n,i[11]=I*l-g*n,i},w.b8=yt,w.b9=yr,w.bA=Hp,w.bB=function(i){return i.message===ft},w.bC=nn,w.bD=pr,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){let{x:r,y:n}=yl.fromLngLat(t);return!(i<0||i>25||n<0||n>=1||r<0||r>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends A{},w.be=uh,w.bf=Tg,w.bh=lt,w.bi=function(i,t){pt.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete pt.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){let r={};for(let l=0;l<i.length;l++){let p=t&&t[i[l].id]||cc(i[l]);t&&(t[i[l].id]=p);let d=r[p];d||(d=r[p]=[]),d.push(i[l])}let n=[];for(let l in r)n.push(r[l]);return n},w.bl=Pe,w.bm=Sd,w.bn=Ed,w.bo=id,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=gi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;let t=i.bucket.layers[0],r=t.layout,n=t._unevaluatedLayout._values,l={layoutIconSize:n["icon-size"].possiblyEvaluate(new Wt(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Wt(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Wt(18))};if(i.bucket.textSizeData.kind==="composite"){let{minZoom:x,maxZoom:S}=i.bucket.textSizeData;l.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Wt(x),i.canonical),n["text-size"].possiblyEvaluate(new Wt(S),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){let{minZoom:x,maxZoom:S}=i.bucket.iconSizeData;l.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Wt(x),i.canonical),n["icon-size"].possiblyEvaluate(new Wt(S),i.canonical)]}let p=r.get("text-line-height")*vi,d=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",f=r.get("text-keep-upright"),g=r.get("text-size");for(let x of i.bucket.features){let S=r.get("text-font").evaluate(x,{},i.canonical).join(","),T=g.evaluate(x,{},i.canonical),I=l.layoutTextSize.evaluate(x,{},i.canonical),P=l.layoutIconSize.evaluate(x,{},i.canonical),B={horizontal:{},vertical:void 0},R=x.text,V,Z=[0,0];if(R){let ae=R.toString(),he=r.get("text-letter-spacing").evaluate(x,{},i.canonical)*vi,ye=ku(ae)?he:0,Ie=r.get("text-anchor").evaluate(x,{},i.canonical),Ze=Fd(t,x,i.canonical);if(!Ze){let ze=r.get("text-radial-offset").evaluate(x,{},i.canonical);Z=ze?Rd(Ie,[ze*vi,dh]):r.get("text-offset").evaluate(x,{},i.canonical).map(Me=>Me*vi)}let Ce=d?"center":r.get("text-justify").evaluate(x,{},i.canonical),Ee=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(x,{},i.canonical)*vi:1/0,Oe=()=>{i.bucket.allowVerticalPlacement&&Yo(ae)&&(B.vertical=Mc(R,i.glyphMap,i.glyphPositions,i.imagePositions,S,Ee,p,Ie,"left",ye,Z,w.ah.vertical,!0,I,T))};if(!d&&Ze){let ze=new Set;if(Ce==="auto")for(let fe=0;fe<Ze.values.length;fe+=2)ze.add(fh(Ze.values[fe]));else ze.add(Ce);let Me=!1;for(let fe of ze)if(!B.horizontal[fe])if(Me)B.horizontal[fe]=B.horizontal[0];else{let Ne=Mc(R,i.glyphMap,i.glyphPositions,i.imagePositions,S,Ee,p,"center",fe,ye,Z,w.ah.horizontal,!1,I,T);Ne&&(B.horizontal[fe]=Ne,Me=Ne.positionedLines.length===1)}Oe()}else{Ce==="auto"&&(Ce=fh(Ie));let ze=Mc(R,i.glyphMap,i.glyphPositions,i.imagePositions,S,Ee,p,Ie,Ce,ye,Z,w.ah.horizontal,!1,I,T);ze&&(B.horizontal[Ce]=ze),Oe(),Yo(ae)&&d&&f&&(B.vertical=Mc(R,i.glyphMap,i.glyphPositions,i.imagePositions,S,Ee,p,Ie,Ce,ye,Z,w.ah.vertical,!1,I,T))}}let oe=!1;if(x.icon&&x.icon.name){let ae=i.imageMap[x.icon.name];ae&&(V=lg(i.imagePositions[x.icon.name],r.get("icon-offset").evaluate(x,{},i.canonical),r.get("icon-anchor").evaluate(x,{},i.canonical)),oe=!!ae.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=oe:i.bucket.sdfIcons!==oe&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}let J=Nd(B.horizontal)||B.vertical;i.bucket.iconsInText=!!J&&J.iconsInText,(J||V)&&Ag(i.bucket,x,B,V,i.imageMap,l,I,P,Z,oe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=Yu,w.br=Xu,w.bs=Ju,w.bt=wn,w.bu=eh,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,r,n,l){return c(this,void 0,void 0,function*(){if(Tt())try{return yield Lt(i,t,r,n,l)}catch{}return function(p,d,f,g,x){let S=p.width,T=p.height;wi&&li||(wi=new OffscreenCanvas(S,T),li=wi.getContext("2d",{willReadFrequently:!0})),wi.width=S,wi.height=T,li.drawImage(p,0,0,S,T);let I=li.getImageData(d,f,g,x);return li.clearRect(0,0,S,T),I.data}(i,t,r,n,l)})},w.bx=wd,w.by=Q,w.bz=ee,w.c=Dt,w.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=bi,w.f=i=>new Promise((t,r)=>{let n=new Image;n.onload=()=>{t(n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=kt})},n.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let l=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(l):kt}),w.g=Mt,w.h=(i,t)=>Ge(bi(i,{type:"json"}),t),w.i=pi,w.j=_i,w.k=di,w.l=(i,t)=>Ge(bi(i,{type:"arrayBuffer"}),t),w.m=Ge,w.n=function(i){return new eh(i).readFields(tg,[])},w.o=ol,w.p=td,w.q=h,w.r=Du,w.s=nt,w.t=Xo,w.u=Fa,w.v=ce,w.w=et,w.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.y=Ji,w.z=Wt}),E("worker",["./shared"],function(w){"use strict";class c{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,k){for(let U of M){this._layerConfigs[U.id]=U;let Y=this._layers[U.id]=w.aA(U);Y._featureFilter=w.a7(Y.filter),this.keyCache[U.id]&&delete this.keyCache[U.id]}for(let U of k)delete this.keyCache[U],delete this._layerConfigs[U],delete this._layers[U];this.familiesBySource={};let O=w.bk(Object.values(this._layerConfigs),this.keyCache);for(let U of O){let Y=U.map(ue=>this._layers[ue.id]),ie=Y[0];if(ie.visibility==="none")continue;let se=ie.source||"",X=this.familiesBySource[se];X||(X=this.familiesBySource[se]={});let pe=ie.sourceLayer||"_geojsonTileLayer",ge=X[pe];ge||(ge=X[pe]=[]),ge.push(Y)}}}class Q{constructor(M){let k={},O=[];for(let se in M){let X=M[se],pe=k[se]={};for(let ge in X){let ue=X[+ge];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;let be={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};O.push(be),pe[ge]={rect:be,metrics:ue.metrics}}}let{w:U,h:Y}=w.p(O),ie=new w.o({width:U||1,height:Y||1});for(let se in M){let X=M[se];for(let pe in X){let ge=X[+pe];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;let ue=k[se][pe].rect;w.o.copy(ge.bitmap,ie,{x:0,y:0},{x:ue.x+1,y:ue.y+1},ge.bitmap)}}this.image=ie,this.positions=k}}w.bl("GlyphAtlas",Q);class ee{constructor(M){this.tileID=new w.S(M.tileID.overscaledZ,M.tileID.wrap,M.tileID.canonical.z,M.tileID.canonical.x,M.tileID.canonical.y),this.uid=M.uid,this.zoom=M.zoom,this.pixelRatio=M.pixelRatio,this.tileSize=M.tileSize,this.source=M.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=M.showCollisionBoxes,this.collectResourceTiming=!!M.collectResourceTiming,this.returnDependencies=!!M.returnDependencies,this.promoteId=M.promoteId,this.inFlightDependencies=[]}parse(M,k,O,U){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=M,this.collisionBoxArray=new w.a5;let Y=new w.bm(Object.keys(M.layers).sort()),ie=new w.bn(this.tileID,this.promoteId);ie.bucketLayerIDs=[];let se={},X={featureIndex:ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},pe=k.familiesBySource[this.source];for(let st in pe){let Pt=M.layers[st];if(!Pt)continue;Pt.version===1&&w.w(`Vector tile source "${this.source}" layer "${st}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ei=Y.encode(st),Ai=[];for(let Ii=0;Ii<Pt.length;Ii++){let Ui=Pt.feature(Ii),Ha=ie.getId(Ui,st);Ai.push({feature:Ui,id:Ha,index:Ii,sourceLayerIndex:ei})}for(let Ii of pe[st]){let Ui=Ii[0];Ui.source!==this.source&&w.w(`layer.source = ${Ui.source} does not equal this.source = ${this.source}`),Ui.minzoom&&this.zoom<Math.floor(Ui.minzoom)||Ui.maxzoom&&this.zoom>=Ui.maxzoom||Ui.visibility!=="none"&&(de(Ii,this.zoom,O),(se[Ui.id]=Ui.createBucket({index:ie.bucketLayerIDs.length,layers:Ii,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ei,sourceID:this.source})).populate(Ai,X,this.tileID.canonical),ie.bucketLayerIDs.push(Ii.map(Ha=>Ha.id)))}}let ge=w.aF(X.glyphDependencies,st=>Object.keys(st).map(Number));this.inFlightDependencies.forEach(st=>st?.abort()),this.inFlightDependencies=[];let ue=Promise.resolve({});if(Object.keys(ge).length){let st=new AbortController;this.inFlightDependencies.push(st),ue=U.sendAsync({type:"GG",data:{stacks:ge,source:this.source,tileID:this.tileID,type:"glyphs"}},st)}let be=Object.keys(X.iconDependencies),qe=Promise.resolve({});if(be.length){let st=new AbortController;this.inFlightDependencies.push(st),qe=U.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},st)}let $e=Object.keys(X.patternDependencies),bt=Promise.resolve({});if($e.length){let st=new AbortController;this.inFlightDependencies.push(st),bt=U.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"patterns"}},st)}let[it,wt,mt]=yield Promise.all([ue,qe,bt]),fi=new Q(it),ii=new w.bo(wt,mt);for(let st in se){let Pt=se[st];Pt instanceof w.a6?(de(Pt.layers,this.zoom,O),w.bp({bucket:Pt,glyphMap:it,glyphPositions:fi.positions,imageMap:wt,imagePositions:ii.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Pt.hasPattern&&(Pt instanceof w.bq||Pt instanceof w.br||Pt instanceof w.bs)&&(de(Pt.layers,this.zoom,O),Pt.addFeatures(X,this.tileID.canonical,ii.patternPositions))}return this.status="done",{buckets:Object.values(se).filter(st=>!st.isEmpty()),featureIndex:ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fi.image,imageAtlas:ii,glyphMap:this.returnDependencies?it:null,iconMap:this.returnDependencies?wt:null,glyphPositions:this.returnDependencies?fi.positions:null}})}}function de(G,M,k){let O=new w.z(M);for(let U of G)U.recalculate(O,k)}class ne{constructor(M,k,O){this.actor=M,this.layerIndex=k,this.availableImages=O,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(M,k){return w._(this,void 0,void 0,function*(){let O=yield w.l(M.request,k);try{return{vectorTile:new w.bt.VectorTile(new w.bu(O.data)),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(U){let Y=new Uint8Array(O.data),ie=`Unable to parse the tile at ${M.request.url}, `;throw ie+=Y[0]===31&&Y[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${U.message}`,new Error(ie)}})}loadTile(M){return w._(this,void 0,void 0,function*(){let k=M.uid,O=!!(M&&M.request&&M.request.collectResourceTiming)&&new w.bv(M.request),U=new ee(M);this.loading[k]=U;let Y=new AbortController;U.abort=Y;try{let ie=yield this.loadVectorTile(M,Y);if(delete this.loading[k],!ie)return null;let se=ie.rawData,X={};ie.expires&&(X.expires=ie.expires),ie.cacheControl&&(X.cacheControl=ie.cacheControl);let pe={};if(O){let ue=O.finish();ue&&(pe.resourceTiming=JSON.parse(JSON.stringify(ue)))}U.vectorTile=ie.vectorTile;let ge=U.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[k]=U,this.fetching[k]={rawTileData:se,cacheControl:X,resourceTiming:pe};try{let ue=yield ge;return w.e({rawTileData:se.slice(0)},ue,X,pe)}finally{delete this.fetching[k]}}catch(ie){throw delete this.loading[k],U.status="done",this.loaded[k]=U,ie}})}reloadTile(M){return w._(this,void 0,void 0,function*(){let k=M.uid;if(!this.loaded||!this.loaded[k])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let O=this.loaded[k];if(O.showCollisionBoxes=M.showCollisionBoxes,O.status==="parsing"){let U=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor),Y;if(this.fetching[k]){let{rawTileData:ie,cacheControl:se,resourceTiming:X}=this.fetching[k];delete this.fetching[k],Y=w.e({rawTileData:ie.slice(0)},U,se,X)}else Y=U;return Y}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(M){return w._(this,void 0,void 0,function*(){let k=this.loading,O=M.uid;k&&k[O]&&k[O].abort&&(k[O].abort.abort(),delete k[O])})}removeTile(M){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[M.uid]&&delete this.loaded[M.uid]})}}class ${constructor(){this.loaded={}}loadTile(M){return w._(this,void 0,void 0,function*(){let{uid:k,encoding:O,rawImageData:U,redFactor:Y,greenFactor:ie,blueFactor:se,baseShift:X}=M,pe=U.width+2,ge=U.height+2,ue=w.b(U)?new w.R({width:pe,height:ge},yield w.bw(U,-1,-1,pe,ge)):U,be=new w.bx(k,ue,O,Y,ie,se,X);return this.loaded=this.loaded||{},this.loaded[k]=be,be})}removeTile(M){let k=this.loaded,O=M.uid;k&&k[O]&&delete k[O]}}function Re(G,M){if(G.length!==0){Xe(G[0],M);for(var k=1;k<G.length;k++)Xe(G[k],!M)}}function Xe(G,M){for(var k=0,O=0,U=0,Y=G.length,ie=Y-1;U<Y;ie=U++){var se=(G[U][0]-G[ie][0])*(G[ie][1]+G[U][1]),X=k+se;O+=Math.abs(k)>=Math.abs(se)?k-X+se:se-X+k,k=X}k+O>=0!=!!M&&G.reverse()}var ot=w.by(function G(M,k){var O,U=M&&M.type;if(U==="FeatureCollection")for(O=0;O<M.features.length;O++)G(M.features[O],k);else if(U==="GeometryCollection")for(O=0;O<M.geometries.length;O++)G(M.geometries[O],k);else if(U==="Feature")G(M.geometry,k);else if(U==="Polygon")Re(M.coordinates,k);else if(U==="MultiPolygon")for(O=0;O<M.coordinates.length;O++)Re(M.coordinates[O],k);return M});let St=w.bt.VectorTileFeature.prototype.toGeoJSON;var xt={exports:{}},Tt=w.bz,yt=w.bt.VectorTileFeature,yr=dt;function dt(G,M){this.options=M||{},this.features=G,this.length=G.length}function Ht(G,M){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=M||4096}dt.prototype.feature=function(G){return new Ht(this.features[G],this.options.extent)},Ht.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var M=0;M<G.length;M++){for(var k=G[M],O=[],U=0;U<k.length;U++)O.push(new Tt(k[U][0],k[U][1]));this.geometry.push(O)}return this.geometry},Ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,M=1/0,k=-1/0,O=1/0,U=-1/0,Y=0;Y<G.length;Y++)for(var ie=G[Y],se=0;se<ie.length;se++){var X=ie[se];M=Math.min(M,X.x),k=Math.max(k,X.x),O=Math.min(O,X.y),U=Math.max(U,X.y)}return[M,O,k,U]},Ht.prototype.toGeoJSON=yt.prototype.toGeoJSON;var bi=w.bA,Ue=yr;function je(G){var M=new bi;return function(k,O){for(var U in k.layers)O.writeMessage(3,ht,k.layers[U])}(G,M),M.finish()}function ht(G,M){var k;M.writeVarintField(15,G.version||1),M.writeStringField(1,G.name||""),M.writeVarintField(5,G.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(k=0;k<G.length;k++)O.feature=G.feature(k),M.writeMessage(2,Ve,O);var U=O.keys;for(k=0;k<U.length;k++)M.writeStringField(3,U[k]);var Y=O.values;for(k=0;k<Y.length;k++)M.writeMessage(4,yi,Y[k])}function Ve(G,M){var k=G.feature;k.id!==void 0&&M.writeVarintField(1,k.id),M.writeMessage(2,Qt,G),M.writeVarintField(3,k.type),M.writeMessage(4,pi,k)}function Qt(G,M){var k=G.feature,O=G.keys,U=G.values,Y=G.keycache,ie=G.valuecache;for(var se in k.properties){var X=k.properties[se],pe=Y[se];if(X!==null){pe===void 0&&(O.push(se),Y[se]=pe=O.length-1),M.writeVarint(pe);var ge=typeof X;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(X=JSON.stringify(X));var ue=ge+":"+X,be=ie[ue];be===void 0&&(U.push(X),ie[ue]=be=U.length-1),M.writeVarint(be)}}}function et(G,M){return(M<<3)+(7&G)}function Nt(G){return G<<1^G>>31}function pi(G,M){for(var k=G.loadGeometry(),O=G.type,U=0,Y=0,ie=k.length,se=0;se<ie;se++){var X=k[se],pe=1;O===1&&(pe=X.length),M.writeVarint(et(1,pe));for(var ge=O===3?X.length-1:X.length,ue=0;ue<ge;ue++){ue===1&&O!==1&&M.writeVarint(et(2,ge-1));var be=X[ue].x-U,qe=X[ue].y-Y;M.writeVarint(Nt(be)),M.writeVarint(Nt(qe)),U+=be,Y+=qe}O===3&&M.writeVarint(et(7,1))}}function yi(G,M){var k=typeof G;k==="string"?M.writeStringField(1,G):k==="boolean"?M.writeBooleanField(7,G):k==="number"&&(G%1!=0?M.writeDoubleField(3,G):G<0?M.writeSVarintField(6,G):M.writeVarintField(5,G))}xt.exports=je,xt.exports.fromVectorTileJs=je,xt.exports.fromGeojsonVt=function(G,M){M=M||{};var k={};for(var O in G)k[O]=new Ue(G[O].features,M),k[O].name=O,k[O].version=M.version,k[O].extent=M.extent;return je({layers:k})},xt.exports.GeoJSONWrapper=Ue;var oi=w.by(xt.exports);let kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},Lt=Math.fround||(wi=new Float32Array(1),G=>(wi[0]=+G,wi[0]));var wi;let li=3,ft=5,Dt=6;class pt{constructor(M){this.options=Object.assign(Object.create(kt),M),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(M){let{log:k,minZoom:O,maxZoom:U}=this.options;k&&console.time("total time");let Y=`prepare ${M.length} points`;k&&console.time(Y),this.points=M;let ie=[];for(let X=0;X<M.length;X++){let pe=M[X];if(!pe.geometry)continue;let[ge,ue]=pe.geometry.coordinates,be=Lt(lt(ge)),qe=Lt(ci(ue));ie.push(be,qe,1/0,X,-1,1),this.options.reduce&&ie.push(0)}let se=this.trees[U+1]=this._createTree(ie);k&&console.timeEnd(Y);for(let X=U;X>=O;X--){let pe=+Date.now();se=this.trees[X]=this._createTree(this._cluster(se,X)),k&&console.log("z%d: %d clusters in %dms",X,se.numItems,+Date.now()-pe)}return k&&console.timeEnd("total time"),this}getClusters(M,k){let O=((M[0]+180)%360+360)%360-180,U=Math.max(-90,Math.min(90,M[1])),Y=M[2]===180?180:((M[2]+180)%360+360)%360-180,ie=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)O=-180,Y=180;else if(O>Y){let ue=this.getClusters([O,U,180,ie],k),be=this.getClusters([-180,U,Y,ie],k);return ue.concat(be)}let se=this.trees[this._limitZoom(k)],X=se.range(lt(O),ci(ie),lt(Y),ci(U)),pe=se.data,ge=[];for(let ue of X){let be=this.stride*ue;ge.push(pe[be+ft]>1?Mt(pe,be,this.clusterProps):this.points[pe[be+li]])}return ge}getChildren(M){let k=this._getOriginId(M),O=this._getOriginZoom(M),U="No cluster with the specified id.",Y=this.trees[O];if(!Y)throw new Error(U);let ie=Y.data;if(k*this.stride>=ie.length)throw new Error(U);let se=this.options.radius/(this.options.extent*Math.pow(2,O-1)),X=Y.within(ie[k*this.stride],ie[k*this.stride+1],se),pe=[];for(let ge of X){let ue=ge*this.stride;ie[ue+4]===M&&pe.push(ie[ue+ft]>1?Mt(ie,ue,this.clusterProps):this.points[ie[ue+li]])}if(pe.length===0)throw new Error(U);return pe}getLeaves(M,k,O){let U=[];return this._appendLeaves(U,M,k=k||10,O=O||0,0),U}getTile(M,k,O){let U=this.trees[this._limitZoom(M)],Y=Math.pow(2,M),{extent:ie,radius:se}=this.options,X=se/ie,pe=(O-X)/Y,ge=(O+1+X)/Y,ue={features:[]};return this._addTileFeatures(U.range((k-X)/Y,pe,(k+1+X)/Y,ge),U.data,k,O,Y,ue),k===0&&this._addTileFeatures(U.range(1-X/Y,pe,1,ge),U.data,Y,O,Y,ue),k===Y-1&&this._addTileFeatures(U.range(0,pe,X/Y,ge),U.data,-1,O,Y,ue),ue.features.length?ue:null}getClusterExpansionZoom(M){let k=this._getOriginZoom(M)-1;for(;k<=this.options.maxZoom;){let O=this.getChildren(M);if(k++,O.length!==1)break;M=O[0].properties.cluster_id}return k}_appendLeaves(M,k,O,U,Y){let ie=this.getChildren(k);for(let se of ie){let X=se.properties;if(X&&X.cluster?Y+X.point_count<=U?Y+=X.point_count:Y=this._appendLeaves(M,X.cluster_id,O,U,Y):Y<U?Y++:M.push(se),M.length===O)break}return Y}_createTree(M){let k=new w.av(M.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<M.length;O+=this.stride)k.add(M[O],M[O+1]);return k.finish(),k.data=M,k}_addTileFeatures(M,k,O,U,Y,ie){for(let se of M){let X=se*this.stride,pe=k[X+ft]>1,ge,ue,be;if(pe)ge=Ut(k,X,this.clusterProps),ue=k[X],be=k[X+1];else{let bt=this.points[k[X+li]];ge=bt.properties;let[it,wt]=bt.geometry.coordinates;ue=lt(it),be=ci(wt)}let qe={type:1,geometry:[[Math.round(this.options.extent*(ue*Y-O)),Math.round(this.options.extent*(be*Y-U))]],tags:ge},$e;$e=pe||this.options.generateId?k[X+li]:this.points[k[X+li]].id,$e!==void 0&&(qe.id=$e),ie.features.push(qe)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(Math.floor(+M),this.options.maxZoom+1))}_cluster(M,k){let{radius:O,extent:U,reduce:Y,minPoints:ie}=this.options,se=O/(U*Math.pow(2,k)),X=M.data,pe=[],ge=this.stride;for(let ue=0;ue<X.length;ue+=ge){if(X[ue+2]<=k)continue;X[ue+2]=k;let be=X[ue],qe=X[ue+1],$e=M.within(X[ue],X[ue+1],se),bt=X[ue+ft],it=bt;for(let wt of $e){let mt=wt*ge;X[mt+2]>k&&(it+=X[mt+ft])}if(it>bt&&it>=ie){let wt,mt=be*bt,fi=qe*bt,ii=-1,st=((ue/ge|0)<<5)+(k+1)+this.points.length;for(let Pt of $e){let ei=Pt*ge;if(X[ei+2]<=k)continue;X[ei+2]=k;let Ai=X[ei+ft];mt+=X[ei]*Ai,fi+=X[ei+1]*Ai,X[ei+4]=st,Y&&(wt||(wt=this._map(X,ue,!0),ii=this.clusterProps.length,this.clusterProps.push(wt)),Y(wt,this._map(X,ei)))}X[ue+4]=st,pe.push(mt/it,fi/it,1/0,st,-1,it),Y&&pe.push(ii)}else{for(let wt=0;wt<ge;wt++)pe.push(X[ue+wt]);if(it>1)for(let wt of $e){let mt=wt*ge;if(!(X[mt+2]<=k)){X[mt+2]=k;for(let fi=0;fi<ge;fi++)pe.push(X[mt+fi])}}}}return pe}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,k,O){if(M[k+ft]>1){let ie=this.clusterProps[M[k+Dt]];return O?Object.assign({},ie):ie}let U=this.points[M[k+li]].properties,Y=this.options.map(U);return O&&Y===U?Object.assign({},Y):Y}}function Mt(G,M,k){return{type:"Feature",id:G[M+li],properties:Ut(G,M,k),geometry:{type:"Point",coordinates:[(O=G[M],360*(O-.5)),Ge(G[M+1])]}};var O}function Ut(G,M,k){let O=G[M+ft],U=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,Y=G[M+Dt],ie=Y===-1?{}:Object.assign({},k[Y]);return Object.assign(ie,{cluster:!0,cluster_id:G[M+li],point_count:O,point_count_abbreviated:U})}function lt(G){return G/360+.5}function ci(G){let M=Math.sin(G*Math.PI/180),k=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return k<0?0:k>1?1:k}function Ge(G){let M=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function nt(G,M,k,O){let U=O,Y=M+(k-M>>1),ie,se=k-M,X=G[M],pe=G[M+1],ge=G[k],ue=G[k+1];for(let be=M+3;be<k;be+=3){let qe=qt(G[be],G[be+1],X,pe,ge,ue);if(qe>U)ie=be,U=qe;else if(qe===U){let $e=Math.abs(be-Y);$e<se&&(ie=be,se=$e)}}U>O&&(ie-M>3&&nt(G,M,ie,O),G[ie+2]=U,k-ie>3&&nt(G,ie,k,O))}function qt(G,M,k,O,U,Y){let ie=U-k,se=Y-O;if(ie!==0||se!==0){let X=((G-k)*ie+(M-O)*se)/(ie*ie+se*se);X>1?(k=U,O=Y):X>0&&(k+=ie*X,O+=se*X)}return ie=G-k,se=M-O,ie*ie+se*se}function tt(G,M,k,O){let U={id:G??null,type:M,geometry:k,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(M==="Point"||M==="MultiPoint"||M==="LineString")di(U,k);else if(M==="Polygon")di(U,k[0]);else if(M==="MultiLineString")for(let Y of k)di(U,Y);else if(M==="MultiPolygon")for(let Y of k)di(U,Y[0]);return U}function di(G,M){for(let k=0;k<M.length;k+=3)G.minX=Math.min(G.minX,M[k]),G.minY=Math.min(G.minY,M[k+1]),G.maxX=Math.max(G.maxX,M[k]),G.maxY=Math.max(G.maxY,M[k+1])}function _i(G,M,k,O){if(!M.geometry)return;let U=M.geometry.coordinates;if(U&&U.length===0)return;let Y=M.geometry.type,ie=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2),se=[],X=M.id;if(k.promoteId?X=M.properties[k.promoteId]:k.generateId&&(X=O||0),Y==="Point")jt(U,se);else if(Y==="MultiPoint")for(let pe of U)jt(pe,se);else if(Y==="LineString")ce(U,se,ie,!1);else if(Y==="MultiLineString"){if(k.lineMetrics){for(let pe of U)se=[],ce(pe,se,ie,!1),G.push(tt(X,"LineString",se,M.properties));return}Hi(U,se,ie,!1)}else if(Y==="Polygon")Hi(U,se,ie,!0);else{if(Y!=="MultiPolygon"){if(Y==="GeometryCollection"){for(let pe of M.geometry.geometries)_i(G,{id:X,geometry:pe,properties:M.properties},k,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let pe of U){let ge=[];Hi(pe,ge,ie,!0),se.push(ge)}}G.push(tt(X,Y,se,M.properties))}function jt(G,M){M.push(Mr(G[0]),ct(G[1]),0)}function ce(G,M,k,O){let U,Y,ie=0;for(let X=0;X<G.length;X++){let pe=Mr(G[X][0]),ge=ct(G[X][1]);M.push(pe,ge,0),X>0&&(ie+=O?(U*ge-pe*Y)/2:Math.sqrt(Math.pow(pe-U,2)+Math.pow(ge-Y,2))),U=pe,Y=ge}let se=M.length-3;M[2]=1,nt(M,0,se,k),M[se+2]=1,M.size=Math.abs(ie),M.start=0,M.end=M.size}function Hi(G,M,k,O){for(let U=0;U<G.length;U++){let Y=[];ce(G[U],Y,k,O),M.push(Y)}}function Mr(G){return G/360+.5}function ct(G){let M=Math.sin(G*Math.PI/180),k=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return k<0?0:k>1?1:k}function Bt(G,M,k,O,U,Y,ie,se){if(O/=M,Y>=(k/=M)&&ie<O)return G;if(ie<k||Y>=O)return null;let X=[];for(let pe of G){let ge=pe.geometry,ue=pe.type,be=U===0?pe.minX:pe.minY,qe=U===0?pe.maxX:pe.maxY;if(be>=k&&qe<O){X.push(pe);continue}if(qe<k||be>=O)continue;let $e=[];if(ue==="Point"||ue==="MultiPoint")_r(ge,$e,k,O,U);else if(ue==="LineString")Pr(ge,$e,k,O,U,!1,se.lineMetrics);else if(ue==="MultiLineString")Qr(ge,$e,k,O,U,!1);else if(ue==="Polygon")Qr(ge,$e,k,O,U,!0);else if(ue==="MultiPolygon")for(let bt of ge){let it=[];Qr(bt,it,k,O,U,!0),it.length&&$e.push(it)}if($e.length){if(se.lineMetrics&&ue==="LineString"){for(let bt of $e)X.push(tt(pe.id,ue,bt,pe.tags));continue}ue!=="LineString"&&ue!=="MultiLineString"||($e.length===1?(ue="LineString",$e=$e[0]):ue="MultiLineString"),ue!=="Point"&&ue!=="MultiPoint"||(ue=$e.length===3?"Point":"MultiPoint"),X.push(tt(pe.id,ue,$e,pe.tags))}}return X.length?X:null}function _r(G,M,k,O,U){for(let Y=0;Y<G.length;Y+=3){let ie=G[Y+U];ie>=k&&ie<=O&&Vi(M,G[Y],G[Y+1],G[Y+2])}}function Pr(G,M,k,O,U,Y,ie){let se=Wi(G),X=U===0?ua:Ea,pe,ge,ue=G.start;for(let it=0;it<G.length-3;it+=3){let wt=G[it],mt=G[it+1],fi=G[it+2],ii=G[it+3],st=G[it+4],Pt=U===0?wt:mt,ei=U===0?ii:st,Ai=!1;ie&&(pe=Math.sqrt(Math.pow(wt-ii,2)+Math.pow(mt-st,2))),Pt<k?ei>k&&(ge=X(se,wt,mt,ii,st,k),ie&&(se.start=ue+pe*ge)):Pt>O?ei<O&&(ge=X(se,wt,mt,ii,st,O),ie&&(se.start=ue+pe*ge)):Vi(se,wt,mt,fi),ei<k&&Pt>=k&&(ge=X(se,wt,mt,ii,st,k),Ai=!0),ei>O&&Pt<=O&&(ge=X(se,wt,mt,ii,st,O),Ai=!0),!Y&&Ai&&(ie&&(se.end=ue+pe*ge),M.push(se),se=Wi(G)),ie&&(ue+=pe)}let be=G.length-3,qe=G[be],$e=G[be+1],bt=U===0?qe:$e;bt>=k&&bt<=O&&Vi(se,qe,$e,G[be+2]),be=se.length-3,Y&&be>=3&&(se[be]!==se[0]||se[be+1]!==se[1])&&Vi(se,se[0],se[1],se[2]),se.length&&M.push(se)}function Wi(G){let M=[];return M.size=G.size,M.start=G.start,M.end=G.end,M}function Qr(G,M,k,O,U,Y){for(let ie of G)Pr(ie,M,k,O,U,Y,!1)}function Vi(G,M,k,O){G.push(M,k,O)}function ua(G,M,k,O,U,Y){let ie=(Y-M)/(O-M);return Vi(G,Y,k+(U-k)*ie,1),ie}function Ea(G,M,k,O,U,Y){let ie=(Y-k)/(U-k);return Vi(G,M+(O-M)*ie,Y,1),ie}function ve(G,M){let k=[];for(let O=0;O<G.length;O++){let U=G[O],Y=U.type,ie;if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")ie=sr(U.geometry,M);else if(Y==="MultiLineString"||Y==="Polygon"){ie=[];for(let se of U.geometry)ie.push(sr(se,M))}else if(Y==="MultiPolygon"){ie=[];for(let se of U.geometry){let X=[];for(let pe of se)X.push(sr(pe,M));ie.push(X)}}k.push(tt(U.id,Y,ie,U.tags))}return k}function sr(G,M){let k=[];k.size=G.size,G.start!==void 0&&(k.start=G.start,k.end=G.end);for(let O=0;O<G.length;O+=3)k.push(G[O]+M,G[O+1],G[O+2]);return k}function Si(G,M){if(G.transformed)return G;let k=1<<G.z,O=G.x,U=G.y;for(let Y of G.features){let ie=Y.geometry,se=Y.type;if(Y.geometry=[],se===1)for(let X=0;X<ie.length;X+=2)Y.geometry.push(or(ie[X],ie[X+1],M,k,O,U));else for(let X=0;X<ie.length;X++){let pe=[];for(let ge=0;ge<ie[X].length;ge+=2)pe.push(or(ie[X][ge],ie[X][ge+1],M,k,O,U));Y.geometry.push(pe)}}return G.transformed=!0,G}function or(G,M,k,O,U,Y){return[Math.round(k*(G*O-U)),Math.round(k*(M*O-Y))]}function zr(G,M,k,O,U){let Y=M===U.maxZoom?0:U.tolerance/((1<<M)*U.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:G.length,source:null,x:k,y:O,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let se of G)xe(ie,se,Y,U);return ie}function xe(G,M,k,O){let U=M.geometry,Y=M.type,ie=[];if(G.minX=Math.min(G.minX,M.minX),G.minY=Math.min(G.minY,M.minY),G.maxX=Math.max(G.maxX,M.maxX),G.maxY=Math.max(G.maxY,M.maxY),Y==="Point"||Y==="MultiPoint")for(let se=0;se<U.length;se+=3)ie.push(U[se],U[se+1]),G.numPoints++,G.numSimplified++;else if(Y==="LineString")rt(ie,U,G,k,!1,!1);else if(Y==="MultiLineString"||Y==="Polygon")for(let se=0;se<U.length;se++)rt(ie,U[se],G,k,Y==="Polygon",se===0);else if(Y==="MultiPolygon")for(let se=0;se<U.length;se++){let X=U[se];for(let pe=0;pe<X.length;pe++)rt(ie,X[pe],G,k,!0,pe===0)}if(ie.length){let se=M.tags||null;if(Y==="LineString"&&O.lineMetrics){se={};for(let pe in M.tags)se[pe]=M.tags[pe];se.mapbox_clip_start=U.start/U.size,se.mapbox_clip_end=U.end/U.size}let X={geometry:ie,type:Y==="Polygon"||Y==="MultiPolygon"?3:Y==="LineString"||Y==="MultiLineString"?2:1,tags:se};M.id!==null&&(X.id=M.id),G.features.push(X)}}function rt(G,M,k,O,U,Y){let ie=O*O;if(O>0&&M.size<(U?ie:O))return void(k.numPoints+=M.length/3);let se=[];for(let X=0;X<M.length;X+=3)(O===0||M[X+2]>ie)&&(k.numSimplified++,se.push(M[X],M[X+1])),k.numPoints++;U&&function(X,pe){let ge=0;for(let ue=0,be=X.length,qe=be-2;ue<be;qe=ue,ue+=2)ge+=(X[ue]-X[qe])*(X[ue+1]+X[qe+1]);if(ge>0===pe)for(let ue=0,be=X.length;ue<be/2;ue+=2){let qe=X[ue],$e=X[ue+1];X[ue]=X[be-2-ue],X[ue+1]=X[be-1-ue],X[be-2-ue]=qe,X[be-1-ue]=$e}}(se,Y),G.push(se)}let We={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Di{constructor(M,k){let O=(k=this.options=function(Y,ie){for(let se in ie)Y[se]=ie[se];return Y}(Object.create(We),k)).debug;if(O&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");let U=function(Y,ie){let se=[];if(Y.type==="FeatureCollection")for(let X=0;X<Y.features.length;X++)_i(se,Y.features[X],ie,X);else _i(se,Y.type==="Feature"?Y:{geometry:Y},ie);return se}(M,k);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),U=function(Y,ie){let se=ie.buffer/ie.extent,X=Y,pe=Bt(Y,1,-1-se,se,0,-1,2,ie),ge=Bt(Y,1,1-se,2+se,0,-1,2,ie);return(pe||ge)&&(X=Bt(Y,1,-se,1+se,0,-1,2,ie)||[],pe&&(X=ve(pe,1).concat(X)),ge&&(X=X.concat(ve(ge,-1)))),X}(U,k),U.length&&this.splitTile(U,0,0,0),O&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(M,k,O,U,Y,ie,se){let X=[M,k,O,U],pe=this.options,ge=pe.debug;for(;X.length;){U=X.pop(),O=X.pop(),k=X.pop(),M=X.pop();let ue=1<<k,be=Xi(k,O,U),qe=this.tiles[be];if(!qe&&(ge>1&&console.time("creation"),qe=this.tiles[be]=zr(M,k,O,U,pe),this.tileCoords.push({z:k,x:O,y:U}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,O,U,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));let Ai=`z${k}`;this.stats[Ai]=(this.stats[Ai]||0)+1,this.total++}if(qe.source=M,Y==null){if(k===pe.indexMaxZoom||qe.numPoints<=pe.indexMaxPoints)continue}else{if(k===pe.maxZoom||k===Y)continue;if(Y!=null){let Ai=Y-k;if(O!==ie>>Ai||U!==se>>Ai)continue}}if(qe.source=null,M.length===0)continue;ge>1&&console.time("clipping");let $e=.5*pe.buffer/pe.extent,bt=.5-$e,it=.5+$e,wt=1+$e,mt=null,fi=null,ii=null,st=null,Pt=Bt(M,ue,O-$e,O+it,0,qe.minX,qe.maxX,pe),ei=Bt(M,ue,O+bt,O+wt,0,qe.minX,qe.maxX,pe);M=null,Pt&&(mt=Bt(Pt,ue,U-$e,U+it,1,qe.minY,qe.maxY,pe),fi=Bt(Pt,ue,U+bt,U+wt,1,qe.minY,qe.maxY,pe),Pt=null),ei&&(ii=Bt(ei,ue,U-$e,U+it,1,qe.minY,qe.maxY,pe),st=Bt(ei,ue,U+bt,U+wt,1,qe.minY,qe.maxY,pe),ei=null),ge>1&&console.timeEnd("clipping"),X.push(mt||[],k+1,2*O,2*U),X.push(fi||[],k+1,2*O,2*U+1),X.push(ii||[],k+1,2*O+1,2*U),X.push(st||[],k+1,2*O+1,2*U+1)}}getTile(M,k,O){M=+M,k=+k,O=+O;let U=this.options,{extent:Y,debug:ie}=U;if(M<0||M>24)return null;let se=1<<M,X=Xi(M,k=k+se&se-1,O);if(this.tiles[X])return Si(this.tiles[X],Y);ie>1&&console.log("drilling down to z%d-%d-%d",M,k,O);let pe,ge=M,ue=k,be=O;for(;!pe&&ge>0;)ge--,ue>>=1,be>>=1,pe=this.tiles[Xi(ge,ue,be)];return pe&&pe.source?(ie>1&&(console.log("found parent tile z%d-%d-%d",ge,ue,be),console.time("drilling down")),this.splitTile(pe.source,ge,ue,be,M,k,O),ie>1&&console.timeEnd("drilling down"),this.tiles[X]?Si(this.tiles[X],Y):null):null}}function Xi(G,M,k){return 32*((1<<G)*k+M)+G}function Ke(G,M){return M?G.properties[M]:G.id}function Ki(G,M){if(G==null)return!0;if(G.type==="Feature")return Ke(G,M)!=null;if(G.type==="FeatureCollection"){let k=new Set;for(let O of G.features){let U=Ke(O,M);if(U==null||k.has(U))return!1;k.add(U)}return!0}return!1}function vr(G,M){let k=new Map;if(G!=null)if(G.type==="Feature")k.set(Ke(G,M),G);else for(let O of G.features)k.set(Ke(O,M),O);return k}class ha extends ne{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(M,k){return w._(this,void 0,void 0,function*(){let O=M.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let U=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!U)return null;let Y=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=se.length,this._features=se}feature(se){return new class{constructor(X){this._feature=X,this.extent=w.X,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){let X=[];for(let pe of this._feature.geometry)X.push([new w.P(pe[0],pe[1])]);return X}{let X=[];for(let pe of this._feature.geometry){let ge=[];for(let ue of pe)ge.push(new w.P(ue[0],ue[1]));X.push(ge)}return X}}toGeoJSON(X,pe,ge){return St.call(this,X,pe,ge)}}(this._features[se])}}(U.features),ie=oi(Y);return ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),{vectorTile:Y,rawData:ie.buffer}})}loadData(M){return w._(this,void 0,void 0,function*(){var k;(k=this._pendingRequest)===null||k===void 0||k.abort();let O=!!(M&&M.request&&M.request.collectResourceTiming)&&new w.bv(M.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(M,this._pendingRequest),this._geoJSONIndex=M.cluster?new pt(function({superclusterOptions:ie,clusterProperties:se}){if(!se||!ie)return ie;let X={},pe={},ge={accumulated:null,zoom:0},ue={properties:null},be=Object.keys(se);for(let qe of be){let[$e,bt]=se[qe],it=w.bC(bt),wt=w.bC(typeof $e=="string"?[$e,["accumulated"],["get",qe]]:$e);X[qe]=it.value,pe[qe]=wt.value}return ie.map=qe=>{ue.properties=qe;let $e={};for(let bt of be)$e[bt]=X[bt].evaluate(ge,ue);return $e},ie.reduce=(qe,$e)=>{ue.properties=$e;for(let bt of be)ge.accumulated=qe[bt],qe[bt]=pe[bt].evaluate(ge,ue)},ie}(M)).load((yield this._pendingData).features):(U=yield this._pendingData,new Di(U,M.geojsonVtOptions)),this.loaded={};let Y={};if(O){let ie=O.finish();ie&&(Y.resourceTiming={},Y.resourceTiming[M.source]=JSON.parse(JSON.stringify(ie)))}return Y}catch(Y){if(delete this._pendingRequest,w.bB(Y))return{abandoned:!0};throw Y}var U})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(M){let k=this.loaded;return k&&k[M.uid]?super.reloadTile(M):this.loadTile(M)}loadAndProcessGeoJSON(M,k){return w._(this,void 0,void 0,function*(){let O=yield this.loadGeoJSON(M,k);if(delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`);if(ot(O,!0),M.filter){let U=w.bC(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(U.result==="error")throw new Error(U.value.map(ie=>`${ie.key}: ${ie.message}`).join(", "));O={type:"FeatureCollection",features:O.features.filter(ie=>U.value.evaluate({zoom:0},ie))}}return O})}loadGeoJSON(M,k){return w._(this,void 0,void 0,function*(){let{promoteId:O}=M;if(M.request){let U=yield w.h(M.request,k);return this._dataUpdateable=Ki(U.data,O)?vr(U.data,O):void 0,U.data}if(typeof M.data=="string")try{let U=JSON.parse(M.data);return this._dataUpdateable=Ki(U,O)?vr(U,O):void 0,U}catch{throw new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`)}if(!M.dataDiff)throw new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${M.source}`);return function(U,Y,ie){var se,X,pe,ge;if(Y.removeAll&&U.clear(),Y.remove)for(let ue of Y.remove)U.delete(ue);if(Y.add)for(let ue of Y.add){let be=Ke(ue,ie);be!=null&&U.set(be,ue)}if(Y.update)for(let ue of Y.update){let be=U.get(ue.id);if(be==null)continue;let qe=!ue.removeAllProperties&&(((se=ue.removeProperties)===null||se===void 0?void 0:se.length)>0||((X=ue.addOrUpdateProperties)===null||X===void 0?void 0:X.length)>0);if((ue.newGeometry||ue.removeAllProperties||qe)&&(be=Object.assign({},be),U.set(ue.id,be),qe&&(be.properties=Object.assign({},be.properties))),ue.newGeometry&&(be.geometry=ue.newGeometry),ue.removeAllProperties)be.properties={};else if(((pe=ue.removeProperties)===null||pe===void 0?void 0:pe.length)>0)for(let $e of ue.removeProperties)Object.prototype.hasOwnProperty.call(be.properties,$e)&&delete be.properties[$e];if(((ge=ue.addOrUpdateProperties)===null||ge===void 0?void 0:ge.length)>0)for(let{key:$e,value:bt}of ue.addOrUpdateProperties)be.properties[$e]=bt}}(this._dataUpdateable,M.dataDiff,O),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(M){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(M){return this._geoJSONIndex.getClusterExpansionZoom(M.clusterId)}getClusterChildren(M){return this._geoJSONIndex.getChildren(M.clusterId)}getClusterLeaves(M){return this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset)}}class Zr{constructor(M){this.self=M,this.actor=new w.F(M),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(k,O)=>{if(this.externalWorkerSourceTypes[k])throw new Error(`Worker source with name "${k}" already registered.`);this.externalWorkerSourceTypes[k]=O},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=k=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(k)},this.actor.registerMessageHandler("LDT",(k,O)=>this._getDEMWorkerSource(k,O.source).loadTile(O)),this.actor.registerMessageHandler("RDT",(k,O)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(k,O.source).removeTile(O)})),this.actor.registerMessageHandler("GCEZ",(k,O)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(k,O.type,O.source).getClusterExpansionZoom(O)})),this.actor.registerMessageHandler("GCC",(k,O)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(k,O.type,O.source).getClusterChildren(O)})),this.actor.registerMessageHandler("GCL",(k,O)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(k,O.type,O.source).getClusterLeaves(O)})),this.actor.registerMessageHandler("LD",(k,O)=>this._getWorkerSource(k,O.type,O.source).loadData(O)),this.actor.registerMessageHandler("GD",(k,O)=>this._getWorkerSource(k,O.type,O.source).getData()),this.actor.registerMessageHandler("LT",(k,O)=>this._getWorkerSource(k,O.type,O.source).loadTile(O)),this.actor.registerMessageHandler("RT",(k,O)=>this._getWorkerSource(k,O.type,O.source).reloadTile(O)),this.actor.registerMessageHandler("AT",(k,O)=>this._getWorkerSource(k,O.type,O.source).abortTile(O)),this.actor.registerMessageHandler("RMT",(k,O)=>this._getWorkerSource(k,O.type,O.source).removeTile(O)),this.actor.registerMessageHandler("RS",(k,O)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[k]||!this.workerSources[k][O.type]||!this.workerSources[k][O.type][O.source])return;let U=this.workerSources[k][O.type][O.source];delete this.workerSources[k][O.type][O.source],U.removeSource!==void 0&&U.removeSource(O)})),this.actor.registerMessageHandler("RM",k=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[k],delete this.availableImages[k],delete this.workerSources[k],delete this.demWorkerSources[k]})),this.actor.registerMessageHandler("SR",(k,O)=>w._(this,void 0,void 0,function*(){this.referrer=O})),this.actor.registerMessageHandler("SRPS",(k,O)=>this._syncRTLPluginState(k,O)),this.actor.registerMessageHandler("IS",(k,O)=>w._(this,void 0,void 0,function*(){this.self.importScripts(O)})),this.actor.registerMessageHandler("SI",(k,O)=>this._setImages(k,O)),this.actor.registerMessageHandler("UL",(k,O)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(k).update(O.layers,O.removedIds)})),this.actor.registerMessageHandler("SL",(k,O)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(k).replace(O)}))}_setImages(M,k){return w._(this,void 0,void 0,function*(){this.availableImages[M]=k;for(let O in this.workerSources[M]){let U=this.workerSources[M][O];for(let Y in U)U[Y].availableImages=k}})}_syncRTLPluginState(M,k){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(k.pluginStatus!=="loading")return w.bD.setState(k),k;let O=k.pluginURL;if(this.self.importScripts(O),w.bD.isParsed()){let U={pluginStatus:"loaded",pluginURL:O};return w.bD.setState(U),U}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${O}`)})}_getAvailableImages(M){let k=this.availableImages[M];return k||(k=[]),k}_getLayerIndex(M){let k=this.layerIndexes[M];return k||(k=this.layerIndexes[M]=new c),k}_getWorkerSource(M,k,O){if(this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][k]||(this.workerSources[M][k]={}),!this.workerSources[M][k][O]){let U={sendAsync:(Y,ie)=>(Y.targetMapId=M,this.actor.sendAsync(Y,ie))};switch(k){case"vector":this.workerSources[M][k][O]=new ne(U,this._getLayerIndex(M),this._getAvailableImages(M));break;case"geojson":this.workerSources[M][k][O]=new ha(U,this._getLayerIndex(M),this._getAvailableImages(M));break;default:this.workerSources[M][k][O]=new this.externalWorkerSourceTypes[k](U,this._getLayerIndex(M),this._getAvailableImages(M))}}return this.workerSources[M][k][O]}_getDEMWorkerSource(M,k){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][k]||(this.demWorkerSources[M][k]=new $),this.demWorkerSources[M][k]}}return w.i(self)&&(self.worker=new Zr(self)),Zr}),E("index",["exports","./shared"],function(w,c){"use strict";var Q="4.7.1";let ee,de,ne={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:h=>new Promise((e,a)=>{let s=requestAnimationFrame(e);h.signal.addEventListener("abort",()=>{cancelAnimationFrame(s),a(c.c())})}),getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){let e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,a.drawImage(h,0,0,h.width,h.height),a},resolveURL:h=>(ee||(ee=document.createElement("a")),ee.href=h,ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in $.docStyle)return e[a];return e[0]}static create(e,a,s){let o=window.document.createElement(e);return a!==void 0&&(o.className=a),s&&s.appendChild(o),o}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,a){e.style[$.transformProp]=a}static addEventListener(e,a,s,o={}){e.addEventListener(a,s,"passive"in o?o:o.capture)}static removeEventListener(e,a,s,o={}){e.removeEventListener(a,s,"passive"in o?o:o.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(e){let a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,s){let o=a.boundingClientRect;return new c.P((s.clientX-o.left)/a.x-e.clientLeft,(s.clientY-o.top)/a.y-e.clientTop)}static mousePos(e,a){let s=$.getScale(e);return $.getPoint(e,s,a)}static touchPos(e,a){let s=[],o=$.getScale(e);for(let u=0;u<a.length;u++)s.push($.getPoint(e,o,a[u]));return s}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);let Re={supported:!1,testSupport:function(h){!St&&ot&&(xt?Tt(h):Xe=h)}},Xe,ot,St=!1,xt=!1;function Tt(h){let e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,ot),h.isContextLost())return;Re.supported=!0}catch{}h.deleteTexture(e),St=!0}var yt;typeof document<"u"&&(ot=document.createElement("img"),ot.onload=()=>{Xe&&Tt(Xe),Xe=null,xt=!0},ot.onerror=()=>{St=!0,Xe=null},ot.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let e,a,s,o;h.resetRequestQueue=()=>{e=[],a=0,s=0,o={}},h.addThrottleControl=v=>{let A=s++;return o[A]=v,A},h.removeThrottleControl=v=>{delete o[v],m()},h.getImage=(v,A,C=!0)=>new Promise((D,L)=>{Re.supported&&(v.headers||(v.headers={}),v.headers.accept="image/webp,*/*"),c.e(v,{type:"image"}),e.push({abortController:A,requestParameters:v,supportImageRefresh:C,state:"queued",onError:F=>{L(F)},onSuccess:F=>{D(F)}}),m()});let u=v=>c._(this,void 0,void 0,function*(){v.state="running";let{requestParameters:A,supportImageRefresh:C,onError:D,onSuccess:L,abortController:F}=v,N=C===!1&&!c.i(self)&&!c.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce((W,K)=>W&&K==="accept",!0));a++;let j=N?y(A,F):c.m(A,F);try{let W=yield j;delete v.abortController,v.state="completed",W.data instanceof HTMLImageElement||c.b(W.data)?L(W):W.data&&L({data:yield(H=W.data,typeof createImageBitmap=="function"?c.d(H):c.f(H)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete v.abortController,D(W)}finally{a--,m()}var H}),m=()=>{let v=(()=>{for(let A of Object.keys(o))if(o[A]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=a;A<v&&e.length>0;A++){let C=e.shift();C.abortController.signal.aborted?A--:u(C)}},y=(v,A)=>new Promise((C,D)=>{let L=new Image,F=v.url,N=v.credentials;N&&N==="include"?L.crossOrigin="use-credentials":(N&&N==="same-origin"||!c.s(F))&&(L.crossOrigin="anonymous"),A.signal.addEventListener("abort",()=>{L.src="",D(c.c())}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,C({data:L})},L.onerror=()=>{L.onerror=L.onload=null,A.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=F})}(yt||(yt={})),yt.resetRequestQueue();class yr{constructor(e){this._transformRequestFn=e}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function dt(h){var e=new c.A(3);return e[0]=h[0],e[1]=h[1],e[2]=h[2],e}var Ht,bi=function(h,e,a){return h[0]=e[0]-a[0],h[1]=e[1]-a[1],h[2]=e[2]-a[2],h};Ht=new c.A(3),c.A!=Float32Array&&(Ht[0]=0,Ht[1]=0,Ht[2]=0);var Ue=function(h){var e=h[0],a=h[1];return e*e+a*a};function je(h){let e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){let a=[];for(let{id:s,url:o}of h){let u=`${s}${o}`;a.indexOf(u)===-1&&(a.push(u),e.push({id:s,url:o}))}}return e}function ht(h,e,a){let s=h.split("?");return s[0]+=`${e}${a}`,s.join("?")}(function(){var h=new c.A(2);c.A!=Float32Array&&(h[0]=0,h[1]=0)})();class Ve{constructor(e,a,s,o){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(a,o)}update(e,a,s){let{width:o,height:u}=e,m=!(this.size&&this.size[0]===o&&this.size[1]===u||s),{context:y}=this,{gl:v}=y;if(this.useMipmap=!!(a&&a.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!a||a.premultiply!==!1)),m)this.size=[o,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,o,u,0,this.format,v.UNSIGNED_BYTE,e.data);else{let{x:A,y:C}=s||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?v.texSubImage2D(v.TEXTURE_2D,0,A,C,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,A,C,o,u,v.RGBA,v.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D)}bind(e,a,s){let{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_2D,this.texture),s!==u.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=u.LINEAR),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,s||e),this.filter=e),a!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,a),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Qt(h){let{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class et extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:a,promiseResolve:s}of this.requestors)s(this._getImagesForIds(a));this.requestors=[]}}getImage(e){let a=this.images[e];if(a&&!a.data&&a.spriteData){let s=a.spriteData;a.data=new c.R({width:s.width,height:s.height},s.context.getImageData(s.x,s.y,s.width,s.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let s=!0,o=a.data||a.spriteData;return this._validateStretch(a.stretchX,o&&o.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),s=!1),this._validateStretch(a.stretchY,o&&o.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),s=!1),this._validateContent(a.content,a)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),s=!1),s}_validateStretch(e,a){if(!e)return!0;let s=0;for(let o of e){if(o[0]<s||o[1]<o[0]||a<o[1])return!1;s=o[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;let s=a.spriteData,o=s&&s.width||a.data.width,u=s&&s.height||a.data.height;return!(e[0]<0||o<e[0]||e[1]<0||u<e[1]||e[2]<0||o<e[2]||e[3]<0||u<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,s=!0){let o=this.getImage(e);if(s&&(o.data.width!==a.data.width||o.data.height!==a.data.height))throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=o.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){let a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((a,s)=>{let o=!0;if(!this.isLoaded())for(let u of e)this.images[u]||(o=!1);this.isLoaded()||o?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})})}_getImagesForIds(e){let a={};for(let s of e){let o=this.getImage(s);o||(this.fire(new c.k("styleimagemissing",{id:s})),o=this.getImage(s)),o?a[s]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,textFitWidth:o.textFitWidth,textFitHeight:o.textFitHeight,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:c.w(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){let{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){let a=this.patterns[e],s=this.getImage(e);if(!s)return null;if(a&&a.position.version===s.version)return a.position;if(a)a.position.version=s.version;else{let o={w:s.data.width+2,h:s.data.height+2,x:0,y:0},u=new c.I(o,s);this.patterns[e]={bin:o,position:u}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ve(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let u in this.patterns)e.push(this.patterns[u].bin);let{w:a,h:s}=c.p(e),o=this.atlasImage;o.resize({width:a||1,height:s||1});for(let u in this.patterns){let{bin:m}=this.patterns[u],y=m.x+1,v=m.y+1,A=this.getImage(u).data,C=A.width,D=A.height;c.R.copy(A,o,{x:0,y:0},{x:y,y:v},{width:C,height:D}),c.R.copy(A,o,{x:0,y:D-1},{x:y,y:v-1},{width:C,height:1}),c.R.copy(A,o,{x:0,y:0},{x:y,y:v+D},{width:C,height:1}),c.R.copy(A,o,{x:C-1,y:0},{x:y-1,y:v},{width:1,height:D}),c.R.copy(A,o,{x:0,y:0},{x:y+C,y:v},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;let s=this.getImage(a);s||c.w(`Image with ID: "${a}" was not found`),Qt(s)&&this.updateImage(a,s)}}}let Nt=1e20;function pi(h,e,a,s,o,u,m,y,v){for(let A=e;A<e+s;A++)yi(h,a*u+A,u,o,m,y,v);for(let A=a;A<a+o;A++)yi(h,A*u+e,1,s,m,y,v)}function yi(h,e,a,s,o,u,m){u[0]=0,m[0]=-Nt,m[1]=Nt,o[0]=h[e];for(let y=1,v=0,A=0;y<s;y++){o[y]=h[e+y*a];let C=y*y;do{let D=u[v];A=(o[y]-o[D]+C-D*D)/(y-D)/2}while(A<=m[v]&&--v>-1);v++,u[v]=y,m[v]=A,m[v+1]=Nt}for(let y=0,v=0;y<s;y++){for(;m[v+1]<y;)v++;let A=u[v],C=y-A;h[e+y*a]=o[A]+C*C}}class oi{constructor(e,a){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){let a=[];for(let u in e)for(let m of e[u])a.push(this._getAndCacheGlyphsPromise(u,m));let s=yield Promise.all(a),o={};for(let{stack:u,id:m,glyph:y}of s)o[u]||(o[u]={}),o[u][m]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics};return o})}_getAndCacheGlyphsPromise(e,a){return c._(this,void 0,void 0,function*(){let s=this.entries[e];s||(s=this.entries[e]={glyphs:{},requests:{},ranges:{}});let o=s.glyphs[a];if(o!==void 0)return{stack:e,id:a,glyph:o};if(o=this._tinySDF(s,e,a),o)return s.glyphs[a]=o,{stack:e,id:a,glyph:o};let u=Math.floor(a/256);if(256*u>65535)throw new Error("glyphs > 65535 not supported");if(s.ranges[u])return{stack:e,id:a,glyph:o};if(!this.url)throw new Error("glyphsUrl is not set");if(!s.requests[u]){let y=oi.loadGlyphRange(e,u,this.url,this.requestManager);s.requests[u]=y}let m=yield s.requests[u];for(let y in m)this._doesCharSupportLocalGlyph(+y)||(s.glyphs[+y]=m[+y]);return s.ranges[u]=!0,{stack:e,id:a,glyph:m[a]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,a,s){let o=this.localIdeographFontFamily;if(!o||!this._doesCharSupportLocalGlyph(s))return;let u=e.tinySDF;if(!u){let y="400";/bold/i.test(a)?y="900":/medium/i.test(a)?y="500":/light/i.test(a)&&(y="200"),u=e.tinySDF=new oi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:y})}let m=u.draw(String.fromCharCode(s));return{id:s,bitmap:new c.o({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}oi.loadGlyphRange=function(h,e,a,s){return c._(this,void 0,void 0,function*(){let o=256*e,u=o+255,m=s.transformRequest(a.replace("{fontstack}",h).replace("{range}",`${o}-${u}`),"Glyphs"),y=yield c.l(m,new AbortController);if(!y||!y.data)throw new Error(`Could not load glyph range. range: ${e}, ${o}-${u}`);let v={};for(let A of c.n(y.data))v[A.id]=A;return v})},oi.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:a=8,cutoff:s=.25,fontFamily:o="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=a;let y=this.size=h+4*e,v=this._createCanvas(y),A=this.ctx=v.getContext("2d",{willReadFrequently:!0});A.font=`${m} ${u} ${h}px ${o}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(h){let e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){let{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:s,actualBoundingBoxLeft:o,actualBoundingBoxRight:u}=this.ctx.measureText(h),m=Math.ceil(a),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-o))),v=Math.min(this.size-this.buffer,m+Math.ceil(s)),A=y+2*this.buffer,C=v+2*this.buffer,D=Math.max(A*C,0),L=new Uint8ClampedArray(D),F={data:L,width:A,height:C,glyphWidth:y,glyphHeight:v,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||v===0)return F;let{ctx:N,buffer:j,gridInner:H,gridOuter:W}=this;N.clearRect(j,j,y,v),N.fillText(h,j,j+m);let K=N.getImageData(j,j,y,v);W.fill(Nt,0,D),H.fill(0,0,D);for(let q=0;q<v;q++)for(let te=0;te<y;te++){let re=K.data[4*(q*y+te)+3]/255;if(re===0)continue;let le=(q+j)*A+te+j;if(re===1)W[le]=0,H[le]=Nt;else{let me=.5-re;W[le]=me>0?me*me:0,H[le]=me<0?me*me:0}}pi(W,0,0,A,C,A,this.f,this.v,this.z),pi(H,j,j,y,v,A,this.f,this.v,this.z);for(let q=0;q<D;q++){let te=Math.sqrt(W[q])-Math.sqrt(H[q]);L[q]=Math.round(255-255*(te/this.radius+this.cutoff))}return F}};class kt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,a){return c.x(e.expression.evaluate(a))}interpolate(e,a,s){return{x:c.y.number(e.x,a.x,s),y:c.y.number(e.y,a.y,s),z:c.y.number(e.z,a.z,s)}}}let Lt;class wi extends c.E{constructor(e){super(),Lt=Lt||new c.q({anchor:new c.D(c.v.light.anchor),position:new kt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Lt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(c.r,e,a))for(let s in e){let o=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),o):this._transitionable.setValue(s,o)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,s){return(!s||s.validate!==!1)&&c.t(this,e.call(c.u,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}let li=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class ft extends c.E{constructor(e){super(),this._transitionable=new c.T(li),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,a={}){if(!this._validate(c.B,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let s in e){let o=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),o):this._transitionable.setValue(s,o)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,s={}){return s?.validate!==!1&&c.t(this,e.call(c.u,c.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Dt{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){let s=e.join(",")+String(a);return this.dashEntry[s]||(this.dashEntry[s]=this.addDash(e,a)),this.dashEntry[s]}getDashRanges(e,a,s){let o=[],u=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,y=!0;o.push({left:u,right:m,isDash:y,zeroLength:e[0]===0});let v=e[0];for(let A=1;A<e.length;A++){y=!y;let C=e[A];u=v*s,v+=C,m=v*s,o.push({left:u,right:m,isDash:y,zeroLength:C===0})}return o}addRoundDash(e,a,s){let o=a/2;for(let u=-s;u<=s;u++){let m=this.width*(this.nextRow+s+u),y=0,v=e[y];for(let A=0;A<this.width;A++){A/v.right>1&&(v=e[++y]);let C=Math.abs(A-v.left),D=Math.abs(A-v.right),L=Math.min(C,D),F,N=u/s*(o+1);if(v.isDash){let j=o-Math.abs(N);F=Math.sqrt(L*L+j*j)}else F=o-Math.sqrt(L*L+N*N);this.data[m+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e){for(let y=e.length-1;y>=0;--y){let v=e[y],A=e[y+1];v.zeroLength?e.splice(y,1):A&&A.isDash===v.isDash&&(A.left=v.left,e.splice(y,1))}let a=e[0],s=e[e.length-1];a.isDash===s.isDash&&(a.left=s.left-this.width,s.right=a.right+this.width);let o=this.width*this.nextRow,u=0,m=e[u];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++u]);let v=Math.abs(y-m.left),A=Math.abs(y-m.right),C=Math.min(v,A);this.data[o+y]=Math.max(0,Math.min(255,(m.isDash?C:-C)+128))}}addDash(e,a){let s=a?7:0,o=2*s+1;if(this.nextRow+o>this.height)return c.w("LineAtlas out of space"),null;let u=0;for(let y=0;y<e.length;y++)u+=e[y];if(u!==0){let y=this.width/u,v=this.getDashRanges(e,this.width,y);a?this.addRoundDash(v,y,s):this.addRegularDash(v)}let m={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:u};return this.nextRow+=o,this.dirty=!0,m}bind(e){let a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}let pt="maplibre_preloaded_worker_pool";class Mt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Mt.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pt]}numActive(){return Object.keys(this.active).length}}let Ut=Math.floor(ne.hardwareConcurrency/2),lt,ci;function Ge(){return lt||(lt=new Mt),lt}Mt.workerCount=c.C(globalThis)?Math.max(Math.min(Ut,3),1):1;class nt{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;let s=this.workerPool.acquire(a);for(let o=0;o<s.length;o++){let u=new c.F(s[o],a);u.name=`Worker ${o}`,this.actors.push(u)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){let s=[];for(let o of this.actors)s.push(o.sendAsync({type:e,data:a}));return Promise.all(s)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(let s of this.actors)s.registerMessageHandler(e,a)}}function qt(){return ci||(ci=new nt(Ge(),c.G),ci.registerMessageHandler("GR",(h,e,a)=>c.m(e,a))),ci}function tt(h,e){let a=c.H();return c.J(a,a,[1,1,0]),c.K(a,a,[.5*h.width,.5*h.height,1]),c.L(a,a,h.calculatePosMatrix(e.toUnwrapped()))}function di(h,e,a,s,o,u){let m=function(D,L,F){if(D)for(let N of D){let j=L[N];if(j&&j.source===F&&j.type==="fill-extrusion")return!0}else for(let N in L){let j=L[N];if(j.source===F&&j.type==="fill-extrusion")return!0}return!1}(o&&o.layers,e,h.id),y=u.maxPitchScaleFactor(),v=h.tilesIn(s,y,m);v.sort(_i);let A=[];for(let D of v)A.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,a,h._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,o,u,y,tt(h.transform,D.tileID))});let C=function(D){let L={},F={};for(let N of D){let j=N.queryResults,H=N.wrappedTileID,W=F[H]=F[H]||{};for(let K in j){let q=j[K],te=W[K]=W[K]||{},re=L[K]=L[K]||[];for(let le of q)te[le.featureIndex]||(te[le.featureIndex]=!0,re.push(le))}}return L}(A);for(let D in C)C[D].forEach(L=>{let F=L.feature,N=h.getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=N});return C}function _i(h,e){let a=h.tileID,s=e.tileID;return a.overscaledZ-s.overscaledZ||a.canonical.y-s.canonical.y||a.wrap-s.wrap||a.canonical.x-s.canonical.x}function jt(h,e,a){return c._(this,void 0,void 0,function*(){let s=h;if(h.url?s=(yield c.h(e.transformRequest(h.url,"Source"),a)).data:yield ne.frameAsync(a),!s)return null;let o=c.M(c.e(s,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in s&&s.vector_layers&&(o.vectorLayerIds=s.vector_layers.map(u=>u.id)),o})}class ce{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){let a=this._sw,s=this._ne,o,u;if(e instanceof c.N)o=e,u=e;else{if(!(e instanceof ce))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ce.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(o=e._sw,u=e._ne,!o||!u)return this}return a||s?(a.lng=Math.min(o.lng,a.lng),a.lat=Math.min(o.lat,a.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new c.N(o.lng,o.lat),this._ne=new c.N(u.lng,u.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:a,lat:s}=c.N.convert(e),o=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&o}static convert(e){return e instanceof ce?e:e&&new ce(e)}static fromLngLat(e,a=0){let s=360*a/40075017,o=s/Math.cos(Math.PI/180*e.lat);return new ce(new c.N(e.lng-o,e.lat-s),new c.N(e.lng+o,e.lat+s))}adjustAntiMeridian(){let e=new c.N(this._sw.lng,this._sw.lat),a=new c.N(this._ne.lng,this._ne.lat);return new ce(e,e.lng>a.lng?new c.N(a.lng+360,a.lat):a)}}class Hi{constructor(e,a,s){this.bounds=ce.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=s||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let a=Math.pow(2,e.z),s=Math.floor(c.O(this.bounds.getWest())*a),o=Math.floor(c.Q(this.bounds.getNorth())*a),u=Math.ceil(c.O(this.bounds.getEast())*a),m=Math.ceil(c.Q(this.bounds.getSouth())*a);return e.x>=s&&e.x<u&&e.y>=o&&e.y<m}}class Mr extends c.E{constructor(e,a,s,o){if(super(),this.id=e,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(a,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield jt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Hi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request.collectResourceTiming=this._collectResourceTiming;let o="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((u,m)=>{e.reloadPromise={resolve:u,reject:m}})}else e.actor=this.dispatcher.getActor(),o="LT";e.abortController=new AbortController;try{let u=yield e.actor.sendAsync({type:o,data:s},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,u)}catch(u){if(delete e.abortController,e.aborted)return;if(u&&u.status!==404)throw u;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){let s=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(s.resolve).catch(s.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ct extends c.E{constructor(e,a,s,o){super(),this.id=e,this.dispatcher=s,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},a),c.e(this,c.M(a,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield jt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Hi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let s=yield yt.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){this.map._refreshExpiredTiles&&s.cacheControl&&s.expires&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let o=this.map.painter.context,u=o.gl,m=s.data;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new Ve(o,m,u.RGBA,{useMipmap:!0}),e.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Bt extends ct{constructor(e,a,s,o){super(e,a,s,o),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let o=yield yt.getImage(s,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){let u=o.data;this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});let m=c.b(u)&&c.U()?u:yield this.readImageNow(u),y={type:this.type,uid:e.uid,source:this.id,rawImageData:m,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let v=yield e.actor.sendAsync({type:"LDT",data:y});e.dem=v,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){let a=e.width+2,s=e.height+2;try{return new c.R({width:a,height:s},yield c.W(e,-1,-1,a,s))}catch{}}return ne.getImageData(e,1)})}_getNeighboringTiles(e){let a=e.canonical,s=Math.pow(2,a.z),o=(a.x-1+s)%s,u=a.x===0?e.wrap-1:e.wrap,m=(a.x+1+s)%s,y=a.x+1===s?e.wrap+1:e.wrap,v={};return v[new c.S(e.overscaledZ,u,a.z,o,a.y).key]={backfilled:!1},v[new c.S(e.overscaledZ,y,a.z,m,a.y).key]={backfilled:!1},a.y>0&&(v[new c.S(e.overscaledZ,u,a.z,o,a.y-1).key]={backfilled:!1},v[new c.S(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},v[new c.S(e.overscaledZ,y,a.z,m,a.y-1).key]={backfilled:!1}),a.y+1<s&&(v[new c.S(e.overscaledZ,u,a.z,o,a.y+1).key]={backfilled:!1},v[new c.S(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},v[new c.S(e.overscaledZ,y,a.z,m,a.y+1).key]={backfilled:!1}),v}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class _r extends c.E{constructor(e,a,s,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=s.getActor(),this.setEventedParent(o),this._data=a.data,this._options=c.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;let u=c.X/this.tileSize;a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*u,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*u,extent:c.X,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:c.X,radius:(a.clusterRadius||50)*u,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){let e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,s){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:s}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){let a=c.e({type:this.type},this.workerOptions);e?a.dataDiff=e:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(ne.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{let s=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||s.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let o=null;s.resourceTiming&&s.resourceTiming[this.id]&&(o=s.resourceTiming[this.id].slice(0));let u={dataType:"source"};this._collectResourceTiming&&o&&o.length>0&&c.e(u,{resourceTiming:o}),this.fire(new c.k("data",Object.assign(Object.assign({},u),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},u),{sourceDataType:"content"})))}catch(s){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(s))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){let a=e.actor?"RT":"LT";e.actor=this.actor;let s={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;let o=yield this.actor.sendAsync({type:a,data:s},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(o,this.map.painter,a==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Pr=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wi extends c.E{constructor(e,a,s,o){super(),this.id=e,this.dispatcher=s,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=a}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let a=yield yt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new c.j(a))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let a=e.map(c.Z.fromLngLat);this.tileID=function(o){let u=1/0,m=1/0,y=-1/0,v=-1/0;for(let L of o)u=Math.min(u,L.x),m=Math.min(m,L.y),y=Math.max(y,L.x),v=Math.max(v,L.y);let A=Math.max(y-u,v-m),C=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),D=Math.pow(2,C);return new c.a1(C,Math.floor((u+y)/2*D),Math.floor((m+v)/2*D))}(a),this.minzoom=this.maxzoom=this.tileID.z;let s=a.map(o=>this.tileID.getTilePoint(o)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(s[0].x,s[0].y,0,0),this._boundsArray.emplaceBack(s[1].x,s[1].y,c.X,0),this._boundsArray.emplaceBack(s[3].x,s[3].y,0,c.X),this._boundsArray.emplaceBack(s[2].x,s[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Pr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ve(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let s=!1;for(let o in this.tiles){let u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,s=!0)}s&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Qr extends Wi{constructor(e,a,s,o){super(e,a,s,o),this.roundZoom=!0,this.type="video",this.options=a}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{let a=yield c.a3(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new c.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Pr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new Ve(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let s=!1;for(let o in this.tiles){let u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,s=!0)}s&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Vi extends Wi{constructor(e,a,s,o){super(e,a,s,o),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(u=>!Array.isArray(u)||u.length!==2||u.some(m=>typeof m!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context,s=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Pr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ve(a,this.canvas,s.RGBA,{premultiply:!0});let o=!1;for(let u in this.tiles){let m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let ua={},Ea=h=>{switch(h){case"geojson":return _r;case"image":return Wi;case"raster":return ct;case"raster-dem":return Bt;case"vector":return Mr;case"video":return Qr;case"canvas":return Vi}return ua[h]},ve="RTLPluginLoaded";class sr extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(a,s=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ne.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!s)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ve))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Si=null;function or(){return Si||(Si=new sr),Si}class zr{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,u){let m={};if(!u)return m;for(let y of o){let v=y.layerIds.map(A=>u.getLayer(A)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(A=>v.filter(C=>C.id===A)[0]));for(let A of v)m[A.id]=y}}return m}(e.buckets,a.style),this.hasSymbolBuckets=!1;for(let o in this.buckets){let u=this.buckets[o];if(u instanceof c.a6){if(this.hasSymbolBuckets=!0,!s)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let o in this.buckets){let u=this.buckets[o];if(u instanceof c.a6&&u.hasRTLText){this.hasRTLText=!0,or().lazyLoad();break}}this.queryPadding=0;for(let o in this.buckets){let u=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(o).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let s in this.buckets){let o=this.buckets[s];o.uploadPending()&&o.upload(e)}let a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ve(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ve(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,s,o,u,m,y,v,A,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:o,cameraQueryGeometry:u,scale:m,tileSize:this.tileSize,pixelPosMatrix:C,transform:v,params:y,queryPadding:this.queryPadding*A},e,a,s):{}}querySourceFeatures(e,a){let s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;let o=s.loadVTLayers(),u=a&&a.sourceLayer?a.sourceLayer:"",m=o._geojsonTileLayer||o[u];if(!m)return;let y=c.a7(a&&a.filter),{z:v,x:A,y:C}=this.tileID.canonical,D={z:v,x:A,y:C};for(let L=0;L<m.length;L++){let F=m.feature(L);if(y.needGeometry){let H=c.a8(F,!0);if(!y.filter(new c.z(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!y.filter(new c.z(this.tileID.overscaledZ),F))continue;let N=s.getId(F,u),j=new c.a9(F,v,A,C,N);j.tile=D,e.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let a=this.expirationTime;if(e.cacheControl){let s=c.aa(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let s=Date.now(),o=!1;if(this.expirationTime>s)o=!1;else if(a)if(this.expirationTime<a)o=!0;else{let u=this.expirationTime-a;u?this.expirationTime=s+Math.max(u,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let s=this.latestFeatureIndex.loadVTLayers();for(let o in this.buckets){if(!a.style.hasLayer(o))continue;let u=this.buckets[o],m=u.layers[0].sourceLayer||"_geojsonTileLayer",y=s[m],v=e[m];if(!y||!v||Object.keys(v).length===0)continue;u.update(v,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});let A=a&&a.style&&a.style.getLayer(o);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(u)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ne.now()+e}setDependencies(e,a){let s={};for(let o of a)s[o]=!0;this.dependencies[e]=s}hasDependency(e,a){for(let s of e){let o=this.dependencies[s];if(o){for(let u of a)if(o[u])return!0}}return!1}}class xe{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(let e in this.data)for(let a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,s){let o=e.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);let u={value:a,timeout:void 0};if(s!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},s)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){let m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){let a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;let s=e.wrapped().key,o=a===void 0?0:this.data[s].indexOf(a),u=this.data[s][o];return this.data[s].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(u.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){let a=[];for(let s in this.data)for(let o of this.data[s])e(o.value)||a.push(o);for(let s of a)this.remove(s.value.tileID,s)}}class rt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,s){let o=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},c.e(this.stateChanges[e][o],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(let u in this.state[e])u!==o&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][o]===null){this.deletedStates[e][o]={};for(let u in this.state[e][o])s[u]||(this.deletedStates[e][o][u]=null)}else for(let u in s)this.deletedStates[e]&&this.deletedStates[e][o]&&this.deletedStates[e][o][u]===null&&delete this.deletedStates[e][o][u]}removeFeatureState(e,a,s){if(this.deletedStates[e]===null)return;let o=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&a!==void 0)this.deletedStates[e][o]!==null&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][s]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][o])for(s in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][s]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,a){let s=String(a),o=c.e({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let u=this.deletedStates[e][a];if(u===null)return{};for(let m in u)delete o[m]}return o}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){let s={};for(let o in this.stateChanges){this.state[o]=this.state[o]||{};let u={};for(let m in this.stateChanges[o])this.state[o][m]||(this.state[o][m]={}),c.e(this.state[o][m],this.stateChanges[o][m]),u[m]=this.state[o][m];s[o]=u}for(let o in this.deletedStates){this.state[o]=this.state[o]||{};let u={};if(this.deletedStates[o]===null)for(let m in this.state[o])u[m]={},this.state[o][m]={};else for(let m in this.deletedStates[o]){if(this.deletedStates[o][m]===null)this.state[o][m]={};else for(let y of Object.keys(this.deletedStates[o][m]))delete this.state[o][m][y];u[m]=this.state[o][m]}s[o]=s[o]||{},c.e(s[o],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(let o in e)e[o].setFeatureState(s,a)}}class We extends c.E{constructor(e,a,s){super(),this.id=e,this.dispatcher=s,this.on("data",o=>this._dataHandler(o)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((o,u,m,y)=>{let v=new(Ea(u.type))(o,u,m,y);if(v.id!==o)throw new Error(`Expected Source id to be ${o} instead of ${v.id}`);return v})(e,a,s,this),this._tiles={},this._cache=new xe(0,o=>this._unloadTile(o)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new rt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,s){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,s)}catch(o){e.state="errored",o.status!==404?this._source.fire(new c.j(o,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let s=this._tiles[a];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Di).map(e=>e.key)}getRenderableIds(e){let a=[];for(let s in this._tiles)this._isIdRenderable(s,e)&&a.push(this._tiles[s]);return e?a.sort((s,o)=>{let u=s.tileID,m=o.tileID,y=new c.P(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),v=new c.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-m.overscaledZ||v.y-y.y||v.x-y.x}).map(s=>s.tileID.key):a.map(s=>s.tileID).sort(Di).map(s=>s.key)}hasRenderableParent(e){let a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,a){return c._(this,void 0,void 0,function*(){let s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=a),yield this._loadTile(s,e,a))})}_tileLoaded(e,a,s){e.timeAdded=ne.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let a=this.getRenderableIds();for(let o=0;o<a.length;o++){let u=a[o];if(e.neighboringTiles&&e.neighboringTiles[u]){let m=this.getTileByID(u);s(e,m),s(m,e)}}function s(o,u){o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0;let m=u.tileID.canonical.x-o.tileID.canonical.x,y=u.tileID.canonical.y-o.tileID.canonical.y,v=Math.pow(2,o.tileID.canonical.z),A=u.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+v)===1?m+=v:Math.abs(m-v)===1&&(m-=v)),u.dem&&o.dem&&(o.dem.backfillBorder(u.dem,m,y),o.neighboringTiles&&o.neighboringTiles[A]&&(o.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a,s,o){for(let u in this._tiles){let m=this._tiles[u];if(o[u]||!m.hasData()||m.tileID.overscaledZ<=a||m.tileID.overscaledZ>s)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>a+1;){let A=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[A.key],m&&m.hasData()&&(y=A)}let v=y;for(;v.overscaledZ>a;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){o[y.key]=y;break}}}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){let s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=a?s:null}for(let s=e.overscaledZ-1;s>=a;s--){let o=e.scaledTo(s),u=this._getLoadedTile(o);if(u)return u}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let a=Math.ceil(e.width/this._source.tileSize)+1,s=Math.ceil(e.height/this._source.tileSize)+1,o=Math.floor(a*s*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(u)}handleWrapJump(e){let a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){let s={};for(let o in this._tiles){let u=this._tiles[o];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+a),s[u.tileID.key]=u}this._tiles=s;for(let o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(let o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}}_updateCoveredAndRetainedTiles(e,a,s,o,u,m){let y={},v={},A=Object.keys(e),C=ne.now();for(let D of A){let L=e[D],F=this._tiles[D];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=C)continue;let N=this.findLoadedParent(L,a),j=this.findLoadedSibling(L),H=N||j||null;H&&(this._addTile(H.tileID),y[H.tileID.key]=H.tileID),v[D]=L}this._retainLoadedChildren(v,o,s,e);for(let D in y)e[D]||(this._coveredTiles[D]=!0,e[D]=y[D]);if(m){let D={},L={};for(let F of u)this._tiles[F.key].hasData()?D[F.key]=F:L[F.key]=F;for(let F in L){let N=L[F].children(this._source.maxzoom);this._tiles[N[0].key]&&this._tiles[N[1].key]&&this._tiles[N[2].key]&&this._tiles[N[3].key]&&(D[N[0].key]=e[N[0].key]=N[0],D[N[1].key]=e[N[1].key]=N[1],D[N[2].key]=e[N[2].key]=N[2],D[N[3].key]=e[N[3].key]=N[3],delete L[F])}for(let F in L){let N=L[F],j=this.findLoadedParent(N,this._source.minzoom),H=this.findLoadedSibling(N),W=j||H||null;if(W){D[W.tileID.key]=e[W.tileID.key]=W.tileID;for(let K in D)D[K].isChildOf(W.tileID)&&delete D[K]}}for(let F in this._tiles)D[F]||(this._coveredTiles[F]=!0)}}update(e,a){if(!this._sourceLoaded||this._paused)return;let s;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new c.S(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(s=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(s=s.filter(C=>this._source.hasTile(C)))):s=[];let o=e.coveringZoomLevel(this._source),u=Math.max(o-We.maxOverzooming,this._source.minzoom),m=Math.max(o+We.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let C={};for(let D of s)if(D.canonical.z>this._source.minzoom){let L=D.scaledTo(D.canonical.z-1);C[L.key]=L;let F=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));C[F.key]=F}s=s.concat(Object.values(C))}let y=s.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let v=this._updateRetainedTiles(s,o);Xi(this._source.type)&&this._updateCoveredAndRetainedTiles(v,u,m,o,s,a);for(let C in v)this._tiles[C].clearFadeHold();let A=c.ab(this._tiles,v);for(let C of A){let D=this._tiles[C];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var s;let o={},u={},m=Math.max(a-We.maxOverzooming,this._source.minzoom),y=Math.max(a+We.maxUnderzooming,this._source.minzoom),v={};for(let A of e){let C=this._addTile(A);o[A.key]=A,C.hasData()||a<this._source.maxzoom&&(v[A.key]=A)}this._retainLoadedChildren(v,a,y,o);for(let A of e){let C=this._tiles[A.key];if(C.hasData())continue;if(a+1>this._source.maxzoom){let L=A.children(this._source.maxzoom)[0],F=this.getTile(L);if(F&&F.hasData()){o[L.key]=L;continue}}else{let L=A.children(this._source.maxzoom);if(o[L[0].key]&&o[L[1].key]&&o[L[2].key]&&o[L[3].key])continue}let D=C.wasRequested();for(let L=A.overscaledZ-1;L>=m;--L){let F=A.scaledTo(L);if(u[F.key])break;if(u[F.key]=!0,C=this.getTile(F),!C&&D&&(C=this._addTile(F)),C){let N=C.hasData();if((N||!(!((s=this.map)===null||s===void 0)&&s.cancelPendingTileRequestsWhileZooming)||D)&&(o[F.key]=F),D=C.wasRequested(),N)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let a=[],s,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){s=this._loadedParentTiles[o.key];break}a.push(o.key);let u=o.scaledTo(o.overscaledZ-1);if(s=this._getLoadedTile(u),s)break;o=u}for(let u of a)this._loadedParentTiles[u]=s}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let a=this._tiles[e].tileID,s=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=s}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));let s=a;return a||(a=new zr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,s||this._source.fire(new c.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let s=a.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){let a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){let a=e.sourceDataType;e.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&a==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,s){let o=[],u=this.transform;if(!u)return o;let m=s?u.getCameraQueryGeometry(e):e,y=e.map(N=>u.pointCoordinate(N,this.terrain)),v=m.map(N=>u.pointCoordinate(N,this.terrain)),A=this.getIds(),C=1/0,D=1/0,L=-1/0,F=-1/0;for(let N of v)C=Math.min(C,N.x),D=Math.min(D,N.y),L=Math.max(L,N.x),F=Math.max(F,N.y);for(let N=0;N<A.length;N++){let j=this._tiles[A[N]];if(j.holdingForFade())continue;let H=j.tileID,W=Math.pow(2,u.zoom-j.tileID.overscaledZ),K=a*j.queryPadding*c.X/j.tileSize/W,q=[H.getTilePoint(new c.Z(C,D)),H.getTilePoint(new c.Z(L,F))];if(q[0].x-K<c.X&&q[0].y-K<c.X&&q[1].x+K>=0&&q[1].y+K>=0){let te=y.map(le=>H.getTilePoint(le)),re=v.map(le=>H.getTilePoint(le));o.push({tile:j,tileID:H,queryGeometry:te,cameraQueryGeometry:re,scale:W})}}return o}getVisibleCoordinates(e){let a=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(let s of a)s.posMatrix=this.transform.calculatePosMatrix(s.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Xi(this._source.type)){let e=ne.now();for(let a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,s){this._state.updateState(e=e||"_geojsonTileLayer",a,s)}removeFeatureState(e,a,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,s)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,s){let o=this._tiles[e];o&&o.setDependencies(a,s)}reloadTilesForDependencies(e,a){for(let s in this._tiles)this._tiles[s].hasDependency(e,a)&&this._reloadTile(s,"reloading");this._cache.filter(s=>!s.hasDependency(e,a))}}function Di(h,e){let a=Math.abs(2*h.wrap)-+(h.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||s-a||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function Xi(h){return h==="raster"||h==="image"||h==="video"}We.maxOverzooming=10,We.maxUnderzooming=3;class Ke{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let a=1,s=this._distances[a],o=e*this.paddedLength+this.padding;for(;s<o&&a<this._distances.length;)s=this._distances[++a];let u=a-1,m=this._distances[u],y=s-m,v=y>0?(o-m)/y:0;return this.points[u].mult(1-v).add(this.points[a].mult(v))}}function Ki(h,e){let a=!0;return h==="always"||h!=="never"&&e!=="never"||(a=!1),a}class vr{constructor(e,a,s){let o=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(e/s),this.yCellCount=Math.ceil(a/s);for(let m=0;m<this.xCellCount*this.yCellCount;m++)o.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,s,o,u){this._forEachCell(a,s,o,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(o),this.bboxes.push(u)}insertCircle(e,a,s,o){this._forEachCell(a-o,s-o,a+o,s+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(s),this.circles.push(o)}_insertBoxCell(e,a,s,o,u,m){this.boxCells[u].push(m)}_insertCircleCell(e,a,s,o,u,m){this.circleCells[u].push(m)}_query(e,a,s,o,u,m,y){if(s<0||e>this.width||o<0||a>this.height)return[];let v=[];if(e<=0&&a<=0&&this.width<=s&&this.height<=o){if(u)return[{key:null,x1:e,y1:a,x2:s,y2:o}];for(let A=0;A<this.boxKeys.length;A++)v.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let C=this.circles[3*A],D=this.circles[3*A+1],L=this.circles[3*A+2];v.push({key:this.circleKeys[A],x1:C-L,y1:D-L,x2:C+L,y2:D+L})}}else this._forEachCell(e,a,s,o,this._queryCell,v,{hitTest:u,overlapMode:m,seenUids:{box:{},circle:{}}},y);return v}query(e,a,s,o){return this._query(e,a,s,o,!1,null)}hitTest(e,a,s,o,u,m){return this._query(e,a,s,o,!0,u,m).length>0}hitTestCircle(e,a,s,o,u){let m=e-s,y=e+s,v=a-s,A=a+s;if(y<0||m>this.width||A<0||v>this.height)return!1;let C=[];return this._forEachCell(m,v,y,A,this._queryCellCircle,C,{hitTest:!0,overlapMode:o,circle:{x:e,y:a,radius:s},seenUids:{box:{},circle:{}}},u),C.length>0}_queryCell(e,a,s,o,u,m,y,v){let{seenUids:A,hitTest:C,overlapMode:D}=y,L=this.boxCells[u];if(L!==null){let N=this.bboxes;for(let j of L)if(!A.box[j]){A.box[j]=!0;let H=4*j,W=this.boxKeys[j];if(e<=N[H+2]&&a<=N[H+3]&&s>=N[H+0]&&o>=N[H+1]&&(!v||v(W))&&(!C||!Ki(D,W.overlapMode))&&(m.push({key:W,x1:N[H],y1:N[H+1],x2:N[H+2],y2:N[H+3]}),C))return!0}}let F=this.circleCells[u];if(F!==null){let N=this.circles;for(let j of F)if(!A.circle[j]){A.circle[j]=!0;let H=3*j,W=this.circleKeys[j];if(this._circleAndRectCollide(N[H],N[H+1],N[H+2],e,a,s,o)&&(!v||v(W))&&(!C||!Ki(D,W.overlapMode))){let K=N[H],q=N[H+1],te=N[H+2];if(m.push({key:W,x1:K-te,y1:q-te,x2:K+te,y2:q+te}),C)return!0}}}return!1}_queryCellCircle(e,a,s,o,u,m,y,v){let{circle:A,seenUids:C,overlapMode:D}=y,L=this.boxCells[u];if(L!==null){let N=this.bboxes;for(let j of L)if(!C.box[j]){C.box[j]=!0;let H=4*j,W=this.boxKeys[j];if(this._circleAndRectCollide(A.x,A.y,A.radius,N[H+0],N[H+1],N[H+2],N[H+3])&&(!v||v(W))&&!Ki(D,W.overlapMode))return m.push(!0),!0}}let F=this.circleCells[u];if(F!==null){let N=this.circles;for(let j of F)if(!C.circle[j]){C.circle[j]=!0;let H=3*j,W=this.circleKeys[j];if(this._circlesCollide(N[H],N[H+1],N[H+2],A.x,A.y,A.radius)&&(!v||v(W))&&!Ki(D,W.overlapMode))return m.push(!0),!0}}}_forEachCell(e,a,s,o,u,m,y,v){let A=this._convertToXCellCoord(e),C=this._convertToYCellCoord(a),D=this._convertToXCellCoord(s),L=this._convertToYCellCoord(o);for(let F=A;F<=D;F++)for(let N=C;N<=L;N++)if(u.call(this,e,a,s,o,this.xCellCount*N+F,m,y,v))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,s,o,u,m){let y=o-e,v=u-a,A=s+m;return A*A>y*y+v*v}_circleAndRectCollide(e,a,s,o,u,m,y){let v=(m-o)/2,A=Math.abs(e-(o+v));if(A>v+s)return!1;let C=(y-u)/2,D=Math.abs(a-(u+C));if(D>C+s)return!1;if(A<=v||D<=C)return!0;let L=A-v,F=D-C;return L*L+F*F<=s*s}}function ha(h,e,a,s,o){let u=c.H();return e?(c.K(u,u,[1/o,1/o,1]),a||c.ad(u,u,s.angle)):c.L(u,s.labelPlaneMatrix,h),u}function Zr(h,e,a,s,o){if(e){let u=c.ae(h);return c.K(u,u,[o,o,1]),a||c.ad(u,u,-s.angle),u}return s.glCoordMatrix}function G(h,e,a,s){let o;s?(o=[h,e,s(h,e),1],c.af(o,o,a)):(o=[h,e,0,1],bt(o,o,a));let u=o[3];return{point:new c.P(o[0]/u,o[1]/u),signedDistanceFromCamera:u,isOccluded:!1}}function M(h,e){return .5+h/e*.5}function k(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function O(h,e,a,s,o,u,m,y,v,A,C,D,L,F,N){let j=s?h.textSizeData:h.iconSizeData,H=c.ag(j,a.transform.zoom),W=[256/a.width*2+1,256/a.height*2+1],K=s?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;K.clear();let q=h.lineVertexArray,te=s?h.text.placedSymbolArray:h.icon.placedSymbolArray,re=a.transform.width/a.transform.height,le=!1;for(let me=0;me<te.length;me++){let _e=te.get(me);if(_e.hidden||_e.writingMode===c.ah.vertical&&!le){$e(_e.numGlyphs,K);continue}le=!1;let Te=G(_e.anchorX,_e.anchorY,e,N);if(!k(Te.point,W)){$e(_e.numGlyphs,K);continue}let ke=M(a.transform.cameraToCenterDistance,Te.signedDistanceFromCamera),Se=c.ai(j,H,_e),we=m?Se/ke:Se*ke,Be={getElevation:N,labelPlaneMatrix:o,lineVertexArray:q,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:A,tileAnchorPoint:new c.P(_e.anchorX,_e.anchorY),unwrappedTileID:C,width:D,height:L,translation:F},Qe=ie(Be,_e,we,!1,y,e,u,h.glyphOffsetArray,K,re,v);le=Qe.useVertical,(Qe.notEnoughRoom||le||Qe.needsFlipping&&ie(Be,_e,we,!0,y,e,u,h.glyphOffsetArray,K,re,v).notEnoughRoom)&&$e(_e.numGlyphs,K)}s?h.text.dynamicLayoutVertexBuffer.updateData(K):h.icon.dynamicLayoutVertexBuffer.updateData(K)}function U(h,e,a,s,o,u,m,y){let v=u.glyphStartIndex+u.numGlyphs,A=u.lineStartIndex,C=u.lineStartIndex+u.lineLength,D=e.getoffsetX(u.glyphStartIndex),L=e.getoffsetX(v-1),F=be(h*D,a,s,o,u.segment,A,C,y,m);if(!F)return null;let N=be(h*L,a,s,o,u.segment,A,C,y,m);return N?y.projectionCache.anyProjectionOccluded?null:{first:F,last:N}:null}function Y(h,e,a,s){return h===c.ah.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*s?{useVertical:!0}:(h===c.ah.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function ie(h,e,a,s,o,u,m,y,v,A,C){let D=a/24,L=e.lineOffsetX*D,F=e.lineOffsetY*D,N;if(e.numGlyphs>1){let j=e.glyphStartIndex+e.numGlyphs,H=e.lineStartIndex,W=e.lineStartIndex+e.lineLength,K=U(D,y,L,F,s,e,C,h);if(!K)return{notEnoughRoom:!0};let q=G(K.first.point.x,K.first.point.y,m,h.getElevation).point,te=G(K.last.point.x,K.last.point.y,m,h.getElevation).point;if(o&&!s){let re=Y(e.writingMode,q,te,A);if(re)return re}N=[K.first];for(let re=e.glyphStartIndex+1;re<j-1;re++)N.push(be(D*y.getoffsetX(re),L,F,s,e.segment,H,W,h,C));N.push(K.last)}else{if(o&&!s){let H=G(h.tileAnchorPoint.x,h.tileAnchorPoint.y,u,h.getElevation).point,W=e.lineStartIndex+e.segment+1,K=new c.P(h.lineVertexArray.getx(W),h.lineVertexArray.gety(W)),q=G(K.x,K.y,u,h.getElevation),te=q.signedDistanceFromCamera>0?q.point:function(le,me,_e,Te,ke,Se){return se(le,me,_e,1,ke,Se)}(h.tileAnchorPoint,K,H,0,u,h),re=Y(e.writingMode,H,te,A);if(re)return re}let j=be(D*y.getoffsetX(e.glyphStartIndex),L,F,s,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,h,C);if(!j||h.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};N=[j]}for(let j of N)c.aj(v,j.point,j.angle);return{}}function se(h,e,a,s,o,u){let m=h.add(h.sub(e)._unit()),y=o!==void 0?G(m.x,m.y,o,u.getElevation).point:pe(m.x,m.y,u).point,v=a.sub(y);return a.add(v._mult(s/v.mag()))}function X(h,e,a){let s=e.projectionCache;if(s.projections[h])return s.projections[h];let o=new c.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),u=pe(o.x,o.y,e);if(u.signedDistanceFromCamera>0)return s.projections[h]=u.point,s.anyProjectionOccluded=s.anyProjectionOccluded||u.isOccluded,u.point;let m=h-a.direction;return function(y,v,A,C,D){return se(y,v,A,C,void 0,D)}(a.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),o,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function pe(h,e,a){let s=h+a.translation[0],o=e+a.translation[1],u;return!a.pitchWithMap&&a.projection.useSpecialProjectionForSymbols?(u=a.projection.projectTileCoordinates(s,o,a.unwrappedTileID,a.getElevation),u.point.x=(.5*u.point.x+.5)*a.width,u.point.y=(.5*-u.point.y+.5)*a.height):(u=G(s,o,a.labelPlaneMatrix,a.getElevation),u.isOccluded=!1),u}function ge(h,e,a){return h._unit()._perp()._mult(e*a)}function ue(h,e,a,s,o,u,m,y,v){if(y.projectionCache.offsets[h])return y.projectionCache.offsets[h];let A=a.add(e);if(h+v.direction<s||h+v.direction>=o)return y.projectionCache.offsets[h]=A,A;let C=X(h+v.direction,y,v),D=ge(C.sub(a),m,v.direction),L=a.add(D),F=C.add(D);return y.projectionCache.offsets[h]=c.ak(u,A,L,F)||A,y.projectionCache.offsets[h]}function be(h,e,a,s,o,u,m,y,v){let A=s?h-e:h+e,C=A>0?1:-1,D=0;s&&(C*=-1,D=Math.PI),C<0&&(D+=Math.PI);let L,F=C>0?u+o:u+o+1;y.projectionCache.cachedAnchorPoint?L=y.projectionCache.cachedAnchorPoint:(L=pe(y.tileAnchorPoint.x,y.tileAnchorPoint.y,y).point,y.projectionCache.cachedAnchorPoint=L);let N,j,H=L,W=L,K=0,q=0,te=Math.abs(A),re=[],le;for(;K+q<=te;){if(F+=C,F<u||F>=m)return null;K+=q,W=H,j=N;let Te={absOffsetX:te,direction:C,distanceFromAnchor:K,previousVertex:W};if(H=X(F,y,Te),a===0)re.push(W),le=H.sub(W);else{let ke,Se=H.sub(W);ke=Se.mag()===0?ge(X(F+C,y,Te).sub(H),a,C):ge(Se,a,C),j||(j=W.add(ke)),N=ue(F,ke,H,u,m,j,a,y,Te),re.push(j),le=N.sub(j)}q=le.mag()}let me=le._mult((te-K)/q)._add(j||W),_e=D+Math.atan2(H.y-W.y,H.x-W.x);return re.push(me),{point:me,angle:v?_e:0,path:re}}let qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $e(h,e){for(let a=0;a<h;a++){let s=e.length;e.resize(s+4),e.float32.set(qe,3*s)}}function bt(h,e,a){let s=e[0],o=e[1];return h[0]=a[0]*s+a[4]*o+a[12],h[1]=a[1]*s+a[5]*o+a[13],h[3]=a[3]*s+a[7]*o+a[15],h}let it=100;class wt{constructor(e,a,s=new vr(e.width+200,e.height+200,25),o=new vr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=a,this.grid=s,this.ignoredGrid=o,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+it,this.screenBottomBoundary=e.height+it,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,s,o,u,m,y,v,A,C,D){let L=e.anchorPointX+v[0],F=e.anchorPointY+v[1],N=this.projectAndGetPerspectiveRatio(o,L,F,u,C),j=s*N.perspectiveRatio,H;if(m||y)H=this._projectCollisionBox(e,j,o,u,m,y,v,N,C,D);else{let re=N.point.x+(D?D.x*j:0),le=N.point.y+(D?D.y*j:0);H={allPointsOccluded:!1,box:[re+e.x1*j,le+e.y1*j,re+e.x2*j,le+e.y2*j]}}let[W,K,q,te]=H.box;return this.mapProjection.useSpecialProjectionForSymbols&&(m?H.allPointsOccluded:this.mapProjection.isOccluded(L,F,u))||N.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(W,K,q,te)||a!=="always"&&this.grid.hitTest(W,K,q,te,a,A)?{box:[W,K,q,te],placeable:!1,offscreen:!1}:{box:[W,K,q,te],placeable:!0,offscreen:this.isOffscreen(W,K,q,te)}}placeCollisionCircles(e,a,s,o,u,m,y,v,A,C,D,L,F,N,j,H){let W=[],K=new c.P(a.anchorX,a.anchorY),q=this.getPerspectiveRatio(m,K.x,K.y,y,H),te=(D?u/q:u*q)/c.ap,re={getElevation:H,labelPlaneMatrix:v,lineVertexArray:s,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:K,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:j},le=U(te,o,a.lineOffsetX*te,a.lineOffsetY*te,!1,a,!1,re),me=!1,_e=!1,Te=!0;if(le){let ke=.5*F*q+N,Se=new c.P(-100,-100),we=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Be=new Ke,Qe=le.first,Ae=le.last,De=[];for(let at=Qe.path.length-1;at>=1;at--)De.push(Qe.path[at]);for(let at=1;at<Ae.path.length;at++)De.push(Ae.path[at]);let Je=2.5*ke;if(A){let at=this.projectPathToScreenSpace(De,re,A);De=at.some(gt=>gt.signedDistanceFromCamera<=0)?[]:at.map(gt=>gt.point)}let Xt=[];if(De.length>0){let at=De[0].clone(),gt=De[0].clone();for(let Kt=1;Kt<De.length;Kt++)at.x=Math.min(at.x,De[Kt].x),at.y=Math.min(at.y,De[Kt].y),gt.x=Math.max(gt.x,De[Kt].x),gt.y=Math.max(gt.y,De[Kt].y);Xt=at.x>=Se.x&&gt.x<=we.x&&at.y>=Se.y&&gt.y<=we.y?[De]:gt.x<Se.x||at.x>we.x||gt.y<Se.y||at.y>we.y?[]:c.al([De],Se.x,Se.y,we.x,we.y)}for(let at of Xt){Be.reset(at,.25*ke);let gt=0;gt=Be.length<=.5*ke?1:Math.ceil(Be.paddedLength/Je)+1;for(let Kt=0;Kt<gt;Kt++){let zi=Kt/Math.max(gt-1,1),Nr=Be.lerp(zi),Jt=Nr.x+it,Qi=Nr.y+it;W.push(Jt,Qi,ke,0);let ji=Jt-ke,Li=Qi-ke,$i=Jt+ke,Kr=Qi+ke;if(Te=Te&&this.isOffscreen(ji,Li,$i,Kr),_e=_e||this.isInsideGrid(ji,Li,$i,Kr),e!=="always"&&this.grid.hitTestCircle(Jt,Qi,ke,e,L)&&(me=!0,!C))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!C&&me||!_e||q<this.perspectiveRatioCutoff?[]:W,offscreen:Te,collisionDetected:me}}projectPathToScreenSpace(e,a,s){return e.map(o=>G(o.x,o.y,s,a.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],s=1/0,o=1/0,u=-1/0,m=-1/0;for(let C of e){let D=new c.P(C.x+it,C.y+it);s=Math.min(s,D.x),o=Math.min(o,D.y),u=Math.max(u,D.x),m=Math.max(m,D.y),a.push(D)}let y=this.grid.query(s,o,u,m).concat(this.ignoredGrid.query(s,o,u,m)),v={},A={};for(let C of y){let D=C.key;if(v[D.bucketInstanceId]===void 0&&(v[D.bucketInstanceId]={}),v[D.bucketInstanceId][D.featureIndex])continue;let L=[new c.P(C.x1,C.y1),new c.P(C.x2,C.y1),new c.P(C.x2,C.y2),new c.P(C.x1,C.y2)];c.am(a,L)&&(v[D.bucketInstanceId][D.featureIndex]=!0,A[D.bucketInstanceId]===void 0&&(A[D.bucketInstanceId]=[]),A[D.bucketInstanceId].push(D.featureIndex))}return A}insertCollisionBox(e,a,s,o,u,m){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:u,collisionGroupID:m,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,s,o,u,m){let y=s?this.ignoredGrid:this.grid,v={bucketInstanceId:o,featureIndex:u,collisionGroupID:m,overlapMode:a};for(let A=0;A<e.length;A+=4)y.insertCircle(v,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,a,s,o,u){let m;u?(m=[a,s,u(a,s),1],c.af(m,m,e)):(m=[a,s,0,1],bt(m,m,e));let y=m[3];return{point:new c.P((m[0]/y+1)/2*this.transform.width+it,(-m[1]/y+1)/2*this.transform.height+it),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y*.5,isOccluded:!1,signedDistanceFromCamera:y}}getPerspectiveRatio(e,a,s,o,u){let m=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(a,s,o,u):G(a,s,e,u);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,a,s,o){return s<it||e>=this.screenRightBoundary||o<it||a>this.screenBottomBoundary}isInsideGrid(e,a,s,o){return s>=0&&e<this.gridRightBoundary&&o>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,s,o,u,m,y,v,A,C){let D=new c.P(1,0),L=new c.P(0,1),F=new c.P(e.anchorPointX+y[0],e.anchorPointY+y[1]);if(m&&!u){let Te=this.projectAndGetPerspectiveRatio(s,F.x+1,F.y,o,A).point.sub(v.point).unit(),ke=Math.atan(Te.y/Te.x)+(Te.x<0?Math.PI:0),Se=Math.sin(ke),we=Math.cos(ke);D=new c.P(we,Se),L=new c.P(-Se,we)}else if(!m&&u){let Te=-this.transform.angle,ke=Math.sin(Te),Se=Math.cos(Te);D=new c.P(Se,ke),L=new c.P(-ke,Se)}let N=v.point,j=a;if(u){N=F;let Te=this.transform.zoom-Math.floor(this.transform.zoom);j=Math.pow(2,-Te),j*=this.mapProjection.getPitchedTextCorrection(this.transform,F,o),C||(j*=c.ac(.5+v.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}C&&(N=N.add(D.mult(C.x*j)).add(L.mult(C.y*j)));let H=e.x1*j,W=e.x2*j,K=(H+W)/2,q=e.y1*j,te=e.y2*j,re=(q+te)/2,le=[{offsetX:H,offsetY:q},{offsetX:K,offsetY:q},{offsetX:W,offsetY:q},{offsetX:W,offsetY:re},{offsetX:W,offsetY:te},{offsetX:K,offsetY:te},{offsetX:H,offsetY:te},{offsetX:H,offsetY:re}],me=[];for(let{offsetX:Te,offsetY:ke}of le)me.push(new c.P(N.x+D.x*Te+L.x*ke,N.y+D.y*Te+L.y*ke));let _e=!1;if(u){let Te=me.map(ke=>this.projectAndGetPerspectiveRatio(s,ke.x,ke.y,o,A));_e=Te.some(ke=>!ke.isOccluded),me=Te.map(ke=>ke.point)}else _e=!0;return{box:c.ao(me),allPointsOccluded:!_e}}}function mt(h,e,a){return e*(c.X/(h.tileSize*Math.pow(2,a-h.tileID.overscaledZ)))}class fi{constructor(e,a,s,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):o&&s?1:0,this.placed=s}isHidden(){return this.opacity===0&&!this.placed}}class ii{constructor(e,a,s,o,u){this.text=new fi(e?e.text:null,a,s,u),this.icon=new fi(e?e.icon:null,a,o,u)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class st{constructor(e,a,s){this.text=e,this.icon=a,this.skipFade=s}}class Pt{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class ei{constructor(e,a,s,o,u){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=s,this.bucketIndex=o,this.tileID=u}}class Ai{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:s=>s.collisionGroupID===a}}return this.collisionGroups[e]}}function Ii(h,e,a,s,o){let{horizontalAlign:u,verticalAlign:m}=c.au(h);return new c.P(-(u-.5)*e+s[0]*o,-(m-.5)*a+s[1]*o)}class Ui{constructor(e,a,s,o,u,m){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new wt(this.transform,a),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ai(u),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let a=this.terrain;return a?(s,o)=>a.getElevation(e,s,o):null}getBucketParts(e,a,s,o){let u=s.getBucket(a),m=s.latestFeatureIndex;if(!u||!m||a.id!==u.layerIds[0])return;let y=s.collisionBoxArray,v=u.layers[0].layout,A=u.layers[0].paint,C=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),D=s.tileSize/c.X,L=s.tileID.toUnwrapped(),F=this.transform.calculatePosMatrix(L),N=v.get("text-pitch-alignment")==="map",j=v.get("text-rotation-alignment")==="map",H=mt(s,1,this.transform.zoom),W=this.collisionIndex.mapProjection.translatePosition(this.transform,s,A.get("text-translate"),A.get("text-translate-anchor")),K=this.collisionIndex.mapProjection.translatePosition(this.transform,s,A.get("icon-translate"),A.get("icon-translate-anchor")),q=ha(F,N,j,this.transform,H),te=null;if(N){let le=Zr(F,N,j,this.transform,H);te=c.L([],this.transform.labelPlaneMatrix,le)}this.retainedQueryData[u.bucketInstanceId]=new ei(u.bucketInstanceId,m,u.sourceLayerIndex,u.index,s.tileID);let re={bucket:u,layout:v,translationText:W,translationIcon:K,posMatrix:F,unwrappedTileID:L,textLabelPlaneMatrix:q,labelToScreenMatrix:te,scale:C,textPixelRatio:D,holdingForFade:s.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:c.ag(u.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(o)for(let le of u.sortKeyRanges){let{sortKey:me,symbolInstanceStart:_e,symbolInstanceEnd:Te}=le;e.push({sortKey:me,symbolInstanceStart:_e,symbolInstanceEnd:Te,parameters:re})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:re})}attemptAnchorPlacement(e,a,s,o,u,m,y,v,A,C,D,L,F,N,j,H,W,K,q){let te=c.aq[e.textAnchor],re=[e.textOffset0,e.textOffset1],le=Ii(te,s,o,re,u),me=this.collisionIndex.placeCollisionBox(a,L,v,A,C,y,m,H,D.predicate,q,le);if((!K||this.collisionIndex.placeCollisionBox(K,L,v,A,C,y,m,W,D.predicate,q,le).placeable)&&me.placeable){let _e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(_e=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:re,width:s,height:o,anchor:te,textBoxScale:u,prevAnchor:_e},this.markUsedJustification(N,te,F,j),N.allowVerticalPlacement&&(this.markUsedOrientation(N,j,F),this.placedOrientations[F.crossTileID]=j),{shift:le,placedGlyphBoxes:me}}}placeLayerBucketPart(e,a,s){let{bucket:o,layout:u,translationText:m,translationIcon:y,posMatrix:v,unwrappedTileID:A,textLabelPlaneMatrix:C,labelToScreenMatrix:D,textPixelRatio:L,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:j,collisionGroup:H}=e.parameters,W=u.get("text-optional"),K=u.get("icon-optional"),q=c.ar(u,"text-overlap","text-allow-overlap"),te=q==="always",re=c.ar(u,"icon-overlap","icon-allow-overlap"),le=re==="always",me=u.get("text-rotation-alignment")==="map",_e=u.get("text-pitch-alignment")==="map",Te=u.get("icon-text-fit")!=="none",ke=u.get("symbol-z-order")==="viewport-y",Se=te&&(le||!o.hasIconData()||K),we=le&&(te||!o.hasTextData()||W);!o.collisionArrays&&N&&o.deserializeCollisionBoxes(N);let Be=this._getTerrainElevationFunc(this.retainedQueryData[o.bucketInstanceId].tileID),Qe=(Ae,De,Je)=>{var Xt,at;if(a[Ae.crossTileID])return;if(F)return void(this.placements[Ae.crossTileID]=new st(!1,!1,!1));let gt=!1,Kt=!1,zi=!0,Nr=null,Jt={box:null,placeable:!1,offscreen:null},Qi={box:null,placeable:!1,offscreen:null},ji=null,Li=null,$i=null,Kr=0,gn=0,Ns=0;De.textFeatureIndex?Kr=De.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(Kr=Ae.featureIndex),De.verticalTextFeatureIndex&&(gn=De.verticalTextFeatureIndex);let yn=De.textBox;if(yn){let Er=ki=>{let Bi=c.ah.horizontal;if(o.allowVerticalPlacement&&!ki&&this.prevPlacement){let dr=this.prevPlacement.placedOrientations[Ae.crossTileID];dr&&(this.placedOrientations[Ae.crossTileID]=dr,Bi=dr,this.markUsedOrientation(o,Bi,Ae))}return Bi},Tr=(ki,Bi)=>{if(o.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&De.verticalTextBox){for(let dr of o.writingModes)if(dr===c.ah.vertical?(Jt=Bi(),Qi=Jt):Jt=ki(),Jt&&Jt.placeable)break}else Jt=ki()},fa=Ae.textAnchorOffsetStartIndex,qr=Ae.textAnchorOffsetEndIndex;if(qr===fa){let ki=(Bi,dr)=>{let vt=this.collisionIndex.placeCollisionBox(Bi,q,L,v,A,_e,me,m,H.predicate,Be);return vt&&vt.placeable&&(this.markUsedOrientation(o,dr,Ae),this.placedOrientations[Ae.crossTileID]=dr),vt};Tr(()=>ki(yn,c.ah.horizontal),()=>{let Bi=De.verticalTextBox;return o.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Bi?ki(Bi,c.ah.vertical):{box:null,offscreen:null}}),Er(Jt&&Jt.placeable)}else{let ki=c.aq[(at=(Xt=this.prevPlacement)===null||Xt===void 0?void 0:Xt.variableOffsets[Ae.crossTileID])===null||at===void 0?void 0:at.anchor],Bi=(vt,Oa,_n)=>{let vn=vt.x2-vt.x1,_c=vt.y2-vt.y1,Bu=Ae.textBoxScale,vc=Te&&re==="never"?Oa:null,ma=null,xc=q==="never"?1:2,Vs="never";ki&&xc++;for(let Kn=0;Kn<xc;Kn++){for(let Us=fa;Us<qr;Us++){let js=o.textAnchorOffsets.get(Us);if(ki&&js.textAnchor!==ki)continue;let xn=this.attemptAnchorPlacement(js,vt,vn,_c,Bu,me,_e,L,v,A,H,Vs,Ae,o,_n,m,y,vc,Be);if(xn&&(ma=xn.placedGlyphBoxes,ma&&ma.placeable))return gt=!0,Nr=xn.shift,ma}ki?ki=null:Vs=q}return s&&!ma&&(ma={box:this.collisionIndex.placeCollisionBox(yn,"always",L,v,A,_e,me,m,H.predicate,Be,new c.P(0,0)).box,offscreen:!1,placeable:!1}),ma};Tr(()=>Bi(yn,De.iconBox,c.ah.horizontal),()=>{let vt=De.verticalTextBox;return o.allowVerticalPlacement&&(!Jt||!Jt.placeable)&&Ae.numVerticalGlyphVertices>0&&vt?Bi(vt,De.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Jt&&(gt=Jt.placeable,zi=Jt.offscreen);let dr=Er(Jt&&Jt.placeable);if(!gt&&this.prevPlacement){let vt=this.prevPlacement.variableOffsets[Ae.crossTileID];vt&&(this.variableOffsets[Ae.crossTileID]=vt,this.markUsedJustification(o,vt.anchor,Ae,dr))}}}if(ji=Jt,gt=ji&&ji.placeable,zi=ji&&ji.offscreen,Ae.useRuntimeCollisionCircles){let Er=o.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex),Tr=c.ai(o.textSizeData,j,Er),fa=u.get("text-padding");Li=this.collisionIndex.placeCollisionCircles(q,Er,o.lineVertexArray,o.glyphOffsetArray,Tr,v,A,C,D,s,_e,H.predicate,Ae.collisionCircleDiameter,fa,m,Be),Li.circles.length&&Li.collisionDetected&&!s&&c.w("Collisions detected, but collision boxes are not shown"),gt=te||Li.circles.length>0&&!Li.collisionDetected,zi=zi&&Li.offscreen}if(De.iconFeatureIndex&&(Ns=De.iconFeatureIndex),De.iconBox){let Er=Tr=>this.collisionIndex.placeCollisionBox(Tr,re,L,v,A,_e,me,y,H.predicate,Be,Te&&Nr?Nr:void 0);Qi&&Qi.placeable&&De.verticalIconBox?($i=Er(De.verticalIconBox),Kt=$i.placeable):($i=Er(De.iconBox),Kt=$i.placeable),zi=zi&&$i.offscreen}let Ar=W||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,qs=K||Ae.numIconVertices===0;Ar||qs?qs?Ar||(Kt=Kt&&gt):gt=Kt&&gt:Kt=gt=Kt&&gt;let rl=Kt&&$i.placeable;if(gt&&ji.placeable&&this.collisionIndex.insertCollisionBox(ji.box,q,u.get("text-ignore-placement"),o.bucketInstanceId,Qi&&Qi.placeable&&gn?gn:Kr,H.ID),rl&&this.collisionIndex.insertCollisionBox($i.box,re,u.get("icon-ignore-placement"),o.bucketInstanceId,Ns,H.ID),Li&&gt&&this.collisionIndex.insertCollisionCircles(Li.circles,q,u.get("text-ignore-placement"),o.bucketInstanceId,Kr,H.ID),s&&this.storeCollisionData(o.bucketInstanceId,Je,De,ji,$i,Li),Ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(o.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ae.crossTileID]=new st(gt||Se,Kt||we,zi||o.justReloaded),a[Ae.crossTileID]=!0};if(ke){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ae=o.getSortedSymbolIndexes(this.transform.angle);for(let De=Ae.length-1;De>=0;--De){let Je=Ae[De];Qe(o.symbolInstances.get(Je),o.collisionArrays[Je],Je)}}else for(let Ae=e.symbolInstanceStart;Ae<e.symbolInstanceEnd;Ae++)Qe(o.symbolInstances.get(Ae),o.collisionArrays[Ae],Ae);if(s&&o.bucketInstanceId in this.collisionCircleArrays){let Ae=this.collisionCircleArrays[o.bucketInstanceId];c.as(Ae.invProjMatrix,v),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}storeCollisionData(e,a,s,o,u,m){if(s.textBox||s.iconBox){let y,v;this.collisionBoxArrays.has(e)?y=this.collisionBoxArrays.get(e):(y=new Map,this.collisionBoxArrays.set(e,y)),y.has(a)?v=y.get(a):(v={text:null,icon:null},y.set(a,v)),s.textBox&&(v.text=o.box),s.iconBox&&(v.icon=u.box)}if(m){let y=this.collisionCircleArrays[e];y===void 0&&(y=this.collisionCircleArrays[e]=new Pt);for(let v=0;v<m.circles.length;v+=4)y.circles.push(m.circles[v+0]),y.circles.push(m.circles[v+1]),y.circles.push(m.circles[v+2]),y.circles.push(m.collisionDetected?1:0)}}markUsedJustification(e,a,s,o){let u;u=o===c.ah.vertical?s.verticalPlacedTextSymbolIndex:{left:s.leftJustifiedTextSymbolIndex,center:s.centerJustifiedTextSymbolIndex,right:s.rightJustifiedTextSymbolIndex}[c.at(a)];let m=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex,s.verticalPlacedTextSymbolIndex];for(let y of m)y>=0&&(e.text.placedSymbolArray.get(y).crossTileID=u>=0&&y!==u?0:s.crossTileID)}markUsedOrientation(e,a,s){let o=a===c.ah.horizontal||a===c.ah.horizontalOnly?a:0,u=a===c.ah.vertical?a:0,m=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex];for(let y of m)e.text.placedSymbolArray.get(y).placedOrientation=o;s.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).placedOrientation=u)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,s=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let o=a?a.symbolFadeChange(e):1,u=a?a.opacities:{},m=a?a.variableOffsets:{},y=a?a.placedOrientations:{};for(let v in this.placements){let A=this.placements[v],C=u[v];C?(this.opacities[v]=new ii(C,o,A.text,A.icon),s=s||A.text!==C.text.placed||A.icon!==C.icon.placed):(this.opacities[v]=new ii(null,o,A.text,A.icon,A.skipFade),s=s||A.text||A.icon)}for(let v in u){let A=u[v];if(!this.opacities[v]){let C=new ii(A,o,!1,!1);C.isHidden()||(this.opacities[v]=C,s=s||A.text.placed||A.icon.placed)}}for(let v in m)this.variableOffsets[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.variableOffsets[v]=m[v]);for(let v in y)this.placedOrientations[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.placedOrientations[v]=y[v]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");s?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){let s={};for(let o of a){let u=o.getBucket(e);u&&o.latestFeatureIndex&&e.id===u.layerIds[0]&&this.updateBucketOpacities(u,o.tileID,s,o.collisionBoxArray)}}updateBucketOpacities(e,a,s,o){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let u=e.layers[0],m=u.layout,y=new ii(null,0,!1,!1,!0),v=m.get("text-allow-overlap"),A=m.get("icon-allow-overlap"),C=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=m.get("text-rotation-alignment")==="map",L=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",N=new ii(null,0,v&&(A||!e.hasIconData()||m.get("icon-optional")),A&&(v||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);let j=(W,K,q)=>{for(let te=0;te<K/4;te++)W.opacityVertexArray.emplaceBack(q);W.hasVisibleVertices=W.hasVisibleVertices||q!==Wa},H=this.collisionBoxArrays.get(e.bucketInstanceId);for(let W=0;W<e.symbolInstances.length;W++){let K=e.symbolInstances.get(W),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:te,crossTileID:re}=K,le=this.opacities[re];s[re]?le=y:le||(le=N,this.opacities[re]=le),s[re]=!0;let me=K.numIconVertices>0,_e=this.placedOrientations[K.crossTileID],Te=_e===c.ah.vertical,ke=_e===c.ah.horizontal||_e===c.ah.horizontalOnly;if(q>0||te>0){let we=ur(le.text);j(e.text,q,Te?Wa:we),j(e.text,te,ke?Wa:we);let Be=le.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(De=>{De>=0&&(e.text.placedSymbolArray.get(De).hidden=Be||Te?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Be||ke?1:0);let Qe=this.variableOffsets[K.crossTileID];Qe&&this.markUsedJustification(e,Qe.anchor,K,_e);let Ae=this.placedOrientations[K.crossTileID];Ae&&(this.markUsedJustification(e,"left",K,Ae),this.markUsedOrientation(e,Ae,K))}if(me){let we=ur(le.icon),Be=!(F&&K.verticalPlacedIconSymbolIndex&&Te);K.placedIconSymbolIndex>=0&&(j(e.icon,K.numIconVertices,Be?we:Wa),e.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=le.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(j(e.icon,K.numVerticalIconVertices,Be?Wa:we),e.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}let Se=H&&H.has(W)?H.get(W):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let we=e.collisionArrays[W];if(we){let Be=new c.P(0,0);if(we.textBox||we.verticalTextBox){let Qe=!0;if(C){let Ae=this.variableOffsets[re];Ae?(Be=Ii(Ae.anchor,Ae.width,Ae.height,Ae.textOffset,Ae.textBoxScale),D&&Be._rotate(L?this.transform.angle:-this.transform.angle)):Qe=!1}if(we.textBox||we.verticalTextBox){let Ae;we.textBox&&(Ae=Te),we.verticalTextBox&&(Ae=ke),Ha(e.textCollisionBox.collisionVertexArray,le.text.placed,!Qe||Ae,Se.text,Be.x,Be.y)}}if(we.iconBox||we.verticalIconBox){let Qe=!!(!ke&&we.verticalIconBox),Ae;we.iconBox&&(Ae=Qe),we.verticalIconBox&&(Ae=!Qe),Ha(e.iconCollisionBox.collisionVertexArray,le.icon.placed,Ae,Se.icon,F?Be.x:0,F?Be.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){let W=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=W.invProjMatrix,e.placementViewportMatrix=W.viewportMatrix,e.collisionCircleArray=W.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){let s=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*s>e}setStale(){this.stale=!0}}function Ha(h,e,a,s,o,u){s&&s.length!==0||(s=[0,0,0,0]);let m=s[0]-it,y=s[1]-it,v=s[2]-it,A=s[3]-it;h.emplaceBack(e?1:0,a?1:0,o||0,u||0,m,y),h.emplaceBack(e?1:0,a?1:0,o||0,u||0,v,y),h.emplaceBack(e?1:0,a?1:0,o||0,u||0,v,A),h.emplaceBack(e?1:0,a?1:0,o||0,u||0,m,A)}let zt=Math.pow(2,25),fo=Math.pow(2,24),mo=Math.pow(2,17),lr=Math.pow(2,16),cr=Math.pow(2,9),cu=Math.pow(2,8),xr=Math.pow(2,1);function ur(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let e=h.placed?1:0,a=Math.floor(127*h.opacity);return a*zt+e*fo+a*mo+e*lr+a*cr+e*cu+a*xr+e}let Wa=0;function Ta(){return{isOccluded:(h,e,a)=>!1,getPitchedTextCorrection:(h,e,a)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(h,e,a,s){throw new Error("Not implemented.")},translatePosition:(h,e,a,s)=>function(o,u,m,y,v=!1){if(!m[0]&&!m[1])return[0,0];let A=v?y==="map"?o.angle:0:y==="viewport"?-o.angle:0;if(A){let C=Math.sin(A),D=Math.cos(A);m=[m[0]*D-m[1]*C,m[0]*C+m[1]*D]}return[v?m[0]:mt(u,m[0],o.zoom),v?m[1]:mt(u,m[1],o.zoom)]}(h,e,a,s),getCircleRadiusCorrection:h=>1}}class mi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,s,o,u){let m=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(m,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((y,v)=>y.sortKey-v.sortKey));this._currentPartIndex<m.length;)if(a.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,s),this._currentPartIndex++,u())return!0;return!1}}class Pn{constructor(e,a,s,o,u,m,y,v){this.placement=new Ui(e,Ta(),a,m,y,v),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(e,a,s){let o=ne.now(),u=()=>!this._forceFullPlacement&&ne.now()-o>2;for(;this._currentPlacementIndex>=0;){let m=a[e[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=y)&&(!m.maxzoom||m.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new mi(m)),this._inProgressLayer.continuePlacement(s[m.source],this.placement,this._showCollisionBoxes,m,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let Lr=512/c.X/2;class ui{constructor(e,a,s){this.tileID=e,this.bucketInstanceId=s,this._symbolsByKey={};let o=new Map;for(let u=0;u<a.length;u++){let m=a.get(u),y=m.key,v=o.get(y);v?v.push(m):o.set(y,[m])}for(let[u,m]of o){let y={positions:m.map(v=>({x:Math.floor(v.anchorX*Lr),y:Math.floor(v.anchorY*Lr)})),crossTileIDs:m.map(v=>v.crossTileID)};if(y.positions.length>128){let v=new c.av(y.positions.length,16,Uint16Array);for(let{x:A,y:C}of y.positions)v.add(A,C);v.finish(),delete y.positions,y.index=v}this._symbolsByKey[u]=y}}getScaledCoordinates(e,a){let{x:s,y:o,z:u}=this.tileID.canonical,{x:m,y,z:v}=a.canonical,A=Lr/Math.pow(2,v-u),C=(y*c.X+e.anchorY)*A,D=o*c.X*Lr;return{x:Math.floor((m*c.X+e.anchorX)*A-s*c.X*Lr),y:Math.floor(C-D)}}findMatches(e,a,s){let o=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let u=0;u<e.length;u++){let m=e.get(u);if(m.crossTileID)continue;let y=this._symbolsByKey[m.key];if(!y)continue;let v=this.getScaledCoordinates(m,a);if(y.index){let A=y.index.range(v.x-o,v.y-o,v.x+o,v.y+o).sort();for(let C of A){let D=y.crossTileIDs[C];if(!s[D]){s[D]=!0,m.crossTileID=D;break}}}else if(y.positions)for(let A=0;A<y.positions.length;A++){let C=y.positions[A],D=y.crossTileIDs[A];if(Math.abs(C.x-v.x)<=o&&Math.abs(C.y-v.y)<=o&&!s[D]){s[D]=!0,m.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ls{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Br{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let a=Math.round((e-this.lng)/360);if(a!==0)for(let s in this.indexes){let o=this.indexes[s],u={};for(let m in o){let y=o[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),u[y.tileID.key]=y}this.indexes[s]=u}this.lng=e}addBucket(e,a,s){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let u=0;u<a.symbolInstances.length;u++)a.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let o=this.usedCrossTileIDs[e.overscaledZ];for(let u in this.indexes){let m=this.indexes[u];if(Number(u)>e.overscaledZ)for(let y in m){let v=m[y];v.tileID.isChildOf(e)&&v.findMatches(a.symbolInstances,e,o)}else{let y=m[e.scaledTo(Number(u)).key];y&&y.findMatches(a.symbolInstances,e,o)}}for(let u=0;u<a.symbolInstances.length;u++){let m=a.symbolInstances.get(u);m.crossTileID||(m.crossTileID=s.generate(),o[m.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ui(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(let s of a.getCrossTileIDsLists())for(let o of s)delete this.usedCrossTileIDs[e][o]}removeStaleBuckets(e){let a=!1;for(let s in this.indexes){let o=this.indexes[s];for(let u in o)e[o[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,o[u]),delete o[u],a=!0)}return a}}class go{constructor(){this.layerIndexes={},this.crossTileIDs=new ls,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,s){let o=this.layerIndexes[e.id];o===void 0&&(o=this.layerIndexes[e.id]=new Br);let u=!1,m={};o.handleWrapJump(s);for(let y of a){let v=y.getBucket(e);v&&e.id===v.layerIds[0]&&(v.bucketInstanceId||(v.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(y.tileID,v,this.crossTileIDs)&&(u=!0),m[v.bucketInstanceId]=!0)}return o.removeStaleBuckets(m)&&(u=!0),u}pruneUnusedLayers(e){let a={};e.forEach(s=>{a[s]=!0});for(let s in this.layerIndexes)a[s]||delete this.layerIndexes[s]}}let Rr=(h,e)=>c.t(h,e&&e.filter(a=>a.identifier!=="source.canvas")),uu=c.aw();class cs extends c.E{constructor(e,a={}){super(),this._rtlPluginLoaded=()=>{for(let s in this.sourceCaches){let o=this.sourceCaches[s].getSource().type;o!=="vector"&&o!=="geojson"||this.sourceCaches[s].reload()}},this.map=e,this.dispatcher=new nt(Ge(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(s,o)=>this.getGlyphs(s,o)),this.dispatcher.registerMessageHandler("GI",(s,o)=>this.getImages(s,o)),this.imageManager=new et,this.imageManager.setEventedParent(this),this.glyphManager=new oi(e._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Dt(256,512),this.crossTileSymbolIndex=new go,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),or().on(ve,this._rtlPluginLoaded),this.on("data",s=>{if(s.dataType!=="source"||s.sourceDataType!=="metadata")return;let o=this.sourceCaches[s.sourceId];if(!o)return;let u=o.getSource();if(u&&u.vectorLayerIds)for(let m in this._layers){let y=this._layers[m];y.source===u.id&&this._validateLayer(y)}})}loadURL(e,a={},s){this.fire(new c.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;let o=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let u=this._loadStyleRequest;c.h(o,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,a,s)}).catch(m=>{this._loadStyleRequest=null,m&&!u.signal.aborted&&this.fire(new c.j(m))})}loadJSON(e,a={},s){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,s)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(uu,{validate:!1})}_load(e,a,s){var o;let u=a.transformStyle?a.transformStyle(s,e):e;if(!a.validate||!Rr(this,c.u(u))){this._loaded=!0,this.stylesheet=u;for(let m in u.sources)this.addSource(m,u.sources[m],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs),this._createLayers(),this.light=new wi(this.stylesheet.light),this.sky=new ft(this.stylesheet.sky),this.map.setTerrain((o=this.stylesheet.terrain)!==null&&o!==void 0?o:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){let e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(a=>a.id),this._layers={},this._serializedLayers=null;for(let a of e){let s=c.aA(a);s.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=s}}_loadSprite(e,a=!1,s=void 0){let o;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(u,m,y,v){return c._(this,void 0,void 0,function*(){let A=je(u),C=y>1?"@2x":"",D={},L={};for(let{id:F,url:N}of A){let j=m.transformRequest(ht(N,C,".json"),"SpriteJSON");D[F]=c.h(j,v);let H=m.transformRequest(ht(N,C,".png"),"SpriteImage");L[F]=yt.getImage(H,v)}return yield Promise.all([...Object.values(D),...Object.values(L)]),function(F,N){return c._(this,void 0,void 0,function*(){let j={};for(let H in F){j[H]={};let W=ne.getImageCanvasContext((yield N[H]).data),K=(yield F[H]).data;for(let q in K){let{width:te,height:re,x:le,y:me,sdf:_e,pixelRatio:Te,stretchX:ke,stretchY:Se,content:we,textFitWidth:Be,textFitHeight:Qe}=K[q];j[H][q]={data:null,pixelRatio:Te,sdf:_e,stretchX:ke,stretchY:Se,content:we,textFitWidth:Be,textFitHeight:Qe,spriteData:{width:te,height:re,x:le,y:me,context:W}}}}return j})}(D,L)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(u=>{if(this._spriteRequest=null,u)for(let m in u){this._spritesImagesIds[m]=[];let y=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter(v=>!(v in u)):[];for(let v of y)this.imageManager.removeImage(v),this._changedImages[v]=!0;for(let v in u[m]){let A=m==="default"?v:`${m}:${v}`;this._spritesImagesIds[m].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,u[m][v],!1):this.imageManager.addImage(A,u[m][v]),a&&(this._changedImages[A]=!0)}}}).catch(u=>{this._spriteRequest=null,o=u,this.fire(new c.j(o))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),s&&s(o)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){let a=this.sourceCaches[e.source];if(!a)return;let s=e.sourceLayer;if(!s)return;let o=a.getSource();(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(s)===-1)&&this.fire(new c.j(new Error(`Source layer "${s}" does not exist on source "${o.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){let s=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?c.aB(s):s);let o=[];for(let u of e)if(s[u]){let m=a?c.aB(s[u]):s[u];o.push(m)}return o}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let a=Object.keys(this._layers);for(let s of a){let o=this._layers[s];o.type!=="custom"&&(e[s]=o.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let a=this._changed;if(a){let o=Object.keys(this._updatedLayers),u=Object.keys(this._removedLayers);(o.length||u.length)&&this._updateWorkerLayers(o,u);for(let m in this._updatedSources){let y=this._updatedSources[m];if(y==="reload")this._reloadSource(m);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let m in this._updatedPaintProps)this._layers[m].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let s={};for(let o in this.sourceCaches){let u=this.sourceCaches[o];s[o]=u.used,u.used=!1}for(let o of this._order){let u=this._layers[o];u.recalculate(e,this._availableImages),!u.isHidden(e.zoom)&&u.source&&(this.sourceCaches[u.source].used=!0)}for(let o in s){let u=this.sourceCaches[o];!!s[o]!=!!u.used&&u.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:o}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,a&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var s;this._checkLoaded();let o=this.serialize();if(e=a.transformStyle?a.transformStyle(o,e):e,((s=a.validate)===null||s===void 0||s)&&Rr(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);let u=c.aC(o,e),m=this._getOperationsToPerform(u);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(m.operations.length===0)return!1;for(let y of m.operations)y();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let a=[],s=[];for(let o of e)switch(o.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,o.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,o.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,o.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,o.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,o.args));break;case"addSource":a.push(()=>this.addSource.apply(this,o.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,o.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,o.args));break;case"setLight":a.push(()=>this.setLight.apply(this,o.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,o.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,o.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,o.args));break;case"setSky":a.push(()=>this.setSky.apply(this,o.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,o.args));break;case"setTransition":a.push(()=>{});break;default:s.push(o.command)}return{operations:a,unimplemented:s}}addImage(e,a){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,s={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(c.u.source,`sources.${e}`,a,null,s))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let o=this.sourceCaches[e]=new We(e,a,this.dispatcher);o.style=this,o.setEventedParent(this,()=>({isSourceLoaded:o.loaded(),source:o.serialize(),sourceId:e})),o.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let s in this._layers)if(this._layers[s].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${s}" is using it.`)));let a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let s=this.sourceCaches[e].getSource();if(s.type!=="geojson")throw new Error(`geojsonSource.type is ${s.type}, which is !== 'geojson`);s.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,s={}){this._checkLoaded();let o=e.id;if(this.getLayer(o))return void this.fire(new c.j(new Error(`Layer "${o}" already exists on this map.`)));let u;if(e.type==="custom"){if(Rr(this,c.aD(e)))return;u=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(o,e.source),e=c.aB(e),e=c.e(e,{source:o})),this._validate(c.u.layer,`layers.${o}`,e,{arrayIndex:-1},s))return;u=c.aA(e),this._validateLayer(u),u.setEventedParent(this,{layer:{id:o}})}let m=a?this._order.indexOf(a):this._order.length;if(a&&m===-1)this.fire(new c.j(new Error(`Cannot add layer "${o}" before non-existing layer "${a}".`)));else{if(this._order.splice(m,0,o),this._layerOrderChanged=!0,this._layers[o]=u,this._removedLayers[o]&&u.source&&u.type!=="custom"){let y=this._removedLayers[o];delete this._removedLayers[o],y.type!==u.type?this._updatedSources[u.source]="clear":(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;let s=this._order.indexOf(e);this._order.splice(s,1);let o=a?this._order.indexOf(a):this._order.length;a&&o===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let a=this._layers[e];if(!a)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);let s=this._order.indexOf(e);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,s){this._checkLoaded();let o=this.getLayer(e);o?o.minzoom===a&&o.maxzoom===s||(a!=null&&(o.minzoom=a),s!=null&&(o.maxzoom=s),this._updateLayer(o)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,s={}){this._checkLoaded();let o=this.getLayer(e);if(o){if(!c.aE(o.filter,a))return a==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(c.u.filter,`layers.${o.id}.filter`,a,null,s)||(o.filter=c.aB(a),this._updateLayer(o)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,a,s,o={}){this._checkLoaded();let u=this.getLayer(e);u?c.aE(u.getLayoutProperty(a),s)||(u.setLayoutProperty(a,s,o),this._updateLayer(u)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){let s=this.getLayer(e);if(s)return s.getLayoutProperty(a);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,s,o={}){this._checkLoaded();let u=this.getLayer(e);u?c.aE(u.getPaintProperty(a),s)||(u.setPaintProperty(a,s,o)&&this._updateLayer(u),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();let s=e.source,o=e.sourceLayer,u=this.sourceCaches[s];if(u===void 0)return void this.fire(new c.j(new Error(`The source '${s}' does not exist in the map's style.`)));let m=u.getSource().type;m==="geojson"&&o?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||o?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),u.setFeatureState(o,e.id,a)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();let s=e.source,o=this.sourceCaches[s];if(o===void 0)return void this.fire(new c.j(new Error(`The source '${s}' does not exist in the map's style.`)));let u=o.getSource().type,m=u==="vector"?e.sourceLayer:void 0;u!=="vector"||m?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):o.removeFeatureState(m,e.id,a):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let a=e.source,s=e.sourceLayer,o=this.sourceCaches[a];if(o!==void 0)return o.getSource().type!=="vector"||s?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),o.getFeatureState(s,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=c.aF(this.sourceCaches,u=>u.serialize()),a=this._serializeByIds(this._order,!0),s=this.map.getTerrain()||void 0,o=this.stylesheet;return c.aG({version:o.version,name:o.name,metadata:o.metadata,light:o.light,sky:o.sky,center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,sprite:o.sprite,glyphs:o.glyphs,transition:o.transition,sources:e,layers:a,terrain:s},u=>u!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let a=m=>this._layers[m].type==="fill-extrusion",s={},o=[];for(let m=this._order.length-1;m>=0;m--){let y=this._order[m];if(a(y)){s[y]=m;for(let v of e){let A=v[y];if(A)for(let C of A)o.push(C)}}}o.sort((m,y)=>y.intersectionZ-m.intersectionZ);let u=[];for(let m=this._order.length-1;m>=0;m--){let y=this._order[m];if(a(y))for(let v=o.length-1;v>=0;v--){let A=o[v].feature;if(s[A.layer.id]<m)break;u.push(A),o.pop()}else for(let v of e){let A=v[y];if(A)for(let C of A)u.push(C.feature)}}return u}queryRenderedFeatures(e,a,s){a&&a.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",a.filter,null,a);let o={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(let y of a.layers){let v=this._layers[y];if(!v)return this.fire(new c.j(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];o[v.source]=!0}}let u=[];a.availableImages=this._availableImages;let m=this._serializedAllLayers();for(let y in this.sourceCaches)a.layers&&!o[y]||u.push(di(this.sourceCaches[y],this._layers,m,e,a,s));return this.placement&&u.push(function(y,v,A,C,D,L,F){let N={},j=L.queryRenderedSymbols(C),H=[];for(let W of Object.keys(j).map(Number))H.push(F[W]);H.sort(_i);for(let W of H){let K=W.featureIndex.lookupSymbolFeatures(j[W.bucketInstanceId],v,W.bucketIndex,W.sourceLayerIndex,D.filter,D.layers,D.availableImages,y);for(let q in K){let te=N[q]=N[q]||[],re=K[q];re.sort((le,me)=>{let _e=W.featureSortOrder;if(_e){let Te=_e.indexOf(le.featureIndex);return _e.indexOf(me.featureIndex)-Te}return me.featureIndex-le.featureIndex});for(let le of re)te.push(le)}}for(let W in N)N[W].forEach(K=>{let q=K.feature,te=A[y[W].source].getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=te});return N}(this._layers,m,this.sourceCaches,e,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(e,a){a&&a.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",a.filter,null,a);let s=this.sourceCaches[e];return s?function(o,u){let m=o.getRenderableIds().map(A=>o.getTileByID(A)),y=[],v={};for(let A=0;A<m.length;A++){let C=m[A],D=C.tileID.canonical.key;v[D]||(v[D]=!0,C.querySourceFeatures(y,u))}return y}(s,a):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();let s=this.light.getLight(),o=!1;for(let m in e)if(!c.aE(e[m],s[m])){o=!0;break}if(!o)return;let u={now:ne.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(u)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){let s=this.getSky(),o=!1;if(!e&&!s)return;if(e&&!s)o=!0;else if(!e&&s)o=!0;else for(let m in e)if(!c.aE(e[m],s[m])){o=!0;break}if(!o)return;let u={now:ne.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(u)}_validate(e,a,s,o,u={}){return(!u||u.validate!==!1)&&Rr(this,e.call(c.u,c.e({key:a,style:this.serialize(),value:s,styleSpec:c.v},o)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),or().off(ve,this._rtlPluginLoaded);for(let a in this._layers)this._layers[a].setEventedParent(null);for(let a in this.sourceCaches){let s=this.sourceCaches[a];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,s,o,u=!1){let m=!1,y=!1,v={};for(let A of this._order){let C=this._layers[A];if(C.type!=="symbol")continue;if(!v[C.source]){let L=this.sourceCaches[C.source];v[C.source]=L.getRenderableIds(!0).map(F=>L.getTileByID(F)).sort((F,N)=>N.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(N.tileID)?-1:1))}let D=this.crossTileSymbolIndex.addLayer(C,v[C.source],e.center.lng);m=m||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((u=u||this._layerOrderChanged||s===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ne.now(),e.zoom))&&(this.pauseablePlacement=new Pn(e,this.map.terrain,this._order,u,a,s,o,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,v),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ne.now()),y=!0),m&&this.pauseablePlacement.placement.setStale()),y||m)for(let A of this._order){let C=this._layers[A];C.type==="symbol"&&this.placement.updateLayerOpacities(C,v[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ne.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return c._(this,void 0,void 0,function*(){let s=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();let o=this.sourceCaches[a.source];return o&&o.setDependencies(a.tileID.key,a.type,a.icons),s})}getGlyphs(e,a){return c._(this,void 0,void 0,function*(){let s=yield this.glyphManager.getGlyphs(a.stacks),o=this.sourceCaches[a.source];return o&&o.setDependencies(a.tileID.key,a.type,[""]),s})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,s={},o){this._checkLoaded();let u=[{id:e,url:a}],m=[...je(this.stylesheet.sprite),...u];this._validate(c.u.sprite,"sprite",m,null,s)||(this.stylesheet.sprite=m,this._loadSprite(u,!0,o))}removeSprite(e){this._checkLoaded();let a=je(this.stylesheet.sprite);if(a.find(s=>s.id===e)){if(this._spritesImagesIds[e])for(let s of this._spritesImagesIds[e])this.imageManager.removeImage(s),this._changedImages[s]=!0;a.splice(a.findIndex(s=>s.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return je(this.stylesheet.sprite)}setSprite(e,a={},s){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,s):(this._unloadSprite(),s&&s(null)))}}var Ca=c.Y([{name:"a_pos",type:"Int16",components:2}]);let pa={prelude:Ct(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ct(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ct(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ct(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ct(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ct(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ct("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ct(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ct(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ct(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ct(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ct(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ct(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ct(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ct(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ct(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ct(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ct(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ct("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ct("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ct("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Ct("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ct(h,e){let a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=e.match(/attribute ([\w]+) ([\w]+)/g),o=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),u=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=u?u.concat(o):o,y={};return{fragmentSource:h=h.replace(a,(v,A,C,D,L)=>(y[L]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${C} ${D} ${L};
#else
uniform ${C} ${D} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${C} ${D} ${L} = u_${L};
#endif
`)),vertexSource:e=e.replace(a,(v,A,C,D,L)=>{let F=D==="float"?"vec2":"vec4",N=L.match(/color/)?"color":F;return y[L]?A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${C} ${F} a_${L};
varying ${C} ${D} ${L};
#else
uniform ${C} ${D} u_${L};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${C} ${D} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${N}(a_${L}, u_${L}_t);
#else
    ${C} ${D} ${L} = u_${L};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${C} ${F} a_${L};
#else
uniform ${C} ${D} u_${L};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${C} ${D} ${L} = a_${L};
#else
    ${C} ${D} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${C} ${D} ${L} = unpack_mix_${N}(a_${L}, u_${L}_t);
#else
    ${C} ${D} ${L} = u_${L};
#endif
`}),staticAttributes:s,staticUniforms:m}}class yo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,s,o,u,m,y,v,A){this.context=e;let C=this.boundPaintVertexBuffers.length!==o.length;for(let D=0;!C&&D<o.length;D++)this.boundPaintVertexBuffers[D]!==o[D]&&(C=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==s||C||this.boundIndexBuffer!==u||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==v||this.boundDynamicVertexBuffer3!==A?this.freshBind(a,s,o,u,m,y,v,A):(e.bindVertexArray.set(this.vao),y&&y.bind(),u&&u.dynamicDraw&&u.bind(),v&&v.bind(),A&&A.bind())}freshBind(e,a,s,o,u,m,y,v){let A=e.numAttributes,C=this.context,D=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=o,this.boundVertexOffset=u,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=v,a.enableAttributes(D,e);for(let L of s)L.enableAttributes(D,e);m&&m.enableAttributes(D,e),y&&y.enableAttributes(D,e),v&&v.enableAttributes(D,e),a.bind(),a.setVertexAttribPointers(D,e,u);for(let L of s)L.bind(),L.setVertexAttribPointers(D,e,u);m&&(m.bind(),m.setVertexAttribPointers(D,e,u)),o&&o.bind(),y&&(y.bind(),y.setVertexAttribPointers(D,e,u)),v&&(v.bind(),v.setVertexAttribPointers(D,e,u)),C.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let _o=(h,e,a,s,o)=>({u_matrix:h,u_texture:0,u_ele_delta:e,u_fog_matrix:a,u_fog_color:s?s.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:s?s.calculateFogBlendOpacity(o):0,u_horizon_color:s?s.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1});function Xa(h){let e=[];for(let a=0;a<h.length;a++){if(h[a]===null)continue;let s=h[a].split(" ");e.push(s.pop())}return e}class vo{constructor(e,a,s,o,u,m){let y=e.gl;this.program=y.createProgram();let v=Xa(a.staticAttributes),A=s?s.getBinderAttributes():[],C=v.concat(A),D=pa.prelude.staticUniforms?Xa(pa.prelude.staticUniforms):[],L=a.staticUniforms?Xa(a.staticUniforms):[],F=s?s.getBinderUniforms():[],N=D.concat(L).concat(F),j=[];for(let le of N)j.indexOf(le)<0&&j.push(le);let H=s?s.defines():[];u&&H.push("#define OVERDRAW_INSPECTOR;"),m&&H.push("#define TERRAIN3D;");let W=H.concat(pa.prelude.fragmentSource,a.fragmentSource).join(`
`),K=H.concat(pa.prelude.vertexSource,a.vertexSource).join(`
`),q=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(q,W),y.compileShader(q),!y.getShaderParameter(q,y.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${y.getShaderInfoLog(q)}`);y.attachShader(this.program,q);let te=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(te,K),y.compileShader(te),!y.getShaderParameter(te,y.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${y.getShaderInfoLog(te)}`);y.attachShader(this.program,te),this.attributes={};let re={};this.numAttributes=C.length;for(let le=0;le<this.numAttributes;le++)C[le]&&(y.bindAttribLocation(this.program,le,C[le]),this.attributes[C[le]]=le);if(y.linkProgram(this.program),!y.getProgramParameter(this.program,y.LINK_STATUS))throw new Error(`Program failed to link: ${y.getProgramInfoLog(this.program)}`);y.deleteShader(te),y.deleteShader(q);for(let le=0;le<j.length;le++){let me=j[le];if(me&&!re[me]){let _e=y.getUniformLocation(this.program,me);_e&&(re[me]=_e)}}this.fixedUniforms=o(e,re),this.terrainUniforms=((le,me)=>({u_depth:new c.aH(le,me.u_depth),u_terrain:new c.aH(le,me.u_terrain),u_terrain_dim:new c.aI(le,me.u_terrain_dim),u_terrain_matrix:new c.aJ(le,me.u_terrain_matrix),u_terrain_unpack:new c.aK(le,me.u_terrain_unpack),u_terrain_exaggeration:new c.aI(le,me.u_terrain_exaggeration)}))(e,re),this.binderUniforms=s?s.getUniforms(e,re):[]}draw(e,a,s,o,u,m,y,v,A,C,D,L,F,N,j,H,W,K){let q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(s),e.setStencilMode(o),e.setColorMode(u),e.setCullFace(m),v){e.activeTexture.set(q.TEXTURE2),q.bindTexture(q.TEXTURE_2D,v.depthTexture),e.activeTexture.set(q.TEXTURE3),q.bindTexture(q.TEXTURE_2D,v.texture);for(let re in this.terrainUniforms)this.terrainUniforms[re].set(v[re])}for(let re in this.fixedUniforms)this.fixedUniforms[re].set(y[re]);j&&j.setUniforms(e,this.binderUniforms,F,{zoom:N});let te=0;switch(a){case q.LINES:te=2;break;case q.TRIANGLES:te=3;break;case q.LINE_STRIP:te=1}for(let re of L.get()){let le=re.vaos||(re.vaos={});(le[A]||(le[A]=new yo)).bind(e,this,C,j?j.getPaintVertexBuffers():[],D,re.vertexOffset,H,W,K),q.drawElements(a,re.primitiveLength*te,q.UNSIGNED_SHORT,re.primitiveOffset*te*2)}}}function us(h,e,a){let s=1/mt(a,1,e.transform.tileZoom),o=Math.pow(2,a.tileID.overscaledZ),u=a.tileSize*Math.pow(2,e.transform.tileZoom)/o,m=u*(a.tileID.canonical.x+a.tileID.wrap*o),y=u*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[s,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[m>>16,y>>16],u_pixel_coord_lower:[65535&m,65535&y]}}let zn=(h,e,a,s)=>{let o=e.style.light,u=o.properties.get("position"),m=[u.x,u.y,u.z],y=function(){var A=new c.A(9);return c.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();o.properties.get("anchor")==="viewport"&&function(A,C){var D=Math.sin(C),L=Math.cos(C);A[0]=L,A[1]=D,A[2]=0,A[3]=-D,A[4]=L,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(y,-e.transform.angle),function(A,C,D){var L=C[0],F=C[1],N=C[2];A[0]=L*D[0]+F*D[3]+N*D[6],A[1]=L*D[1]+F*D[4]+N*D[7],A[2]=L*D[2]+F*D[5]+N*D[8]}(m,m,y);let v=o.properties.get("color");return{u_matrix:h,u_lightpos:m,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+a,u_opacity:s}},hs=(h,e,a,s,o,u,m)=>c.e(zn(h,e,a,s),us(u,e,m),{u_height_factor:-Math.pow(2,o.overscaledZ)/m.tileSize/8}),Ka=h=>({u_matrix:h}),Nl=(h,e,a,s)=>c.e(Ka(h),us(a,e,s)),hu=(h,e)=>({u_matrix:h,u_world:e}),ql=(h,e,a,s,o)=>c.e(Nl(h,e,a,s),{u_world:o}),pu=(h,e,a,s)=>{let o=h.transform,u,m;if(s.paint.get("circle-pitch-alignment")==="map"){let y=mt(a,1,o.zoom);u=!0,m=[y,y]}else u=!1,m=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(e.posMatrix,a,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_pitch_with_map:+u,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:m}},Da=(h,e,a)=>({u_matrix:h,u_inv_matrix:e,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}),Ln=(h,e,a=1)=>({u_matrix:h,u_color:e,u_overlay:0,u_overlay_scale:a}),Ji=h=>({u_matrix:h}),Yi=(h,e,a,s)=>({u_matrix:h,u_extrude_scale:mt(e,1,a),u_intensity:s}),ps=(h,e,a,s)=>{let o=c.H();c.aP(o,0,h.width,h.height,0,0,1);let u=h.context.gl;return{u_matrix:o,u_world:[u.drawingBufferWidth,u.drawingBufferHeight],u_image:a,u_color_ramp:s,u_opacity:e.paint.get("heatmap-opacity")}};function ds(h,e){let a=Math.pow(2,e.canonical.z),s=e.canonical.y;return[new c.Z(0,s/a).toLngLat().lat,new c.Z(0,(s+1)/a).toLngLat().lat]}let fs=(h,e,a,s)=>{let o=h.transform;return{u_matrix:jl(h,e,a,s),u_ratio:1/mt(e,1,o.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Vl=(h,e,a,s,o)=>c.e(fs(h,e,a,o),{u_image:0,u_image_height:s}),Ja=(h,e,a,s,o)=>{let u=h.transform,m=Ul(e,u);return{u_matrix:jl(h,e,a,o),u_texsize:e.imageAtlasTexture.size,u_ratio:1/mt(e,1,u.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[m,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},du=(h,e,a,s,o,u)=>{let m=h.lineAtlas,y=Ul(e,h.transform),v=a.layout.get("line-cap")==="round",A=m.getDash(s.from,v),C=m.getDash(s.to,v),D=A.width*o.fromScale,L=C.width*o.toScale;return c.e(fs(h,e,a,u),{u_patternscale_a:[y/D,-A.height/2],u_patternscale_b:[y/L,-C.height/2],u_sdfgamma:m.width/(256*Math.min(D,L)*h.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:C.y,u_mix:o.t})};function Ul(h,e){return 1/mt(h,1,e.tileZoom)}function jl(h,e,a,s){return h.translatePosMatrix(s?s.posMatrix:e.tileID.posMatrix,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}let fu=(h,e,a,s,o)=>{return{u_matrix:h,u_tl_parent:e,u_scale_parent:a,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(m=o.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(u=o.paint.get("raster-contrast"),u>0?1/(1-u):1+u),u_spin_weights:mu(o.paint.get("raster-hue-rotate"))};var u,m};function mu(h){h*=Math.PI/180;let e=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}let $l=(h,e,a,s,o,u,m,y,v,A,C,D,L,F)=>{let N=m.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:N.cameraToCenterDistance,u_pitch:N.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:N.width/N.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:v,u_coord_matrix:A,u_is_text:+D,u_pitch_with_map:+s,u_is_along_line:o,u_is_variable_anchor:u,u_texsize:L,u_texture:0,u_translation:C,u_pitched_scale:F}},Bn=(h,e,a,s,o,u,m,y,v,A,C,D,L,F,N)=>{let j=m.transform;return c.e($l(h,e,a,s,o,u,m,y,v,A,C,D,L,N),{u_gamma_scale:s?Math.cos(j._pitch)*j.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+F})},xo=(h,e,a,s,o,u,m,y,v,A,C,D,L,F)=>c.e(Bn(h,e,a,s,o,u,m,y,v,A,C,!0,D,!0,F),{u_texsize_icon:L,u_texture_icon:1}),ms=(h,e,a)=>({u_matrix:h,u_opacity:e,u_color:a}),bo=(h,e,a,s,o,u)=>c.e(function(m,y,v,A){let C=v.imageManager.getPattern(m.from.toString()),D=v.imageManager.getPattern(m.to.toString()),{width:L,height:F}=v.imageManager.getPixelSize(),N=Math.pow(2,A.tileID.overscaledZ),j=A.tileSize*Math.pow(2,v.transform.tileZoom)/N,H=j*(A.tileID.canonical.x+A.tileID.wrap*N),W=j*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[L,F],u_mix:y.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/mt(A,1,v.transform.tileZoom),u_pixel_coord_upper:[H>>16,W>>16],u_pixel_coord_lower:[65535&H,65535&W]}}(s,u,a,o),{u_matrix:h,u_opacity:e}),wo={fillExtrusion:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_lightpos:new c.aN(h,e.u_lightpos),u_lightintensity:new c.aI(h,e.u_lightintensity),u_lightcolor:new c.aN(h,e.u_lightcolor),u_vertical_gradient:new c.aI(h,e.u_vertical_gradient),u_opacity:new c.aI(h,e.u_opacity)}),fillExtrusionPattern:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_lightpos:new c.aN(h,e.u_lightpos),u_lightintensity:new c.aI(h,e.u_lightintensity),u_lightcolor:new c.aN(h,e.u_lightcolor),u_vertical_gradient:new c.aI(h,e.u_vertical_gradient),u_height_factor:new c.aI(h,e.u_height_factor),u_image:new c.aH(h,e.u_image),u_texsize:new c.aO(h,e.u_texsize),u_pixel_coord_upper:new c.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(h,e.u_pixel_coord_lower),u_scale:new c.aN(h,e.u_scale),u_fade:new c.aI(h,e.u_fade),u_opacity:new c.aI(h,e.u_opacity)}),fill:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix)}),fillPattern:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_image:new c.aH(h,e.u_image),u_texsize:new c.aO(h,e.u_texsize),u_pixel_coord_upper:new c.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(h,e.u_pixel_coord_lower),u_scale:new c.aN(h,e.u_scale),u_fade:new c.aI(h,e.u_fade)}),fillOutline:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_world:new c.aO(h,e.u_world)}),fillOutlinePattern:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_world:new c.aO(h,e.u_world),u_image:new c.aH(h,e.u_image),u_texsize:new c.aO(h,e.u_texsize),u_pixel_coord_upper:new c.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(h,e.u_pixel_coord_lower),u_scale:new c.aN(h,e.u_scale),u_fade:new c.aI(h,e.u_fade)}),circle:(h,e)=>({u_camera_to_center_distance:new c.aI(h,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(h,e.u_scale_with_map),u_pitch_with_map:new c.aH(h,e.u_pitch_with_map),u_extrude_scale:new c.aO(h,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_matrix:new c.aJ(h,e.u_matrix)}),collisionBox:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_pixel_extrude_scale:new c.aO(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_inv_matrix:new c.aJ(h,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(h,e.u_camera_to_center_distance),u_viewport_size:new c.aO(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new c.aL(h,e.u_color),u_matrix:new c.aJ(h,e.u_matrix),u_overlay:new c.aH(h,e.u_overlay),u_overlay_scale:new c.aI(h,e.u_overlay_scale)}),clippingMask:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix)}),heatmap:(h,e)=>({u_extrude_scale:new c.aI(h,e.u_extrude_scale),u_intensity:new c.aI(h,e.u_intensity),u_matrix:new c.aJ(h,e.u_matrix)}),heatmapTexture:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_world:new c.aO(h,e.u_world),u_image:new c.aH(h,e.u_image),u_color_ramp:new c.aH(h,e.u_color_ramp),u_opacity:new c.aI(h,e.u_opacity)}),hillshade:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_image:new c.aH(h,e.u_image),u_latrange:new c.aO(h,e.u_latrange),u_light:new c.aO(h,e.u_light),u_shadow:new c.aL(h,e.u_shadow),u_highlight:new c.aL(h,e.u_highlight),u_accent:new c.aL(h,e.u_accent)}),hillshadePrepare:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_image:new c.aH(h,e.u_image),u_dimension:new c.aO(h,e.u_dimension),u_zoom:new c.aI(h,e.u_zoom),u_unpack:new c.aK(h,e.u_unpack)}),line:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_ratio:new c.aI(h,e.u_ratio),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_ratio:new c.aI(h,e.u_ratio),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(h,e.u_units_to_pixels),u_image:new c.aH(h,e.u_image),u_image_height:new c.aI(h,e.u_image_height)}),linePattern:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_texsize:new c.aO(h,e.u_texsize),u_ratio:new c.aI(h,e.u_ratio),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_image:new c.aH(h,e.u_image),u_units_to_pixels:new c.aO(h,e.u_units_to_pixels),u_scale:new c.aN(h,e.u_scale),u_fade:new c.aI(h,e.u_fade)}),lineSDF:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_ratio:new c.aI(h,e.u_ratio),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(h,e.u_units_to_pixels),u_patternscale_a:new c.aO(h,e.u_patternscale_a),u_patternscale_b:new c.aO(h,e.u_patternscale_b),u_sdfgamma:new c.aI(h,e.u_sdfgamma),u_image:new c.aH(h,e.u_image),u_tex_y_a:new c.aI(h,e.u_tex_y_a),u_tex_y_b:new c.aI(h,e.u_tex_y_b),u_mix:new c.aI(h,e.u_mix)}),raster:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_tl_parent:new c.aO(h,e.u_tl_parent),u_scale_parent:new c.aI(h,e.u_scale_parent),u_buffer_scale:new c.aI(h,e.u_buffer_scale),u_fade_t:new c.aI(h,e.u_fade_t),u_opacity:new c.aI(h,e.u_opacity),u_image0:new c.aH(h,e.u_image0),u_image1:new c.aH(h,e.u_image1),u_brightness_low:new c.aI(h,e.u_brightness_low),u_brightness_high:new c.aI(h,e.u_brightness_high),u_saturation_factor:new c.aI(h,e.u_saturation_factor),u_contrast_factor:new c.aI(h,e.u_contrast_factor),u_spin_weights:new c.aN(h,e.u_spin_weights)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new c.aH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(h,e.u_is_size_feature_constant),u_size_t:new c.aI(h,e.u_size_t),u_size:new c.aI(h,e.u_size),u_camera_to_center_distance:new c.aI(h,e.u_camera_to_center_distance),u_pitch:new c.aI(h,e.u_pitch),u_rotate_symbol:new c.aH(h,e.u_rotate_symbol),u_aspect_ratio:new c.aI(h,e.u_aspect_ratio),u_fade_change:new c.aI(h,e.u_fade_change),u_matrix:new c.aJ(h,e.u_matrix),u_label_plane_matrix:new c.aJ(h,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(h,e.u_coord_matrix),u_is_text:new c.aH(h,e.u_is_text),u_pitch_with_map:new c.aH(h,e.u_pitch_with_map),u_is_along_line:new c.aH(h,e.u_is_along_line),u_is_variable_anchor:new c.aH(h,e.u_is_variable_anchor),u_texsize:new c.aO(h,e.u_texsize),u_texture:new c.aH(h,e.u_texture),u_translation:new c.aO(h,e.u_translation),u_pitched_scale:new c.aI(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new c.aH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(h,e.u_is_size_feature_constant),u_size_t:new c.aI(h,e.u_size_t),u_size:new c.aI(h,e.u_size),u_camera_to_center_distance:new c.aI(h,e.u_camera_to_center_distance),u_pitch:new c.aI(h,e.u_pitch),u_rotate_symbol:new c.aH(h,e.u_rotate_symbol),u_aspect_ratio:new c.aI(h,e.u_aspect_ratio),u_fade_change:new c.aI(h,e.u_fade_change),u_matrix:new c.aJ(h,e.u_matrix),u_label_plane_matrix:new c.aJ(h,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(h,e.u_coord_matrix),u_is_text:new c.aH(h,e.u_is_text),u_pitch_with_map:new c.aH(h,e.u_pitch_with_map),u_is_along_line:new c.aH(h,e.u_is_along_line),u_is_variable_anchor:new c.aH(h,e.u_is_variable_anchor),u_texsize:new c.aO(h,e.u_texsize),u_texture:new c.aH(h,e.u_texture),u_gamma_scale:new c.aI(h,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_is_halo:new c.aH(h,e.u_is_halo),u_translation:new c.aO(h,e.u_translation),u_pitched_scale:new c.aI(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new c.aH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(h,e.u_is_size_feature_constant),u_size_t:new c.aI(h,e.u_size_t),u_size:new c.aI(h,e.u_size),u_camera_to_center_distance:new c.aI(h,e.u_camera_to_center_distance),u_pitch:new c.aI(h,e.u_pitch),u_rotate_symbol:new c.aH(h,e.u_rotate_symbol),u_aspect_ratio:new c.aI(h,e.u_aspect_ratio),u_fade_change:new c.aI(h,e.u_fade_change),u_matrix:new c.aJ(h,e.u_matrix),u_label_plane_matrix:new c.aJ(h,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(h,e.u_coord_matrix),u_is_text:new c.aH(h,e.u_is_text),u_pitch_with_map:new c.aH(h,e.u_pitch_with_map),u_is_along_line:new c.aH(h,e.u_is_along_line),u_is_variable_anchor:new c.aH(h,e.u_is_variable_anchor),u_texsize:new c.aO(h,e.u_texsize),u_texsize_icon:new c.aO(h,e.u_texsize_icon),u_texture:new c.aH(h,e.u_texture),u_texture_icon:new c.aH(h,e.u_texture_icon),u_gamma_scale:new c.aI(h,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(h,e.u_device_pixel_ratio),u_is_halo:new c.aH(h,e.u_is_halo),u_translation:new c.aO(h,e.u_translation),u_pitched_scale:new c.aI(h,e.u_pitched_scale)}),background:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_opacity:new c.aI(h,e.u_opacity),u_color:new c.aL(h,e.u_color)}),backgroundPattern:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_opacity:new c.aI(h,e.u_opacity),u_image:new c.aH(h,e.u_image),u_pattern_tl_a:new c.aO(h,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(h,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(h,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(h,e.u_pattern_br_b),u_texsize:new c.aO(h,e.u_texsize),u_mix:new c.aI(h,e.u_mix),u_pattern_size_a:new c.aO(h,e.u_pattern_size_a),u_pattern_size_b:new c.aO(h,e.u_pattern_size_b),u_scale_a:new c.aI(h,e.u_scale_a),u_scale_b:new c.aI(h,e.u_scale_b),u_pixel_coord_upper:new c.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_texture:new c.aH(h,e.u_texture),u_ele_delta:new c.aI(h,e.u_ele_delta),u_fog_matrix:new c.aJ(h,e.u_fog_matrix),u_fog_color:new c.aL(h,e.u_fog_color),u_fog_ground_blend:new c.aI(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(h,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(h,e.u_horizon_color),u_horizon_fog_blend:new c.aI(h,e.u_horizon_fog_blend)}),terrainDepth:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_ele_delta:new c.aI(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_matrix:new c.aJ(h,e.u_matrix),u_texture:new c.aH(h,e.u_texture),u_terrain_coords_id:new c.aI(h,e.u_terrain_coords_id),u_ele_delta:new c.aI(h,e.u_ele_delta)}),sky:(h,e)=>({u_sky_color:new c.aL(h,e.u_sky_color),u_horizon_color:new c.aL(h,e.u_horizon_color),u_horizon:new c.aI(h,e.u_horizon),u_sky_horizon_blend:new c.aI(h,e.u_sky_horizon_blend)})};class Hr{constructor(e,a,s){this.context=e;let o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let gu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class So{constructor(e,a,s,o){this.length=a.length,this.attributes=s,this.itemSize=a.bytesPerElement,this.dynamicDraw=o,this.context=e;let u=e.gl;this.buffer=u.createBuffer(),e.bindVertexBuffer.set(this.buffer),u.bufferData(u.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let s=0;s<this.attributes.length;s++){let o=a.attributes[this.attributes[s].name];o!==void 0&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,a,s){for(let o=0;o<this.attributes.length;o++){let u=this.attributes[o],m=a.attributes[u.name];m!==void 0&&e.vertexAttribPointer(m,u.components,e[gu[u.type]],!1,this.itemSize,u.offset+this.itemSize*(s||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Ia=new WeakMap;function da(h){var e;if(Ia.has(h))return Ia.get(h);{let a=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ia.set(h,a),a}}class It{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gs extends It{getDefault(){return c.aM.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class yu extends It{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ya extends It{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class _u extends It{getDefault(){return[!0,!0,!0,!0]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Gl extends It{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vu extends It{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Zl extends It{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ao extends It{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Hl extends It{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class Wl extends It{getDefault(){return[0,1]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Xl extends It{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Kl extends It{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ka extends It{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Jl extends It{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class xu extends It{getDefault(){return c.aM.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Yl extends It{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Rn extends It{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class bu extends It{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ys extends It{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class wu extends It{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Su extends It{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ql extends It{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ec extends It{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class tc extends It{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Eo extends It{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ic extends It{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _s extends It{getDefault(){return null}set(e){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ea extends It{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;let s=this.gl;da(s)?s.bindVertexArray(e):(a=s.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class To extends It{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Co extends It{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Do extends It{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class vs extends It{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class Io extends vs{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ma extends vs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ko extends vs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Au{constructor(e,a,s,o,u){this.context=e,this.width=a,this.height=s;let m=e.gl,y=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new Io(e,y),o)this.depthAttachment=u?new ko(e,y):new Ma(e,y);else if(u)throw new Error("Stencil cannot be set without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){let s=this.depthAttachment.get();s&&e.deleteRenderbuffer(s)}e.deleteFramebuffer(this.framebuffer)}}class ai{constructor(e,a,s){this.blendFunction=e,this.blendColor=a,this.mask=s}}ai.Replace=[1,0],ai.disabled=new ai(ai.Replace,c.aM.transparent,[!1,!1,!1,!1]),ai.unblended=new ai(ai.Replace,c.aM.transparent,[!0,!0,!0,!0]),ai.alphaBlended=new ai([1,771],c.aM.transparent,[!0,!0,!0,!0]);class Eu{constructor(e){var a,s;if(this.gl=e,this.clearColor=new gs(this),this.clearDepth=new yu(this),this.clearStencil=new Ya(this),this.colorMask=new _u(this),this.depthMask=new Gl(this),this.stencilMask=new vu(this),this.stencilFunc=new Zl(this),this.stencilOp=new Ao(this),this.stencilTest=new Hl(this),this.depthRange=new Wl(this),this.depthTest=new Xl(this),this.depthFunc=new Kl(this),this.blend=new ka(this),this.blendFunc=new Jl(this),this.blendColor=new xu(this),this.blendEquation=new Yl(this),this.cullFace=new Rn(this),this.cullFaceSide=new bu(this),this.frontFace=new ys(this),this.program=new wu(this),this.activeTexture=new Su(this),this.viewport=new Ql(this),this.bindFramebuffer=new ec(this),this.bindRenderbuffer=new tc(this),this.bindTexture=new Eo(this),this.bindVertexBuffer=new ic(this),this.bindElementBuffer=new _s(this),this.bindVertexArray=new ea(this),this.pixelStoreUnpack=new To(this),this.pixelStoreUnpackPremultiplyAlpha=new Co(this),this.pixelStoreUnpackFlipY=new Do(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),da(e)){this.HALF_FLOAT=e.HALF_FLOAT;let o=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:o?.RGBA16F_EXT,this.RGB16F=(s=e.RGB16F)!==null&&s!==void 0?s:o?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let o=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=o?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Hr(this,e,a)}createVertexBuffer(e,a,s){return new So(this,e,a,s)}createRenderbuffer(e,a,s){let o=this.gl,u=o.createRenderbuffer();return this.bindRenderbuffer.set(u),o.renderbufferStorage(o.RENDERBUFFER,e,a,s),this.bindRenderbuffer.set(null),u}createFramebuffer(e,a,s,o){return new Au(this,e,a,s,o)}clear({color:e,depth:a,stencil:s}){let o=this.gl,u=0;e&&(u|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(u|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),s!==void 0&&(u|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),o.clear(u)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return da(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return da(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ut{constructor(e,a,s){this.func=e,this.mask=a,this.range=s}}ut.ReadOnly=!1,ut.ReadWrite=!0,ut.disabled=new ut(519,ut.ReadOnly,[0,1]);let xs=7680;class $t{constructor(e,a,s,o,u,m){this.test=e,this.ref=a,this.mask=s,this.fail=o,this.depthFail=u,this.pass=m}}$t.disabled=new $t({func:519,mask:0},0,0,xs,xs,xs);class Rt{constructor(e,a,s){this.enable=e,this.mode=a,this.frontFace=s}}let Pa;function Fn(h,e,a,s,o){let u=h.context,m=u.gl,y=h.useProgram("collisionBox"),v=[],A=0,C=0;for(let W=0;W<s.length;W++){let K=s[W],q=e.getTile(K).getBucket(a);if(!q)continue;let te=o?q.textCollisionBox:q.iconCollisionBox,re=q.collisionCircleArray;if(re.length>0){let le=c.H();c.aQ(le,q.placementInvProjMatrix,h.transform.glCoordMatrix),c.aQ(le,le,q.placementViewportMatrix),v.push({circleArray:re,circleOffset:C,transform:K.posMatrix,invTransform:le,coord:K}),A+=re.length/4,C=A}te&&y.draw(u,m.LINES,ut.disabled,$t.disabled,h.colorModeForRenderPass(),Rt.disabled,{u_matrix:K.posMatrix,u_pixel_extrude_scale:[1/(D=h.transform).width,1/D.height]},h.style.map.terrain&&h.style.map.terrain.getTerrainData(K),a.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,null,h.transform.zoom,null,null,te.collisionVertexBuffer)}var D;if(!o||!v.length)return;let L=h.useProgram("collisionCircle"),F=new c.aR;F.resize(4*A),F._trim();let N=0;for(let W of v)for(let K=0;K<W.circleArray.length/4;K++){let q=4*K,te=W.circleArray[q+0],re=W.circleArray[q+1],le=W.circleArray[q+2],me=W.circleArray[q+3];F.emplace(N++,te,re,le,me,0),F.emplace(N++,te,re,le,me,1),F.emplace(N++,te,re,le,me,2),F.emplace(N++,te,re,le,me,3)}(!Pa||Pa.length<2*A)&&(Pa=function(W){let K=2*W,q=new c.aT;q.resize(K),q._trim();for(let te=0;te<K;te++){let re=6*te;q.uint16[re+0]=4*te+0,q.uint16[re+1]=4*te+1,q.uint16[re+2]=4*te+2,q.uint16[re+3]=4*te+2,q.uint16[re+4]=4*te+3,q.uint16[re+5]=4*te+0}return q}(A));let j=u.createIndexBuffer(Pa,!0),H=u.createVertexBuffer(F,c.aS.members,!0);for(let W of v){let K=Da(W.transform,W.invTransform,h.transform);L.draw(u,m.TRIANGLES,ut.disabled,$t.disabled,h.colorModeForRenderPass(),Rt.disabled,K,h.style.map.terrain&&h.style.map.terrain.getTerrainData(W.coord),a.id,H,j,c.a0.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,h.transform.zoom,null,null,null)}H.destroy(),j.destroy()}Rt.disabled=new Rt(!1,1029,2305),Rt.backCCW=new Rt(!0,1029,2305);let On=c.an(new Float32Array(16));function Mo(h,e,a,s,o,u){let{horizontalAlign:m,verticalAlign:y}=c.au(h);return new c.P((-(m-.5)*e/o+s[0])*u,(-(y-.5)*a/o+s[1])*u)}function za(h,e,a,s,o,u){let m=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let y=s.mult(u);a||(y=y.rotate(-o));let v=m.add(y);return G(v.x,v.y,e.labelPlaneMatrix,e.getElevation).point}if(a){let y=pe(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),v=Math.atan(y.y/y.x)+(y.x<0?Math.PI:0);return h.add(s.rotate(v))}return h.add(s)}function Qa(h,e,a,s,o,u,m,y,v,A,C,D,L,F){let N=h.text.placedSymbolArray,j=h.text.dynamicLayoutVertexArray,H=h.icon.dynamicLayoutVertexArray,W={};j.clear();for(let K=0;K<N.length;K++){let q=N.get(K),te=q.hidden||!q.crossTileID||h.allowVerticalPlacement&&!q.placedOrientation?null:s[q.crossTileID];if(te){let re=new c.P(q.anchorX,q.anchorY),le={getElevation:F,width:o.width,height:o.height,labelPlaneMatrix:u,lineVertexArray:null,pitchWithMap:a,projection:C,projectionCache:null,tileAnchorPoint:re,translation:D,unwrappedTileID:L},me=a?G(re.x,re.y,m,F):pe(re.x,re.y,le),_e=M(o.cameraToCenterDistance,me.signedDistanceFromCamera),Te=c.ai(h.textSizeData,v,q)*_e/c.ap;a&&(Te*=h.tilePixelRatio/y);let{width:ke,height:Se,anchor:we,textOffset:Be,textBoxScale:Qe}=te,Ae=Mo(we,ke,Se,Be,Qe,Te),De=C.getPitchedTextCorrection(o,re.add(new c.P(D[0],D[1])),L),Je=za(me.point,le,e,Ae,o.angle,De),Xt=h.allowVerticalPlacement&&q.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let at=0;at<q.numGlyphs;at++)c.aj(j,Je,Xt);A&&q.associatedIconIndex>=0&&(W[q.associatedIconIndex]={shiftedAnchor:Je,angle:Xt})}else $e(q.numGlyphs,j)}if(A){H.clear();let K=h.icon.placedSymbolArray;for(let q=0;q<K.length;q++){let te=K.get(q);if(te.hidden)$e(te.numGlyphs,H);else{let re=W[q];if(re)for(let le=0;le<te.numGlyphs;le++)c.aj(H,re.shiftedAnchor,re.angle);else $e(te.numGlyphs,H)}}h.icon.dynamicLayoutVertexBuffer.updateData(H)}h.text.dynamicLayoutVertexBuffer.updateData(j)}function br(h,e,a){return a.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Po(h,e,a,s,o,u,m,y,v,A,C,D){let L=h.context,F=L.gl,N=h.transform,j=Ta(),H=y==="map",W=v==="map",K=y!=="viewport"&&a.layout.get("symbol-placement")!=="point",q=H&&!W&&!K,te=!W&&K,re=!a.layout.get("symbol-sort-key").isConstant(),le=!1,me=h.depthModeForSublayer(0,ut.ReadOnly),_e=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],ke=j.getCircleRadiusCorrection(N);for(let Se of s){let we=e.getTile(Se),Be=we.getBucket(a);if(!Be)continue;let Qe=o?Be.text:Be.icon;if(!Qe||!Qe.segments.get().length||!Qe.hasVisibleVertices)continue;let Ae=Qe.programConfigurations.get(a.id),De=o||Be.sdfIcons,Je=o?Be.textSizeData:Be.iconSizeData,Xt=W||N.pitch!==0,at=h.useProgram(br(De,o,Be),Ae),gt=c.ag(Je,N.zoom),Kt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Se),zi,Nr,Jt,Qi,ji=[0,0],Li=null;if(o)Nr=we.glyphAtlasTexture,Jt=F.LINEAR,zi=we.glyphAtlasTexture.size,Be.iconsInText&&(ji=we.imageAtlasTexture.size,Li=we.imageAtlasTexture,Qi=Xt||h.options.rotating||h.options.zooming||Je.kind==="composite"||Je.kind==="camera"?F.LINEAR:F.NEAREST);else{let vt=a.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;Nr=we.imageAtlasTexture,Jt=De||h.options.rotating||h.options.zooming||vt||Xt?F.LINEAR:F.NEAREST,zi=we.imageAtlasTexture.size}let $i=mt(we,1,h.transform.zoom),Kr=te?Se.posMatrix:On,gn=ha(Kr,W,H,h.transform,$i),Ns=Zr(Kr,W,H,h.transform,$i),yn=Zr(Se.posMatrix,W,H,h.transform,$i),Ar=j.translatePosition(h.transform,we,u,m),qs=_e&&Be.hasTextData(),rl=a.layout.get("icon-text-fit")!=="none"&&qs&&Be.hasIconData();if(K){let vt=h.style.map.terrain?(_n,vn)=>h.style.map.terrain.getElevation(Se,_n,vn):null,Oa=a.layout.get("text-rotation-alignment")==="map";O(Be,Se.posMatrix,h,o,gn,yn,W,A,Oa,j,Se.toUnwrapped(),N.width,N.height,Ar,vt)}let Er=Se.posMatrix,Tr=o&&_e||rl,fa=K||Tr?On:gn,qr=Ns,ki=De&&a.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Bi;Bi=De?Be.iconsInText?xo(Je.kind,gt,q,W,K,Tr,h,Er,fa,qr,Ar,zi,ji,ke):Bn(Je.kind,gt,q,W,K,Tr,h,Er,fa,qr,Ar,o,zi,!0,ke):$l(Je.kind,gt,q,W,K,Tr,h,Er,fa,qr,Ar,o,zi,ke);let dr={program:at,buffers:Qe,uniformValues:Bi,atlasTexture:Nr,atlasTextureIcon:Li,atlasInterpolation:Jt,atlasInterpolationIcon:Qi,isSDF:De,hasHalo:ki};if(re&&Be.canOverlap){le=!0;let vt=Qe.segments.get();for(let Oa of vt)Te.push({segments:new c.a0([Oa]),sortKey:Oa.sortKey,state:dr,terrainData:Kt})}else Te.push({segments:Qe.segments,sortKey:0,state:dr,terrainData:Kt})}le&&Te.sort((Se,we)=>Se.sortKey-we.sortKey);for(let Se of Te){let we=Se.state;if(L.activeTexture.set(F.TEXTURE0),we.atlasTexture.bind(we.atlasInterpolation,F.CLAMP_TO_EDGE),we.atlasTextureIcon&&(L.activeTexture.set(F.TEXTURE1),we.atlasTextureIcon&&we.atlasTextureIcon.bind(we.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),we.isSDF){let Be=we.uniformValues;we.hasHalo&&(Be.u_is_halo=1,zo(we.buffers,Se.segments,a,h,we.program,me,C,D,Be,Se.terrainData)),Be.u_is_halo=0}zo(we.buffers,Se.segments,a,h,we.program,me,C,D,we.uniformValues,Se.terrainData)}}function zo(h,e,a,s,o,u,m,y,v,A){let C=s.context;o.draw(C,C.gl.TRIANGLES,u,m,y,Rt.disabled,v,A,a.id,h.layoutVertexBuffer,h.indexBuffer,e,a.paint,s.transform.zoom,h.programConfigurations.get(a.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Lo(h,e,a,s){let o=h.context,u=o.gl,m=$t.disabled,y=new ai([u.ONE,u.ONE],c.aM.transparent,[!0,!0,!0,!0]),v=e.getBucket(a);if(!v)return;let A=s.key,C=a.heatmapFbos.get(A);C||(C=Nn(o,e.tileSize,e.tileSize),a.heatmapFbos.set(A,C)),o.bindFramebuffer.set(C.framebuffer),o.viewport.set([0,0,e.tileSize,e.tileSize]),o.clear({color:c.aM.transparent});let D=v.programConfigurations.get(a.id),L=h.useProgram("heatmap",D),F=h.style.map.terrain.getTerrainData(s);L.draw(o,u.TRIANGLES,ut.disabled,m,y,Rt.disabled,Yi(s.posMatrix,e,h.transform.zoom,a.paint.get("heatmap-intensity")),F,a.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,a.paint,h.transform.zoom,D)}function La(h,e,a){let s=h.context,o=s.gl;s.setColorMode(h.colorModeForRenderPass());let u=qn(s,e),m=a.key,y=e.heatmapFbos.get(m);y&&(s.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,y.colorAttachment.get()),s.activeTexture.set(o.TEXTURE1),u.bind(o.LINEAR,o.CLAMP_TO_EDGE),h.useProgram("heatmapTexture").draw(s,o.TRIANGLES,ut.disabled,$t.disabled,h.colorModeForRenderPass(),Rt.disabled,ps(h,e,0,1),null,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,h.transform.zoom),y.destroy(),e.heatmapFbos.delete(m))}function Nn(h,e,a){var s,o;let u=h.gl,m=u.createTexture();u.bindTexture(u.TEXTURE_2D,m),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR);let y=(s=h.HALF_FLOAT)!==null&&s!==void 0?s:u.UNSIGNED_BYTE,v=(o=h.RGBA16F)!==null&&o!==void 0?o:u.RGBA;u.texImage2D(u.TEXTURE_2D,0,v,e,a,0,u.RGBA,y,null);let A=h.createFramebuffer(e,a,!1,!1);return A.colorAttachment.set(m),A}function qn(h,e){return e.colorRampTexture||(e.colorRampTexture=new Ve(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function en(h,e,a,s,o){if(!a||!s||!s.imageAtlas)return;let u=s.imageAtlas.patternPositions,m=u[a.to.toString()],y=u[a.from.toString()];if(!m&&y&&(m=y),!y&&m&&(y=m),!m||!y){let v=o.getPaintProperty(e);m=u[v],y=u[v]}m&&y&&h.setConstantPatternPositions(m,y)}function Vn(h,e,a,s,o,u,m){let y=h.context.gl,v="fill-pattern",A=a.paint.get(v),C=A&&A.constantOr(1),D=a.getCrossfadeParameters(),L,F,N,j,H;m?(F=C&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=y.LINES):(F=C?"fillPattern":"fill",L=y.TRIANGLES);let W=A.constantOr(null);for(let K of s){let q=e.getTile(K);if(C&&!q.patternsLoaded())continue;let te=q.getBucket(a);if(!te)continue;let re=te.programConfigurations.get(a.id),le=h.useProgram(F,re),me=h.style.map.terrain&&h.style.map.terrain.getTerrainData(K);C&&(h.context.activeTexture.set(y.TEXTURE0),q.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),re.updatePaintBuffers(D)),en(re,v,W,q,a);let _e=me?K:null,Te=h.translatePosMatrix(_e?_e.posMatrix:K.posMatrix,q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(m){j=te.indexBuffer2,H=te.segments2;let ke=[y.drawingBufferWidth,y.drawingBufferHeight];N=F==="fillOutlinePattern"&&C?ql(Te,h,D,q,ke):hu(Te,ke)}else j=te.indexBuffer,H=te.segments,N=C?Nl(Te,h,D,q):Ka(Te);le.draw(h.context,L,o,h.stencilModeForClipping(K),u,Rt.disabled,N,me,a.id,te.layoutVertexBuffer,j,H,a.paint,h.transform.zoom,re)}}function bs(h,e,a,s,o,u,m){let y=h.context,v=y.gl,A="fill-extrusion-pattern",C=a.paint.get(A),D=C.constantOr(1),L=a.getCrossfadeParameters(),F=a.paint.get("fill-extrusion-opacity"),N=C.constantOr(null);for(let j of s){let H=e.getTile(j),W=H.getBucket(a);if(!W)continue;let K=h.style.map.terrain&&h.style.map.terrain.getTerrainData(j),q=W.programConfigurations.get(a.id),te=h.useProgram(D?"fillExtrusionPattern":"fillExtrusion",q);D&&(h.context.activeTexture.set(v.TEXTURE0),H.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),q.updatePaintBuffers(L)),en(q,A,N,H,a);let re=h.translatePosMatrix(j.posMatrix,H,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),le=a.paint.get("fill-extrusion-vertical-gradient"),me=D?hs(re,h,le,F,j,L,H):zn(re,h,le,F);te.draw(y,y.gl.TRIANGLES,o,u,m,Rt.backCCW,me,K,a.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,a.paint,h.transform.zoom,q,h.style.map.terrain&&W.centroidVertexBuffer)}}function tn(h,e,a,s,o,u,m){let y=h.context,v=y.gl,A=a.fbo;if(!A)return;let C=h.useProgram("hillshade"),D=h.style.map.terrain&&h.style.map.terrain.getTerrainData(e);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,A.colorAttachment.get()),C.draw(y,v.TRIANGLES,o,u,m,Rt.disabled,((L,F,N,j)=>{let H=N.paint.get("hillshade-shadow-color"),W=N.paint.get("hillshade-highlight-color"),K=N.paint.get("hillshade-accent-color"),q=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(q-=L.transform.angle);let te=!L.options.moving;return{u_matrix:j?j.posMatrix:L.transform.calculatePosMatrix(F.tileID.toUnwrapped(),te),u_image:0,u_latrange:ds(0,F.tileID),u_light:[N.paint.get("hillshade-exaggeration"),q],u_shadow:H,u_highlight:W,u_accent:K}})(h,a,s,D?e:null),D,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function rn(h,e,a,s,o,u){let m=h.context,y=m.gl,v=e.dem;if(v&&v.data){let A=v.dim,C=v.stride,D=v.getPixels();if(m.activeTexture.set(y.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||h.getTileTexture(C),e.demTexture){let F=e.demTexture;F.update(D,{premultiply:!1}),F.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else e.demTexture=new Ve(m,D,y.RGBA,{premultiply:!1}),e.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);m.activeTexture.set(y.TEXTURE0);let L=e.fbo;if(!L){let F=new Ve(m,{width:A,height:A,data:null},y.RGBA);F.bind(y.LINEAR,y.CLAMP_TO_EDGE),L=e.fbo=m.createFramebuffer(A,A,!0,!1),L.colorAttachment.set(F.texture)}m.bindFramebuffer.set(L.framebuffer),m.viewport.set([0,0,A,A]),h.useProgram("hillshadePrepare").draw(m,y.TRIANGLES,s,o,u,Rt.disabled,((F,N)=>{let j=N.stride,H=c.H();return c.aP(H,0,c.X,-c.X,0,0,1),c.J(H,H,[0,-c.X,0]),{u_matrix:H,u_image:1,u_dimension:[j,j],u_zoom:F.overscaledZ,u_unpack:N.getUnpackVector()}})(e.tileID,v),null,a.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function rc(h,e,a,s,o,u){let m=s.paint.get("raster-fade-duration");if(!u&&m>0){let y=ne.now(),v=(y-h.timeAdded)/m,A=e?(y-e.timeAdded)/m:-1,C=a.getSource(),D=o.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),L=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),F=L&&h.refreshedUponExpiration?1:c.ac(L?v:1-A,0,1);return h.refreshedUponExpiration&&v>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}let Bo=new c.aM(1,0,0,1),At=new c.aM(0,1,0,1),ws=new c.aM(0,0,1,1),Tu=new c.aM(1,0,1,1),ac=new c.aM(0,1,1,1);function an(h,e,a,s){Ss(h,0,e+a/2,h.transform.width,a,s)}function nc(h,e,a,s){Ss(h,e-a/2,0,a,h.transform.height,s)}function Ss(h,e,a,s,o,u){let m=h.context,y=m.gl;y.enable(y.SCISSOR_TEST),y.scissor(e*h.pixelRatio,a*h.pixelRatio,s*h.pixelRatio,o*h.pixelRatio),m.clear({color:u}),y.disable(y.SCISSOR_TEST)}function sc(h,e,a){let s=h.context,o=s.gl,u=a.posMatrix,m=h.useProgram("debug"),y=ut.disabled,v=$t.disabled,A=h.colorModeForRenderPass(),C="$debug",D=h.style.map.terrain&&h.style.map.terrain.getTerrainData(a);s.activeTexture.set(o.TEXTURE0);let L=e.getTileByID(a.key).latestRawTileData,F=Math.floor((L&&L.byteLength||0)/1024),N=e.getTile(a).tileSize,j=512/Math.min(N,512)*(a.overscaledZ/h.transform.zoom)*.5,H=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(H+=` => ${a.overscaledZ}`),function(W,K){W.initDebugOverlayCanvas();let q=W.debugOverlayCanvas,te=W.context.gl,re=W.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,q.width,q.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(K,5,5),re.strokeText(K,5,5),W.debugOverlayTexture.update(q),W.debugOverlayTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE)}(h,`${H} ${F}kB`),m.draw(s,o.TRIANGLES,y,v,ai.alphaBlended,Rt.disabled,Ln(u,c.aM.transparent,j),null,C,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),m.draw(s,o.LINE_STRIP,y,v,A,Rt.disabled,Ln(u,c.aM.red),D,C,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function oc(h,e,a){let s=h.context,o=s.gl,u=h.colorModeForRenderPass(),m=new ut(o.LEQUAL,ut.ReadWrite,h.depthRangeFor3D),y=h.useProgram("terrain"),v=e.getTerrainMesh();s.bindFramebuffer.set(null),s.viewport.set([0,0,h.width,h.height]);for(let A of a){let C=h.renderToTexture.getTexture(A),D=e.getTerrainData(A.tileID);s.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,C.texture);let L=h.transform.calculatePosMatrix(A.tileID.toUnwrapped()),F=e.getMeshFrameDelta(h.transform.zoom),N=h.transform.calculateFogMatrix(A.tileID.toUnwrapped()),j=_o(L,F,N,h.style.sky,h.transform.pitch);y.draw(s,o.TRIANGLES,m,$t.disabled,u,Rt.backCCW,j,D,"terrain",v.vertexBuffer,v.indexBuffer,v.segments)}}class As{constructor(e,a,s){this.vertexBuffer=e,this.indexBuffer=a,this.segments=s}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Es{constructor(e,a){this.context=new Eu(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=We.maxUnderzooming+We.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new go}resize(e,a,s){if(this.width=Math.floor(e*s),this.height=Math.floor(a*s),this.pixelRatio=s,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let o of this.style._order)this.style._layers[o].resize()}setup(){let e=this.context,a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(a,Ca.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);let s=new c.aX;s.emplaceBack(0,0),s.emplaceBack(c.X,0),s.emplaceBack(0,c.X),s.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(s,Ca.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);let o=new c.$;o.emplaceBack(0,0,0,0),o.emplaceBack(c.X,0,c.X,0),o.emplaceBack(0,c.X,0,c.X),o.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(o,Pr.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);let u=new c.aX;u.emplaceBack(0,0),u.emplaceBack(1,0),u.emplaceBack(0,1),u.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(u,Ca.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);let m=new c.aZ;m.emplaceBack(0),m.emplaceBack(1),m.emplaceBack(3),m.emplaceBack(2),m.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(m);let y=new c.aY;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(y);let v=this.context.gl;this.stencilClearMode=new $t({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO)}clearStencil(){let e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let s=c.H();c.aP(s,0,this.width,this.height,0,0,1),c.K(s,s,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,a.TRIANGLES,ut.disabled,this.stencilClearMode,ai.disabled,Rt.disabled,Ji(s),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source;let s=this.context,o=s.gl;this.nextStencilID+a.length>256&&this.clearStencil(),s.setColorMode(ai.disabled),s.setDepthMode(ut.disabled);let u=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let m of a){let y=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,v=this.style.map.terrain&&this.style.map.terrain.getTerrainData(m);u.draw(s,o.TRIANGLES,ut.disabled,new $t({func:o.ALWAYS,mask:0},y,255,o.KEEP,o.KEEP,o.REPLACE),ai.disabled,Rt.disabled,Ji(m.posMatrix),v,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,a=this.context.gl;return new $t({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){let a=this.context.gl;return new $t({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(e){let a=this.context.gl,s=e.sort((m,y)=>y.overscaledZ-m.overscaledZ),o=s[s.length-1].overscaledZ,u=s[0].overscaledZ-o+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();let m={};for(let y=0;y<u;y++)m[y+o]=new $t({func:a.GEQUAL,mask:255},y+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=u,[m,s]}return[{[o]:$t.disabled},s]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new ai([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ai.unblended:ai.alphaBlended}depthModeForSublayer(e,a,s){if(!this.opaquePassEnabledForLayer())return ut.disabled;let o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ut(s||this.context.gl.LEQUAL,a,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ne.now()),this.imageManager.beginFrame();let s=this.style._order,o=this.style.sourceCaches,u={},m={},y={};for(let v in o){let A=o[v];A.used&&A.prepare(this.context),u[v]=A.getVisibleCoordinates(),m[v]=u[v].slice().reverse(),y[v]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<s.length;v++)if(this.style._layers[s[v]].is3D()){this.opaquePassCutoff=v;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let v of s){let A=this.style._layers[v];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;let C=m[A.source];(A.type==="custom"||C.length)&&this.renderLayer(this,o[A.source],A,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(v,A){let C=v.context,D=C.gl,L=((W,K,q)=>({u_sky_color:W.properties.get("sky-color"),u_horizon_color:W.properties.get("horizon-color"),u_horizon:(K.height/2+K.getHorizon())*q,u_sky_horizon_blend:W.properties.get("sky-horizon-blend")*K.height/2*q}))(A,v.style.map.transform,v.pixelRatio),F=new ut(D.LEQUAL,ut.ReadWrite,[0,1]),N=$t.disabled,j=v.colorModeForRenderPass(),H=v.useProgram("sky");if(!A.mesh){let W=new c.aX;W.emplaceBack(-1,-1),W.emplaceBack(1,-1),W.emplaceBack(1,1),W.emplaceBack(-1,1);let K=new c.aY;K.emplaceBack(0,1,2),K.emplaceBack(0,2,3),A.mesh=new As(C.createVertexBuffer(W,Ca.members),C.createIndexBuffer(K),c.a0.simpleSegment(0,0,W.length,K.length))}H.draw(C,D.TRIANGLES,F,N,j,Rt.disabled,L,void 0,"sky",A.mesh.vertexBuffer,A.mesh.indexBuffer,A.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){let v=this.style._layers[s[this.currentLayer]],A=o[v.source],C=u[v.source];this._renderTileClippingMasks(v,C),this.renderLayer(this,A,v,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){let v=this.style._layers[s[this.currentLayer]],A=o[v.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(v))continue;let C=(v.type==="symbol"?y:m)[v.source];this._renderTileClippingMasks(v,u[v.source]),this.renderLayer(this,A,v,C)}if(this.options.showTileBoundaries){let v=function(A,C){let D=null,L=Object.values(A._layers).flatMap(H=>H.source&&!H.isHidden(C)?[A.sourceCaches[H.source]]:[]),F=L.filter(H=>H.getSource().type==="vector"),N=L.filter(H=>H.getSource().type!=="vector"),j=H=>{(!D||D.getSource().maxzoom<H.getSource().maxzoom)&&(D=H)};return F.forEach(H=>j(H)),D||N.forEach(H=>j(H)),D}(this.style,this.transform.zoom);v&&function(A,C,D){for(let L=0;L<D.length;L++)sc(A,C,D[L])}(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){let A=v.transform.padding;an(v,v.transform.height-(A.top||0),3,Bo),an(v,A.bottom||0,3,At),nc(v,A.left||0,3,ws),nc(v,v.transform.width-(A.right||0),3,Tu);let C=v.transform.centerPoint;(function(D,L,F,N){Ss(D,L-1,F-10,2,20,N),Ss(D,L-10,F-1,20,2,N)})(v,C.x,v.transform.height-C.y,ac)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let a=this.terrainFacilitator.matrix,s=this.transform.modelViewProjectionMatrix,o=this.terrainFacilitator.dirty;o||(o=e?!c.a_(a,s):!c.a$(a,s)),o||(o=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),o&&(c.b0(a,s),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(u,m){let y=u.context,v=y.gl,A=ai.unblended,C=new ut(v.LEQUAL,ut.ReadWrite,[0,1]),D=m.getTerrainMesh(),L=m.sourceCache.getRenderableTiles(),F=u.useProgram("terrainDepth");y.bindFramebuffer.set(m.getFramebuffer("depth").framebuffer),y.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),y.clear({color:c.aM.transparent,depth:1});for(let N of L){let j=m.getTerrainData(N.tileID),H={u_matrix:u.transform.calculatePosMatrix(N.tileID.toUnwrapped()),u_ele_delta:m.getMeshFrameDelta(u.transform.zoom)};F.draw(y,v.TRIANGLES,C,$t.disabled,A,Rt.backCCW,H,j,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}y.bindFramebuffer.set(null),y.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain),function(u,m){let y=u.context,v=y.gl,A=ai.unblended,C=new ut(v.LEQUAL,ut.ReadWrite,[0,1]),D=m.getTerrainMesh(),L=m.getCoordsTexture(),F=m.sourceCache.getRenderableTiles(),N=u.useProgram("terrainCoords");y.bindFramebuffer.set(m.getFramebuffer("coords").framebuffer),y.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),y.clear({color:c.aM.transparent,depth:1}),m.coordsIndex=[];for(let j of F){let H=m.getTerrainData(j.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,L.texture);let W={u_matrix:u.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_terrain_coords_id:(255-m.coordsIndex.length)/255,u_texture:0,u_ele_delta:m.getMeshFrameDelta(u.transform.zoom)};N.draw(y,v.TRIANGLES,C,$t.disabled,A,Rt.backCCW,W,H,"terrain",D.vertexBuffer,D.indexBuffer,D.segments),m.coordsIndex.push(j.tileID.key)}y.bindFramebuffer.set(null),y.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain))}renderLayer(e,a,s,o){if(!s.isHidden(this.transform.zoom)&&(s.type==="background"||s.type==="custom"||(o||[]).length))switch(this.id=s.id,s.type){case"symbol":(function(u,m,y,v,A){if(u.renderPass!=="translucent")return;let C=$t.disabled,D=u.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(L,F,N,j,H,W,K,q,te){let re=F.transform,le=Ta(),me=H==="map",_e=W==="map";for(let Te of L){let ke=j.getTile(Te),Se=ke.getBucket(N);if(!Se||!Se.text||!Se.text.segments.get().length)continue;let we=c.ag(Se.textSizeData,re.zoom),Be=mt(ke,1,F.transform.zoom),Qe=ha(Te.posMatrix,_e,me,F.transform,Be),Ae=N.layout.get("icon-text-fit")!=="none"&&Se.hasIconData();if(we){let De=Math.pow(2,re.zoom-ke.tileID.overscaledZ),Je=F.style.map.terrain?(at,gt)=>F.style.map.terrain.getElevation(Te,at,gt):null,Xt=le.translatePosition(re,ke,K,q);Qa(Se,me,_e,te,re,Qe,Te.posMatrix,De,we,Ae,le,Xt,Te.toUnwrapped(),Je)}}}(v,u,y,m,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),A),y.paint.get("icon-opacity").constantOr(1)!==0&&Po(u,m,y,v,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),C,D),y.paint.get("text-opacity").constantOr(1)!==0&&Po(u,m,y,v,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),C,D),m.map.showCollisionBoxes&&(Fn(u,m,y,v,!0),Fn(u,m,y,v,!1))})(e,a,s,o,this.style.placement.variableOffsets);break;case"circle":(function(u,m,y,v){if(u.renderPass!=="translucent")return;let A=y.paint.get("circle-opacity"),C=y.paint.get("circle-stroke-width"),D=y.paint.get("circle-stroke-opacity"),L=!y.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(C.constantOr(1)===0||D.constantOr(1)===0))return;let F=u.context,N=F.gl,j=u.depthModeForSublayer(0,ut.ReadOnly),H=$t.disabled,W=u.colorModeForRenderPass(),K=[];for(let q=0;q<v.length;q++){let te=v[q],re=m.getTile(te),le=re.getBucket(y);if(!le)continue;let me=le.programConfigurations.get(y.id),_e=u.useProgram("circle",me),Te=le.layoutVertexBuffer,ke=le.indexBuffer,Se=u.style.map.terrain&&u.style.map.terrain.getTerrainData(te),we={programConfiguration:me,program:_e,layoutVertexBuffer:Te,indexBuffer:ke,uniformValues:pu(u,te,re,y),terrainData:Se};if(L){let Be=le.segments.get();for(let Qe of Be)K.push({segments:new c.a0([Qe]),sortKey:Qe.sortKey,state:we})}else K.push({segments:le.segments,sortKey:0,state:we})}L&&K.sort((q,te)=>q.sortKey-te.sortKey);for(let q of K){let{programConfiguration:te,program:re,layoutVertexBuffer:le,indexBuffer:me,uniformValues:_e,terrainData:Te}=q.state;re.draw(F,N.TRIANGLES,j,H,W,Rt.disabled,_e,Te,y.id,le,me,q.segments,y.paint,u.transform.zoom,te)}})(e,a,s,o);break;case"heatmap":(function(u,m,y,v){if(y.paint.get("heatmap-opacity")===0)return;let A=u.context;if(u.style.map.terrain){for(let C of v){let D=m.getTile(C);m.hasRenderableParent(C)||(u.renderPass==="offscreen"?Lo(u,D,y,C):u.renderPass==="translucent"&&La(u,y,C))}A.viewport.set([0,0,u.width,u.height])}else u.renderPass==="offscreen"?function(C,D,L,F){let N=C.context,j=N.gl,H=$t.disabled,W=new ai([j.ONE,j.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(K,q,te){let re=K.gl;K.activeTexture.set(re.TEXTURE1),K.viewport.set([0,0,q.width/4,q.height/4]);let le=te.heatmapFbos.get(c.aU);le?(re.bindTexture(re.TEXTURE_2D,le.colorAttachment.get()),K.bindFramebuffer.set(le.framebuffer)):(le=Nn(K,q.width/4,q.height/4),te.heatmapFbos.set(c.aU,le))})(N,C,L),N.clear({color:c.aM.transparent});for(let K=0;K<F.length;K++){let q=F[K];if(D.hasRenderableParent(q))continue;let te=D.getTile(q),re=te.getBucket(L);if(!re)continue;let le=re.programConfigurations.get(L.id),me=C.useProgram("heatmap",le),{zoom:_e}=C.transform;me.draw(N,j.TRIANGLES,ut.disabled,H,W,Rt.disabled,Yi(q.posMatrix,te,_e,L.paint.get("heatmap-intensity")),null,L.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,L.paint,C.transform.zoom,le)}N.viewport.set([0,0,C.width,C.height])}(u,m,y,v):u.renderPass==="translucent"&&function(C,D){let L=C.context,F=L.gl;L.setColorMode(C.colorModeForRenderPass());let N=D.heatmapFbos.get(c.aU);N&&(L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,N.colorAttachment.get()),L.activeTexture.set(F.TEXTURE1),qn(L,D).bind(F.LINEAR,F.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(L,F.TRIANGLES,ut.disabled,$t.disabled,C.colorModeForRenderPass(),Rt.disabled,ps(C,D,0,1),null,D.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,D.paint,C.transform.zoom))}(u,y)})(e,a,s,o);break;case"line":(function(u,m,y,v){if(u.renderPass!=="translucent")return;let A=y.paint.get("line-opacity"),C=y.paint.get("line-width");if(A.constantOr(1)===0||C.constantOr(1)===0)return;let D=u.depthModeForSublayer(0,ut.ReadOnly),L=u.colorModeForRenderPass(),F=y.paint.get("line-dasharray"),N=y.paint.get("line-pattern"),j=N.constantOr(1),H=y.paint.get("line-gradient"),W=y.getCrossfadeParameters(),K=j?"linePattern":F?"lineSDF":H?"lineGradient":"line",q=u.context,te=q.gl,re=!0;for(let le of v){let me=m.getTile(le);if(j&&!me.patternsLoaded())continue;let _e=me.getBucket(y);if(!_e)continue;let Te=_e.programConfigurations.get(y.id),ke=u.context.program.get(),Se=u.useProgram(K,Te),we=re||Se.program!==ke,Be=u.style.map.terrain&&u.style.map.terrain.getTerrainData(le),Qe=N.constantOr(null);if(Qe&&me.imageAtlas){let Je=me.imageAtlas,Xt=Je.patternPositions[Qe.to.toString()],at=Je.patternPositions[Qe.from.toString()];Xt&&at&&Te.setConstantPatternPositions(Xt,at)}let Ae=Be?le:null,De=j?Ja(u,me,y,W,Ae):F?du(u,me,y,F,W,Ae):H?Vl(u,me,y,_e.lineClipsArray.length,Ae):fs(u,me,y,Ae);if(j)q.activeTexture.set(te.TEXTURE0),me.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Te.updatePaintBuffers(W);else if(F&&(we||u.lineAtlas.dirty))q.activeTexture.set(te.TEXTURE0),u.lineAtlas.bind(q);else if(H){let Je=_e.gradients[y.id],Xt=Je.texture;if(y.gradientVersion!==Je.version){let at=256;if(y.stepInterpolant){let gt=m.getSource().maxzoom,Kt=le.canonical.z===gt?Math.ceil(1<<u.transform.maxZoom-le.canonical.z):1;at=c.ac(c.aV(_e.maxLineLength/c.X*1024*Kt),256,q.maxTextureSize)}Je.gradient=c.aW({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:Je.gradient||void 0,clips:_e.lineClipsArray}),Je.texture?Je.texture.update(Je.gradient):Je.texture=new Ve(q,Je.gradient,te.RGBA),Je.version=y.gradientVersion,Xt=Je.texture}q.activeTexture.set(te.TEXTURE0),Xt.bind(y.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}Se.draw(q,te.TRIANGLES,D,u.stencilModeForClipping(le),L,Rt.disabled,De,Be,y.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,y.paint,u.transform.zoom,Te,_e.layoutVertexBuffer2),re=!1}})(e,a,s,o);break;case"fill":(function(u,m,y,v){let A=y.paint.get("fill-color"),C=y.paint.get("fill-opacity");if(C.constantOr(1)===0)return;let D=u.colorModeForRenderPass(),L=y.paint.get("fill-pattern"),F=u.opaquePassEnabledForLayer()&&!L.constantOr(1)&&A.constantOr(c.aM.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===F){let N=u.depthModeForSublayer(1,u.renderPass==="opaque"?ut.ReadWrite:ut.ReadOnly);Vn(u,m,y,v,N,D,!1)}if(u.renderPass==="translucent"&&y.paint.get("fill-antialias")){let N=u.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,ut.ReadOnly);Vn(u,m,y,v,N,D,!0)}})(e,a,s,o);break;case"fill-extrusion":(function(u,m,y,v){let A=y.paint.get("fill-extrusion-opacity");if(A!==0&&u.renderPass==="translucent"){let C=new ut(u.context.gl.LEQUAL,ut.ReadWrite,u.depthRangeFor3D);if(A!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))bs(u,m,y,v,C,$t.disabled,ai.disabled),bs(u,m,y,v,C,u.stencilModeFor3D(),u.colorModeForRenderPass());else{let D=u.colorModeForRenderPass();bs(u,m,y,v,C,$t.disabled,D)}}})(e,a,s,o);break;case"hillshade":(function(u,m,y,v){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;let A=u.context,C=u.depthModeForSublayer(0,ut.ReadOnly),D=u.colorModeForRenderPass(),[L,F]=u.renderPass==="translucent"?u.stencilConfigForOverlap(v):[{},v];for(let N of F){let j=m.getTile(N);j.needsHillshadePrepare!==void 0&&j.needsHillshadePrepare&&u.renderPass==="offscreen"?rn(u,j,y,C,$t.disabled,D):u.renderPass==="translucent"&&tn(u,N,j,y,C,L[N.overscaledZ],D)}A.viewport.set([0,0,u.width,u.height])})(e,a,s,o);break;case"raster":(function(u,m,y,v){if(u.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!v.length)return;let A=u.context,C=A.gl,D=m.getSource(),L=u.useProgram("raster"),F=u.colorModeForRenderPass(),[N,j]=D instanceof Wi?[{},v]:u.stencilConfigForOverlap(v),H=j[j.length-1].overscaledZ,W=!u.options.moving;for(let K of j){let q=u.depthModeForSublayer(K.overscaledZ-H,y.paint.get("raster-opacity")===1?ut.ReadWrite:ut.ReadOnly,C.LESS),te=m.getTile(K);te.registerFadeDuration(y.paint.get("raster-fade-duration"));let re=m.findLoadedParent(K,0),le=m.findLoadedSibling(K),me=rc(te,re||le||null,m,y,u.transform,u.style.map.terrain),_e,Te,ke=y.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;A.activeTexture.set(C.TEXTURE0),te.texture.bind(ke,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(C.TEXTURE1),re?(re.texture.bind(ke,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,re.tileID.overscaledZ-te.tileID.overscaledZ),Te=[te.tileID.canonical.x*_e%1,te.tileID.canonical.y*_e%1]):te.texture.bind(ke,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),te.texture.useMipmap&&A.extTextureFilterAnisotropic&&u.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let Se=u.style.map.terrain&&u.style.map.terrain.getTerrainData(K),we=Se?K:null,Be=we?we.posMatrix:u.transform.calculatePosMatrix(K.toUnwrapped(),W),Qe=fu(Be,Te||[0,0],_e||1,me,y);D instanceof Wi?L.draw(A,C.TRIANGLES,q,$t.disabled,F,Rt.disabled,Qe,Se,y.id,D.boundsBuffer,u.quadTriangleIndexBuffer,D.boundsSegments):L.draw(A,C.TRIANGLES,q,N[K.overscaledZ],F,Rt.disabled,Qe,Se,y.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}})(e,a,s,o);break;case"background":(function(u,m,y,v){let A=y.paint.get("background-color"),C=y.paint.get("background-opacity");if(C===0)return;let D=u.context,L=D.gl,F=u.transform,N=F.tileSize,j=y.paint.get("background-pattern");if(u.isPatternMissing(j))return;let H=!j&&A.a===1&&C===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==H)return;let W=$t.disabled,K=u.depthModeForSublayer(0,H==="opaque"?ut.ReadWrite:ut.ReadOnly),q=u.colorModeForRenderPass(),te=u.useProgram(j?"backgroundPattern":"background"),re=v||F.coveringTiles({tileSize:N,terrain:u.style.map.terrain});j&&(D.activeTexture.set(L.TEXTURE0),u.imageManager.bind(u.context));let le=y.getCrossfadeParameters();for(let me of re){let _e=v?me.posMatrix:u.transform.calculatePosMatrix(me.toUnwrapped()),Te=j?bo(_e,C,u,j,{tileID:me,tileSize:N},le):ms(_e,C,A),ke=u.style.map.terrain&&u.style.map.terrain.getTerrainData(me);te.draw(D,L.TRIANGLES,K,W,q,Rt.disabled,Te,ke,y.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}})(e,0,s,o);break;case"custom":(function(u,m,y){let v=u.context,A=y.implementation;if(u.renderPass==="offscreen"){let C=A.prerender;C&&(u.setCustomLayerDefaults(),v.setColorMode(u.colorModeForRenderPass()),C.call(A,v.gl,u.transform.customLayerMatrix()),v.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),v.setColorMode(u.colorModeForRenderPass()),v.setStencilMode($t.disabled);let C=A.renderingMode==="3d"?new ut(u.context.gl.LEQUAL,ut.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,ut.ReadOnly);v.setDepthMode(C),A.render(v.gl,u.transform.customLayerMatrix(),{farZ:u.transform.farZ,nearZ:u.transform.nearZ,fov:u.transform._fov,modelViewProjectionMatrix:u.transform.modelViewProjectionMatrix,projectionMatrix:u.transform.projectionMatrix}),v.setDirty(),u.setBaseState(),v.bindFramebuffer.set(null)}})(e,0,s)}}translatePosMatrix(e,a,s,o,u){if(!s[0]&&!s[1])return e;let m=u?o==="map"?this.transform.angle:0:o==="viewport"?-this.transform.angle:0;if(m){let A=Math.sin(m),C=Math.cos(m);s=[s[0]*C-s[1]*A,s[0]*A+s[1]*C]}let y=[u?s[0]:mt(a,s[0],this.transform.zoom),u?s[1]:mt(a,s[1],this.transform.zoom),0],v=new Float32Array(16);return c.J(v,e,y),v}saveTileTexture(e){let a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let a=this.imageManager.getPattern(e.from.toString()),s=this.imageManager.getPattern(e.to.toString());return!a||!s}useProgram(e,a){this.cache=this.cache||{};let s=e+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[s]||(this.cache[s]=new vo(this.context,pa[e],a,wo[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ve(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}class nn{constructor(e,a){this.points=e,this.planes=a}static fromInvProjectionMatrix(e,a,s){let o=Math.pow(2,s),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{let v=1/(y=c.af([],y,e))[3]/a*o;return c.b1(y,y,[v,v,1/y[3],v])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{let v=function(L,F){var N=F[0],j=F[1],H=F[2],W=N*N+j*j+H*H;return W>0&&(W=1/Math.sqrt(W)),L[0]=F[0]*W,L[1]=F[1]*W,L[2]=F[2]*W,L}([],function(L,F,N){var j=F[0],H=F[1],W=F[2],K=N[0],q=N[1],te=N[2];return L[0]=H*te-W*q,L[1]=W*K-j*te,L[2]=j*q-H*K,L}([],bi([],u[y[0]],u[y[1]]),bi([],u[y[2]],u[y[1]]))),A=-((C=v)[0]*(D=u[y[1]])[0]+C[1]*D[1]+C[2]*D[2]);var C,D;return v.concat(A)});return new nn(u,m)}}class sn{constructor(e,a){this.min=e,this.max=a,this.center=function(s,o,u){return s[0]=.5*o[0],s[1]=.5*o[1],s[2]=.5*o[2],s}([],function(s,o,u){return s[0]=o[0]+u[0],s[1]=o[1]+u[1],s[2]=o[2]+u[2],s}([],this.min,this.max))}quadrant(e){let a=[e%2==0,e<2],s=dt(this.min),o=dt(this.max);for(let u=0;u<a.length;u++)s[u]=a[u]?this.min[u]:this.center[u],o[u]=a[u]?this.center[u]:this.max[u];return o[2]=this.max[2],new sn(s,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){let a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],s=!0;for(let o=0;o<e.planes.length;o++){let u=e.planes[o],m=0;for(let y=0;y<a.length;y++)c.b2(u,a[y])>=0&&m++;if(m===0)return 0;m!==a.length&&(s=!1)}if(s)return 2;for(let o=0;o<3;o++){let u=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){let v=e.points[y][o]-this.min[o];u=Math.min(u,v),m=Math.max(m,v)}if(m<0||u>this.max[o]-this.min[o])return 0}return 1}}class on{constructor(e=0,a=0,s=0,o=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(s)||s<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=s,this.right=o}interpolate(e,a,s){return a.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,a.top,s)),a.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,a.bottom,s)),a.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,a.left,s)),a.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,a.right,s)),this}getCenter(e,a){let s=c.ac((this.left+e-this.right)/2,0,e),o=c.ac((this.top+a-this.bottom)/2,0,a);return new c.P(s,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new on(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Ro=85.051129;class ln{constructor(e,a,s,o,u){this.tileSize=512,this._renderWorldCopies=u===void 0||!!u,this._minZoom=e||0,this._maxZoom=a||22,this._minPitch=s??0,this._maxPitch=o??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new on,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){let e=new ln(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let a=-c.b3(e,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var s=new c.A(4);return c.A!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s}(),function(s,o,u){var m=o[0],y=o[1],v=o[2],A=o[3],C=Math.sin(u),D=Math.cos(u);s[0]=m*D+v*C,s[1]=y*D+A*C,s[2]=m*-C+v*D,s[3]=y*-C+A*D}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let a=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let a=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,s){this._unmodified=!1,this._edgeInsets.interpolate(e,a,s),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let a=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(e){let a=[new c.b4(0,e)];if(this._renderWorldCopies){let s=this.pointCoordinate(new c.P(0,0)),o=this.pointCoordinate(new c.P(this.width,0)),u=this.pointCoordinate(new c.P(this.width,this.height)),m=this.pointCoordinate(new c.P(0,this.height)),y=Math.floor(Math.min(s.x,o.x,u.x,m.x)),v=Math.floor(Math.max(s.x,o.x,u.x,m.x)),A=1;for(let C=y-A;C<=v+A;C++)C!==0&&a.push(new c.b4(C,e))}return a}coveringTiles(e){var a,s;let o=this.coveringZoomLevel(e),u=o;if(e.minzoom!==void 0&&o<e.minzoom)return[];e.maxzoom!==void 0&&o>e.maxzoom&&(o=e.maxzoom);let m=this.pointCoordinate(this.getCameraPoint()),y=c.Z.fromLngLat(this.center),v=Math.pow(2,o),A=[v*m.x,v*m.y,0],C=[v*y.x,v*y.y,0],D=nn.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,o),L=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(L=o);let F=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,N=q=>({aabb:new sn([q*v,0,0],[(q+1)*v,v,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),j=[],H=[],W=o,K=e.reparseOverscaled?u:o;if(this._renderWorldCopies)for(let q=1;q<=3;q++)j.push(N(-q)),j.push(N(q));for(j.push(N(0));j.length>0;){let q=j.pop(),te=q.x,re=q.y,le=q.fullyVisible;if(!le){let Se=q.aabb.intersects(D);if(Se===0)continue;le=Se===2}let me=e.terrain?A:C,_e=q.aabb.distanceX(me),Te=q.aabb.distanceY(me),ke=Math.max(Math.abs(_e),Math.abs(Te));if(q.zoom===W||ke>F+(1<<W-q.zoom)-2&&q.zoom>=L){let Se=W-q.zoom,we=A[0]-.5-(te<<Se),Be=A[1]-.5-(re<<Se);H.push({tileID:new c.S(q.zoom===W?K:q.zoom,q.wrap,q.zoom,te,re),distanceSq:Ue([C[0]-.5-te,C[1]-.5-re]),tileDistanceToCamera:Math.sqrt(we*we+Be*Be)})}else for(let Se=0;Se<4;Se++){let we=(te<<1)+Se%2,Be=(re<<1)+(Se>>1),Qe=q.zoom+1,Ae=q.aabb.quadrant(Se);if(e.terrain){let De=new c.S(Qe,q.wrap,Qe,we,Be),Je=e.terrain.getMinMaxElevation(De),Xt=(a=Je.minElevation)!==null&&a!==void 0?a:this.elevation,at=(s=Je.maxElevation)!==null&&s!==void 0?s:this.elevation;Ae=new sn([Ae.min[0],Ae.min[1],Xt],[Ae.max[0],Ae.max[1],at])}j.push({aabb:Ae,zoom:Qe,x:we,y:Be,wrap:q.wrap,fullyVisible:le})}}return H.sort((q,te)=>q.distanceSq-te.distanceSq).map(q=>q.tileID)}resize(e,a){this.width=e,this.height=a,this.pixelsToGLUnits=[2/e,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let a=c.ac(e.lat,-85.051129,Ro);return new c.P(c.O(e.lng)*this.worldSize,c.Q(a)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){let a=this.elevation,s=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,o=this.pointLocation(this.centerPoint,e),u=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-u))return;let m=s+a-u,y=Math.cos(this._pitch)*this.cameraToCenterDistance/m/c.b5(1,o.lat),v=this.scaleZoom(y/this.tileSize);this._elevation=u,this._center=o,this.zoom=v}setLocationAtPoint(e,a){let s=this.pointCoordinate(a),o=this.pointCoordinate(this.centerPoint),u=this.locationCoordinate(e),m=new c.Z(u.x-(s.x-o.x),u.y-(s.y-o.y));this.center=this.coordinateLocation(m),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,a){return a?this.coordinatePoint(this.locationCoordinate(e),a.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,a){return this.coordinateLocation(this.pointCoordinate(e,a))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,a){if(a){let L=a.pointCoordinate(e);if(L!=null)return L}let s=[e.x,e.y,0,1],o=[e.x,e.y,1,1];c.af(s,s,this.pixelMatrixInverse),c.af(o,o,this.pixelMatrixInverse);let u=s[3],m=o[3],y=s[1]/u,v=o[1]/m,A=s[2]/u,C=o[2]/m,D=A===C?0:(0-A)/(C-A);return new c.Z(c.y.number(s[0]/u,o[0]/m,D)/this.worldSize,c.y.number(y,v,D)/this.worldSize)}coordinatePoint(e,a=0,s=this.pixelMatrix){let o=[e.x*this.worldSize,e.y*this.worldSize,a,1];return c.af(o,o,s),new c.P(o[0]/o[3],o[1]/o[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new ce().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ce([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ro])}calculateTileMatrix(e){let a=e.canonical,s=this.worldSize/this.zoomScale(a.z),o=a.x+Math.pow(2,a.z)*e.wrap,u=c.an(new Float64Array(16));return c.J(u,u,[o*s,a.y*s,0]),c.K(u,u,[s/c.X,s/c.X,1]),u}calculatePosMatrix(e,a=!1){let s=e.key,o=a?this._alignedPosMatrixCache:this._posMatrixCache;if(o[s])return o[s];let u=this.calculateTileMatrix(e);return c.L(u,a?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,u),o[s]=new Float32Array(u),o[s]}calculateFogMatrix(e){let a=e.key,s=this._fogMatrixCache;if(s[a])return s[a];let o=this.calculateTileMatrix(e);return c.L(o,this.fogMatrix,o),s[a]=new Float32Array(o),s[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,a){a=c.ac(+a,this.minZoom,this.maxZoom);let s={center:new c.N(e.lng,e.lat),zoom:a},o=this.lngRange;if(!this._renderWorldCopies&&o===null){let q=179.9999999999;o=[-q,q]}let u=this.tileSize*this.zoomScale(s.zoom),m=0,y=u,v=0,A=u,C=0,D=0,{x:L,y:F}=this.size;if(this.latRange){let q=this.latRange;m=c.Q(q[1])*u,y=c.Q(q[0])*u,y-m<F&&(C=F/(y-m))}o&&(v=c.b3(c.O(o[0])*u,0,u),A=c.b3(c.O(o[1])*u,0,u),A<v&&(A+=u),A-v<L&&(D=L/(A-v)));let{x:N,y:j}=this.project.call({worldSize:u},e),H,W,K=Math.max(D||0,C||0);if(K){let q=new c.P(D?(A+v)/2:N,C?(y+m)/2:j);return s.center=this.unproject.call({worldSize:u},q).wrap(),s.zoom+=this.scaleZoom(K),s}if(this.latRange){let q=F/2;j-q<m&&(W=m+q),j+q>y&&(W=y-q)}if(o){let q=(v+A)/2,te=N;this._renderWorldCopies&&(te=c.b3(N,q-u/2,q+u/2));let re=L/2;te-re<v&&(H=v+re),te+re>A&&(H=A-re)}if(H!==void 0||W!==void 0){let q=new c.P(H??N,W??j);s.center=this.unproject.call({worldSize:u},q).wrap()}return s}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:a,zoom:s}=this.getConstrained(this.center,this.zoom);this.center=a,this.zoom=s,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,a=this.point.x,s=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let o=c.an(new Float64Array(16));c.K(o,o,[this.width/2,-this.height/2,1]),c.J(o,o,[1,-1,0]),this.labelPlaneMatrix=o,o=c.an(new Float64Array(16)),c.K(o,o,[1,-1,1]),c.J(o,o,[-1,-1,0]),c.K(o,o,[2/this.width,2/this.height,1]),this.glCoordMatrix=o;let u=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),m=Math.min(this.elevation,this.minElevationForCurrentTile),y=u-m*this._pixelPerMeter/Math.cos(this._pitch),v=m<0?y:u,A=Math.PI/2+this._pitch,C=this._fov*(.5+e.y/this.height),D=Math.sin(C)*v/Math.sin(c.ac(Math.PI-A-C,.01,Math.PI-.01)),L=this.getHorizon(),F=2*Math.atan(L/this.cameraToCenterDistance)*(.5+e.y/(2*L)),N=Math.sin(F)*v/Math.sin(c.ac(Math.PI-A-F,.01,Math.PI-.01)),j=Math.min(D,N);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*j+v),this.nearZ=this.height/50,o=new Float64Array(16),c.b6(o,this._fov,this.width/this.height,this.nearZ,this.farZ),o[8]=2*-e.x/this.width,o[9]=2*e.y/this.height,this.projectionMatrix=c.ae(o),c.K(o,o,[1,-1,1]),c.J(o,o,[0,0,-this.cameraToCenterDistance]),c.b7(o,o,this._pitch),c.ad(o,o,this.angle),c.J(o,o,[-a,-s,0]),this.mercatorMatrix=c.K([],o,[this.worldSize,this.worldSize,this.worldSize]),c.K(o,o,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,o),c.J(o,o,[0,0,-this.elevation]),this.modelViewProjectionMatrix=o,this.invModelViewProjectionMatrix=c.as([],o),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,u,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-a,-s,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,o);let H=this.width%2/2,W=this.height%2/2,K=Math.cos(this.angle),q=Math.sin(this.angle),te=a-Math.round(a)+K*H+q*W,re=s-Math.round(s)+K*W+q*H,le=new Float64Array(o);if(c.J(le,le,[te>.5?te-1:te,re>.5?re-1:re,0]),this.alignedModelViewProjectionMatrix=le,o=c.as(new Float64Array(16),this.pixelMatrix),!o)throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new c.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){let a=this.getCameraPoint();if(e.length===1)return[e[0],a];{let s=a.x,o=a.y,u=a.x,m=a.y;for(let y of e)s=Math.min(s,y.x),o=Math.min(o,y.y),u=Math.max(u,y.x),m=Math.max(m,y.y);return[new c.P(s,o),new c.P(u,o),new c.P(u,m),new c.P(s,m),new c.P(s,o)]}}lngLatToCameraDepth(e,a){let s=this.locationCoordinate(e),o=[s.x*this.worldSize,s.y*this.worldSize,a,1];return c.af(o,o,this.modelViewProjectionMatrix),o[2]/o[3]}}function Un(h,e){let a,s=!1,o=null,u=null,m=()=>{o=null,s&&(h.apply(u,a),o=setTimeout(m,e),s=!1)};return(...y)=>(s=!0,u=this,a=y,o||m(),o)}class Ts{constructor(e){this._getCurrentHash=()=>{let a=window.location.hash.replace("#","");if(this._hashName){let s;return a.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(s=o)}),(s&&s[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{let a=this._getCurrentHash();if(a.length>=3&&!a.some(s=>isNaN(s))){let s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:s,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{let a=this._getCurrentHash();if(a.length===0)return;let s=a.join("/"),o=s;o.split("&").length>0&&(o=o.split("&")[0]),this._hashName&&(o=`${this._hashName}=${s}`);let u=window.location.hash.replace(o,"");u.startsWith("#&")?u=u.slice(0,1)+u.slice(2):u==="#"&&(u="");let m=window.location.href.replace(/(#.+)?$/,u);m=m.replace("&&","&"),window.history.replaceState(window.history.state,null,m)},this._updateHash=Un(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let a=this._map.getCenter(),s=Math.round(100*this._map.getZoom())/100,o=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,o),m=Math.round(a.lng*u)/u,y=Math.round(a.lat*u)/u,v=this._map.getBearing(),A=this._map.getPitch(),C="";if(C+=e?`/${m}/${y}/${s}`:`${s}/${y}/${m}`,(v||A)&&(C+="/"+Math.round(10*v)/10),A&&(C+=`/${Math.round(A)}`),this._hashName){let D=this._hashName,L=!1,F=window.location.hash.slice(1).split("&").map(N=>{let j=N.split("=")[0];return j===D?(L=!0,`${j}=${C}`):N}).filter(N=>N);return L||F.push(`${D}=${C}`),`#${F.join("&")}`}return`#${C}`}}let Cs={linearity:.3,easing:c.b8(0,0,.3,1)},Fo=c.e({deceleration:2500,maxSpeed:1400},Cs),Cu=c.e({deceleration:20,maxSpeed:1400},Cs),lc=c.e({deceleration:1e3,maxSpeed:360},Cs),Ds=c.e({deceleration:1e3,maxSpeed:90},Cs);class Oo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ne.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,a=ne.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let a={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:u}of this._inertiaBuffer)a.zoom+=u.zoomDelta||0,a.bearing+=u.bearingDelta||0,a.pitch+=u.pitchDelta||0,u.panDelta&&a.pan._add(u.panDelta),u.around&&(a.around=u.around),u.pinchAround&&(a.pinchAround=u.pinchAround);let s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(a.pan.mag()){let u=$n(a.pan.mag(),s,c.e({},Fo,e||{}));o.offset=a.pan.mult(u.amount/a.pan.mag()),o.center=this._map.transform.center,jn(o,u)}if(a.zoom){let u=$n(a.zoom,s,Cu);o.zoom=this._map.transform.zoom+u.amount,jn(o,u)}if(a.bearing){let u=$n(a.bearing,s,lc);o.bearing=this._map.transform.bearing+c.ac(u.amount,-179,179),jn(o,u)}if(a.pitch){let u=$n(a.pitch,s,Ds);o.pitch=this._map.transform.pitch+u.amount,jn(o,u)}if(o.zoom||o.bearing){let u=a.pinchAround===void 0?a.around:a.pinchAround;o.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),c.e(o,{noMoveStart:!0})}}function jn(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function $n(h,e,a){let{maxSpeed:s,linearity:o,deceleration:u}=a,m=c.ac(h*o/(e/1e3),-s,s),y=Math.abs(m)/(u*o);return{easing:a.easing,duration:1e3*y,amount:m*(y/2)}}class Pi extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,s,o={}){let u=$.mousePos(a.getCanvas(),s),m=a.unproject(u);super(e,c.e({point:u,lngLat:m,originalEvent:s},o)),this._defaultPrevented=!1,this.target=a}}class Ba extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,s){let o=e==="touchend"?s.changedTouches:s.touches,u=$.touchPos(a.getCanvasContainer(),o),m=u.map(v=>a.unproject(v)),y=u.reduce((v,A,C,D)=>v.add(A.div(D.length)),new c.P(0,0));super(e,{points:u,point:y,lngLats:m,lngLat:a.unproject(y),originalEvent:s}),this._defaultPrevented=!1}}class cc extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,s){super(e,{originalEvent:s}),this._defaultPrevented=!1}}class uc{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new cc(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Pi(e.type,this._map,e))}mouseup(e){this._map.fire(new Pi(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Pi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Pi(e.type,this._map,e))}mouseover(e){this._map.fire(new Pi(e.type,this._map,e))}mouseout(e){this._map.fire(new Pi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ba(e.type,this._map,e))}touchmove(e){this._map.fire(new Ba(e.type,this._map,e))}touchend(e){this._map.fire(new Ba(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ba(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ni{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Pi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Pi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class hr{constructor(e,a){this._map=e,this._tr=new Fr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;let s=a;if(this._lastPos.equals(s)||!this._box&&s.dist(this._startPos)<this._clickTolerance)return;let o=this._startPos;this._lastPos=s,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let u=Math.min(o.x,s.x),m=Math.max(o.x,s.x),y=Math.min(o.y,s.y),v=Math.max(o.y,s.y);$.setTransform(this._box,`translate(${u}px,${y}px)`),this._box.style.width=m-u+"px",this._box.style.height=v-y+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;let s=this._startPos,o=a;if(this.reset(),$.suppressClick(),s.x!==o.x||s.y!==o.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:u=>u.fitScreenCoordinates(s,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new c.k(e,{originalEvent:a}))}}function Gn(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);let a={};for(let s=0;s<h.length;s++)a[h[s].identifier]=e[s];return a}class No{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),s.length===this.numTouches&&(this.centroid=function(o){let u=new c.P(0,0);for(let m of o)u._add(m);return u.div(o.length)}(a),this.touches=Gn(s,a)))}touchmove(e,a,s){if(this.aborted||!this.centroid)return;let o=Gn(s,a);for(let u in this.touches){let m=o[u];(!m||m.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(e,a,s){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),s.length===0){let o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class Is{constructor(e){this.singleTap=new No(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,s){this.singleTap.touchstart(e,a,s)}touchmove(e,a,s){this.singleTap.touchmove(e,a,s)}touchend(e,a,s){let o=this.singleTap.touchend(e,a,s);if(o){let u=e.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(o)<30;if(u&&m||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class cn{constructor(e){this._tr=new Fr(e),this._zoomIn=new Is({numTouches:1,numTaps:2}),this._zoomOut=new Is({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,s){this._zoomIn.touchstart(e,a,s),this._zoomOut.touchstart(e,a,s)}touchmove(e,a,s){this._zoomIn.touchmove(e,a,s),this._zoomOut.touchmove(e,a,s)}touchend(e,a,s){let o=this._zoomIn.touchend(e,a,s),u=this._zoomOut.touchend(e,a,s),m=this._tr;return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(o)},{originalEvent:e})}):u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(u)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ta{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;let s=this._lastPoint;if(!s)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let o=a.length?a[0]:a;return!this._moved&&o.dist(s)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=o,this._move(s,o))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let qo={0:1,2:2};class ks{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let a=$.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(a,s){let o=qo[s];return a.buttons===void 0||(a.buttons&o)!==o}(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class Vo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let Ms=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}},Uo=({enable:h,clickTolerance:e,bearingDegreesPerPixelMoved:a=.8})=>{let s=new ks({checkCorrectEvent:o=>$.mouseButton(o)===0&&o.ctrlKey||$.mouseButton(o)===2});return new ta({clickTolerance:e,move:(o,u)=>({bearingDelta:(u.x-o.x)*a}),moveStateManager:s,enable:h,assignEvents:Ms})},jo=({enable:h,clickTolerance:e,pitchDegreesPerPixelMoved:a=-.5})=>{let s=new ks({checkCorrectEvent:o=>$.mouseButton(o)===0&&o.ctrlKey||$.mouseButton(o)===2});return new ta({clickTolerance:e,move:(o,u)=>({pitchDelta:(u.y-o.y)*a}),moveStateManager:s,enable:h,assignEvents:Ms})};class Ra{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,s){return this._calculateTransform(e,a,s)}touchmove(e,a,s){if(this._active){if(!this._shouldBePrevented(s.length))return e.preventDefault(),this._calculateTransform(e,a,s);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,s){this._calculateTransform(e,a,s),this._active&&this._shouldBePrevented(s.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,s){s.length>0&&(this._active=!0);let o=Gn(s,a),u=new c.P(0,0),m=new c.P(0,0),y=0;for(let A in o){let C=o[A],D=this._touches[A];D&&(u._add(C),m._add(C.sub(D)),y++,o[A]=C)}if(this._touches=o,this._shouldBePrevented(y)||!m.mag())return;let v=m.div(y);return this._sum._add(v),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(y),panDelta:v}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ps{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,s){if(!this._firstTwoTouches)return;e.preventDefault();let[o,u]=this._firstTwoTouches,m=Zn(s,a,o),y=Zn(s,a,u);if(!m||!y)return;let v=this._aroundCenter?null:m.add(y).div(2);return this._move([m,y],v,e)}touchend(e,a,s){if(!this._firstTwoTouches)return;let[o,u]=this._firstTwoTouches,m=Zn(s,a,o),y=Zn(s,a,u);m&&y||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Zn(h,e,a){for(let s=0;s<h.length;s++)if(h[s].identifier===a)return e[s]}function $o(h,e){return Math.log(h/e)/Math.LN2}class Go extends Ps{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){let s=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs($o(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$o(this._distance,s),pinchAround:a}}}function Zo(h,e){return 180*h.angleWith(e)/Math.PI}class Ho extends Ps{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,s){let o=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Zo(this._vector,o),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let a=25/(Math.PI*this._minDiameter)*360,s=Zo(e,this._startVector);return Math.abs(s)<a}}function zs(h){return Math.abs(h.y)>Math.abs(h.x)}class un extends Ps{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,s){super.touchstart(e,a,s),this._currentTouchCount=s.length}_start(e){this._lastPoints=e,zs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,s){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let o=e[0].sub(this._lastPoints[0]),u=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(o,u,s.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+u.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,s){if(this._valid!==void 0)return this._valid;let o=e.mag()>=2,u=a.mag()>=2;if(!o&&!u)return;if(!o||!u)return this._firstMove===void 0&&(this._firstMove=s),s-this._firstMove<100&&void 0;let m=e.y>0==a.y>0;return zs(e)&&zs(a)&&m}}let hc={panStep:100,bearingStep:15,pitchStep:10};class wr{constructor(e){this._tr=new Fr(e);let a=hc;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,s=0,o=0,u=0,m=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?s=-1:(e.preventDefault(),u=-1);break;case 39:e.shiftKey?s=1:(e.preventDefault(),u=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),m=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(s=0,o=0),{cameraAnimation:y=>{let v=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:Wr,zoom:a?Math.round(v.zoom)+a*(e.shiftKey?2:1):v.zoom,bearing:v.bearing+s*this._bearingStep,pitch:v.pitch+o*this._pitchStep,offset:[-u*this._panStep,-m*this._panStep],center:v.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wr(h){return h*(2-h)}let Wo=4.000244140625;class Or{constructor(e,a){this._onTimeout=s=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},this._map=e,this._tr=new Fr(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,s=ne.now(),o=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,a!==0&&a%Wo==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=$.mousePos(this._map.getCanvas(),e),s=this._tr;this._around=a.y>s.transform.height/2-s.transform.getHorizon()?c.N.convert(this._aroundCenter?s.center:s.unproject(a)):c.N.convert(s.center),this._aroundPoint=s.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let v=this._type==="wheel"&&Math.abs(this._delta)>Wo?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&A!==0&&(A=1/A);let C=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(C*A))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let a=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,s=this._startZoom,o=this._easing,u,m=!1,y=ne.now()-this._lastWheelEventTime;if(this._type==="wheel"&&s&&o&&y){let v=Math.min(y/200,1),A=o(v);u=c.y.number(s,a,A),v<1?this._frameId||(this._frameId=!0):m=!0}else u=a,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:u-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=c.b9;if(this._prevEase){let s=this._prevEase,o=(ne.now()-s.start)/s.duration,u=s.easing(o+.01)-s.easing(o),m=.27/Math.sqrt(u*u+1e-4)*.01,y=Math.sqrt(.0729-m*m);a=c.b8(m,y,.25,1)}return this._prevEase={start:ne.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fa{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Du{constructor(e){this._tr=new Fr(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Iu{constructor(){this._tap=new Is({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,s){if(!this._swipePoint)if(this._tapTime){let o=a[0],u=e.timeStamp-this._tapTime<500,m=this._tapPoint.dist(o)<30;u&&m?s.length>0&&(this._swipePoint=o,this._swipeTouch=s[0].identifier):this.reset()}else this._tap.touchstart(e,a,s)}touchmove(e,a,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;let o=a[0],u=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(e,a,s)}touchend(e,a,s){if(this._tapTime)this._swipePoint&&s.length===0&&this.reset();else{let o=this._tap.touchend(e,a,s);o&&(this._tapTime=e.timeStamp,this._tapPoint=o)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pc{constructor(e,a,s){this._el=e,this._mousePan=a,this._touchPan=s}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dc{constructor(e,a,s){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=a,this._mousePitch=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xo{constructor(e,a,s,o){this._el=e,this._touchZoom=a,this._touchRotate=s,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class hn{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let s=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),o=document.createElement("div");o.className="maplibregl-desktop-message",o.textContent=a,this._container.appendChild(o);let u=document.createElement("div");u.className="maplibregl-mobile-message",u.textContent=s,this._container.appendChild(u),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Sr=h=>h.zoom||h.drag||h.pitch||h.rotate;class Pe extends c.k{}function Ls(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ko{constructor(e,a){this.handleWindowEvent=o=>{this.handleEvent(o,`${o.type}Window`)},this.handleEvent=(o,u)=>{if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let m=o.type==="renderFrame"?void 0:o,y={needsRenderFrame:!1},v={},A={},C=o.touches,D=C?this._getMapTouches(C):void 0,L=D?$.touchPos(this._map.getCanvas(),D):$.mousePos(this._map.getCanvas(),o);for(let{handlerName:j,handler:H,allowed:W}of this._handlers){if(!H.isEnabled())continue;let K;this._blockedByActive(A,W,j)?H.reset():H[u||o.type]&&(K=H[u||o.type](o,L,D),this.mergeHandlerResult(y,v,K,j,m),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||H.isActive())&&(A[j]=H)}let F={};for(let j in this._previousActiveHandlers)A[j]||(F[j]=m);this._previousActiveHandlers=A,(Object.keys(F).length||Ls(y))&&(this._changes.push([y,v,F]),this._triggerRenderFrame()),(Object.keys(A).length||Ls(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:N}=y;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Oo(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);let s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[window,"blur",void 0]];for(let[o,u,m]of this._listeners)$.addEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(let[e,a,s]of this._listeners)$.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(e){let a=this._map,s=a.getCanvasContainer();this._add("mapEvent",new uc(a,e));let o=a.boxZoom=new hr(a,e);this._add("boxZoom",o),e.interactive&&e.boxZoom&&o.enable();let u=a.cooperativeGestures=new hn(a,e.cooperativeGestures);this._add("cooperativeGestures",u),e.cooperativeGestures&&u.enable();let m=new cn(a),y=new Du(a);a.doubleClickZoom=new Fa(y,m),this._add("tapZoom",m),this._add("clickZoom",y),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();let v=new Iu;this._add("tapDragZoom",v);let A=a.touchPitch=new un(a);this._add("touchPitch",A),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);let C=Uo(e),D=jo(e);a.dragRotate=new dc(e,C,D),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();let L=(({enable:K,clickTolerance:q})=>{let te=new ks({checkCorrectEvent:re=>$.mouseButton(re)===0&&!re.ctrlKey});return new ta({clickTolerance:q,move:(re,le)=>({around:le,panDelta:le.sub(re)}),activateOnStart:!0,moveStateManager:te,enable:K,assignEvents:Ms})})(e),F=new Ra(e,a);a.dragPan=new pc(s,L,F),this._add("mousePan",L),this._add("touchPan",F,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);let N=new Ho,j=new Go;a.touchZoomRotate=new Xo(s,j,N,v),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);let H=a.scrollZoom=new Or(a,()=>this._triggerRenderFrame());this._add("scrollZoom",H,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);let W=a.keyboard=new wr(a);this._add("keyboard",W),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new ni(a))}_add(e,a,s){this._handlers.push({handlerName:e,handler:a,allowed:s}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Sr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,s){for(let o in e)if(o!==s&&(!a||a.indexOf(o)<0))return!0;return!1}_getMapTouches(e){let a=[];for(let s of e)this._el.contains(s.target)&&a.push(s);return a}mergeHandlerResult(e,a,s,o,u){if(!s)return;c.e(e,s);let m={handlerName:o,originalEvent:s.originalEvent||u};s.zoomDelta!==void 0&&(a.zoom=m),s.panDelta!==void 0&&(a.drag=m),s.pitchDelta!==void 0&&(a.pitch=m),s.bearingDelta!==void 0&&(a.rotate=m)}_applyChanges(){let e={},a={},s={};for(let[o,u,m]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),o.around!==void 0&&(e.around=o.around),o.pinchAround!==void 0&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),c.e(a,u),c.e(s,m);this._updateMapTransform(e,a,s),this._changes=[]}_updateMapTransform(e,a,s){let o=this._map,u=o._getTransformForUpdate(),m=o.terrain;if(!(Ls(e)||m&&this._terrainMovement))return this._fireEvents(a,s,!0);let{panDelta:y,zoomDelta:v,bearingDelta:A,pitchDelta:C,around:D,pinchAround:L}=e;L!==void 0&&(D=L),o._stop(!0),D=D||o.transform.centerPoint;let F=u.pointLocation(y?D.sub(y):D);A&&(u.bearing+=A),C&&(u.pitch+=C),v&&(u.zoom+=v),m?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?u.center=u.pointLocation(u.centerPoint.sub(y)):u.setLocationAtPoint(F,D):(this._terrainMovement=!0,this._map._elevationFreeze=!0,u.setLocationAtPoint(F,D)):u.setLocationAtPoint(F,D),o._applyUpdatedTransform(u),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,s,!0)}_fireEvents(e,a,s){let o=Sr(this._eventsInProgress),u=Sr(e),m={};for(let D in e){let{originalEvent:L}=e[D];this._eventsInProgress[D]||(m[`${D}start`]=L),this._eventsInProgress[D]=e[D]}!o&&u&&this._fireEvent("movestart",u.originalEvent);for(let D in m)this._fireEvent(D,m[D]);u&&this._fireEvent("move",u.originalEvent);for(let D in e){let{originalEvent:L}=e[D];this._fireEvent(D,L)}let y={},v;for(let D in this._eventsInProgress){let{handlerName:L,originalEvent:F}=this._eventsInProgress[D];this._handlersById[L].isActive()||(delete this._eventsInProgress[D],v=a[L]||F,y[`${D}end`]=v)}for(let D in y)this._fireEvent(D,y[D]);let A=Sr(this._eventsInProgress),C=(o||u)&&!A;if(C&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let D=this._map._getTransformForUpdate();D.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(D)}if(s&&C){this._updatingCamera=!0;let D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!D||!D.essential&&ne.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:v})),L(this._map.getBearing())&&this._map.resetNorth()):(L(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:v})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new c.k(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Pe("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class fc extends c.E{constructor(e,a){super(),this._renderFrameCallback=()=>{let s=Math.min((ne.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}panBy(e,a,s){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},a),s)}panTo(e,a,s){return this.easeTo(c.e({center:e},a),s)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,s){return this.easeTo(c.e({zoom:e},a),s)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,s){return this.easeTo(c.e({bearing:e},a),s)}resetNorth(e,a){return this.rotateTo(0,c.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}cameraForBounds(e,a){e=ce.convert(e).adjustAntiMeridian();let s=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),s,a)}_cameraForBoxAndBearing(e,a,s,o){let u={top:0,bottom:0,right:0,left:0};if(typeof(o=c.e({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){let Se=o.padding;o.padding={top:Se,bottom:Se,right:Se,left:Se}}o.padding=c.e(u,o.padding);let m=this.transform,y=m.padding,v=new ce(e,a),A=m.project(v.getNorthWest()),C=m.project(v.getNorthEast()),D=m.project(v.getSouthEast()),L=m.project(v.getSouthWest()),F=c.ba(-s),N=A.rotate(F),j=C.rotate(F),H=D.rotate(F),W=L.rotate(F),K=new c.P(Math.max(N.x,j.x,W.x,H.x),Math.max(N.y,j.y,W.y,H.y)),q=new c.P(Math.min(N.x,j.x,W.x,H.x),Math.min(N.y,j.y,W.y,H.y)),te=K.sub(q),re=(m.width-(y.left+y.right+o.padding.left+o.padding.right))/te.x,le=(m.height-(y.top+y.bottom+o.padding.top+o.padding.bottom))/te.y;if(le<0||re<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let me=Math.min(m.scaleZoom(m.scale*Math.min(re,le)),o.maxZoom),_e=c.P.convert(o.offset),Te=new c.P((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(c.ba(s)),ke=_e.add(Te).mult(m.scale/m.zoomScale(me));return{center:m.unproject(A.add(D).div(2).sub(ke)),zoom:me,bearing:s}}fitBounds(e,a,s){return this._fitInternal(this.cameraForBounds(e,a),a,s)}fitScreenCoordinates(e,a,s,o,u){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(a)),s,o),o,u)}_fitInternal(e,a,s){return e?(delete(a=c.e(e,a)).padding,a.linear?this.easeTo(a,s):this.flyTo(a,s)):this}jumpTo(e,a){this.stop();let s=this._getTransformForUpdate(),o=!1,u=!1,m=!1;return"zoom"in e&&s.zoom!==+e.zoom&&(o=!0,s.zoom=+e.zoom),e.center!==void 0&&(s.center=c.N.convert(e.center)),"bearing"in e&&s.bearing!==+e.bearing&&(u=!0,s.bearing=+e.bearing),"pitch"in e&&s.pitch!==+e.pitch&&(m=!0,s.pitch=+e.pitch),e.padding==null||s.isPaddingEqual(e.padding)||(s.padding=e.padding),this._applyUpdatedTransform(s),this.fire(new c.k("movestart",a)).fire(new c.k("move",a)),o&&this.fire(new c.k("zoomstart",a)).fire(new c.k("zoom",a)).fire(new c.k("zoomend",a)),u&&this.fire(new c.k("rotatestart",a)).fire(new c.k("rotate",a)).fire(new c.k("rotateend",a)),m&&this.fire(new c.k("pitchstart",a)).fire(new c.k("pitch",a)).fire(new c.k("pitchend",a)),this.fire(new c.k("moveend",a))}calculateCameraOptionsFromTo(e,a,s,o=0){let u=c.Z.fromLngLat(e,a),m=c.Z.fromLngLat(s,o),y=m.x-u.x,v=m.y-u.y,A=m.z-u.z,C=Math.hypot(y,v,A);if(C===0)throw new Error("Can't calculate camera options with same From and To");let D=Math.hypot(y,v),L=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),F=180*Math.atan2(y,-v)/Math.PI,N=180*Math.acos(D/C)/Math.PI;return N=A<0?90-N:90+N,{center:m.toLngLat(),zoom:L,pitch:N,bearing:F}}easeTo(e,a){var s;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&ne.prefersReducedMotion)&&(e.duration=0);let o=this._getTransformForUpdate(),u=o.zoom,m=o.bearing,y=o.pitch,v=o.padding,A="bearing"in e?this._normalizeBearing(e.bearing,m):m,C="pitch"in e?+e.pitch:y,D="padding"in e?e.padding:o.padding,L=c.P.convert(e.offset),F=o.centerPoint.add(L),N=o.pointLocation(F),{center:j,zoom:H}=o.getConstrained(c.N.convert(e.center||N),(s=e.zoom)!==null&&s!==void 0?s:u);this._normalizeCenter(j,o);let W=o.project(N),K=o.project(j).sub(W),q=o.zoomScale(H-u),te,re;e.around&&(te=c.N.convert(e.around),re=o.locationPoint(te));let le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||H!==u,this._rotating=this._rotating||m!==A,this._pitching=this._pitching||C!==y,this._padding=!o.isPaddingEqual(D),this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,le),this.terrain&&this._prepareElevation(j),this._ease(me=>{if(this._zooming&&(o.zoom=c.y.number(u,H,me)),this._rotating&&(o.bearing=c.y.number(m,A,me)),this._pitching&&(o.pitch=c.y.number(y,C,me)),this._padding&&(o.interpolatePadding(v,D,me),F=o.centerPoint.add(L)),this.terrain&&!e.freezeElevation&&this._updateElevation(me),te)o.setLocationAtPoint(te,re);else{let _e=o.zoomScale(o.zoom-u),Te=H>u?Math.min(2,q):Math.max(.5,q),ke=Math.pow(Te,1-me),Se=o.unproject(W.add(K.mult(me*ke)).mult(_e));o.setLocationAtPoint(o.renderWorldCopies?Se.wrap():Se,F)}this._applyUpdatedTransform(o),this._fireMoveEvents(a)},me=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,me)},e),this}_prepareEase(e,a,s={}){this._moving=!0,a||s.moving||this.fire(new c.k("movestart",e)),this._zooming&&!s.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!s.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!s.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){let s=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(s-(a-(s*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){let a=e.getCameraPosition(),s=this.terrain.getElevationForLngLatZoom(a.lngLat,e.zoom);if(a.altitude<s){let o=this.calculateCameraOptionsFromTo(a.lngLat,s,e.center,e.elevation);return{pitch:o.pitch,zoom:o.zoom}}return{}}_applyUpdatedTransform(e){let a=[];if(this.terrain&&a.push(o=>this._elevateCameraIfInsideTerrain(o)),this.transformCameraUpdate&&a.push(o=>this.transformCameraUpdate(o)),!a.length)return;let s=e.clone();for(let o of a){let u=s.clone(),{center:m,zoom:y,pitch:v,bearing:A,elevation:C}=o(u);m&&(u.center=m),y!==void 0&&(u.zoom=y),v!==void 0&&(u.pitch=v),A!==void 0&&(u.bearing=A),C!==void 0&&(u.elevation=C),s.apply(u)}this.transform.apply(s)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;let s=this._zooming,o=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,s&&this.fire(new c.k("zoomend",e)),o&&this.fire(new c.k("rotateend",e)),u&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,a){var s;if(!e.essential&&ne.prefersReducedMotion){let De=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(De,a)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);let o=this._getTransformForUpdate(),u=o.zoom,m=o.bearing,y=o.pitch,v=o.padding,A="bearing"in e?this._normalizeBearing(e.bearing,m):m,C="pitch"in e?+e.pitch:y,D="padding"in e?e.padding:o.padding,L=c.P.convert(e.offset),F=o.centerPoint.add(L),N=o.pointLocation(F),{center:j,zoom:H}=o.getConstrained(c.N.convert(e.center||N),(s=e.zoom)!==null&&s!==void 0?s:u);this._normalizeCenter(j,o);let W=o.zoomScale(H-u),K=o.project(N),q=o.project(j).sub(K),te=e.curve,re=Math.max(o.width,o.height),le=re/W,me=q.mag();if("minZoom"in e){let De=c.ac(Math.min(e.minZoom,u,H),o.minZoom,o.maxZoom),Je=re/o.zoomScale(De-u);te=Math.sqrt(Je/me*2)}let _e=te*te;function Te(De){let Je=(le*le-re*re+(De?-1:1)*_e*_e*me*me)/(2*(De?le:re)*_e*me);return Math.log(Math.sqrt(Je*Je+1)-Je)}function ke(De){return(Math.exp(De)-Math.exp(-De))/2}function Se(De){return(Math.exp(De)+Math.exp(-De))/2}let we=Te(!1),Be=function(De){return Se(we)/Se(we+te*De)},Qe=function(De){return re*((Se(we)*(ke(Je=we+te*De)/Se(Je))-ke(we))/_e)/me;var Je},Ae=(Te(!0)-we)/te;if(Math.abs(me)<1e-6||!isFinite(Ae)){if(Math.abs(re-le)<1e-6)return this.easeTo(e,a);let De=le<re?-1:1;Ae=Math.abs(Math.log(le/re))/te,Qe=()=>0,Be=Je=>Math.exp(De*te*Je)}return e.duration="duration"in e?+e.duration:1e3*Ae/("screenSpeed"in e?+e.screenSpeed/te:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==A,this._pitching=C!==y,this._padding=!o.isPaddingEqual(D),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(j),this._ease(De=>{let Je=De*Ae,Xt=1/Be(Je);o.zoom=De===1?H:u+o.scaleZoom(Xt),this._rotating&&(o.bearing=c.y.number(m,A,De)),this._pitching&&(o.pitch=c.y.number(y,C,De)),this._padding&&(o.interpolatePadding(v,D,De),F=o.centerPoint.add(L)),this.terrain&&!e.freezeElevation&&this._updateElevation(De);let at=De===1?j:o.unproject(K.add(q.mult(Qe(Je))).mult(Xt));o.setLocationAtPoint(o.renderWorldCopies?at.wrap():at,F),this._applyUpdatedTransform(o),this._fireMoveEvents(a)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var s;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,a)}return e||(s=this.handlers)===null||s===void 0||s.stop(!1),this}_ease(e,a,s){s.animate===!1||s.duration===0?(e(1),a()):(this._easeStart=ne.now(),this._easeOptions=s,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=c.b3(e,-180,180);let s=Math.abs(e-a);return Math.abs(e-360-a)<s&&(e-=360),Math.abs(e+360-a)<s&&(e+=360),e}_normalizeCenter(e,a){if(!a.renderWorldCopies||a.lngRange)return;let s=e.lng-a.center.lng;e.lng+=s>180?-360:s<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}let pn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class dn{constructor(e=pn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){let s=this._map._getUIString(`AttributionControl.${a}`);e.title=s,e.setAttribute("aria-label",s)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(o=>typeof o!="string"?"":o)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}let a=this._map.style.sourceCaches;for(let o in a){let u=a[o];if(u.used||u.usedForTerrain){let m=u.getSource();m.attribution&&e.indexOf(m.attribution)<0&&e.push(m.attribution)}}e=e.filter(o=>String(o).trim()),e.sort((o,u)=>o.length-u.length),e=e.filter((o,u)=>{for(let m=u+1;m<e.length;m++)if(e[m].indexOf(o)>=0)return!1;return!0});let s=e.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,e.length?(this._innerContainer.innerHTML=s,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jo{constructor(e={}){this._updateCompact=()=>{let a=this._container.children;if(a.length){let s=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact"):s.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");let a=$.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class _t{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){let a=this._currentlyRunning,s=a?this._queue.concat(a):this._queue;for(let o of s)if(o.id===e)return void(o.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let a=this._currentlyRunning=this._queue;this._queue=[];for(let s of a)if(!s.cancelled&&(s.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Yo=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ku extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];let s={};for(let o of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))s[o.key]=!0,this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),c.aP(o.posMatrix,0,c.X,0,c.X,0,1),this._tiles[o.key]=new zr(o,this.tileSize));for(let o in this._tiles)s[o]||delete this._tiles[o]}freeRtt(e){for(let a in this._tiles){let s=this._tiles[a];(!e||s.tileID.equals(e)||s.tileID.isChildOf(e)||e.isChildOf(s.tileID))&&(s.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let a={};for(let s of this._renderableTilesKeys){let o=this._tiles[s].tileID;if(o.canonical.equals(e.canonical)){let u=e.clone();u.posMatrix=new Float64Array(16),c.aP(u.posMatrix,0,c.X,0,c.X,0,1),a[s]=u}else if(o.canonical.isChildOf(e.canonical)){let u=e.clone();u.posMatrix=new Float64Array(16);let m=o.canonical.z-e.canonical.z,y=o.canonical.x-(o.canonical.x>>m<<m),v=o.canonical.y-(o.canonical.y>>m<<m),A=c.X>>m;c.aP(u.posMatrix,0,A,0,A,0,1),c.J(u.posMatrix,u.posMatrix,[-y*A,-v*A,0]),a[s]=u}else if(e.canonical.isChildOf(o.canonical)){let u=e.clone();u.posMatrix=new Float64Array(16);let m=e.canonical.z-o.canonical.z,y=e.canonical.x-(e.canonical.x>>m<<m),v=e.canonical.y-(e.canonical.y>>m<<m),A=c.X>>m;c.aP(u.posMatrix,0,c.X,0,c.X,0,1),c.J(u.posMatrix,u.posMatrix,[y*A,v*A,0]),c.K(u.posMatrix,u.posMatrix,[1/2**m,1/2**m,0]),a[s]=u}}return a}getSourceTile(e,a){let s=this.sourceCache._source,o=e.overscaledZ-this.deltaZoom;if(o>s.maxzoom&&(o=s.maxzoom),o<s.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(o).key);let u=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!u||!u.dem)&&a)for(;o>=s.minzoom&&(!u||!u.dem);)u=this.sourceCache.getTileByID(e.scaledTo(o--).key);return u}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=e)}}class Qo{constructor(e,a,s){this.painter=e,this.sourceCache=new ku(a),this.options=s,this.exaggeration=typeof s.exaggeration=="number"?s.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,s,o=c.X){var u;if(!(a>=0&&a<o&&s>=0&&s<o))return 0;let m=this.getTerrainData(e),y=(u=m.tile)===null||u===void 0?void 0:u.dem;if(!y)return 0;let v=function(N,j,H){var W=j[0],K=j[1];return N[0]=H[0]*W+H[4]*K+H[12],N[1]=H[1]*W+H[5]*K+H[13],N}([],[a/o*c.X,s/o*c.X],m.u_terrain_matrix),A=[v[0]*y.dim,v[1]*y.dim],C=Math.floor(A[0]),D=Math.floor(A[1]),L=A[0]-C,F=A[1]-D;return y.get(C,D)*(1-L)*(1-F)+y.get(C+1,D)*L*(1-F)+y.get(C,D+1)*(1-L)*F+y.get(C+1,D+1)*L*F}getElevationForLngLatZoom(e,a){if(!c.bb(a,e.wrap()))return 0;let{tileID:s,mercatorX:o,mercatorY:u}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(s,o%c.X,u%c.X,c.X)}getElevation(e,a,s,o=c.X){return this.getDEMElevation(e,a,s,o)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let o=this.painter.context,u=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ve(o,u,o.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ve(o,new c.R({width:1,height:1}),o.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}let a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){let o=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Ve(o,a.dem.getPixels(),o.gl.RGBA,{premultiply:!1}),a.demTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}let s=a&&a+a.tileID.key+e.key;if(s&&!this._demMatrixCache[s]){let o=this.sourceCache.sourceCache._source.maxzoom,u=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=o?u=e.canonical.z-o:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let m=e.canonical.x-(e.canonical.x>>u<<u),y=e.canonical.y-(e.canonical.y>>u<<u),v=c.bc(new Float64Array(16),[1/(c.X<<u),1/(c.X<<u),0]);c.J(v,v,[m*c.X,y*c.X,0]),this._demMatrixCache[e.key]={matrix:v,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:s?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){let a=this.painter,s=a.width/devicePixelRatio,o=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===s&&this._fbo.height===o||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ve(a.context,{width:s,height:o,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ve(a.context,{width:s,height:o,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(s,o,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,s,o))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let u=0,m=0;u<this._coordsTextureSize;u++)for(let y=0;y<this._coordsTextureSize;y++,m+=4)a[m+0]=255&y,a[m+1]=255&u,a[m+2]=y>>8<<4|u>>8,a[m+3]=0;let s=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),o=new Ve(e,s,e.gl.RGBA,{premultiply:!1});return o.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=o,o}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let a=new Uint8Array(4),s=this.painter.context,o=s.gl,u=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),m=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),y=Math.round(this.painter.height/devicePixelRatio);s.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),o.readPixels(u,y-m-1,1,1,o.RGBA,o.UNSIGNED_BYTE,a),s.bindFramebuffer.set(null);let v=a[0]+(a[2]>>4<<8),A=a[1]+((15&a[2])<<8),C=this.coordsIndex[255-a[3]],D=C&&this.sourceCache.getTileByID(C);if(!D)return null;let L=this._coordsTextureSize,F=(1<<D.tileID.canonical.z)*L;return new c.Z((D.tileID.canonical.x*L+v)/F+D.tileID.wrap,(D.tileID.canonical.y*L+A)/F,this.getElevation(D.tileID,v,A,L))}depthAtPoint(e){let a=new Uint8Array(4),s=this.painter.context,o=s.gl;return s.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),o.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,o.RGBA,o.UNSIGNED_BYTE,a),s.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;let e=this.painter.context,a=new c.bd,s=new c.aY,o=this.meshSize,u=c.X/o,m=o*o;for(let D=0;D<=o;D++)for(let L=0;L<=o;L++)a.emplaceBack(L*u,D*u,0);for(let D=0;D<m;D+=o+1)for(let L=0;L<o;L++)s.emplaceBack(L+D,o+L+D+1,o+L+D+2),s.emplaceBack(L+D,o+L+D+2,L+D+1);let y=a.length,v=y+2*(o+1);for(let D of[0,1])for(let L=0;L<=o;L++)for(let F of[0,1])a.emplaceBack(L*u,D*c.X,F);for(let D=0;D<2*o;D+=2)s.emplaceBack(v+D,v+D+1,v+D+3),s.emplaceBack(v+D,v+D+3,v+D+2),s.emplaceBack(y+D,y+D+3,y+D+1),s.emplaceBack(y+D,y+D+2,y+D+3);let A=a.length,C=A+2*(o+1);for(let D of[0,1])for(let L=0;L<=o;L++)for(let F of[0,1])a.emplaceBack(D*c.X,L*u,F);for(let D=0;D<2*o;D+=2)s.emplaceBack(A+D,A+D+1,A+D+3),s.emplaceBack(A+D,A+D+3,A+D+2),s.emplaceBack(C+D,C+D+3,C+D+1),s.emplaceBack(C+D,C+D+2,C+D+3);return this._mesh=new As(e.createVertexBuffer(a,Yo.members),e.createIndexBuffer(s),c.a0.simpleSegment(0,0,a.length,s.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,a){var s;let{tileID:o}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(s=this.getMinMaxElevation(o).minElevation)!==null&&s!==void 0?s:0}getMinMaxElevation(e){let a=this.getTerrainData(e).tile,s={minElevation:null,maxElevation:null};return a&&a.dem&&(s.minElevation=a.dem.min*this.exaggeration,s.maxElevation=a.dem.max*this.exaggeration),s}_getOverscaledTileIDFromLngLatZoom(e,a){let s=c.Z.fromLngLat(e.wrap()),o=(1<<a)*c.X,u=s.x*o,m=s.y*o,y=Math.floor(u/c.X),v=Math.floor(m/c.X);return{tileID:new c.S(a,0,a,y,v),mercatorX:u,mercatorY:m}}}class Mu{constructor(e,a,s){this._context=e,this._size=a,this._tileSize=s,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),s=new Ve(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return s.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(s.texture),{id:e,fbo:a,texture:s,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let fn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class mc{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new Mu(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(s=>!e._layers[s].isHidden(a)),this._coordsDescendingInv={};for(let s in e.sourceCaches){this._coordsDescendingInv[s]={};let o=e.sourceCaches[s].getVisibleCoordinates();for(let u of o){let m=this.terrain.sourceCache.getTerrainCoords(u);for(let y in m)this._coordsDescendingInv[s][y]||(this._coordsDescendingInv[s][y]=[]),this._coordsDescendingInv[s][y].push(m[y])}}this._coordsDescendingInvStr={};for(let s of e._order){let o=e._layers[s],u=o.source;if(fn[o.type]&&!this._coordsDescendingInvStr[u]){this._coordsDescendingInvStr[u]={};for(let m in this._coordsDescendingInv[u])this._coordsDescendingInvStr[u][m]=this._coordsDescendingInv[u][m].map(y=>y.key).sort().join()}}for(let s of this._renderableTiles)for(let o in this._coordsDescendingInvStr){let u=this._coordsDescendingInvStr[o][s.tileID.key];u&&u!==s.rttCoords[o]&&(s.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;let a=e.type,s=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(fn[a]&&(this._prevType&&fn[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(e.id),!o))return!0;if(fn[this._prevType]||fn[a]&&o){this._prevType=a;let u=this._stacks.length-1,m=this._stacks[u]||[];for(let y of this._renderableTiles){if(this.pool.isFull()&&(oc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(y),y.rtt[u]){let A=this.pool.getObjectForId(y.rtt[u].id);if(A.stamp===y.rtt[u].stamp){this.pool.useObject(A);continue}}let v=this.pool.getOrCreateFreeObject();this.pool.useObject(v),this.pool.stampObject(v),y.rtt[u]={id:v.id,stamp:v.stamp},s.context.bindFramebuffer.set(v.fbo.framebuffer),s.context.clear({color:c.aM.transparent,stencil:0}),s.currentStencilSource=void 0;for(let A=0;A<m.length;A++){let C=s.style._layers[m[A]],D=C.source?this._coordsDescendingInv[C.source][y.tileID.key]:[y.tileID];s.context.viewport.set([0,0,v.fbo.width,v.fbo.height]),s._renderTileClippingMasks(C,D),s.renderLayer(s,s.style.sourceCaches[C.source],C,D),C.source&&(y.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][y.tileID.key])}}return oc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),fn[a]}return!1}}let el={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},gc=Q,Pu={hash:!1,interactive:!0,bearingSnap:7,attributionControl:pn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},tl=h=>{h.touchstart=h.dragStart,h.touchmoveWindow=h.dragMove,h.touchend=h.dragEnd},zu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lu{constructor(e,a,s=!1){this.mousedown=m=>{this.startMouse(c.e({},m,{ctrlKey:!0,preventDefault:()=>m.preventDefault()}),$.mousePos(this.element,m)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.moveMouse(m,$.mousePos(this.element,m))},this.mouseup=m=>{this.mouseRotate.dragEnd(m),this.mousePitch&&this.mousePitch.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,m.targetTouches)[0],this.startTouch(m,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,m.targetTouches)[0],this.moveTouch(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let o=e.dragRotate._mouseRotate.getClickTolerance(),u=e.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=Uo({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:m,clickTolerance:y,bearingDegreesPerPixelMoved:v=.8})=>{let A=new Vo;return new ta({clickTolerance:y,move:(C,D)=>({bearingDelta:(D.x-C.x)*v}),moveStateManager:A,enable:m,assignEvents:tl})})({clickTolerance:o,enable:!0}),this.map=e,s&&(this.mousePitch=jo({clickTolerance:u,enable:!0}),this.touchPitch=(({enable:m,clickTolerance:y,pitchDegreesPerPixelMoved:v=-.5})=>{let A=new Vo;return new ta({clickTolerance:y,move:(C,D)=>({pitchDelta:(D.y-C.y)*v}),moveStateManager:A,enable:m,assignEvents:tl})})({clickTolerance:u,enable:!0})),$.addEventListener(a,"mousedown",this.mousedown),$.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(a,"touchcancel",this.reset)}startMouse(e,a){this.mouseRotate.dragStart(e,a),this.mousePitch&&this.mousePitch.dragStart(e,a),$.disableDrag()}startTouch(e,a){this.touchRotate.dragStart(e,a),this.touchPitch&&this.touchPitch.dragStart(e,a),$.disableDrag()}moveMouse(e,a){let s=this.map,{bearingDelta:o}=this.mouseRotate.dragMove(e,a)||{};if(o&&s.setBearing(s.getBearing()+o),this.mousePitch){let{pitchDelta:u}=this.mousePitch.dragMove(e,a)||{};u&&s.setPitch(s.getPitch()+u)}}moveTouch(e,a){let s=this.map,{bearingDelta:o}=this.touchRotate.dragMove(e,a)||{};if(o&&s.setBearing(s.getBearing()+o),this.touchPitch){let{pitchDelta:u}=this.touchPitch.dragMove(e,a)||{};u&&s.setPitch(s.getPitch()+u)}}off(){let e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let pr;function Wt(h,e,a){let s=new c.N(h.lng,h.lat);if(h=new c.N(h.lng,h.lat),e){let o=new c.N(h.lng-360,h.lat),u=new c.N(h.lng+360,h.lat),m=a.locationPoint(h).distSqr(e);a.locationPoint(o).distSqr(e)<m?h=o:a.locationPoint(u).distSqr(e)<m&&(h=u)}for(;Math.abs(h.lng-a.center.lng)>180;){let o=a.locationPoint(h);if(o.x>=0&&o.y>=0&&o.x<=a.width&&o.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h.lng!==s.lng&&a.locationPoint(h).y>a.height/2-a.getHorizon()?h:s}let mn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bs(h,e,a){let s=h.classList;for(let o in mn)s.remove(`maplibregl-${a}-anchor-${o}`);s.add(`maplibregl-${a}-anchor-${e}`)}class Rs extends c.E{constructor(e){if(super(),this._onKeyPress=a=>{let s=a.code,o=a.charCode||a.keyCode;s!=="Space"&&s!=="Enter"&&o!==32&&o!==13||this.togglePopup()},this._onMapClick=a=>{let s=a.originalEvent.target,o=this._element;this._popup&&(s===o||o.contains(s))&&this.togglePopup()},this._update=a=>{var s;if(!this._map)return;let o=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!o)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Wt(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${mn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${u}`),ne.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){let s=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");let a=$.createNS("http://www.w3.org/2000/svg","svg"),s=41,o=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${s}px`),a.setAttributeNS(null,"width",`${o}px`),a.setAttributeNS(null,"viewBox",`0 0 ${o} ${s}`);let u=$.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"stroke","none"),u.setAttributeNS(null,"stroke-width","1"),u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"fill-rule","evenodd");let m=$.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");let y=$.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");let v=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let W of v){let K=$.createNS("http://www.w3.org/2000/svg","ellipse");K.setAttributeNS(null,"opacity","0.04"),K.setAttributeNS(null,"cx","10.5"),K.setAttributeNS(null,"cy","5.80029008"),K.setAttributeNS(null,"rx",W.rx),K.setAttributeNS(null,"ry",W.ry),y.appendChild(K)}let A=$.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);let C=$.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(C);let D=$.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");let L=$.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(L);let F=$.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");let N=$.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");let j=$.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#000000"),j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962");let H=$.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#FFFFFF"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962"),N.appendChild(j),N.appendChild(H),m.appendChild(y),m.appendChild(A),m.appendChild(D),m.appendChild(F),m.appendChild(N),a.appendChild(m),a.setAttributeNS(null,"height",s*this._scale+"px"),a.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(a),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Bs(this._element,this._anchor,"marker"),e&&e.className)for(let a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,s;if(!(!((a=this._map)===null||a===void 0)&&a.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let o=this._map,u=o.terrain.depthAtPoint(this._pos),m=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,m)-u<.006)return void(this._element.style.opacity=this._opacity);let y=-this._offset.y/o.transform._pixelPerMeter,v=Math.sin(o.getPitch()*Math.PI/180)*y,A=o.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),C=o.transform.lngLatToCameraDepth(this._lngLat,m+v)-A>.006;!((s=this._popup)===null||s===void 0)&&s.isOpen()&&C&&this._popup.remove(),this._element.style.opacity=C?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return e===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}let yc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Hn=0,Wn=!1,Xr={maxWidth:100,unit:"metric"};function Xn(h,e,a){let s=a&&a.maxWidth||100,o=h._container.clientHeight/2,u=h.unproject([0,o]),m=h.unproject([s,o]),y=u.distanceTo(m);if(a&&a.unit==="imperial"){let v=3.2808*y;v>5280?Le(e,s,v/5280,h._getUIString("ScaleControl.Miles")):Le(e,s,v,h._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Le(e,s,y/1852,h._getUIString("ScaleControl.NauticalMiles")):y>=1e3?Le(e,s,y/1e3,h._getUIString("ScaleControl.Kilometers")):Le(e,s,y,h._getUIString("ScaleControl.Meters"))}function Le(h,e,a,s){let o=function(u){let m=Math.pow(10,`${Math.floor(u)}`.length-1),y=u/m;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(v){let A=Math.pow(10,Math.ceil(-Math.log(v)/Math.LN10));return Math.round(v*A)/A}(y),m*y}(a);h.style.width=e*(o/a)+"px",h.innerHTML=`${o}&nbsp;${s}`}let He={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Fs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Os(h){if(h){if(typeof h=="number"){let e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,h),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-h),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(h,0),right:new c.P(-h,0)}}if(h instanceof c.P||Array.isArray(h)){let e=c.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(h.center||[0,0]),top:c.P.convert(h.top||[0,0]),"top-left":c.P.convert(h["top-left"]||[0,0]),"top-right":c.P.convert(h["top-right"]||[0,0]),bottom:c.P.convert(h.bottom||[0,0]),"bottom-left":c.P.convert(h["bottom-left"]||[0,0]),"bottom-right":c.P.convert(h["bottom-right"]||[0,0]),left:c.P.convert(h.left||[0,0]),right:c.P.convert(h.right||[0,0])}}return Os(new c.P(0,0))}let il=Q;w.AJAXError=c.bh,w.Evented=c.E,w.LngLat=c.N,w.MercatorCoordinate=c.Z,w.Point=c.P,w.addProtocol=c.bi,w.config=c.a,w.removeProtocol=c.bj,w.AttributionControl=dn,w.BoxZoomHandler=hr,w.CanvasSource=Vi,w.CooperativeGesturesHandler=hn,w.DoubleClickZoomHandler=Fa,w.DragPanHandler=pc,w.DragRotateHandler=dc,w.EdgeInsets=on,w.FullscreenControl=class extends c.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let h=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=_r,w.GeolocateControl=class extends c.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let a=new c.N(e.coords.longitude,e.coords.latitude),s=e.coords.accuracy,o=this._map.getBearing(),u=c.e({bearing:o},this.options.fitBoundsOptions),m=ce.fromLngLat(a,s);this._map.fitBounds(m,u,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let a=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Wn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Rs({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},yc,h)}onAdd(h){return this._map=h,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(pr!==void 0&&!e)return pr;if(window.navigator.permissions===void 0)return pr=!!window.navigator.geolocation,pr;try{pr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{pr=!!window.navigator.geolocation}return pr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Hn=0,Wn=!1}_isOutOfMapMaxBounds(h){let e=this._map.getMaxBounds(),a=h.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let h=this._map.getBounds(),e=h.getSouthEast(),a=h.getNorthEast(),s=e.distanceTo(a),o=Math.ceil(this._accuracy/(s/this._map._container.clientHeight)*2);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Hn--,Wn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Hn++,Hn>1?(h={maximumAge:6e5,timeout:0},Wn=!0):(h=this.options.positionOptions,Wn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=Ts,w.ImageSource=Wi,w.KeyboardHandler=wr,w.LngLatBounds=ce,w.LogoControl=Jo,w.Map=class extends fc{constructor(h){c.bf.mark(c.bg.create);let e=Object.assign(Object.assign({},Pu),h);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ln(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new _t,this._controls=[],this._mapId=c.a4(),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},el),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=yt.addThrottleControl(()=>this.isMoving()),this._requestManager=new yr(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1,s=Un(o=>{this._trackResize&&!this._removed&&(this.resize(o),this.redraw())},50);this._resizeObserver=new ResizeObserver(o=>{a?s(o):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ko(this,e),this._hash=e.hash&&new Ts(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new dn(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Jo,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new c.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new c.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new c.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=h.onAdd(this);this._controls.push(h);let s=this._controlPositions[e];return e.indexOf("bottom")!==-1?s.insertBefore(a,s.firstChild):s.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,a,s){return s==null&&this.terrain&&(s=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,a,s)}resize(h){var e;let a=this._containerDimensions(),s=a[0],o=a[1],u=this._getClampedPixelRatio(s,o);if(this._resizeCanvas(s,o,u),this.painter.resize(s,o,u),this.painter.overLimit()){let y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];let v=this._getClampedPixelRatio(s,o);this._resizeCanvas(s,o,v),this.painter.resize(s,o,v)}this.transform.resize(s,o),(e=this._requestedCameraState)===null||e===void 0||e.resize(s,o);let m=!this._moving;return m&&(this.stop(),this.fire(new c.k("movestart",h)).fire(new c.k("move",h))),this.fire(new c.k("resize",h)),m&&this.fire(new c.k("moveend",h)),this}_getClampedPixelRatio(h,e){let{0:a,1:s}=this._maxCanvasSize,o=this.getPixelRatio(),u=h*o,m=e*o;return Math.min(u>a?a/u:1,m>s?s/m:1)*o}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(ce.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(c.N.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.pointLocation(c.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,a){if(h==="mouseenter"||h==="mouseover"){let s=!1;return{layers:e,listener:a,delegates:{mousemove:u=>{let m=e.filter(v=>this.getLayer(v)),y=m.length!==0?this.queryRenderedFeatures(u.point,{layers:m}):[];y.length?s||(s=!0,a.call(this,new Pi(h,this,u.originalEvent,{features:y}))):s=!1},mouseout:()=>{s=!1}}}}if(h==="mouseleave"||h==="mouseout"){let s=!1;return{layers:e,listener:a,delegates:{mousemove:m=>{let y=e.filter(v=>this.getLayer(v));(y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[]).length?s=!0:s&&(s=!1,a.call(this,new Pi(h,this,m.originalEvent)))},mouseout:m=>{s&&(s=!1,a.call(this,new Pi(h,this,m.originalEvent)))}}}}{let s=o=>{let u=e.filter(y=>this.getLayer(y)),m=u.length!==0?this.queryRenderedFeatures(o.point,{layers:u}):[];m.length&&(o.features=m,a.call(this,o),delete o.features)};return{layers:e,listener:a,delegates:{[h]:s}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,a){if(!this._delegatedListeners||!this._delegatedListeners[h])return;let s=this._delegatedListeners[h];for(let o=0;o<s.length;o++){let u=s[o];if(u.listener===a&&u.layers.length===e.length&&u.layers.every(m=>e.includes(m))){for(let m in u.delegates)this.off(m,u.delegates[m]);return void s.splice(o,1)}}}on(h,e,a){if(a===void 0)return super.on(h,e);let s=this._createDelegatedListener(h,typeof e=="string"?[e]:e,a);this._saveDelegatedListener(h,s);for(let o in s.delegates)this.on(o,s.delegates[o]);return this}once(h,e,a){if(a===void 0)return super.once(h,e);let s=typeof e=="string"?[e]:e,o=this._createDelegatedListener(h,s,a);for(let u in o.delegates){let m=o.delegates[u];o.delegates[u]=(...y)=>{this._removeDelegatedListener(h,s,a),m(...y)}}this._saveDelegatedListener(h,o);for(let u in o.delegates)this.once(u,o.delegates[u]);return this}off(h,e,a){return a===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let a,s=h instanceof c.P||Array.isArray(h),o=s?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(s?{}:h)||{},o instanceof c.P||typeof o[0]=="number")a=[c.P.convert(o)];else{let u=c.P.convert(o[0]),m=c.P.convert(o[1]);a=[u,new c.P(m.x,u.y),m,new c.P(u.x,m.y),u]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){let e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));let a=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new cs(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,a):this.style.loadJSON(h,e,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new cs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){let a=this._requestManager.transformRequest(h,"Style");c.h(a,new AbortController).then(s=>{this._updateDiff(s.data,e)}).catch(s=>{s&&this.fire(new c.j(s))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(a){c.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){let e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){let e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(let a in this.style._layers){let s=this.style._layers[a];s.type==="hillshade"&&s.source===h.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qo(this.painter,e,h),this.painter.renderToTexture=new mc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==h.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let h=this.style&&this.style.sourceCaches;for(let e in h){let a=h[e]._tiles;for(let s in a){let o=a[s];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,e,a={}){let{pixelRatio:s=1,sdf:o=!1,stretchX:u,stretchY:m,content:y,textFitWidth:v,textFitHeight:A}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:C,height:D,data:L}=e,F=e;return this.style.addImage(h,{data:new c.R({width:C,height:D},new Uint8Array(L)),pixelRatio:s,stretchX:u,stretchY:m,content:y,textFitWidth:v,textFitHeight:A,sdf:o,version:0,userImage:F}),F.onAdd&&F.onAdd(this,h),this}}{let{width:C,height:D,data:L}=ne.getImageData(e);this.style.addImage(h,{data:new c.R({width:C,height:D},L),pixelRatio:s,stretchX:u,stretchY:m,content:y,textFitWidth:v,textFitHeight:A,sdf:o,version:0})}}updateImage(h,e){let a=this.style.getImage(h);if(!a)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let s=e instanceof HTMLImageElement||c.b(e)?ne.getImageData(e):e,{width:o,height:u,data:m}=s;if(o===void 0||u===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==a.data.width||u!==a.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let y=!(e instanceof HTMLImageElement||c.b(e));return a.data.replace(m,y),this.style.updateImage(h,a),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return yt.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,a){return this.style.setLayerZoomRange(h,e,a),this._update(!0)}setFilter(h,e,a={}){return this.style.setFilter(h,e,a),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,a,s={}){return this.style.setPaintProperty(h,e,a,s),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,a,s={}){return this.style.setLayoutProperty(h,e,a,s),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,a,s=>{s||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,a=>{a||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h){return this._lazyInitEmptyStyle(),this.style.setSky(h),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){let h=this._container;h.classList.add("maplibregl-map");let e=this._canvasContainer=$.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let a=this._containerDimensions(),s=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],s);let o=this._controlContainer=$.create("div","maplibregl-control-container",h),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{u[m]=$.create("div",`maplibregl-ctrl-${m} `,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,a){this._canvas.width=Math.floor(a*h),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let h={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},e=null;this._canvas.addEventListener("webglcontextcreationerror",s=>{e={requestedAttributes:h},s&&(e.statusMessage=s.statusMessage,e.type=s.type)},{once:!0});let a=this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h);if(!a){let s="Failed to initialize WebGL";throw e?(e.message=s,new Error(JSON.stringify(e))):new Error(s)}this.painter=new Es(a,this.transform),Re.testSupport(a)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let o=this.transform.zoom,u=ne.now();this.style.zoomHistory.update(o,u);let m=new c.z(o,{now:u,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),y=m.crossFadingFactor();y===1&&y===this._crossFadingFactor||(a=!0,this._crossFadingFactor=y),this.style.update(m)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let s=this._sourcesDirty||this._styleDirty||this._placementDirty;return s||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||s||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),yt.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(h=>{c.bf.frame(h),this._frameRequest=null,this._render(h)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return gc}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=Pi,w.MapTouchEvent=Ba,w.MapWheelEvent=cc,w.Marker=Rs,w.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{let e=this._map.getZoom(),a=e===this._map.getMaxZoom(),s=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,a)=>{let s=this._map._getUIString(`NavigationControl.${a}`);e.title=s,e.setAttribute("aria-label",s)},this.options=c.e({},zu,h),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){let a=$.create("button",h,this._container);return a.type="button",a.addEventListener("click",e),a}},w.Popup=class extends c.E{constructor(h){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Wt(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!e)return;let s=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let o=this.options.anchor,u=Os(this.options.offset);if(!o){let y=this._container.offsetWidth,v=this._container.offsetHeight,A;A=s.y+u.bottom.y<v?["top"]:s.y>this._map.transform.height-v?["bottom"]:[],s.x<y/2?A.push("left"):s.x>this._map.transform.width-y/2&&A.push("right"),o=A.length===0?"bottom":A.join("-")}let m=s.add(u[o]);this.options.subpixelPositioning||(m=m.round()),$.setTransform(this._container,`${mn[o]} translate(${m.x}px,${m.y}px)`),Bs(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(He),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=c.N.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let e=document.createDocumentFragment(),a=document.createElement("body"),s;for(a.innerHTML=h;s=a.firstChild,s;)e.appendChild(s);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(Fs);h&&h.focus()}},w.RasterDEMTileSource=Bt,w.RasterTileSource=ct,w.ScaleControl=class{constructor(h){this._onMove=()=>{Xn(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Xn(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xr),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=Or,w.Style=cs,w.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=un,w.TwoFingersTouchRotateHandler=Ho,w.TwoFingersTouchZoomHandler=Go,w.TwoFingersTouchZoomRotateHandler=Xo,w.VectorTileSource=Mr,w.VideoSource=Qr,w.addSourceType=(h,e)=>c._(void 0,void 0,void 0,function*(){if(Ea(h))throw new Error(`A source type called "${h}" already exists.`);((a,s)=>{ua[a]=s})(h,e)}),w.clearPrewarmedResources=function(){let h=lt;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(pt),lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return or().getRTLTextPluginStatus()},w.getVersion=function(){return il},w.getWorkerCount=function(){return Mt.workerCount},w.getWorkerUrl=function(){return c.a.WORKER_URL},w.importScriptInWorkers=function(h){return qt().broadcast("IS",h)},w.prewarm=function(){Ge().acquire(pt)},w.setMaxParallelImageRequests=function(h){c.a.MAX_PARALLEL_IMAGE_REQUESTS=h},w.setRTLTextPlugin=function(h,e){return or().setRTLTextPlugin(h,e)},w.setWorkerCount=function(h){Mt.workerCount=h},w.setWorkerUrl=function(h){c.a.WORKER_URL=h}});var z=_;return z})});var Cl=Dn(ao=>{"use strict";function Jg(_,b,E){if(E===void 0&&(E=Array.prototype),_&&typeof E.find=="function")return E.find.call(_,b);for(var z=0;z<_.length;z++)if(Object.prototype.hasOwnProperty.call(_,z)){var w=_[z];if(b.call(void 0,w,z,_))return w}}function Hh(_,b){return b===void 0&&(b=Object),b&&typeof b.freeze=="function"?b.freeze(_):_}function Yg(_,b){if(_===null||typeof _!="object")throw new TypeError("target is not an object");for(var E in b)Object.prototype.hasOwnProperty.call(b,E)&&(_[E]=b[E]);return _}var Gf=Hh({HTML:"text/html",isHTML:function(_){return _===Gf.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Zf=Hh({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(_){return _===Zf.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});ao.assign=Yg;ao.find=Jg;ao.freeze=Hh;ao.MIME_TYPE=Gf;ao.NAMESPACE=Zf});var ap=Dn(kn=>{var em=Cl(),wa=em.find,Dl=em.NAMESPACE;function Qg(_){return _!==""}function e1(_){return _?_.split(/[\t\n\f\r ]+/).filter(Qg):[]}function t1(_,b){return _.hasOwnProperty(b)||(_[b]=!0),_}function Hf(_){if(!_)return[];var b=e1(_);return Object.keys(b.reduce(t1,{}))}function i1(_){return function(b){return _&&_.indexOf(b)!==-1}}function kl(_,b){for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&(b[E]=_[E])}function Ir(_,b){var E=_.prototype;if(!(E instanceof b)){let w=function(){};var z=w;w.prototype=b.prototype,w=new w,kl(E,w),_.prototype=E=w}E.constructor!=_&&(typeof _!="function"&&console.error("unknown Class:"+_),E.constructor=_)}var kr={},ca=kr.ELEMENT_NODE=1,so=kr.ATTRIBUTE_NODE=2,Qc=kr.TEXT_NODE=3,tm=kr.CDATA_SECTION_NODE=4,im=kr.ENTITY_REFERENCE_NODE=5,r1=kr.ENTITY_NODE=6,rm=kr.PROCESSING_INSTRUCTION_NODE=7,am=kr.COMMENT_NODE=8,nm=kr.DOCUMENT_NODE=9,sm=kr.DOCUMENT_TYPE_NODE=10,Ga=kr.DOCUMENT_FRAGMENT_NODE=11,a1=kr.NOTATION_NODE=12,nr={},qi={},dy=nr.INDEX_SIZE_ERR=(qi[1]="Index size error",1),fy=nr.DOMSTRING_SIZE_ERR=(qi[2]="DOMString size error",2),Dr=nr.HIERARCHY_REQUEST_ERR=(qi[3]="Hierarchy request error",3),my=nr.WRONG_DOCUMENT_ERR=(qi[4]="Wrong document",4),gy=nr.INVALID_CHARACTER_ERR=(qi[5]="Invalid character",5),yy=nr.NO_DATA_ALLOWED_ERR=(qi[6]="No data allowed",6),_y=nr.NO_MODIFICATION_ALLOWED_ERR=(qi[7]="No modification allowed",7),om=nr.NOT_FOUND_ERR=(qi[8]="Not found",8),vy=nr.NOT_SUPPORTED_ERR=(qi[9]="Not supported",9),Wf=nr.INUSE_ATTRIBUTE_ERR=(qi[10]="Attribute in use",10),xy=nr.INVALID_STATE_ERR=(qi[11]="Invalid state",11),by=nr.SYNTAX_ERR=(qi[12]="Syntax error",12),wy=nr.INVALID_MODIFICATION_ERR=(qi[13]="Invalid modification",13),Sy=nr.NAMESPACE_ERR=(qi[14]="Invalid namespace",14),Ay=nr.INVALID_ACCESS_ERR=(qi[15]="Invalid access",15);function xi(_,b){if(b instanceof Error)var E=b;else E=this,Error.call(this,qi[_]),this.message=qi[_],Error.captureStackTrace&&Error.captureStackTrace(this,xi);return E.code=_,b&&(this.message=this.message+": "+b),E}xi.prototype=Error.prototype;kl(nr,xi);function $a(){}$a.prototype={length:0,item:function(_){return _>=0&&_<this.length?this[_]:null},toString:function(_,b){for(var E=[],z=0;z<this.length;z++)no(this[z],E,_,b);return E.join("")},filter:function(_){return Array.prototype.filter.call(this,_)},indexOf:function(_){return Array.prototype.indexOf.call(this,_)}};function oo(_,b){this._node=_,this._refresh=b,Kh(this)}function Kh(_){var b=_._node._inc||_._node.ownerDocument._inc;if(_._inc!==b){var E=_._refresh(_._node);if(vm(_,"length",E.length),!_.$$length||E.length<_.$$length)for(var z=E.length;z in _;z++)Object.prototype.hasOwnProperty.call(_,z)&&delete _[z];kl(E,_),_._inc=b}}oo.prototype.item=function(_){return Kh(this),this[_]||null};Ir(oo,$a);function eu(){}function lm(_,b){for(var E=_.length;E--;)if(_[E]===b)return E}function Xf(_,b,E,z){if(z?b[lm(b,z)]=E:b[b.length++]=E,_){E.ownerElement=_;var w=_.ownerDocument;w&&(z&&hm(w,_,z),n1(w,_,E))}}function Kf(_,b,E){var z=lm(b,E);if(z>=0){for(var w=b.length-1;z<w;)b[z]=b[++z];if(b.length=w,_){var c=_.ownerDocument;c&&(hm(c,_,E),E.ownerElement=null)}}else throw new xi(om,new Error(_.tagName+"@"+E))}eu.prototype={length:0,item:$a.prototype.item,getNamedItem:function(_){for(var b=this.length;b--;){var E=this[b];if(E.nodeName==_)return E}},setNamedItem:function(_){var b=_.ownerElement;if(b&&b!=this._ownerElement)throw new xi(Wf);var E=this.getNamedItem(_.nodeName);return Xf(this._ownerElement,this,_,E),E},setNamedItemNS:function(_){var b=_.ownerElement,E;if(b&&b!=this._ownerElement)throw new xi(Wf);return E=this.getNamedItemNS(_.namespaceURI,_.localName),Xf(this._ownerElement,this,_,E),E},removeNamedItem:function(_){var b=this.getNamedItem(_);return Kf(this._ownerElement,this,b),b},removeNamedItemNS:function(_,b){var E=this.getNamedItemNS(_,b);return Kf(this._ownerElement,this,E),E},getNamedItemNS:function(_,b){for(var E=this.length;E--;){var z=this[E];if(z.localName==b&&z.namespaceURI==_)return z}return null}};function cm(){}cm.prototype={hasFeature:function(_,b){return!0},createDocument:function(_,b,E){var z=new Ml;if(z.implementation=this,z.childNodes=new $a,z.doctype=E||null,E&&z.appendChild(E),b){var w=z.createElementNS(_,b);z.appendChild(w)}return z},createDocumentType:function(_,b,E){var z=new ru;return z.name=_,z.nodeName=_,z.publicId=b||"",z.systemId=E||"",z}};function Zt(){}Zt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(_,b){return tu(this,_,b)},replaceChild:function(_,b){tu(this,_,b,dm),b&&this.removeChild(b)},removeChild:function(_){return pm(this,_)},appendChild:function(_){return this.insertBefore(_,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(_){return Xh(this.ownerDocument||this,this,_)},normalize:function(){for(var _=this.firstChild;_;){var b=_.nextSibling;b&&b.nodeType==Qc&&_.nodeType==Qc?(this.removeChild(b),_.appendData(b.data)):(_.normalize(),_=b)}},isSupported:function(_,b){return this.ownerDocument.implementation.hasFeature(_,b)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(_){for(var b=this;b;){var E=b._nsMap;if(E){for(var z in E)if(Object.prototype.hasOwnProperty.call(E,z)&&E[z]===_)return z}b=b.nodeType==so?b.ownerDocument:b.parentNode}return null},lookupNamespaceURI:function(_){for(var b=this;b;){var E=b._nsMap;if(E&&Object.prototype.hasOwnProperty.call(E,_))return E[_];b=b.nodeType==so?b.ownerDocument:b.parentNode}return null},isDefaultNamespace:function(_){var b=this.lookupPrefix(_);return b==null}};function um(_){return _=="<"&&"&lt;"||_==">"&&"&gt;"||_=="&"&&"&amp;"||_=='"'&&"&quot;"||"&#"+_.charCodeAt()+";"}kl(kr,Zt);kl(kr,Zt.prototype);function Il(_,b){if(b(_))return!0;if(_=_.firstChild)do if(Il(_,b))return!0;while(_=_.nextSibling)}function Ml(){this.ownerDocument=this}function n1(_,b,E){_&&_._inc++;var z=E.namespaceURI;z===Dl.XMLNS&&(b._nsMap[E.prefix?E.localName:""]=E.value)}function hm(_,b,E,z){_&&_._inc++;var w=E.namespaceURI;w===Dl.XMLNS&&delete b._nsMap[E.prefix?E.localName:""]}function Jh(_,b,E){if(_&&_._inc){_._inc++;var z=b.childNodes;if(E)z[z.length++]=E;else{for(var w=b.firstChild,c=0;w;)z[c++]=w,w=w.nextSibling;z.length=c,delete z[z.length]}}}function pm(_,b){var E=b.previousSibling,z=b.nextSibling;return E?E.nextSibling=z:_.firstChild=z,z?z.previousSibling=E:_.lastChild=E,b.parentNode=null,b.previousSibling=null,b.nextSibling=null,Jh(_.ownerDocument,_),b}function s1(_){return _&&(_.nodeType===Zt.DOCUMENT_NODE||_.nodeType===Zt.DOCUMENT_FRAGMENT_NODE||_.nodeType===Zt.ELEMENT_NODE)}function o1(_){return _&&(Sa(_)||Yh(_)||Za(_)||_.nodeType===Zt.DOCUMENT_FRAGMENT_NODE||_.nodeType===Zt.COMMENT_NODE||_.nodeType===Zt.PROCESSING_INSTRUCTION_NODE)}function Za(_){return _&&_.nodeType===Zt.DOCUMENT_TYPE_NODE}function Sa(_){return _&&_.nodeType===Zt.ELEMENT_NODE}function Yh(_){return _&&_.nodeType===Zt.TEXT_NODE}function Jf(_,b){var E=_.childNodes||[];if(wa(E,Sa)||Za(b))return!1;var z=wa(E,Za);return!(b&&z&&E.indexOf(z)>E.indexOf(b))}function Yf(_,b){var E=_.childNodes||[];function z(c){return Sa(c)&&c!==b}if(wa(E,z))return!1;var w=wa(E,Za);return!(b&&w&&E.indexOf(w)>E.indexOf(b))}function l1(_,b,E){if(!s1(_))throw new xi(Dr,"Unexpected parent node type "+_.nodeType);if(E&&E.parentNode!==_)throw new xi(om,"child not in parent");if(!o1(b)||Za(b)&&_.nodeType!==Zt.DOCUMENT_NODE)throw new xi(Dr,"Unexpected node type "+b.nodeType+" for parent node type "+_.nodeType)}function c1(_,b,E){var z=_.childNodes||[],w=b.childNodes||[];if(b.nodeType===Zt.DOCUMENT_FRAGMENT_NODE){var c=w.filter(Sa);if(c.length>1||wa(w,Yh))throw new xi(Dr,"More than one element or text in fragment");if(c.length===1&&!Jf(_,E))throw new xi(Dr,"Element in fragment can not be inserted before doctype")}if(Sa(b)&&!Jf(_,E))throw new xi(Dr,"Only one element can be added and only after doctype");if(Za(b)){if(wa(z,Za))throw new xi(Dr,"Only one doctype is allowed");var Q=wa(z,Sa);if(E&&z.indexOf(Q)<z.indexOf(E))throw new xi(Dr,"Doctype can only be inserted before an element");if(!E&&Q)throw new xi(Dr,"Doctype can not be appended since element is present")}}function dm(_,b,E){var z=_.childNodes||[],w=b.childNodes||[];if(b.nodeType===Zt.DOCUMENT_FRAGMENT_NODE){var c=w.filter(Sa);if(c.length>1||wa(w,Yh))throw new xi(Dr,"More than one element or text in fragment");if(c.length===1&&!Yf(_,E))throw new xi(Dr,"Element in fragment can not be inserted before doctype")}if(Sa(b)&&!Yf(_,E))throw new xi(Dr,"Only one element can be added and only after doctype");if(Za(b)){let de=function(ne){return Za(ne)&&ne!==E};var ee=de;if(wa(z,de))throw new xi(Dr,"Only one doctype is allowed");var Q=wa(z,Sa);if(E&&z.indexOf(Q)<z.indexOf(E))throw new xi(Dr,"Doctype can only be inserted before an element")}}function tu(_,b,E,z){l1(_,b,E),_.nodeType===Zt.DOCUMENT_NODE&&(z||c1)(_,b,E);var w=b.parentNode;if(w&&w.removeChild(b),b.nodeType===Ga){var c=b.firstChild;if(c==null)return b;var Q=b.lastChild}else c=Q=b;var ee=E?E.previousSibling:_.lastChild;c.previousSibling=ee,Q.nextSibling=E,ee?ee.nextSibling=c:_.firstChild=c,E==null?_.lastChild=Q:E.previousSibling=Q;do c.parentNode=_;while(c!==Q&&(c=c.nextSibling));return Jh(_.ownerDocument||_,_),b.nodeType==Ga&&(b.firstChild=b.lastChild=null),b}function u1(_,b){return b.parentNode&&b.parentNode.removeChild(b),b.parentNode=_,b.previousSibling=_.lastChild,b.nextSibling=null,b.previousSibling?b.previousSibling.nextSibling=b:_.firstChild=b,_.lastChild=b,Jh(_.ownerDocument,_,b),b}Ml.prototype={nodeName:"#document",nodeType:nm,doctype:null,documentElement:null,_inc:1,insertBefore:function(_,b){if(_.nodeType==Ga){for(var E=_.firstChild;E;){var z=E.nextSibling;this.insertBefore(E,b),E=z}return _}return tu(this,_,b),_.ownerDocument=this,this.documentElement===null&&_.nodeType===ca&&(this.documentElement=_),_},removeChild:function(_){return this.documentElement==_&&(this.documentElement=null),pm(this,_)},replaceChild:function(_,b){tu(this,_,b,dm),_.ownerDocument=this,b&&this.removeChild(b),Sa(_)&&(this.documentElement=_)},importNode:function(_,b){return _m(this,_,b)},getElementById:function(_){var b=null;return Il(this.documentElement,function(E){if(E.nodeType==ca&&E.getAttribute("id")==_)return b=E,!0}),b},getElementsByClassName:function(_){var b=Hf(_);return new oo(this,function(E){var z=[];return b.length>0&&Il(E.documentElement,function(w){if(w!==E&&w.nodeType===ca){var c=w.getAttribute("class");if(c){var Q=_===c;if(!Q){var ee=Hf(c);Q=b.every(i1(ee))}Q&&z.push(w)}}}),z})},createElement:function(_){var b=new os;b.ownerDocument=this,b.nodeName=_,b.tagName=_,b.localName=_,b.childNodes=new $a;var E=b.attributes=new eu;return E._ownerElement=b,b},createDocumentFragment:function(){var _=new au;return _.ownerDocument=this,_.childNodes=new $a,_},createTextNode:function(_){var b=new Qh;return b.ownerDocument=this,b.appendData(_),b},createComment:function(_){var b=new ep;return b.ownerDocument=this,b.appendData(_),b},createCDATASection:function(_){var b=new tp;return b.ownerDocument=this,b.appendData(_),b},createProcessingInstruction:function(_,b){var E=new rp;return E.ownerDocument=this,E.tagName=E.nodeName=E.target=_,E.nodeValue=E.data=b,E},createAttribute:function(_){var b=new iu;return b.ownerDocument=this,b.name=_,b.nodeName=_,b.localName=_,b.specified=!0,b},createEntityReference:function(_){var b=new ip;return b.ownerDocument=this,b.nodeName=_,b},createElementNS:function(_,b){var E=new os,z=b.split(":"),w=E.attributes=new eu;return E.childNodes=new $a,E.ownerDocument=this,E.nodeName=b,E.tagName=b,E.namespaceURI=_,z.length==2?(E.prefix=z[0],E.localName=z[1]):E.localName=b,w._ownerElement=E,E},createAttributeNS:function(_,b){var E=new iu,z=b.split(":");return E.ownerDocument=this,E.nodeName=b,E.name=b,E.namespaceURI=_,E.specified=!0,z.length==2?(E.prefix=z[0],E.localName=z[1]):E.localName=b,E}};Ir(Ml,Zt);function os(){this._nsMap={}}os.prototype={nodeType:ca,hasAttribute:function(_){return this.getAttributeNode(_)!=null},getAttribute:function(_){var b=this.getAttributeNode(_);return b&&b.value||""},getAttributeNode:function(_){return this.attributes.getNamedItem(_)},setAttribute:function(_,b){var E=this.ownerDocument.createAttribute(_);E.value=E.nodeValue=""+b,this.setAttributeNode(E)},removeAttribute:function(_){var b=this.getAttributeNode(_);b&&this.removeAttributeNode(b)},appendChild:function(_){return _.nodeType===Ga?this.insertBefore(_,null):u1(this,_)},setAttributeNode:function(_){return this.attributes.setNamedItem(_)},setAttributeNodeNS:function(_){return this.attributes.setNamedItemNS(_)},removeAttributeNode:function(_){return this.attributes.removeNamedItem(_.nodeName)},removeAttributeNS:function(_,b){var E=this.getAttributeNodeNS(_,b);E&&this.removeAttributeNode(E)},hasAttributeNS:function(_,b){return this.getAttributeNodeNS(_,b)!=null},getAttributeNS:function(_,b){var E=this.getAttributeNodeNS(_,b);return E&&E.value||""},setAttributeNS:function(_,b,E){var z=this.ownerDocument.createAttributeNS(_,b);z.value=z.nodeValue=""+E,this.setAttributeNode(z)},getAttributeNodeNS:function(_,b){return this.attributes.getNamedItemNS(_,b)},getElementsByTagName:function(_){return new oo(this,function(b){var E=[];return Il(b,function(z){z!==b&&z.nodeType==ca&&(_==="*"||z.tagName==_)&&E.push(z)}),E})},getElementsByTagNameNS:function(_,b){return new oo(this,function(E){var z=[];return Il(E,function(w){w!==E&&w.nodeType===ca&&(_==="*"||w.namespaceURI===_)&&(b==="*"||w.localName==b)&&z.push(w)}),z})}};Ml.prototype.getElementsByTagName=os.prototype.getElementsByTagName;Ml.prototype.getElementsByTagNameNS=os.prototype.getElementsByTagNameNS;Ir(os,Zt);function iu(){}iu.prototype.nodeType=so;Ir(iu,Zt);function Pl(){}Pl.prototype={data:"",substringData:function(_,b){return this.data.substring(_,_+b)},appendData:function(_){_=this.data+_,this.nodeValue=this.data=_,this.length=_.length},insertData:function(_,b){this.replaceData(_,0,b)},appendChild:function(_){throw new Error(qi[Dr])},deleteData:function(_,b){this.replaceData(_,b,"")},replaceData:function(_,b,E){var z=this.data.substring(0,_),w=this.data.substring(_+b);E=z+E+w,this.nodeValue=this.data=E,this.length=E.length}};Ir(Pl,Zt);function Qh(){}Qh.prototype={nodeName:"#text",nodeType:Qc,splitText:function(_){var b=this.data,E=b.substring(_);b=b.substring(0,_),this.data=this.nodeValue=b,this.length=b.length;var z=this.ownerDocument.createTextNode(E);return this.parentNode&&this.parentNode.insertBefore(z,this.nextSibling),z}};Ir(Qh,Pl);function ep(){}ep.prototype={nodeName:"#comment",nodeType:am};Ir(ep,Pl);function tp(){}tp.prototype={nodeName:"#cdata-section",nodeType:tm};Ir(tp,Pl);function ru(){}ru.prototype.nodeType=sm;Ir(ru,Zt);function fm(){}fm.prototype.nodeType=a1;Ir(fm,Zt);function mm(){}mm.prototype.nodeType=r1;Ir(mm,Zt);function ip(){}ip.prototype.nodeType=im;Ir(ip,Zt);function au(){}au.prototype.nodeName="#document-fragment";au.prototype.nodeType=Ga;Ir(au,Zt);function rp(){}rp.prototype.nodeType=rm;Ir(rp,Zt);function gm(){}gm.prototype.serializeToString=function(_,b,E){return ym.call(_,b,E)};Zt.prototype.toString=ym;function ym(_,b){var E=[],z=this.nodeType==9&&this.documentElement||this,w=z.prefix,c=z.namespaceURI;if(c&&w==null){var w=z.lookupPrefix(c);if(w==null)var Q=[{namespace:c,prefix:null}]}return no(this,E,_,b,Q),E.join("")}function Qf(_,b,E){var z=_.prefix||"",w=_.namespaceURI;if(!w||z==="xml"&&w===Dl.XML||w===Dl.XMLNS)return!1;for(var c=E.length;c--;){var Q=E[c];if(Q.prefix===z)return Q.namespace!==w}return!0}function Wh(_,b,E){_.push(" ",b,'="',E.replace(/[<>&"\t\n\r]/g,um),'"')}function no(_,b,E,z,w){if(w||(w=[]),z)if(_=z(_),_){if(typeof _=="string"){b.push(_);return}}else return;switch(_.nodeType){case ca:var c=_.attributes,Q=c.length,yt=_.firstChild,ee=_.tagName;E=Dl.isHTML(_.namespaceURI)||E;var de=ee;if(!E&&!_.prefix&&_.namespaceURI){for(var ne,$=0;$<c.length;$++)if(c.item($).name==="xmlns"){ne=c.item($).value;break}if(!ne)for(var Re=w.length-1;Re>=0;Re--){var Xe=w[Re];if(Xe.prefix===""&&Xe.namespace===_.namespaceURI){ne=Xe.namespace;break}}if(ne!==_.namespaceURI)for(var Re=w.length-1;Re>=0;Re--){var Xe=w[Re];if(Xe.namespace===_.namespaceURI){Xe.prefix&&(de=Xe.prefix+":"+ee);break}}}b.push("<",de);for(var ot=0;ot<Q;ot++){var St=c.item(ot);St.prefix=="xmlns"?w.push({prefix:St.localName,namespace:St.value}):St.nodeName=="xmlns"&&w.push({prefix:"",namespace:St.value})}for(var ot=0;ot<Q;ot++){var St=c.item(ot);if(Qf(St,E,w)){var xt=St.prefix||"",Tt=St.namespaceURI;Wh(b,xt?"xmlns:"+xt:"xmlns",Tt),w.push({prefix:xt,namespace:Tt})}no(St,b,E,z,w)}if(ee===de&&Qf(_,E,w)){var xt=_.prefix||"",Tt=_.namespaceURI;Wh(b,xt?"xmlns:"+xt:"xmlns",Tt),w.push({prefix:xt,namespace:Tt})}if(yt||E&&!/^(?:meta|link|img|br|hr|input)$/i.test(ee)){if(b.push(">"),E&&/^script$/i.test(ee))for(;yt;)yt.data?b.push(yt.data):no(yt,b,E,z,w.slice()),yt=yt.nextSibling;else for(;yt;)no(yt,b,E,z,w.slice()),yt=yt.nextSibling;b.push("</",de,">")}else b.push("/>");return;case nm:case Ga:for(var yt=_.firstChild;yt;)no(yt,b,E,z,w.slice()),yt=yt.nextSibling;return;case so:return Wh(b,_.name,_.value);case Qc:return b.push(_.data.replace(/[<&>]/g,um));case tm:return b.push("<![CDATA[",_.data,"]]>");case am:return b.push("<!--",_.data,"-->");case sm:var yr=_.publicId,dt=_.systemId;if(b.push("<!DOCTYPE ",_.name),yr)b.push(" PUBLIC ",yr),dt&&dt!="."&&b.push(" ",dt),b.push(">");else if(dt&&dt!=".")b.push(" SYSTEM ",dt,">");else{var Ht=_.internalSubset;Ht&&b.push(" [",Ht,"]"),b.push(">")}return;case rm:return b.push("<?",_.target," ",_.data,"?>");case im:return b.push("&",_.nodeName,";");default:b.push("??",_.nodeName)}}function _m(_,b,E){var z;switch(b.nodeType){case ca:z=b.cloneNode(!1),z.ownerDocument=_;case Ga:break;case so:E=!0;break}if(z||(z=b.cloneNode(!1)),z.ownerDocument=_,z.parentNode=null,E)for(var w=b.firstChild;w;)z.appendChild(_m(_,w,E)),w=w.nextSibling;return z}function Xh(_,b,E){var z=new b.constructor;for(var w in b)if(Object.prototype.hasOwnProperty.call(b,w)){var c=b[w];typeof c!="object"&&c!=z[w]&&(z[w]=c)}switch(b.childNodes&&(z.childNodes=new $a),z.ownerDocument=_,z.nodeType){case ca:var Q=b.attributes,ee=z.attributes=new eu,de=Q.length;ee._ownerElement=z;for(var ne=0;ne<de;ne++)z.setAttributeNode(Xh(_,Q.item(ne),!0));break;case so:E=!0}if(E)for(var $=b.firstChild;$;)z.appendChild(Xh(_,$,E)),$=$.nextSibling;return z}function vm(_,b,E){_[b]=E}try{if(Object.defineProperty){let _=function(b){switch(b.nodeType){case ca:case Ga:var E=[];for(b=b.firstChild;b;)b.nodeType!==7&&b.nodeType!==8&&E.push(_(b)),b=b.nextSibling;return E.join("");default:return b.nodeValue}};h1=_,Object.defineProperty(oo.prototype,"length",{get:function(){return Kh(this),this.$$length}}),Object.defineProperty(Zt.prototype,"textContent",{get:function(){return _(this)},set:function(b){switch(this.nodeType){case ca:case Ga:for(;this.firstChild;)this.removeChild(this.firstChild);(b||String(b))&&this.appendChild(this.ownerDocument.createTextNode(b));break;default:this.data=b,this.value=b,this.nodeValue=b}}}),vm=function(b,E,z){b["$$"+E]=z}}}catch{}var h1;kn.DocumentType=ru;kn.DOMException=xi;kn.DOMImplementation=cm;kn.Element=os;kn.Node=Zt;kn.NodeList=$a;kn.XMLSerializer=gm});var bm=Dn(zl=>{"use strict";var xm=Cl().freeze;zl.XML_ENTITIES=xm({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'});zl.HTML_ENTITIES=xm({Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",AMP:"&",amp:"&",And:"\u2A53",and:"\u2227",andand:"\u2A55",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",ap:"\u2248",apacir:"\u2A6F",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",Barwed:"\u2306",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",Because:"\u2235",because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxDL:"\u2557",boxDl:"\u2556",boxdL:"\u2555",boxdl:"\u2510",boxDR:"\u2554",boxDr:"\u2553",boxdR:"\u2552",boxdr:"\u250C",boxH:"\u2550",boxh:"\u2500",boxHD:"\u2566",boxHd:"\u2564",boxhD:"\u2565",boxhd:"\u252C",boxHU:"\u2569",boxHu:"\u2567",boxhU:"\u2568",boxhu:"\u2534",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxUL:"\u255D",boxUl:"\u255C",boxuL:"\u255B",boxul:"\u2518",boxUR:"\u255A",boxUr:"\u2559",boxuR:"\u2558",boxur:"\u2514",boxV:"\u2551",boxv:"\u2502",boxVH:"\u256C",boxVh:"\u256B",boxvH:"\u256A",boxvh:"\u253C",boxVL:"\u2563",boxVl:"\u2562",boxvL:"\u2561",boxvl:"\u2524",boxVR:"\u2560",boxVr:"\u255F",boxvR:"\u255E",boxvr:"\u251C",bprime:"\u2035",Breve:"\u02D8",breve:"\u02D8",brvbar:"\xA6",Bscr:"\u212C",bscr:"\u{1D4B7}",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsol:"\\",bsolb:"\u29C5",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",Cap:"\u22D2",cap:"\u2229",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",CenterDot:"\xB7",centerdot:"\xB7",Cfr:"\u212D",cfr:"\u{1D520}",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",cir:"\u25CB",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",Colon:"\u2237",colon:":",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",Conint:"\u222F",conint:"\u222E",ContourIntegral:"\u222E",Copf:"\u2102",copf:"\u{1D554}",coprod:"\u2210",Coproduct:"\u2210",COPY:"\xA9",copy:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",Cross:"\u2A2F",cross:"\u2717",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",Cup:"\u22D3",cup:"\u222A",cupbrcap:"\u2A48",CupCap:"\u224D",cupcap:"\u2A46",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",Dagger:"\u2021",dagger:"\u2020",daleth:"\u2138",Darr:"\u21A1",dArr:"\u21D3",darr:"\u2193",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",DD:"\u2145",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21CA",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",Diamond:"\u22C4",diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",Downarrow:"\u21D3",downarrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVector:"\u21BD",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295F",DownRightVector:"\u21C1",DownRightVectorBar:"\u2957",DownTee:"\u22A4",DownTeeArrow:"\u21A7",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",ecir:"\u2256",Ecirc:"\xCA",ecirc:"\xEA",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",eDot:"\u2251",edot:"\u0117",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",Escr:"\u2130",escr:"\u212F",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",ExponentialE:"\u2147",exponentiale:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",ForAll:"\u2200",forall:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",Fscr:"\u2131",fscr:"\u{1D4BB}",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",gE:"\u2267",ge:"\u2265",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",ges:"\u2A7E",gescc:"\u2AA9",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",Gg:"\u22D9",gg:"\u226B",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gl:"\u2277",gla:"\u2AA5",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gnE:"\u2269",gne:"\u2A88",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",Gt:"\u226B",GT:">",gt:">",gtcc:"\u2AA7",gtcir:"\u2A7A",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",hArr:"\u21D4",harr:"\u2194",harrcir:"\u2948",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",Hfr:"\u210C",hfr:"\u{1D525}",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",Hopf:"\u210D",hopf:"\u{1D559}",horbar:"\u2015",HorizontalLine:"\u2500",Hscr:"\u210B",hscr:"\u{1D4BD}",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",Ifr:"\u2111",ifr:"\u{1D526}",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Im:"\u2111",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",in:"\u2208",incare:"\u2105",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",Int:"\u222C",int:"\u222B",intcal:"\u22BA",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",Iscr:"\u2110",iscr:"\u{1D4BE}",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",Lang:"\u27EA",lang:"\u27E8",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",Larr:"\u219E",lArr:"\u21D0",larr:"\u2190",larrb:"\u21E4",larrbfs:"\u291F",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",lat:"\u2AAB",lAtail:"\u291B",latail:"\u2919",late:"\u2AAD",lates:"\u2AAD\uFE00",lBarr:"\u290E",lbarr:"\u290C",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",lE:"\u2266",le:"\u2264",LeftAngleBracket:"\u27E8",LeftArrow:"\u2190",Leftarrow:"\u21D0",leftarrow:"\u2190",LeftArrowBar:"\u21E4",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21C3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrow:"\u2194",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTee:"\u22A3",LeftTeeArrow:"\u21A4",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangle:"\u22B2",LeftTriangleBar:"\u29CF",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21BF",LeftUpVectorBar:"\u2958",LeftVector:"\u21BC",LeftVectorBar:"\u2952",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",les:"\u2A7D",lescc:"\u2AA8",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",Ll:"\u22D8",ll:"\u226A",llarr:"\u21C7",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoust:"\u23B0",lmoustache:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lnE:"\u2268",lne:"\u2A87",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftarrow:"\u27F5",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longleftrightarrow:"\u27F7",longmapsto:"\u27FC",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",longrightarrow:"\u27F6",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",Lscr:"\u2112",lscr:"\u{1D4C1}",Lsh:"\u21B0",lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",Lt:"\u226A",LT:"<",lt:"<",ltcc:"\u2AA6",ltcir:"\u2A79",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",mid:"\u2223",midast:"*",midcir:"\u2AF0",middot:"\xB7",minus:"\u2212",minusb:"\u229F",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",Mscr:"\u2133",mscr:"\u{1D4C2}",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266E",natural:"\u266E",naturals:"\u2115",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",ne:"\u2260",nearhk:"\u2924",neArr:"\u21D7",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nhArr:"\u21CE",nharr:"\u21AE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlArr:"\u21CD",nlarr:"\u219A",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nLeftarrow:"\u21CD",nleftarrow:"\u219A",nLeftrightarrow:"\u21CE",nleftrightarrow:"\u21AE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",Nopf:"\u2115",nopf:"\u{1D55F}",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangle:"\u22EA",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangle:"\u22EB",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",npre:"\u2AAF\u0338",nprec:"\u2280",npreceq:"\u2AAF\u0338",nrArr:"\u21CF",nrarr:"\u219B",nrarrc:"\u2933\u0338",nrarrw:"\u219D\u0338",nRightarrow:"\u21CF",nrightarrow:"\u219B",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nVDash:"\u22AF",nVdash:"\u22AE",nvDash:"\u22AD",nvdash:"\u22AC",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwArr:"\u21D6",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",ocir:"\u229A",Ocirc:"\xD4",ocirc:"\xF4",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",Or:"\u2A54",or:"\u2228",orarr:"\u21BB",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",Otimes:"\u2A37",otimes:"\u2297",otimesas:"\u2A36",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",par:"\u2225",para:"\xB6",parallel:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plus:"+",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",Popf:"\u2119",popf:"\u{1D561}",pound:"\xA3",Pr:"\u2ABB",pr:"\u227A",prap:"\u2AB7",prcue:"\u227C",prE:"\u2AB3",pre:"\u2AAF",prec:"\u227A",precapprox:"\u2AB7",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",precsim:"\u227E",Prime:"\u2033",prime:"\u2032",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportion:"\u2237",Proportional:"\u221D",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",Qopf:"\u211A",qopf:"\u{1D562}",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",QUOT:'"',quot:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",Rang:"\u27EB",rang:"\u27E9",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",Rarr:"\u21A0",rArr:"\u21D2",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",rAtail:"\u291C",ratail:"\u291A",ratio:"\u2236",rationals:"\u211A",RBarr:"\u2910",rBarr:"\u290F",rbarr:"\u290D",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",Re:"\u211C",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",rect:"\u25AD",REG:"\xAE",reg:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",Rfr:"\u211C",rfr:"\u{1D52F}",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrow:"\u2192",Rightarrow:"\u21D2",rightarrow:"\u2192",RightArrowBar:"\u21E5",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVector:"\u21C2",RightDownVectorBar:"\u2955",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTee:"\u22A2",RightTeeArrow:"\u21A6",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangle:"\u22B3",RightTriangleBar:"\u29D0",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVector:"\u21BE",RightUpVectorBar:"\u2954",RightVector:"\u21C0",RightVectorBar:"\u2953",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoust:"\u23B1",rmoustache:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",Ropf:"\u211D",ropf:"\u{1D563}",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",Rscr:"\u211B",rscr:"\u{1D4C7}",Rsh:"\u21B1",rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",Sc:"\u2ABC",sc:"\u227B",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",sccue:"\u227D",scE:"\u2AB4",sce:"\u2AB0",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdot:"\u22C5",sdotb:"\u22A1",sdote:"\u2A66",searhk:"\u2925",seArr:"\u21D8",searr:"\u2198",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",sol:"/",solb:"\u29C4",solbar:"\u233F",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25A1",Square:"\u25A1",square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",Sub:"\u22D0",sub:"\u2282",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",Subset:"\u22D0",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succ:"\u227B",succapprox:"\u2AB8",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",Sum:"\u2211",sum:"\u2211",sung:"\u266A",Sup:"\u22D1",sup:"\u2283",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",Supset:"\u22D1",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swArr:"\u21D9",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",Therefore:"\u2234",therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",thinsp:"\u2009",ThinSpace:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",Tilde:"\u223C",tilde:"\u02DC",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",times:"\xD7",timesb:"\u22A0",timesbar:"\u2A31",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",top:"\u22A4",topbot:"\u2336",topcir:"\u2AF1",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",TRADE:"\u2122",trade:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",Uarr:"\u219F",uArr:"\u21D1",uarr:"\u2191",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrow:"\u2191",Uparrow:"\u21D1",uparrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21C5",UpDownArrow:"\u2195",Updownarrow:"\u21D5",updownarrow:"\u2195",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03D2",upsi:"\u03C5",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTee:"\u22A5",UpTeeArrow:"\u21A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",vArr:"\u21D5",varr:"\u2195",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",Vbar:"\u2AEB",vBar:"\u2AE8",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",VDash:"\u22AB",Vdash:"\u22A9",vDash:"\u22A8",vdash:"\u22A2",Vdashl:"\u2AE6",Vee:"\u22C1",vee:"\u2228",veebar:"\u22BB",veeeq:"\u225A",vellip:"\u22EE",Verbar:"\u2016",verbar:"|",Vert:"\u2016",vert:"|",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",Wedge:"\u22C0",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xhArr:"\u27FA",xharr:"\u27F7",Xi:"\u039E",xi:"\u03BE",xlArr:"\u27F8",xlarr:"\u27F5",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrArr:"\u27F9",xrarr:"\u27F6",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",Yuml:"\u0178",yuml:"\xFF",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",Zfr:"\u2128",zfr:"\u{1D537}",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",Zopf:"\u2124",zopf:"\u{1D56B}",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"});zl.entityMap=zl.HTML_ENTITIES});var Im=Dn(sp=>{var Fl=Cl().NAMESPACE,np=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,wm=new RegExp("[\\-\\.0-9"+np.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),Sm=new RegExp("^"+np.source+wm.source+"*(?::"+np.source+wm.source+"*)?$"),Ll=0,Mn=1,lo=2,Bl=3,co=4,uo=5,Rl=6,nu=7;function ho(_,b){this.message=_,this.locator=b,Error.captureStackTrace&&Error.captureStackTrace(this,ho)}ho.prototype=new Error;ho.prototype.name=ho.name;function Tm(){}Tm.prototype={parse:function(_,b,E){var z=this.domBuilder;z.startDocument(),Cm(b,b={}),p1(_,b,E,z,this.errorHandler),z.endDocument()}};function p1(_,b,E,z,w){function c(kt){if(kt>65535){kt-=65536;var Lt=55296+(kt>>10),wi=56320+(kt&1023);return String.fromCharCode(Lt,wi)}else return String.fromCharCode(kt)}function Q(kt){var Lt=kt.slice(1,-1);return Object.hasOwnProperty.call(E,Lt)?E[Lt]:Lt.charAt(0)==="#"?c(parseInt(Lt.substr(1).replace("x","0x"))):(w.error("entity not found:"+kt),kt)}function ee(kt){if(kt>xt){var Lt=_.substring(xt,kt).replace(/&#?\w+;/g,Q);Xe&&de(xt),z.characters(Lt,0,kt-xt),xt=kt}}function de(kt,Lt){for(;kt>=$&&(Lt=Re.exec(_));)ne=Lt.index,$=ne+Lt[0].length,Xe.lineNumber++;Xe.columnNumber=kt-ne+1}for(var ne=0,$=0,Re=/.*(?:\r\n?|\n)|.*$/g,Xe=z.locator,ot=[{currentNSMap:b}],St={},xt=0;;){try{var Tt=_.indexOf("<",xt);if(Tt<0){if(!_.substr(xt).match(/^\s*$/)){var yt=z.doc,yr=yt.createTextNode(_.substr(xt));yt.appendChild(yr),z.currentElement=yr}return}switch(Tt>xt&&ee(Tt),_.charAt(Tt+1)){case"/":var et=_.indexOf(">",Tt+3),dt=_.substring(Tt+2,et).replace(/[ \t\n\r]+$/g,""),Ht=ot.pop();et<0?(dt=_.substring(Tt+2).replace(/[\s<].*/,""),w.error("end tag name: "+dt+" is not complete:"+Ht.tagName),et=Tt+1+dt.length):dt.match(/\s</)&&(dt=dt.replace(/[\s<].*/,""),w.error("end tag name: "+dt+" maybe not complete"),et=Tt+1+dt.length);var bi=Ht.localNSMap,Ue=Ht.tagName==dt,je=Ue||Ht.tagName&&Ht.tagName.toLowerCase()==dt.toLowerCase();if(je){if(z.endElement(Ht.uri,Ht.localName,dt),bi)for(var ht in bi)Object.prototype.hasOwnProperty.call(bi,ht)&&z.endPrefixMapping(ht);Ue||w.fatalError("end tag name: "+dt+" is not match the current start tagName:"+Ht.tagName)}else ot.push(Ht);et++;break;case"?":Xe&&de(Tt),et=y1(_,Tt,z);break;case"!":Xe&&de(Tt),et=g1(_,Tt,z,w);break;default:Xe&&de(Tt);var Ve=new Dm,Qt=ot[ot.length-1].currentNSMap,et=d1(_,Tt,Ve,Qt,Q,w),Nt=Ve.length;if(!Ve.closed&&m1(_,et,Ve.tagName,St)&&(Ve.closed=!0,E.nbsp||w.warning("unclosed xml attribute")),Xe&&Nt){for(var pi=Am(Xe,{}),yi=0;yi<Nt;yi++){var oi=Ve[yi];de(oi.offset),oi.locator=Am(Xe,{})}z.locator=pi,Em(Ve,z,Qt)&&ot.push(Ve),z.locator=Xe}else Em(Ve,z,Qt)&&ot.push(Ve);Fl.isHTML(Ve.uri)&&!Ve.closed?et=f1(_,et,Ve.tagName,Q,z):et++}}catch(kt){if(kt instanceof ho)throw kt;w.error("element parse error: "+kt),et=-1}et>xt?xt=et:ee(Math.max(Tt,xt)+1)}}function Am(_,b){return b.lineNumber=_.lineNumber,b.columnNumber=_.columnNumber,b}function d1(_,b,E,z,w,c){function Q(ot,St,xt){E.attributeNames.hasOwnProperty(ot)&&c.fatalError("Attribute "+ot+" redefined"),E.addValue(ot,St.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,w),xt)}for(var ee,de,ne=++b,$=Ll;;){var Re=_.charAt(ne);switch(Re){case"=":if($===Mn)ee=_.slice(b,ne),$=Bl;else if($===lo)$=Bl;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if($===Bl||$===Mn)if($===Mn&&(c.warning('attribute value must after "="'),ee=_.slice(b,ne)),b=ne+1,ne=_.indexOf(Re,b),ne>0)de=_.slice(b,ne),Q(ee,de,b-1),$=uo;else throw new Error("attribute value no end '"+Re+"' match");else if($==co)de=_.slice(b,ne),Q(ee,de,b),c.warning('attribute "'+ee+'" missed start quot('+Re+")!!"),b=ne+1,$=uo;else throw new Error('attribute value must after "="');break;case"/":switch($){case Ll:E.setTagName(_.slice(b,ne));case uo:case Rl:case nu:$=nu,E.closed=!0;case co:case Mn:break;case lo:E.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return c.error("unexpected end of input"),$==Ll&&E.setTagName(_.slice(b,ne)),ne;case">":switch($){case Ll:E.setTagName(_.slice(b,ne));case uo:case Rl:case nu:break;case co:case Mn:de=_.slice(b,ne),de.slice(-1)==="/"&&(E.closed=!0,de=de.slice(0,-1));case lo:$===lo&&(de=ee),$==co?(c.warning('attribute "'+de+'" missed quot(")!'),Q(ee,de,b)):((!Fl.isHTML(z[""])||!de.match(/^(?:disabled|checked|selected)$/i))&&c.warning('attribute "'+de+'" missed value!! "'+de+'" instead!!'),Q(de,de,b));break;case Bl:throw new Error("attribute value missed!!")}return ne;case"\x80":Re=" ";default:if(Re<=" ")switch($){case Ll:E.setTagName(_.slice(b,ne)),$=Rl;break;case Mn:ee=_.slice(b,ne),$=lo;break;case co:var de=_.slice(b,ne);c.warning('attribute "'+de+'" missed quot(")!!'),Q(ee,de,b);case uo:$=Rl;break}else switch($){case lo:var Xe=E.tagName;(!Fl.isHTML(z[""])||!ee.match(/^(?:disabled|checked|selected)$/i))&&c.warning('attribute "'+ee+'" missed value!! "'+ee+'" instead2!!'),Q(ee,ee,b),b=ne,$=Mn;break;case uo:c.warning('attribute space is required"'+ee+'"!!');case Rl:$=Mn,b=ne;break;case Bl:$=co,b=ne;break;case nu:throw new Error("elements closed character '/' and '>' must be connected to")}}ne++}}function Em(_,b,E){for(var z=_.tagName,w=null,Re=_.length;Re--;){var c=_[Re],Q=c.qName,ee=c.value,Xe=Q.indexOf(":");if(Xe>0)var de=c.prefix=Q.slice(0,Xe),ne=Q.slice(Xe+1),$=de==="xmlns"&&ne;else ne=Q,de=null,$=Q==="xmlns"&&"";c.localName=ne,$!==!1&&(w==null&&(w={},Cm(E,E={})),E[$]=w[$]=ee,c.uri=Fl.XMLNS,b.startPrefixMapping($,ee))}for(var Re=_.length;Re--;){c=_[Re];var de=c.prefix;de&&(de==="xml"&&(c.uri=Fl.XML),de!=="xmlns"&&(c.uri=E[de||""]))}var Xe=z.indexOf(":");Xe>0?(de=_.prefix=z.slice(0,Xe),ne=_.localName=z.slice(Xe+1)):(de=null,ne=_.localName=z);var ot=_.uri=E[de||""];if(b.startElement(ot,ne,z,_),_.closed){if(b.endElement(ot,ne,z),w)for(de in w)Object.prototype.hasOwnProperty.call(w,de)&&b.endPrefixMapping(de)}else return _.currentNSMap=E,_.localNSMap=w,!0}function f1(_,b,E,z,w){if(/^(?:script|textarea)$/i.test(E)){var c=_.indexOf("</"+E+">",b),Q=_.substring(b+1,c);if(/[&<]/.test(Q))return/^script$/i.test(E)?(w.characters(Q,0,Q.length),c):(Q=Q.replace(/&#?\w+;/g,z),w.characters(Q,0,Q.length),c)}return b+1}function m1(_,b,E,z){var w=z[E];return w==null&&(w=_.lastIndexOf("</"+E+">"),w<b&&(w=_.lastIndexOf("</"+E)),z[E]=w),w<b}function Cm(_,b){for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&(b[E]=_[E])}function g1(_,b,E,z){var w=_.charAt(b+2);switch(w){case"-":if(_.charAt(b+3)==="-"){var c=_.indexOf("-->",b+4);return c>b?(E.comment(_,b+4,c-b-4),c+3):(z.error("Unclosed comment"),-1)}else return-1;default:if(_.substr(b+3,6)=="CDATA["){var c=_.indexOf("]]>",b+9);return E.startCDATA(),E.characters(_,b+9,c-b-9),E.endCDATA(),c+3}var Q=_1(_,b),ee=Q.length;if(ee>1&&/!doctype/i.test(Q[0][0])){var de=Q[1][0],ne=!1,$=!1;ee>3&&(/^public$/i.test(Q[2][0])?(ne=Q[3][0],$=ee>4&&Q[4][0]):/^system$/i.test(Q[2][0])&&($=Q[3][0]));var Re=Q[ee-1];return E.startDTD(de,ne,$),E.endDTD(),Re.index+Re[0].length}}return-1}function y1(_,b,E){var z=_.indexOf("?>",b);if(z){var w=_.substring(b,z).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(w){var c=w[0].length;return E.processingInstruction(w[1],w[2]),z+2}else return-1}return-1}function Dm(){this.attributeNames={}}Dm.prototype={setTagName:function(_){if(!Sm.test(_))throw new Error("invalid tagName:"+_);this.tagName=_},addValue:function(_,b,E){if(!Sm.test(_))throw new Error("invalid attribute:"+_);this.attributeNames[_]=this.length,this[this.length++]={qName:_,value:b,offset:E}},length:0,getLocalName:function(_){return this[_].localName},getLocator:function(_){return this[_].locator},getQName:function(_){return this[_].qName},getURI:function(_){return this[_].uri},getValue:function(_){return this[_].value}};function _1(_,b){var E,z=[],w=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(w.lastIndex=b,w.exec(_);E=w.exec(_);)if(z.push(E),E[1])return z}sp.XMLReader=Tm;sp.ParseError=ho});var Rm=Dn(ou=>{var v1=Cl(),x1=ap(),km=bm(),zm=Im(),b1=x1.DOMImplementation,Mm=v1.NAMESPACE,w1=zm.ParseError,S1=zm.XMLReader;function Lm(_){return _.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function Bm(_){this.options=_||{locator:{}}}Bm.prototype.parseFromString=function(_,b){var E=this.options,z=new S1,w=E.domBuilder||new Ol,c=E.errorHandler,Q=E.locator,ee=E.xmlns||{},de=/\/x?html?$/.test(b),ne=de?km.HTML_ENTITIES:km.XML_ENTITIES;Q&&w.setDocumentLocator(Q),z.errorHandler=A1(c,w,Q),z.domBuilder=E.domBuilder||w,de&&(ee[""]=Mm.HTML),ee.xml=ee.xml||Mm.XML;var $=E.normalizeLineEndings||Lm;return _&&typeof _=="string"?z.parse($(_),ee,ne):z.errorHandler.error("invalid doc source"),w.doc};function A1(_,b,E){if(!_){if(b instanceof Ol)return b;_=b}var z={},w=_ instanceof Function;E=E||{};function c(Q){var ee=_[Q];!ee&&w&&(ee=_.length==2?function(de){_(Q,de)}:_),z[Q]=ee&&function(de){ee("[xmldom "+Q+"]	"+de+op(E))}||function(){}}return c("warning"),c("error"),c("fatalError"),z}function Ol(){this.cdata=!1}function po(_,b){b.lineNumber=_.lineNumber,b.columnNumber=_.columnNumber}Ol.prototype={startDocument:function(){this.doc=new b1().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(_,b,E,z){var w=this.doc,c=w.createElementNS(_,E||b),Q=z.length;su(this,c),this.currentElement=c,this.locator&&po(this.locator,c);for(var ee=0;ee<Q;ee++){var _=z.getURI(ee),de=z.getValue(ee),E=z.getQName(ee),ne=w.createAttributeNS(_,E);this.locator&&po(z.getLocator(ee),ne),ne.value=ne.nodeValue=de,c.setAttributeNode(ne)}},endElement:function(_,b,E){var z=this.currentElement,w=z.tagName;this.currentElement=z.parentNode},startPrefixMapping:function(_,b){},endPrefixMapping:function(_){},processingInstruction:function(_,b){var E=this.doc.createProcessingInstruction(_,b);this.locator&&po(this.locator,E),su(this,E)},ignorableWhitespace:function(_,b,E){},characters:function(_,b,E){if(_=Pm.apply(this,arguments),_){if(this.cdata)var z=this.doc.createCDATASection(_);else var z=this.doc.createTextNode(_);this.currentElement?this.currentElement.appendChild(z):/^\s*$/.test(_)&&this.doc.appendChild(z),this.locator&&po(this.locator,z)}},skippedEntity:function(_){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(_){(this.locator=_)&&(_.lineNumber=0)},comment:function(_,b,E){_=Pm.apply(this,arguments);var z=this.doc.createComment(_);this.locator&&po(this.locator,z),su(this,z)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(_,b,E){var z=this.doc.implementation;if(z&&z.createDocumentType){var w=z.createDocumentType(_,b,E);this.locator&&po(this.locator,w),su(this,w),this.doc.doctype=w}},warning:function(_){console.warn("[xmldom warning]	"+_,op(this.locator))},error:function(_){console.error("[xmldom error]	"+_,op(this.locator))},fatalError:function(_){throw new w1(_,this.locator)}};function op(_){if(_)return`
@`+(_.systemId||"")+"#[line:"+_.lineNumber+",col:"+_.columnNumber+"]"}function Pm(_,b,E){return typeof _=="string"?_.substr(b,E):_.length>=b+E||b?new java.lang.String(_,b,E)+"":_}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(_){Ol.prototype[_]=function(){return null}});function su(_,b){_.currentElement?_.currentElement.appendChild(b):_.doc.appendChild(b)}ou.__DOMHandler=Ol;ou.normalizeLineEndings=Lm;ou.DOMParser=Bm});var Om=Dn(lu=>{var Fm=ap();lu.DOMImplementation=Fm.DOMImplementation;lu.XMLSerializer=Fm.XMLSerializer;lu.DOMParser=Rm().DOMParser});var qm=Dn((Nm,lp)=>{var E1=function(){"use strict";var _=/\s*/g,b=/^\s*|\s*$/g,E=/\s+/;function z(Ue){if(!Ue||!Ue.length)return 0;for(var je=0,ht=0;je<Ue.length;je++)ht=(ht<<5)-ht+Ue.charCodeAt(je)|0;return ht}function w(Ue,je){return Ue.getElementsByTagName(je)}function c(Ue,je){return Ue.getAttribute(je)}function Q(Ue,je){return parseFloat(c(Ue,je))}function ee(Ue,je){var ht=w(Ue,je);return ht.length?ht[0]:null}function de(Ue){return Ue.normalize&&Ue.normalize(),Ue}function ne(Ue){for(var je=0,ht=[];je<Ue.length;je++)ht[je]=parseFloat(Ue[je]);return ht}function $(Ue){return Ue&&de(Ue),Ue&&Ue.textContent||""}function Re(Ue,je){var ht={},Ve,Qt;for(Qt=0;Qt<je.length;Qt++)Ve=ee(Ue,je[Qt]),Ve&&(ht[je[Qt]]=$(Ve));return ht}function Xe(Ue,je){for(var ht in je)Ue[ht]=je[ht]}function ot(Ue){return ne(Ue.replace(_,"").split(","))}function St(Ue){for(var je=Ue.replace(b,"").split(E),ht=[],Ve=0;Ve<je.length;Ve++)ht.push(ot(je[Ve]));return ht}function xt(Ue){var je=[Q(Ue,"lon"),Q(Ue,"lat")],ht=ee(Ue,"ele"),Ve=ee(Ue,"gpxtpx:hr")||ee(Ue,"hr"),Qt=ee(Ue,"time"),et;return ht&&(et=parseFloat($(ht)),isNaN(et)||je.push(et)),{coordinates:je,time:Qt?$(Qt):null,heartRate:Ve?parseFloat($(Ve)):null}}function Tt(){return{type:"FeatureCollection",features:[]}}var yt;if(typeof XMLSerializer<"u")yt=new XMLSerializer;else{var yr=typeof process=="object"&&!process.browser,dt=typeof Titanium=="object";if(typeof Nm=="object"&&(yr||dt))yt=new(Om()).XMLSerializer;else throw new Error("Unable to initialize serializer")}function Ht(Ue){return Ue.xml!==void 0?Ue.xml:yt.serializeToString(Ue)}var bi={kml:function(Ue){for(var je=Tt(),ht={},Ve={},Qt={},et=["Polygon","LineString","Point","Track","gx:Track"],Nt=w(Ue,"Placemark"),pi=w(Ue,"Style"),yi=w(Ue,"StyleMap"),oi=0;oi<pi.length;oi++){var kt=z(Ht(pi[oi])).toString(16);ht["#"+c(pi[oi],"id")]=kt,Ve[kt]=pi[oi]}for(var Lt=0;Lt<yi.length;Lt++){ht["#"+c(yi[Lt],"id")]=z(Ht(yi[Lt])).toString(16);for(var wi=w(yi[Lt],"Pair"),li={},ft=0;ft<wi.length;ft++)li[$(ee(wi[ft],"key"))]=$(ee(wi[ft],"styleUrl"));Qt["#"+c(yi[Lt],"id")]=li}for(var Dt=0;Dt<Nt.length;Dt++)je.features=je.features.concat(ci(Nt[Dt]));function pt(Ge){var nt,qt;return Ge=Ge||"",Ge.substr(0,1)==="#"&&(Ge=Ge.substr(1)),(Ge.length===6||Ge.length===3)&&(nt=Ge),Ge.length===8&&(qt=parseInt(Ge.substr(0,2),16)/255,nt="#"+Ge.substr(6,2)+Ge.substr(4,2)+Ge.substr(2,2)),[nt,isNaN(qt)?void 0:qt]}function Mt(Ge){return ne(Ge.split(" "))}function Ut(Ge){var nt=w(Ge,"coord","gx"),qt=[],tt=[];nt.length===0&&(nt=w(Ge,"gx:coord"));for(var di=0;di<nt.length;di++)qt.push(Mt($(nt[di])));for(var _i=w(Ge,"when"),jt=0;jt<_i.length;jt++)tt.push($(_i[jt]));return{coords:qt,times:tt}}function lt(Ge){var nt,qt,tt,di,_i,jt=[],ce=[];if(ee(Ge,"MultiGeometry"))return lt(ee(Ge,"MultiGeometry"));if(ee(Ge,"MultiTrack"))return lt(ee(Ge,"MultiTrack"));if(ee(Ge,"gx:MultiTrack"))return lt(ee(Ge,"gx:MultiTrack"));for(tt=0;tt<et.length;tt++)if(qt=w(Ge,et[tt]),qt){for(di=0;di<qt.length;di++)if(nt=qt[di],et[tt]==="Point")jt.push({type:"Point",coordinates:ot($(ee(nt,"coordinates")))});else if(et[tt]==="LineString")jt.push({type:"LineString",coordinates:St($(ee(nt,"coordinates")))});else if(et[tt]==="Polygon"){var Hi=w(nt,"LinearRing"),Mr=[];for(_i=0;_i<Hi.length;_i++)Mr.push(St($(ee(Hi[_i],"coordinates"))));jt.push({type:"Polygon",coordinates:Mr})}else if(et[tt]==="Track"||et[tt]==="gx:Track"){var ct=Ut(nt);jt.push({type:"LineString",coordinates:ct.coords}),ct.times.length&&ce.push(ct.times)}}return{geoms:jt,coordTimes:ce}}function ci(Ge){var nt=lt(Ge),qt,tt={},di=$(ee(Ge,"name")),_i=$(ee(Ge,"address")),jt=$(ee(Ge,"styleUrl")),ce=$(ee(Ge,"description")),Hi=ee(Ge,"TimeSpan"),Mr=ee(Ge,"TimeStamp"),ct=ee(Ge,"ExtendedData"),Bt=ee(Ge,"LineStyle"),_r=ee(Ge,"PolyStyle"),Pr=ee(Ge,"visibility");if(!nt.geoms.length)return[];if(di&&(tt.name=di),_i&&(tt.address=_i),jt){jt[0]!=="#"&&(jt="#"+jt),tt.styleUrl=jt,ht[jt]&&(tt.styleHash=ht[jt]),Qt[jt]&&(tt.styleMapHash=Qt[jt],tt.styleHash=ht[Qt[jt].normal]);var Wi=Ve[tt.styleHash];if(Wi){Bt||(Bt=ee(Wi,"LineStyle")),_r||(_r=ee(Wi,"PolyStyle"));var Qr=ee(Wi,"IconStyle");if(Qr){var Vi=ee(Qr,"Icon");if(Vi){var ua=$(ee(Vi,"href"));ua&&(tt.icon=ua)}}}}if(ce&&(tt.description=ce),Hi){var Ea=$(ee(Hi,"begin")),ve=$(ee(Hi,"end"));tt.timespan={begin:Ea,end:ve}}if(Mr&&(tt.timestamp=$(ee(Mr,"when"))),Bt){var sr=pt($(ee(Bt,"color"))),Si=sr[0],or=sr[1],zr=parseFloat($(ee(Bt,"width")));Si&&(tt.stroke=Si),isNaN(or)||(tt["stroke-opacity"]=or),isNaN(zr)||(tt["stroke-width"]=zr)}if(_r){var xe=pt($(ee(_r,"color"))),rt=xe[0],We=xe[1],Di=$(ee(_r,"fill")),Xi=$(ee(_r,"outline"));rt&&(tt.fill=rt),isNaN(We)||(tt["fill-opacity"]=We),Di&&(tt["fill-opacity"]=Di==="1"?tt["fill-opacity"]||1:0),Xi&&(tt["stroke-opacity"]=Xi==="1"?tt["stroke-opacity"]||1:0)}if(ct){var Ke=w(ct,"Data"),Ki=w(ct,"SimpleData");for(qt=0;qt<Ke.length;qt++)tt[Ke[qt].getAttribute("name")]=$(ee(Ke[qt],"value"));for(qt=0;qt<Ki.length;qt++)tt[Ki[qt].getAttribute("name")]=$(Ki[qt])}Pr&&(tt.visibility=$(Pr)),nt.coordTimes.length&&(tt.coordTimes=nt.coordTimes.length===1?nt.coordTimes[0]:nt.coordTimes);var vr={type:"Feature",geometry:nt.geoms.length===1?nt.geoms[0]:{type:"GeometryCollection",geometries:nt.geoms},properties:tt};return c(Ge,"id")&&(vr.id=c(Ge,"id")),[vr]}return je},gpx:function(Ue){var je,ht=w(Ue,"trk"),Ve=w(Ue,"rte"),Qt=w(Ue,"wpt"),et=Tt(),Nt;for(je=0;je<ht.length;je++)Nt=oi(ht[je]),Nt&&et.features.push(Nt);for(je=0;je<Ve.length;je++)Nt=kt(Ve[je]),Nt&&et.features.push(Nt);for(je=0;je<Qt.length;je++)et.features.push(Lt(Qt[je]));function pi(ft,Dt){for(var pt=0;pt<Dt;pt++)ft.push(null);return ft}function yi(ft,Dt){var pt=w(ft,Dt),Mt=[],Ut=[],lt=[],ci=pt.length;if(ci<2)return{};for(var Ge=0;Ge<ci;Ge++){var nt=xt(pt[Ge]);Mt.push(nt.coordinates),nt.time&&Ut.push(nt.time),(nt.heartRate||lt.length)&&(lt.length||pi(lt,Ge),lt.push(nt.heartRate||null))}return{line:Mt,times:Ut,heartRates:lt}}function oi(ft){for(var Dt=w(ft,"trkseg"),pt=[],Mt=[],Ut=[],lt,ci=0;ci<Dt.length;ci++)if(lt=yi(Dt[ci],"trkpt"),lt&&(lt.line&&pt.push(lt.line),lt.times&&lt.times.length&&Mt.push(lt.times),Ut.length||lt.heartRates&&lt.heartRates.length)){if(!Ut.length)for(var Ge=0;Ge<ci;Ge++)Ut.push(pi([],pt[Ge].length));lt.heartRates&&lt.heartRates.length?Ut.push(lt.heartRates):Ut.push(pi([],lt.line.length||0))}if(pt.length!==0){var nt=li(ft);return Xe(nt,wi(ee(ft,"extensions"))),Mt.length&&(nt.coordTimes=pt.length===1?Mt[0]:Mt),Ut.length&&(nt.heartRates=pt.length===1?Ut[0]:Ut),{type:"Feature",properties:nt,geometry:{type:pt.length===1?"LineString":"MultiLineString",coordinates:pt.length===1?pt[0]:pt}}}}function kt(ft){var Dt=yi(ft,"rtept");if(Dt.line){var pt=li(ft);Xe(pt,wi(ee(ft,"extensions")));var Mt={type:"Feature",properties:pt,geometry:{type:"LineString",coordinates:Dt.line}};return Mt}}function Lt(ft){var Dt=li(ft);return Xe(Dt,Re(ft,["sym"])),{type:"Feature",properties:Dt,geometry:{type:"Point",coordinates:xt(ft).coordinates}}}function wi(ft){var Dt={};if(ft){var pt=ee(ft,"line");if(pt){var Mt=$(ee(pt,"color")),Ut=parseFloat($(ee(pt,"opacity"))),lt=parseFloat($(ee(pt,"width")));Mt&&(Dt.stroke=Mt),isNaN(Ut)||(Dt["stroke-opacity"]=Ut),isNaN(lt)||(Dt["stroke-width"]=lt*96/25.4)}}return Dt}function li(ft){var Dt=Re(ft,["name","cmt","desc","type","time","keywords"]),pt=w(ft,"link");pt.length&&(Dt.links=[]);for(var Mt=0,Ut;Mt<pt.length;Mt++)Ut={href:c(pt[Mt],"href")},Xe(Ut,Re(pt[Mt],["text","type"])),Dt.links.push(Ut);return Dt}return et}};return bi}();typeof lp<"u"&&(lp.exports=E1)});var Wc=Vc(Hc()),ti={layerID:"ukis:layerID",filtertype:"ukis:filtertype",ignoreOpacity:"ukis:ignore-opacity",ignoreVisibility:"ukis:ignore-visibility"};function Al(_){return{"ukis:filtertype":_.filtertype,"ukis:layerID":_.id}}function qh(_){let b={};return b[ti.filtertype]=(_?.metadata)[ti.filtertype],b[ti.layerID]=(_?.metadata)[ti.layerID],b[ti.ignoreOpacity]=(_?.metadata)[ti.ignoreOpacity],b[ti.ignoreVisibility]=(_?.metadata)[ti.ignoreVisibility],b}function Pf(_,b,E,z){let w=new Wc.LngLatBounds([b[0],b[1]],[b[2],b[3]]);return _.fitBounds(w),Vh(_,E)}function Vh(_,b){let E=_.getBounds();return[E.getWest(),E.getSouth(),E.getEast(),E.getNorth()]}function zf(_,b,E){let z=new Wc.LngLat(b[0],b[1]);return _.setCenter(z),Og(_,E)}function Og(_,b){let E=_.getCenter();return[E.lng,E.lat]}function Lf(_,b,E){_.setZoom(b)}function Uh(_,b){_.setPitch(b)}function jh(_,b){let E=0;b>180?E=360-b:E=-b,_.setBearing(E)}function Bf(_){let b=0,E=_.getBearing();return E>0?b=360-E:E<0&&(b=-E),b}function Rf(_,b){let E;typeof b=="string"?E=_.getLayer(b):E=b;let z=qh(E)["ukis:filtertype"],w=In(_,z),c=w.findIndex(Q=>Q.id===E.id);if(c<w.length-1)return w[c+1].id}function Ff(_){let b=_;_==="symbol"&&(b="icon");let E=`${b}-opacity`;return _==="circle"&&(E="circle-stroke-opacity"),_==="hillshade"&&(E="hillshade-exaggeration"),E}function In(_,b){let E=_.getStyle().layers,z=E;if(b){let w=b.toLowerCase();z=E.filter(c=>c.metadata?.[ti.filtertype]?.toLowerCase()===w)}return z}function Xc(_,b){let z=In(_,b).filter(w=>w.metadata?.[ti.layerID]).map(w=>w.metadata?.[ti.layerID]);return[...new Set(z)]}function Nh(_,b){let z=In(_).filter(Q=>{if(Q.metadata?.[ti.layerID]===b)return!0}),w=_.getStyle().sources,c=z.reduce((Q,ee)=>{let de;"source"in ee&&typeof ee.source=="string"?de=ee.source:de=ee.id;let ne=w[de];return ne&&(Q[de]=ne),Q},{});return{layers:z,sources:c}}function Of(_,b){let E={layers:[],sources:{}},z=[],w=In(_);Array.isArray(b)?z=b:z.push(b),z.forEach(Q=>{let ee=Nh(_,Q);E.layers.push(...ee.layers),E.sources=ee.sources}),E.layers.forEach(Q=>{_.getLayer(Q.id)&&_.removeLayer(Q.id)});let c=w.filter(Q=>!E.layers.map(ee=>ee.id).includes(Q.id)).map(Q=>Q?.source).filter((Q,ee,de)=>de.indexOf(Q)===ee&&Q);Object.keys(E.sources).forEach(Q=>{_.getSource(Q)&&!c.includes(Q)&&_.removeSource(Q)})}function Mf(_,b){let E=[],z=b.length,w=z;for(;w--;){let c=b[w],Q=_[w];if(c!==Q.id){let ee={layerId:Q.id,beforeId:null},de=w+1;if(de<z){let ne=_[de].id;ee.beforeId=ne}else if(de===0){let ne=_[de].id;ee.beforeId=ne}E.push(ee)}}return E}function Nf(_,b,E,z){let w=Mf(b,E),c=w.length;if(c)for(let Q=0;Q<c;Q++){let ee=w[Q];if(Q>=1){let de=Xc(_,z);if(Mf(b,de).length===0)break}Ng(_,ee)}}function Ng(_,b){if(b){let E=Nh(_,b.layerId).layers,z=Nh(_,b.beforeId).layers;if(z.length>=1?b.beforeId=z[0].id:b.beforeId=null,E.length>1)E.reverse(),E.forEach((w,c)=>{if(c===0)b.beforeId?_.moveLayer(w.id,b.beforeId):_.moveLayer(w.id);else{let Q=E[c-1];_.moveLayer(w.id,Q.id)}});else if(E.length===1){let w=E[0];b.beforeId?_.moveLayer(w.id,b.beforeId):_.moveLayer(w.id)}}}function Kc(_,b){let E=Object.getOwnPropertyNames(_),z=Object.getOwnPropertyNames(b);if(E.length!==z.length)return!1;if(_ instanceof Date&&b instanceof Date||_ instanceof Boolean&&b instanceof Boolean||_ instanceof Number&&b instanceof Number||_ instanceof String&&b instanceof String){let w=_.toString(),c=b.toString();if(w!==c)return!1}for(let w of E){let c=_[w],Q=b[w];if(Array.isArray(c)&&Array.isArray(Q)){if(c.length!==Q.length||c.map((de,ne)=>{let $=Q[ne],Re=`${de}`,Xe=`${$}`;return Re!==Xe}).includes(!0))return!1}else if(!(typeof c=="object"&&typeof Q=="object"&&Kc(c,Q))&&c!==Q)return!1}return!0}function $h(_){function b(c,Q){return this[c]instanceof Date?`new Date:${Q.valueOf()}`:this[c]instanceof Boolean?`new Boolean:${Q}`:this[c]instanceof Number?`new Number:${Q.toString()}`:this[c]instanceof String?`new String:${Q.toString()}`:Q}function E(c,Q){if(typeof Q=="string"){if(Q.indexOf("new Date:")!==-1)return new Date(Q.slice(9));if(Q.indexOf("new Boolean:")!==-1)return new Boolean(Q.slice(12));if(Q.indexOf("new Number:")!==-1)return new Number(Q.slice(11));if(Q.indexOf("new String:")!==-1)return new String(Q.slice(11))}return Q}let z=JSON.stringify(_,b);return JSON.parse(z,E)}function qf(_){let b=_.url,E=_.params,z=`${b}?bbox={bbox-epsg-3857}&format=${E?.FORMAT||"image/png"}&service=WMS&version=${E?.VERSION||"1.1.1"}&request=GetMap&srs=EPSG:3857&transparent=${E?.TRANSPARENT||"true"}&width=${_.tileSize||256}&height=${_.tileSize||256}&layers=${E?.LAYERS}`;return E.STYLES&&(z+=`&styles=${E.STYLES}`),z}function qg(_){let b=_.url,E=_.params;return`${b}?layer=${E?.layer}&style=${E.style}&tilematrixset=${E.matrixSetOptions?.matrixSet}&service=WTMS&version=${E?.version||"1.0.0"}&request=GetTile&TileMatrix=EPSG:3857:{z}&TileCol={x}&TileRow={y}&format=${E?.format||"image/png"}`}function El(_,b,E){let z={};return z[_.id]=b,{sources:z,layers:E}}function Vf(_){let E=[kh,Dh,Ih,Ch,Mh,Lh,zh,Ph,Bh].includes(_.type);return E||console.warn(`layer of type ${_.type} is not supported!`),E}function Yc(_){let b={},E={};return _ instanceof la?(b.type="vector",_.type==="geojson"||_.type==="wfs"?(b.type="geojson",b.data=_.data||{type:"FeatureCollection",features:[]}):_.type==="kml"&&(b.type="kml",b.data=_.data||{type:"FeatureCollection",features:[]}),(b.type==="kml"||b.type==="geojson")&&(_.data?b.data=_.data:_.url&&(b.data=_.url),_.cluster&&(b.cluster=!0,typeof _.cluster!="boolean"&&((_.cluster?.clusterRadius||_.cluster.distance)&&(b.clusterRadius=_.cluster.clusterRadius|_.cluster.distance),_.cluster?.clusterMaxZoom&&(b.clusterMaxZoom=_.cluster.clusterMaxZoom),_.cluster?.clusterMinPoints&&(b.clusterMinPoints=_.cluster.clusterMinPoints),_.cluster?.clusterProperties&&(b.clusterProperties=_.cluster.clusterProperties)))),_.bbox&&b.type==="vector"&&(b.bounds=_.bbox)):_ instanceof ss&&(b.type="raster",_.bbox&&b.type==="raster"&&(b.bounds=_.bbox)),_.attribution&&(b.attribution=_.attribution),b.type==="raster"&&_ instanceof ss&&(_.tileSize?b.tileSize=_.tileSize:b.tileSize=256),E.id=_.id,E.type="raster",E.source=_.id,E.paint={"raster-opacity":_.opacity},E.layout={visibility:_.visible?"visible":"none"},E.metadata=Al(_),(_.maxZoom||_.maxZoom===0)&&(E.maxzoom=_.maxZoom),(_.minZoom||_.minZoom===0)&&(E.minzoom=_.minZoom),{source:b,layer:E}}function Vg(_){let{source:b,layer:E}=Yc(_);return b.tiles=_.subdomains?_.subdomains.map(z=>(_.url=_.url.replace("{s}",z),qf(_))):[qf(_)],El(_,b,[E])}function Uf(_){let{source:b,layer:E}=Yc(_);return b.tiles=_.subdomains?_.subdomains.map(z=>_.url.replace("{s}",z)):[_.url],b.scheme="xyz",El(_,b,[E])}function Ug(_){let{source:b,layer:E}=Yc(_);return b.tiles=[qg(_)],El(_,b,[E])}function jg(_){let b;if(_ instanceof ss)b=Uf(_);else if(_ instanceof la&&_?.options?.style){let E=$h(_?.options?.style),z=_?.options?.styleSource;Object.entries(E.sources).forEach(w=>{let c=w[0],Q=w[1];!Q.attribution&&_.attribution&&(Q.attribution=_.attribution),c===z&&$g(_,Q)}),E.layers.forEach(w=>{w.metadata=Object.assign(w.metadata||{},Al(_)),w.layout?w.layout.visibility=_.visible?"visible":"none":w.layout={visibility:_.visible?"visible":"none"}}),b=E}return b}function $g(_,b){if((_ instanceof la||_ instanceof ss)&&(_.subdomains&&b.type==="vector"||b.type==="raster"||b.type==="raster-dem"))if(_.type==="wfs"&&_ instanceof la)b.tiles=[_.url.replace("{s}",`${_.subdomains[0]}-${_.subdomains[_.subdomains.length-1]}`)];else{let E=_.subdomains.map(z=>_.url.replace("{s}",`${z}`));b.tiles=E}}function Gh(_){let{source:b}=Yc(_),E=[];if(typeof _.data=="object"){if(_.data.type==="Feature")E=[Jc(_.data,_)];else if(_.data.type==="FeatureCollection")if(!_.data||!_.data.features.length)E=Gg(_);else{let w=_.data.features.map($=>$.geometry.type),c=w.filter(($,Re)=>w.findIndex(Xe=>Xe===$)===Re),Q=[],ee=c.filter($=>$==="Polygon"||$==="MultiPolygon").length,de=c.filter($=>$==="LineString"||$==="MultiLineString").length,ne=c.filter($=>$==="Point").length;if(ee){let $=io().find(Re=>Re.geometry.type==="Polygon");Q.push($)}if(de){let $=io().find(Re=>Re.geometry.type==="LineString");Q.push($)}if(ne){let $=io().find(Re=>Re.geometry.type==="Point");Q.push($)}if(ee&&!de){let $=io().find(Re=>Re.geometry.type==="LineString");Q.push($)}E=Q.map($=>Jc($,_))}}else E=io().map(w=>Jc(w,_));return El(_,b,E)}function Jc(_,b,E){let z={},w={fill:"rgba(255,255,255,0.4)",stroke:"#3399CC","stroke-width":1.25,"circle-radius":5},c=ee=>["coalesce",["get",ee],w[ee]];switch(_.geometry.type){case"Polygon":case"MultiPolygon":z={id:`${b.id}:fill`,type:"fill",source:b.id,paint:{"fill-opacity":b.opacity,"fill-color":c("fill")},layout:{visibility:b.visible?"visible":"none"},metadata:{},filter:["==","$type","Polygon"]},z.metadata[ti.filtertype]=b.filtertype,z.metadata[ti.layerID]=b.id;break;case"LineString":case"MultiLineString":z={id:`${b.id}:line`,type:"line",source:b.id,paint:{"line-opacity":b.opacity,"line-color":c("stroke"),"line-width":c("stroke-width")},layout:{"line-join":"round","line-cap":"round",visibility:b.visible?"visible":"none"},metadata:{},filter:["in","$type","LineString","Polygon"]},z.metadata[ti.filtertype]=b.filtertype,z.metadata[ti.layerID]=b.id;break;case"Point":z={id:`${b.id}:circle`,type:"circle",source:b.id,paint:{"circle-opacity":b.opacity,"circle-stroke-opacity":b.opacity,"circle-stroke-color":c("stroke"),"circle-color":c("fill"),"circle-radius":c("circle-radius"),"circle-stroke-width":c("stroke-width")},layout:{visibility:b.visible?"visible":"none"},metadata:{},filter:["==","$type","Point"]},z.metadata[ti.filtertype]=b.filtertype,z.metadata[ti.layerID]=b.id;break}return typeof E=="number"&&(z.id+=`:${E}`),(b.maxZoom||b.maxZoom===0)&&(z.maxzoom=b.maxZoom),(b.minZoom||b.minZoom===0)&&(z.minzoom=b.minZoom),z}function Gg(_){return io().map(E=>Jc(E,_))}function io(){return[{type:"Feature",geometry:{type:"Polygon",coordinates:[]},properties:{}},{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}},{type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}}]}function Zg(_){let b=null;return _.url&&(_.url.indexOf("http://")===0||_.url.indexOf("https://")===0?b=new URL(_.url):b=new URL(_.url,window.location.origin),b.searchParams.set("srsname","EPSG:4326"),_.url=b.toString()),Gh(_)}function Hg(_){let{sources:b,layers:E}=Gh(_),z=b[_.id];return z.type="kml",El(_,z,E)}function Wg(_){_.custom_layer?.version&&_.custom_layer?.sources&&_.custom_layer?.layers||console.error("custom_layer is not a StyleSpecification");let E=$h(_.custom_layer),z=E.sources;return Object.keys(z).forEach(c=>{let Q=z[c];!Q.attribution&&_.attribution&&(Q.attribution=_.attribution)}),E.layers.forEach(c=>{c.id.indexOf(_.id)===-1&&(c.id=`${c.id}:${_.id}`),c.metadata=Object.assign(c.metadata||{},Al(_)),c.metadata?.[ti.ignoreVisibility]||(c.layout||(c.layout={}),c.layout.visibility=_.visible?"visible":"none");let ee=c.paint?Ff(c.type):null,de=c.metadata?.[ti.ignoreOpacity];ee&&!de&&(c.paint||(c.paint={}),c.paint[ee]=_.opacity)}),E}function Xg(_){if(_ instanceof Sl){let b=_.layers.map(w=>{if(w.visible=_.visible,w.opacity=_.opacity,!(w instanceof Sl))return Tl(w)}),E={},z=[];return b.forEach(w=>{w.layers.forEach(c=>{c.id.indexOf(_.id)===-1&&(c.id=`${c.id}:${_.id}`),c.metadata=Object.assign(c.metadata||{},Al(_)),z.push(c)}),Object.keys(w.sources).forEach(c=>{E[c]=w.sources[c]})}),{sources:E,layers:z}}else console.log("layer is not of type StackedLayer!",_)}function Tl(_){let b;switch(_.type){case kh:b=Uf(_);break;case Dh:b=Vg(_);break;case Ih:b=Ug(_);break;case Ch:b=jg(_);break;case Mh:b=Gh(_);break;case Ph:b=Hg(_);break;case zh:b=Zg(_);break;case Lh:b=Wg(_);break;case Bh:b=Xg(_);break}return b}function jf(_,b,E){let z=_.getStyle().sources[b.id];if(z){let c=In(_).filter(ne=>{if(ne.type!=="background")return ne.source===b.id}),ee=Tl(b).sources[b.id];!Kc(ee,z)&&(c.forEach(ne=>{_.removeLayer(ne.id)}),_.removeSource(b.id),console.log("update source",b.id,ee),_.addSource(b.id,ee),c.forEach(ne=>{_.addLayer(ne)}))}}function $f(_,b,E){let w=Tl(E).layers.find(c=>c.id===b.id);w&&Object.entries(w).map(c=>{let Q=c[0],ee=c[1];switch(Q){case"paint":if(Object.entries(ee).map(Re=>{let Xe=Re[0],ot=b.getPaintProperty(Xe),St=Re[1];if(ot!==St)return _.getTerrain()?!0:(_.setPaintProperty(b.id,Xe,St),!1)}).filter(Re=>Re===!0).length){let Re=Rf(_,b);_.removeLayer(b.id),_.addLayer(w,Re)}break;case"layout":Object.entries(ee).forEach(Re=>{let Xe=Re[0],ot=b.getLayoutProperty(Xe),St=Re[1];ot!==St&&_.setLayoutProperty(b.id,Xe,St)});break;case"maxzoom":b.maxzoom!==ee&&_.setLayerZoomRange(b.id,b.minzoom,ee);break;case"minzoom":b.minzoom!==ee&&_.setLayerZoomRange(b.id,ee,b.maxzoom);break;case"filter":let ne=ee,$=!1;if(ne){let Re=b.filter;Re?$=!Kc(Re,ne):$=!0,w.type!=="background"&&$&&_.setFilter(b.id,ee)}break;case"source":b.source!==ee&&(b.source=ee);break;case"source-layer":b.sourceLayer!==ee&&(b.sourceLayer=ee);break}})}var ro=(()=>{class _{constructor(){this.FILTER_TYPE_KEY="filtertype",this.ID_KEY="id",this.TITLE_KEY="title",this.WebMercator="EPSG:3857",this.WGS84="EPSG:4326",this.map=new Yd(null),this.createLayer=Tl,this.layerIsSupported=Vf}setUkisLayers(E,z,w){let c=z.toLowerCase(),Q=[];if(E.length<1&&c!=="baselayers"||E.forEach(ee=>{let de=this.createLayer(ee);if(de){if("version"in de){let ne=de.layers.map($=>w.getLayer($.id)).filter($=>$);ne.length||Q.push(de),ne.length&&ne.forEach($=>this.updateMlLayer($,ee,w))}else if("sources"in de&&"layers"in de){let ne=de.layers.map($=>w.getLayer($.id)).filter($=>$);ne.length||Q.push(de),ne.length&&ne.forEach($=>this.updateMlLayer($,ee,w))}}}),Q.length>0){this.setLayers(Q,w);let ee={filtertype:c,layers:Q};return w.style.stylesheet.metadata[`ukis:${z}IDs`]=E.map(de=>de.id),ee}else return null}getLayers(E,z){let c=z.getStyle().layers.filter(ee=>ee.metadata[ti.filtertype]===E),Q=c.map(ee=>z.getLayer(ee.id));return{layerSpecifications:c,styleLayers:Q}}getLayersForId(E,z,w){let Q=this.getLayers(z,w).layerSpecifications.filter(ee=>ee.metadata[ti.layerID]===E);if(Q.length){let ee=Q.map(de=>w.getLayer(de.id));return{layerSpecifications:Q,styleLayers:ee}}else return null}setLayers(E,z){return E.forEach(w=>{"sources"in w&&"layers"in w&&w.layers.forEach(c=>{let Q;if(c.type!=="background"){if(typeof c.source=="object"?Q=c.id:Q=c.source,!z.getSource(Q)){let de=w.sources[Q];de?z.addSource(Q,de):console.log("Source was not found in the LayerSourceSpecification!")}z.addLayer(c)}else z.addLayer(c)})}),E}updateMlLayer(E,z,w){this.updateLayerParamsAndSource(w,E,z),$f(w,E,z)}updateLayerParamsAndSource(E,z,w){if(w.type==="wms"||w.type==="wmts"||w.type==="tms"||w.type==="wfs"||w.type==="geojson"){let c=E.getSource(z.source);jf(E,w,c)}}static{this.\u0275fac=function(z){return new(z||_)}}static{this.\u0275prov=Qd({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})();var Aa=Vc(Hc());var Um=Vc(qm());var T1=["mapDiv"],Vm={},jm=(()=>{class _{constructor(E,z){this.ngZone=E,this.mapSvc=z,this.subs=[],this.mapCreated=new Jd,this.mapSize=[0,0],this.initialMapStateSet=!1,this.initialMapState=null,this.mapOnMoveend=w=>{let c=this.mapStateSvc.getMapState().getValue(),Q=this.map.getZoom(),ee=this.map.getCenter(),de=Vh(this.map,!0),ne=this.map.getPitch(),$=Bf(this.map),Re={lat:ee.lat,lon:ee.lng},Xe=new Sf(Q,Re,{notifier:"map"},de,c.time,ne,$);this.mapStateSvc.setMapState(Xe)}}ngOnInit(){this.layersSvc||console.error("provide a LayersService as Input to ukis-map-leaflet"),this.mapStateSvc||console.error("provide a MapStateService as Input to ukis-map-leaflet"),this.subscribeToMapState(),this.subscribeToLayers()}ngAfterViewInit(){this.initMap(),this.subscribeToMapEvents()}ngAfterViewChecked(){this.updateMapSize()}ngOnDestroy(){let E=this.mapStateSvc.getMapState().value;E.options.notifier="user",this.mapStateSvc.setMapState(E),this.subs.forEach(z=>z.unsubscribe()),this.map&&this.map.off("moveend",this.mapOnMoveend)}initMap(){let E={version:8,name:"Merged Style Specifications",metadata:{},sources:{},sprite:"https://openmaptiles.github.io/positron-gl-style/sprite",glyphs:"http://fonts.openmaptiles.org/{fontstack}/{range}.pbf",layers:[]};this.map=new Aa.Map({container:this.mapDivView.nativeElement,style:E}),this.addCustomSources(),this.setControls(),this.layersSvc||console.log("there is no layersSvc as defined!"),this.mapStateSvc||console.log("there is no mapStateSvc as defined!"),this.map.once("load",()=>{this.mapCreated.next(!0),this.mapSvc.map.next(this.map)})}addCustomSources(){Vm.kml||(this.addKmlSourceType(),Vm.kml=!0)}addKmlSourceType(){let E={type:"FeatureCollection",features:[]};class z extends Aa.GeoJSONSource{constructor(c,$,de,ne){var Re=$,{data:Q}=Re,ee=Kd(Re,["data"]);super(c,Object.assign(ee,{data:E}),de,ne),this.id=c,this.type="geojson",this._options.data=Q,this._preSetData(Q)}setData(c){return this._preSetData(c),super.setData(this._data),this}_preSetData(c){if(typeof c=="string"&&c.includes(".kml")){var Q=new XMLHttpRequest;Q.open("GET",c),Q.responseType="text",Q.addEventListener("load",()=>this.setData(Q.response)),Q.send()}else if(c.includes("<?xml")){this._options.data=c;let ee=this._dataToGeojson(c);this._data=ee}else console.error("KMLSource expects a URL or a KML (XML) as string 'data'")}_dataToGeojson(c){let ee=new DOMParser().parseFromString(c,"text/xml");return Um.default.kml(ee)}}(0,Aa.addSourceType)("kml",z)}setControls(){this.map.setMaxPitch(75);let E=new Aa.NavigationControl({showCompass:!0,showZoom:!0,visualizePitch:!0});this.map.addControl(E,"top-left");let z=new Aa.ScaleControl({unit:"metric"});this.map.addControl(z,"bottom-left")}subscribeToMapEvents(){this.map.on("moveend",this.mapOnMoveend)}updateMapSize(){let E=this.getMapDiv();E&&(E.width===this.mapSize[0]&&E.height===this.mapSize[1]?!this.initialMapStateSet&&this.initialMapState&&(this.setMapState(this.initialMapState),this.initialMapStateSet=!0):this.ngZone.runOutsideAngular(()=>{this.map.resize();let z=this.map.getContainer();this.mapSize=[z.clientWidth,z.clientHeight]}))}setMapState(E){this.initialMapState||(this.initialMapState=E);let z=this.mapStateSvc.getLastAction().getValue();E.options.notifier==="user"&&this.map&&(z==="setExtent"?Pf(this.map,E.extent,!0):z==="setState"?(Lf(this.map,E.zoom,E.options.notifier),zf(this.map,[E.center.lon,E.center.lat],!0),jh(this.map,E.rotation),Uh(this.map,E.viewAngle)):z==="setRotation"?jh(this.map,E.rotation):z==="setAngle"&&Uh(this.map,E.viewAngle))}getMapDiv(){return this.mapDivView&&this.mapDivView.nativeElement?{width:this.mapDivView.nativeElement.offsetWidth,height:this.mapDivView.nativeElement.offsetHeight}:null}subscribeToMapState(){if(this.mapStateSvc){let E=this.mapStateSvc.getMapState().subscribe(z=>this.setMapState(z));this.subs.push(E)}}subscribeToLayers(){if(this.layersSvc){let E=this.mapCreated.asObservable().pipe(jc(0),Uc(this.layersSvc.getBaseLayers())).subscribe(c=>this.addUpdateBaseLayers(c[1].filter(Q=>this.mapSvc.layerIsSupported(Q))));this.subs.push(E);let z=this.mapCreated.asObservable().pipe(jc(0),Uc(this.layersSvc.getLayers())).subscribe(c=>this.addUpdateLayers(c[1].filter(Q=>this.mapSvc.layerIsSupported(Q)),"layers"));this.subs.push(z);let w=this.mapCreated.asObservable().pipe(jc(0),Uc(this.layersSvc.getOverlays())).subscribe(c=>this.addUpdateLayers(c[1].filter(Q=>this.mapSvc.layerIsSupported(Q)),"overlays"));this.subs.push(w)}}addUpdateBaseLayers(E){let z="baselayers",w=E.filter(Q=>Q.visible),c=Xc(this.map,z);E.length!==c.length?(w.length===0?E[0].visible=!0:w.length>1&&(E.forEach(Q=>Q.visible=!1),E[0].visible=!0),this.mapSvc.setUkisLayers(E,z,this.map)):this.updateLayers(E,c,z)}addUpdateLayers(E,z){let w=Xc(this.map,z);if(E.length!==w.length){let c=E.map(ee=>ee.id),Q=w.filter(ee=>c.indexOf(ee)===-1);Of(this.map,Q),this.mapSvc.setUkisLayers(E,z,this.map)}else this.updateLayers(E,w,z)}updateLayers(E,z,w){Nf(this.map,E,z,w);for(let c of E)In(this.map).filter(ee=>qh(ee)[ti.layerID]===c.id).map(ee=>this.map.getLayer(ee.id)).filter(ee=>ee).forEach(ee=>{this.mapSvc.updateMlLayer(ee,c,this.map)})}static{this.\u0275fac=function(z){return new(z||_)(as(ef),as(ro))}}static{this.\u0275cmp=$c({type:_,selectors:[["ukis-map-maplibre"]],viewQuery:function(z,w){if(z&1&&rf(T1,5),z&2){let c;af(c=nf())&&(w.mapDivView=c.first)}},inputs:{layersSvc:"layersSvc",mapStateSvc:[0,"mapState","mapStateSvc"]},decls:2,vars:0,consts:[["mapDiv",""],[1,"map"]],template:function(z,w){z&1&&sa(0,"div",1,0)},styles:[`:root{--ukis-popup-bg-color: rgb(238, 238, 238);--ukis-drop-shadow: drop-shadow(0 1px 4px rgba(0, 0, 0, .2));--ukis-gl-bbox-bg-color: rgba(255, 255, 255, .4);--ukis-gl-bbox-border-color: rgba(87, 87, 87, .4);--ukis-gl-overviewmap-left: .5em;--ukis-gl-overviewmap-bottom: 3em;--ukis-gl-control-bg-color: rgba(87, 87, 87, .6);--ukis-gl-control-border-color: rgba(87, 87, 87, .4)}.map{width:100%;height:100%;position:relative}.maplibregl-control-container .maplibregl-ctrl-group button{background-color:var(--ukis-gl-control-bg-color);color:#fff;border-radius:2px}.maplibregl-control-container .maplibregl-ctrl-group button:focus{background-color:var(--ukis-gl-control-bg-color)}.maplibregl-control-container .maplibregl-ctrl-group button:hover{background-color:var(--ukis-gl-control-border-color)}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #ffffffcf}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23000' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23fff' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl-scale{box-shadow:0 0 0 2px #ffffff4d;background:var(--ukis-gl-control-bg-color);line-height:1.575em;padding:1px;border:1px solid #666666;color:#fff;text-align:center}
`],encapsulation:2})}}return _})();var Gm=Vc(Hc());var cp={version:8,name:"Positron-place-labels",metadata:{"mapbox:autocomposite":!1,"mapbox:type":"template","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t","openmaptiles:version":"3.x","maputnik:renderer":"mbgljs","maputnik:thunderforest_access_token":""},sources:{planet_eoc:{type:"vector",__Comment:"The url to the tilejson is not public available so we use the tiles array to skip the request, to make use of the tms service. See https://github.com/openlayers/ol-mapbox-style/blob/v8.2.1/src/util.js#L109",url:"",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://d.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"]}},sprite:"https://openmaptiles.github.io/positron-gl-style/sprite",glyphs:"http://fonts.openmaptiles.org/{fontstack}/{range}.pbf",layers:[{id:"place_suburb",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",minzoom:9,maxzoom:15,filter:["all",["==","$type","Point"],["==","class","suburb"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(117, 129, 145)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_village",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",minzoom:11,maxzoom:24,filter:["all",["==","$type","Point"],["==","class","village"]],layout:{"icon-size":.4,"text-anchor":"left","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(117, 129, 145)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_town",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",minzoom:9,maxzoom:15,filter:["all",["==","$type","Point"],["==","class","town"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[8,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(117, 129, 145)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_city",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",minzoom:7,maxzoom:14,filter:["all",["==","$type","Point"],["all",["!=","capital",2],["==","class","city"],[">","rank",3]]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[8,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(117, 129, 145)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_capital",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",minzoom:3,maxzoom:12,filter:["all",["==","$type","Point"],["all",["==","capital",2],["==","class","city"]]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[8,""]]},"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-justify":"left","text-offset":[.5,.2],"text-transform":"uppercase",visibility:"visible","text-size":14,"icon-size":0},paint:{"icon-opacity":.7,"text-color":"rgb(117, 129, 145)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_city_large",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",minzoom:4,maxzoom:12,filter:["all",["==","$type","Point"],["all",["!=","capital",2],["<=","rank",3],["==","class","city"]]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[8,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":14,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(117, 129, 145)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_state",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["==","class","state"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Regular","Noto Sans Regular"],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(113, 129, 144)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}},{id:"place_country_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Metropolis Light Italic","Noto Sans Italic"],"text-size":{base:1,stops:[[0,9],[6,11]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":{base:1,stops:[[3,"rgb(157,169,177)"],[4,"rgb(153, 153, 153)"]]},"text-halo-color":"rgba(236,236,234,0.7)","text-halo-width":1.4}},{id:"place_country_minor",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],[">=","rank",2],["has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Metropolis Regular","Noto Sans Regular"],"text-size":{base:1,stops:[[0,10],[6,12]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":{base:1,stops:[[3,"rgb(157,169,177)"],[4,"rgb(153, 153, 153)"]]},"text-halo-color":"rgba(236,236,234,0.7)","text-halo-width":1.4}},{id:"place_country_major",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"planet_eoc","source-layer":"place",maxzoom:6,filter:["all",["==","$type","Point"],["<=","rank",1],["==","class","country"],["has","iso_a2"]],layout:{"text-anchor":"center","text-field":"{name:latin}","text-font":["Metropolis Regular","Noto Sans Regular"],"text-size":{base:1.4,stops:[[0,10],[3,12],[4,14]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":{base:1,stops:[[3,"rgb(157,169,177)"],[4,"rgb(153, 153, 153)"]]},"text-halo-color":"rgba(236,236,234,0.7)","text-halo-width":1.4}}],id:"positron"};var $m={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Poly 1"},geometry:{type:"Polygon",coordinates:[[[28.037109375,31.353636941500987],[42.01171875,31.353636941500987],[42.01171875,41.44272637767212],[28.037109375,41.44272637767212],[28.037109375,31.353636941500987]]]}},{type:"Feature",properties:{name:"Poly 2"},geometry:{type:"Polygon",coordinates:[[[24.521484375,19.89072302399691],[28.652343749999996,18.729501999072138],[38.67187499999999,17.22475820662464],[44.736328125,30.90222470517144],[36.5625,31.052933985705163],[25.224609375,31.27855085894653],[24.521484375,19.89072302399691]]]}},{type:"Feature",properties:{name:"Line 1"},geometry:{type:"LineString",coordinates:[[19.6875,17.5602465032949],[25.400390625,11.350796722383672],[30.761718749999996,14.689881366618762],[39.814453125,10.746969318460001]]}},{type:"Feature",properties:{name:"Point 1"},geometry:{type:"Point",coordinates:[29.794921874999996,8.146242825034385]}}]};lf.addIcons(hf,uf,cf);var up=(()=>{class _{constructor(E,z,w){this.layerSvc=E,this.mapStateSvc=z,this.mapSvc=w,this.class="content-container",this.subs=[]}ngOnInit(){this.addBaselayers(),this.setMapState(),this.setTerrain(),this.addlayers(),this.addOverlays()}ngOnDestroy(){this.subs.map(E=>E.unsubscribe())}setMapState(){let z={lat:47.41449812198263,lon:11.7455863952639};this.mapStateSvc.setMapState({zoom:11,center:z,rotation:45,viewAngle:60})}setTerrain(){let E=this.mapSvc.map.subscribe(z=>{if(z){z.addSource("terrainSource",{type:"raster-dem",encoding:"terrarium",tiles:["https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"],tileSize:256,attribution:'\xA9 <a href="https://registry.opendata.aws/terrain-tiles/" target="_blank">AWS Terrain Tiles</a>',minzoom:3});let w=1;z.setTerrain({source:"terrainSource",exaggeration:w}),z.setMaxPitch(80),z.addControl(new Gm.TerrainControl({source:"terrainSource",exaggeration:w}),"top-left")}});this.subs.push(E)}addBaselayers(){Rh.layers.forEach(z=>{z?.layout?.["text-font"]&&(z.layout["text-font"]=z.layout["text-font"].filter(w=>w!=="Noto Sans Regular"&&w!=="Noto Sans Italic"))}),[new Af({visible:!1}),new Ef({visible:!0}),new Cf({visible:!1}),new la({name:"Transparenter Hintergrund",id:"blank_1",type:"geojson",visible:!1,data:{type:"FeatureCollection",features:[]}}),new la({name:"Open Map Styles",id:"planet_eoc_vector_tiles",attribution:'\xA9 <a href="http://openmaptiles.org/" target="_blank">OpenMapTiles</a> \xA9 <a href="https://www.openstreetmap.org/copyright" target="_blank"> OpenStreetMap contributors</a>',description:'EOC-Geoservice TMS-Service, Vector Tiles with OpenMapTiles and customised <a href="https://openmaptiles.org/styles/#positron">positron</a> Style.',type:"tms",url:"https://{s}.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true",subdomains:["a","b","c","d"],options:{style:Rh,styleSource:"planet_eoc"},visible:!1})].map(z=>this.layerSvc.addLayer(z,"Baselayers"))}addlayers(){let E=new ja({name:"EOC Basemap",displayName:"EOC Basemap",id:"eoc_basemap",visible:!1,type:"wms",removable:!1,params:{LAYERS:"eoc:basemap",FORMAT:"image/png",TRANSPARENT:!0},url:"https://tiles.geoservice.dlr.de/service/wms",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/basemap/">DLR</a>',continuousWorld:!1,legendImg:"https://tiles.geoservice.dlr.de/service/wmts?layer=eoc%3Abasemap&style=_empty&tilematrixset=EPSG%3A3857&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A3857%3A5&TileCol=18&TileRow=11",description:"This is the basemap for DLR Service Portals",opacity:1}),z=new ss({name:"OpenStreetMap",displayName:"OpenStreetMap",id:"osm_2",visible:!1,type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c"],attribution:'&copy, <a href="https://www.openstreetmap.org">OpenStreetMap</a> contributors',continuousWorld:!1,legendImg:"https://a.tile.openstreetmap.org/3/4/3.png",description:"OpenStreetMap z-x-y Tiles",opacity:1}),w=new wf({name:"EOC Litemap Tile",displayName:"EOC Litemap Tile",id:"eoc_litemap_tile",visible:!1,type:"wmts",removable:!1,params:{layer:"eoc:litemap",format:"image/png",style:"_empty",matrixSetOptions:{matrixSet:"EPSG:3857",tileMatrixPrefix:"EPSG:3857"}},url:"https://tiles.geoservice.dlr.de/service/wmts",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/basemap/">DLR</a>',continuousWorld:!1,legendImg:"https://tiles.geoservice.dlr.de/service/wmts?layer=eoc%3Alitemap&style=_empty&tilematrixset=EPSG%3A3857&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A3857%3A5&TileCol=18&TileRow=11",description:"EOC Litemap as web map tile service",opacity:1}),c=new Tf,Q=new ja({name:"MODIS EU Daily",id:"MODIS_EU_DAILY",visible:!1,type:"wms",removable:!1,params:{LAYERS:"MODIS_EU_DAILY",FORMAT:"image/png",TRANSPARENT:!0},url:"https://geoservice.dlr.de/eoc/imagery/wms",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/imagery/">DLR</a>',continuousWorld:!1,legendImg:"https://geoservice.dlr.de/eoc/imagery/wms?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=MODIS_EU_DAILY",opacity:1}),ee=new ja({name:"Sentinel-2 Europe",id:"sentinel2Europe",visible:!0,type:"wms",removable:!1,params:{LAYERS:"rgb",FORMAT:"image/png",TRANSPARENT:!0},url:"https://sgx.geodatenzentrum.de/wms_sen2europe",attribution:'&copy, <a href="https://gdz.bkg.bund.de/index.php/default/open-data/wms-europamosaik-aus-sentinel-2-daten-wms-sen2europe.html" target="_blank">Europ\xE4ische Union - BKG</a>',continuousWorld:!1,legendImg:"https://sgx.geodatenzentrum.de/wms_sen2europe?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=rgb",opacity:1}),de=new ja({name:"mosaic_hillshade",id:"gmted2010_dsc075_mosaic_hillshade",visible:!1,type:"wms",removable:!1,params:{LAYERS:"gmted2010_dsc075_mosaic_hillshade",FORMAT:"image/png",TRANSPARENT:!0},url:"https://geoservice.dlr.de/eoc/basemap/wms",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/basemap/">DLR</a>',continuousWorld:!1,legendImg:"https://geoservice.dlr.de/eoc/basemap/wms?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=gmted%3Agmted2010_dsc075_mosaic_hillshade",opacity:.5}),ne=new wl({id:"waterway-planet_eoc",name:"waterway",visible:!0,removable:!0,custom_layer:{version:8,sources:{"waterway-planet_eoc":{type:"vector",url:"",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://d.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"]}},layers:[{id:"water",type:"fill",source:"waterway-planet_eoc","source-layer":"water",filter:["all",["==","$type","Polygon"],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"fill-antialias":!0,"fill-color":"hsl(198, 100%, 28%)"}},{id:"waterway",type:"line",source:"waterway-planet_eoc","source-layer":"waterway",filter:["==","$type","LineString"],layout:{visibility:"visible"},paint:{"line-color":"hsl(198, 100%, 28%)"},metadata:{"ukis:ignore-visibility":!0,"ukis:ignore-opacity":!0}},{id:"water_name",type:"symbol",source:"waterway-planet_eoc","source-layer":"water_name",filter:["==","$type","LineString"],layout:{"symbol-placement":"line","symbol-spacing":500,"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Metropolis Medium Italic"],"text-rotation-alignment":"map","text-size":12},paint:{"text-color":"rgb(157,169,177)","text-halo-blur":1,"text-halo-color":"rgb(242,243,240)","text-halo-width":1}}]}}),$=new wl({id:"hillshade_raster_dem",name:"hillshade raster dem",visible:!1,removable:!0,attribution:'\xA9 <a href="https://registry.opendata.aws/terrain-tiles/" target="_blank">AWS Terrain Tiles</a>',custom_layer:{version:8,sources:{hillshadeSource:{type:"raster-dem",encoding:"terrarium",tileSize:512,tiles:["https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"],minzoom:3}},layers:[{id:"hills",type:"hillshade",source:"hillshadeSource",layout:{visibility:"visible"},paint:{"hillshade-shadow-color":"#473B24"}}]}}),Re=new wl({id:"geoserverCountries",name:"geoserverCountries",visible:!1,removable:!0,custom_layer:{version:8,sources:{geoserverCountries:{type:"vector",tiles:["http://localhost:8080/geoserver/gwc/service/tms/1.0.0/ne%3Acountries@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"],tileSize:512}},layers:[{id:"geoserverCountries",type:"fill",source:"geoserverCountries","source-layer":"countries",filter:["all",["!=","NAME","Germany"]],layout:{visibility:"visible"},paint:{"fill-antialias":!0,"fill-color":"hsl(198, 100%, 28%)"}},{id:"geoserverCountriesLine",type:"line",source:"geoserverCountries","source-layer":"countries",filter:["all",["==","NAME","Germany"]],layout:{visibility:"visible"},paint:{"line-color":"hsl(25, 100%, 50%)"}}]}}),Xe=new la({id:"geojson_test",name:"GeoJSON Vector Layer",attribution:"\xA9 DLR GeoJSON",type:"geojson",data:$m,bbox:[5.461,8.631,53.931,42.193],visible:!1}),ot=new la({id:"WfsLayer",name:"Coastline (WFS)",type:"wfs",visible:!1,url:"https://geoservice.dlr.de/eoc/basemap/wfs?service=WFS&request=GetFeature&outputFormat=application/json&version=1.1.0&srsname=EPSG:4326&typenames=ne:ne_50m_coastline"}),St=new la({id:"ID-ukis-kml",name:"TimeZones (KML)",type:"kml",data:"assets/kml/TimeZones.kml",visible:!1}),xt=new ja({type:"wms",id:"S2_L3A_WASP_FRC_P1M",url:"https://{s}.geoservice.dlr.de/eoc/imagery/wms",name:"Sentinel-2 L3A FRC (WASP)",visible:!1,subdomains:["a","b","c","d"],filtertype:"Layers",attribution:'&copy; <a href="http://www.dlr.de" target="_blank">DLR</a> Contains modified Copernicus Sentinel Data [2020]',params:{LAYERS:"S2_L3A_WASP_FRC_P1M",VERSION:"1.1.0",FORMAT:"image/png"},expanded:{tab:"settings"},bbox:[2.183,47.076,8.206,49.287],styles:[{default:!0,legendURL:"https://geoservice.dlr.de/eoc/imagery/wms?service=WMS&request=GetLegendGraphic&format=image/png&width=20&height=20&layer=land:S2_L3A_WASP_FRC_P1M",name:"s2-ndvi",title:"NDVI"},{default:!1,legendURL:"https://geoservice.dlr.de/eoc/imagery/wms?service=WMS&request=GetLegendGraphic&format=image/png&width=20&height=20&layer=land:S2_L3A_WASP_FRC_P1M",name:"s2-infrared",title:"Infrared (8,4,3)"},{default:!1,legendURL:"https://geoservice.dlr.de/eoc/imagery/wms?service=WMS&request=GetLegendGraphic&format=image/png&width=20&height=20&layer=land:S2_L3A_WASP_FRC_P1M",name:"s2-l3a-wasp-frc",title:"Style for L3A MAJA/WASP Ground Reflectances"}]}),Tt=new Sl({id:"stackedLayer_id",name:"EocLiteMap And Overlay",description:"merged/stacked Layers EOC Lite with Overlay",layers:[w,c],visible:!1});[new bf({id:"group_1",name:"Raster Group",visible:!1,layers:[E,z,Q,$,de],description:"This is a group with multiple raster layers",expanded:{tab:"description"},actions:[{title:"download",icon:"download-cloud",action:dt=>{console.log(dt)}}]}),ee,ne,ot,St,Xe,Tt,xt].map(dt=>{dt instanceof xf?this.layerSvc.addLayer(dt,"Layers"):this.layerSvc.addLayerGroup(dt,"Layers")})}addOverlays(){let E=new ja({name:"EOC Liteoverlay",displayName:"EOC Liteoverlay",id:"eoc_Liteoverlay",visible:!1,type:"wms",removable:!1,params:{LAYERS:"eoc:liteoverlay",FORMAT:"image/png",TRANSPARENT:!0},url:"https://tiles.geoservice.dlr.de/service/wms",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/basemap/">DLR</a>',continuousWorld:!1,legendImg:"https://tiles.geoservice.dlr.de/service/wmts?layer=eoc%3Aliteoverlay&style=_empty&tilematrixset=EPSG%3A3857&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A3857%3A5&TileCol=18&TileRow=11",description:"This is the liteoverlay provided for EOC Service Portals",opacity:1}),z=new ja({name:"Geonames cities",displayName:"Geonames cities",id:"gn_cities",visible:!1,type:"wms",removable:!1,params:{LAYERS:"gn:cities",FORMAT:"image/png",TRANSPARENT:!0},url:"https://geoservice.dlr.de/eoc/basemap/wms",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/basemap/">DLR</a>',continuousWorld:!1,legendImg:"https://geoservice.dlr.de/eoc/basemap/wms?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=gn%3Acities",opacity:1}),w=new ja({name:"admin 0 countries",displayName:"admin 0 countries",id:"ne_10m_admin_0_countries",visible:!1,type:"wms",removable:!1,params:{LAYERS:"ne:ne_10m_admin_0_countries",FORMAT:"image/png",TRANSPARENT:!0},url:"https://geoservice.dlr.de/eoc/basemap/wms",attribution:'&copy, <a href="//geoservice.dlr.de/eoc/basemap/">DLR</a>',continuousWorld:!1,legendImg:"https://geoservice.dlr.de/eoc/basemap/wms?service=WMS&version=1.3.0&request=GetLegendGraphic&format=image%2Fpng&width=20&height=20&layer=ne%3Ane_10m_admin_0_countries",opacity:1});cp.layers.forEach(ee=>{ee.source="place-labels-planet_eoc",ee?.layout?.["text-font"]&&(ee.layout["text-font"]=ee.layout["text-font"].filter(de=>de!=="Noto Sans Regular"&&de!=="Noto Sans Italic"))});let c=new wl({id:"place-labels-planet_eoc",name:"Place Labels",visible:!0,removable:!0,custom_layer:{version:8,sources:{"place-labels-planet_eoc":{type:"vector",url:"",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://d.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"]}},layers:cp.layers}});[E,z,w,c].map(ee=>this.layerSvc.addLayer(ee,"Overlays"))}subscribeToMapState(){let E=this.mapStateSvc.getMapState().subscribe(z=>{console.log({zoom:z.zoom.toString(),center:`${z.center.lat},${z.center.lon}`})});this.subs.push(E)}updateLayer(){let E=this.layerSvc.getLayerOrGroupById("geojson_test");E.data={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[11.771870735772268,47.49013323424285],[11.771870735772268,47.44101685032831],[11.85227430395085,47.44101685032831],[11.85227430395085,47.49013323424285],[11.771870735772268,47.49013323424285]]],type:"Polygon"}}]},this.layerSvc.updateLayer(E)}updateStyleLayer(){let E=this.layerSvc.getLayerOrGroupById("waterway-planet_eoc"),z=E.custom_layer.layers[0];z.paint["fill-color"]="hsl(30, 14%, 53%)",z.type!=="background"&&(z["source-layer"]="landuse"),this.layerSvc.updateLayer(E)}setViewAngle(){this.mapStateSvc.setViewAngle(45)}resetViewAngle(){this.mapStateSvc.setViewAngle(0)}setRotation(){this.mapStateSvc.setRotation(90)}resetRotation(){this.mapStateSvc.setRotation(0)}static{this.\u0275fac=function(z){return new(z||_)(as(Gc),as(Zc),as(ro))}}static{this.\u0275cmp=$c({type:_,selectors:[["app-route-example-maplibre"]],hostVars:2,hostBindings:function(z,w){z&2&&tf(w.class)},features:[sf([Gc,Zc,ro])],decls:34,vars:14,consts:[[1,"content-area","map-view"],[3,"mapState","layersSvc"],[1,"right",3,"clrVerticalNavCollapsible"],[1,"layers",3,"clrVerticalNavGroupExpanded"],["shape","world","title","Overlays","clrVerticalNavIcon",""],[1,"padding","title-ellipsis"],[3,"layersSvc","mapStateSvc","layerfilter"],["shape","layers","clrVerticalNavIcon","","title","layers"],[3,"layersSvc","mapStateSvc"],["shape","world","title","Baselayers","clrVerticalNavIcon",""],["shape","cog","title","Actions","clrVerticalNavIcon",""],[1,"btn","btn-primary",3,"click"]],template:function(z,w){z&1&&(gr(0,"section",0),sa(1,"ukis-map-maplibre",1),na(),gr(2,"clr-vertical-nav",2)(3,"clr-vertical-nav-group",3),sa(4,"cds-icon",4),oa(5," Overlays "),gr(6,"clr-vertical-nav-group-children",5),sa(7,"ukis-layer-control",6),na()(),gr(8,"clr-vertical-nav-group",3),sa(9,"cds-icon",7),oa(10," Layers "),gr(11,"clr-vertical-nav-group-children",5),sa(12,"ukis-layer-control",8),na()(),gr(13,"clr-vertical-nav-group",3),sa(14,"cds-icon",9),oa(15," Baselayers "),gr(16,"clr-vertical-nav-group-children",5),sa(17,"ukis-base-layer-control",8),na()(),gr(18,"clr-vertical-nav-group",3),sa(19,"cds-icon",10),oa(20," Actions "),gr(21,"clr-vertical-nav-group-children",5)(22,"button",11),ns("click",function(){return w.updateLayer()}),oa(23,"update Geojson Layer"),na(),gr(24,"button",11),ns("click",function(){return w.updateStyleLayer()}),oa(25,"update Layer water to landuse"),na(),gr(26,"button",11),ns("click",function(){return w.setViewAngle()}),oa(27,"set ViewAngle"),na(),gr(28,"button",11),ns("click",function(){return w.resetViewAngle()}),oa(29,"reset ViewAngle"),na(),gr(30,"button",11),ns("click",function(){return w.setRotation()}),oa(31,"set Rotation"),na(),gr(32,"button",11),ns("click",function(){return w.resetRotation()}),oa(33,"reset Rotation"),na()()()()),z&2&&(xa(),ba("mapState",w.mapStateSvc)("layersSvc",w.layerSvc),xa(),ba("clrVerticalNavCollapsible",!0),xa(),ba("clrVerticalNavGroupExpanded",!0),xa(4),ba("layersSvc",w.layerSvc)("mapStateSvc",w.mapStateSvc)("layerfilter","Overlays"),xa(),ba("clrVerticalNavGroupExpanded",!0),xa(4),ba("layersSvc",w.layerSvc)("mapStateSvc",w.mapStateSvc),xa(),ba("clrVerticalNavGroupExpanded",!0),xa(4),ba("layersSvc",w.layerSvc)("mapStateSvc",w.mapStateSvc),xa(),ba("clrVerticalNavGroupExpanded",!0))},dependencies:[jm,_f,ff,mf,gf,yf,pf,df,Df,If],styles:[`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}
`],encapsulation:2})}}return _})();var I1=[{path:"",component:up}],k1=(()=>{class _{static{this.\u0275fac=function(z){return new(z||_)}}static{this.\u0275mod=Eh({type:_})}static{this.\u0275inj=Ah({imports:[Th.forChild(I1),Th]})}}return _})(),r_=(()=>{class _{static{this.\u0275fac=function(z){return new(z||_)}}static{this.\u0275mod=Eh({type:_})}static{this.\u0275inj=Ah({imports:[of,k1,vf,up]})}}return _})();export{r_ as RouteExampleMaplibreModule,k1 as RouteExampleMaplibreRoutingModule};
